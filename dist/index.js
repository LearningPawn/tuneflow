"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var Zn="1.13.2",Dn=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},Xt=Array.prototype,Ne=Object.prototype,Vn=typeof Symbol<"u"?Symbol.prototype:null,_s=Xt.push,Pt=Xt.slice,kt=Ne.toString,Ms=Ne.hasOwnProperty,jn=typeof ArrayBuffer<"u",Os=typeof DataView<"u",Us=Array.isArray,Rn=Object.keys,Ln=Object.create,$n=jn&&ArrayBuffer.isView,Fs=isNaN,Bs=isFinite,tr=!{toString:null}.propertyIsEnumerable("toString"),qn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Ds=Math.pow(2,53)-1;function M(e,t){return t=t==null?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var s=Array(t+1);for(i=0;i<t;i++)s[i]=arguments[i];return s[t]=r,e.apply(this,s)}}function j(e){var t=typeof e;return t==="function"||t==="object"&&!!e}function Vs(e){return e===null}function er(e){return e===void 0}function nr(e){return e===!0||e===!1||kt.call(e)==="[object Boolean]"}function Rs(e){return!!(e&&e.nodeType===1)}function P(e){var t="[object "+e+"]";return function(n){return kt.call(n)===t}}const _e=P("String"),rr=P("Number"),Ls=P("Date"),$s=P("RegExp"),qs=P("Error"),ir=P("Symbol"),sr=P("ArrayBuffer");var ar=P("Function"),Hs=Dn.document&&Dn.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof Hs!="function"&&(ar=function(e){return typeof e=="function"||!1});const E=ar,or=P("Object");var ur=Os&&or(new DataView(new ArrayBuffer(8))),Me=typeof Map<"u"&&or(new Map),Gs=P("DataView");function Js(e){return e!=null&&E(e.getInt8)&&sr(e.buffer)}const Jt=ur?Js:Gs,tt=Us||P("Array");function K(e,t){return e!=null&&Ms.call(e,t)}var be=P("Arguments");(function(){be(arguments)||(be=function(e){return K(e,"callee")})})();const Oe=be;function zs(e){return!ir(e)&&Bs(e)&&!isNaN(parseFloat(e))}function cr(e){return rr(e)&&Fs(e)}function lr(e){return function(){return e}}function hr(e){return function(t){var n=e(t);return typeof n=="number"&&n>=0&&n<=Ds}}function fr(e){return function(t){return t?.[e]}}const zt=fr("byteLength"),Ks=hr(zt);var Qs=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function Ws(e){return $n?$n(e)&&!Jt(e):Ks(e)&&Qs.test(kt.call(e))}const pr=jn?Ws:lr(!1),O=fr("length");function Xs(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(i){return t[i]===!0},push:function(i){return t[i]=!0,e.push(i)}}}function gr(e,t){t=Xs(t);var n=qn.length,r=e.constructor,i=E(r)&&r.prototype||Ne,s="constructor";for(K(e,s)&&!t.contains(s)&&t.push(s);n--;)s=qn[n],s in e&&e[s]!==i[s]&&!t.contains(s)&&t.push(s)}function k(e){if(!j(e))return[];if(Rn)return Rn(e);var t=[];for(var n in e)K(e,n)&&t.push(n);return tr&&gr(e,t),t}function Ys(e){if(e==null)return!0;var t=O(e);return typeof t=="number"&&(tt(e)||_e(e)||Oe(e))?t===0:O(k(e))===0}function dr(e,t){var n=k(t),r=n.length;if(e==null)return!r;for(var i=Object(e),s=0;s<r;s++){var a=n[s];if(t[a]!==i[a]||!(a in i))return!1}return!0}function I(e){if(e instanceof I)return e;if(!(this instanceof I))return new I(e);this._wrapped=e}I.VERSION=Zn;I.prototype.value=function(){return this._wrapped};I.prototype.valueOf=I.prototype.toJSON=I.prototype.value;I.prototype.toString=function(){return String(this._wrapped)};function Hn(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,zt(e))}var Gn="[object DataView]";function we(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return!1;if(e!==e)return t!==t;var i=typeof e;return i!=="function"&&i!=="object"&&typeof t!="object"?!1:mr(e,t,n,r)}function mr(e,t,n,r){e instanceof I&&(e=e._wrapped),t instanceof I&&(t=t._wrapped);var i=kt.call(e);if(i!==kt.call(t))return!1;if(ur&&i=="[object Object]"&&Jt(e)){if(!Jt(t))return!1;i=Gn}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:+e==0?1/+e===1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return Vn.valueOf.call(e)===Vn.valueOf.call(t);case"[object ArrayBuffer]":case Gn:return mr(Hn(e),Hn(t),n,r)}var s=i==="[object Array]";if(!s&&pr(e)){var a=zt(e);if(a!==zt(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if(typeof e!="object"||typeof t!="object")return!1;var u=e.constructor,l=t.constructor;if(u!==l&&!(E(u)&&u instanceof u&&E(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var c=n.length;c--;)if(n[c]===e)return r[c]===t;if(n.push(e),r.push(t),s){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!we(e[c],t[c],n,r))return!1}else{var p=k(e),m;if(c=p.length,k(t).length!==c)return!1;for(;c--;)if(m=p[c],!(K(t,m)&&we(e[m],t[m],n,r)))return!1}return n.pop(),r.pop(),!0}function Zs(e,t){return we(e,t)}function Ct(e){if(!j(e))return[];var t=[];for(var n in e)t.push(n);return tr&&gr(e,t),t}function Ue(e){var t=O(e);return function(n){if(n==null)return!1;var r=Ct(n);if(O(r))return!1;for(var i=0;i<t;i++)if(!E(n[e[i]]))return!1;return e!==Tr||!E(n[Fe])}}var Fe="forEach",Ir="has",Be=["clear","delete"],vr=["get",Ir,"set"],js=Be.concat(Fe,vr),Tr=Be.concat(vr),ta=["add"].concat(Be,Fe,Ir);const ea=Me?Ue(js):P("Map"),na=Me?Ue(Tr):P("WeakMap"),ra=Me?Ue(ta):P("Set"),ia=P("WeakSet");function pt(e){for(var t=k(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function sa(e){for(var t=k(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r}function yr(e){for(var t={},n=k(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function xe(e){var t=[];for(var n in e)E(e[n])&&t.push(n);return t.sort()}function De(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||n==null)return n;for(var i=1;i<r;i++)for(var s=arguments[i],a=e(s),u=a.length,l=0;l<u;l++){var c=a[l];(!t||n[c]===void 0)&&(n[c]=s[c])}return n}}const kr=De(Ct),Kt=De(k),br=De(Ct,!0);function aa(){return function(){}}function wr(e){if(!j(e))return{};if(Ln)return Ln(e);var t=aa();t.prototype=e;var n=new t;return t.prototype=null,n}function oa(e,t){var n=wr(e);return t&&Kt(n,t),n}function ua(e){return j(e)?tt(e)?e.slice():kr({},e):e}function ca(e,t){return t(e),e}function xr(e){return tt(e)?e:[e]}I.toPath=xr;function At(e){return I.toPath(e)}function Ve(e,t){for(var n=t.length,r=0;r<n;r++){if(e==null)return;e=e[t[r]]}return n?e:void 0}function Sr(e,t,n){var r=Ve(e,At(t));return er(r)?n:r}function la(e,t){t=At(t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(!K(e,i))return!1;e=e[i]}return!!n}function Re(e){return e}function bt(e){return e=Kt({},e),function(t){return dr(t,e)}}function Le(e){return e=At(e),function(t){return Ve(t,e)}}function Et(e,t,n){if(t===void 0)return e;switch(n??3){case 1:return function(r){return e.call(t,r)};case 3:return function(r,i,s){return e.call(t,r,i,s)};case 4:return function(r,i,s,a){return e.call(t,r,i,s,a)}}return function(){return e.apply(t,arguments)}}function Pr(e,t,n){return e==null?Re:E(e)?Et(e,t,n):j(e)&&!tt(e)?bt(e):Le(e)}function $e(e,t){return Pr(e,t,1/0)}I.iteratee=$e;function U(e,t,n){return I.iteratee!==$e?I.iteratee(e,t):Pr(e,t,n)}function ha(e,t,n){t=U(t,n);for(var r=k(e),i=r.length,s={},a=0;a<i;a++){var u=r[a];s[u]=t(e[u],u,e)}return s}function Cr(){}function fa(e){return e==null?Cr:function(t){return Sr(e,t)}}function pa(e,t,n){var r=Array(Math.max(0,e));t=Et(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r}function Se(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}const wt=Date.now||function(){return new Date().getTime()};function Ar(e){var t=function(s){return e[s]},n="(?:"+k(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(s){return s=s==null?"":""+s,r.test(s)?s.replace(i,t):s}}const Er={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ga=Ar(Er),da=yr(Er),ma=Ar(da),Ia=I.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var de=/(.)^/,va={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ta=/\\|'|\r|\n|\u2028|\u2029/g;function ya(e){return"\\"+va[e]}var ka=/^\s*(\w|\$)+\s*$/;function ba(e,t,n){!t&&n&&(t=n),t=br({},t,I.templateSettings);var r=RegExp([(t.escape||de).source,(t.interpolate||de).source,(t.evaluate||de).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(c,p,m,g,T){return s+=e.slice(i,T).replace(Ta,ya),i=T+c.length,p?s+=`'+
((__t=(`+p+`))==null?'':_.escape(__t))+
'`:m?s+=`'+
((__t=(`+m+`))==null?'':__t)+
'`:g&&(s+=`';
`+g+`
__p+='`),c}),s+=`';
`;var a=t.variable;if(a){if(!ka.test(a))throw new Error("variable is not a bare identifier: "+a)}else s=`with(obj||{}){
`+s+`}
`,a="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var u;try{u=new Function(a,"_",s)}catch(c){throw c.source=s,c}var l=function(c){return u.call(this,c,I)};return l.source="function("+a+`){
`+s+"}",l}function wa(e,t,n){t=At(t);var r=t.length;if(!r)return E(n)?n.call(e):n;for(var i=0;i<r;i++){var s=e?.[t[i]];s===void 0&&(s=n,i=r),e=E(s)?s.call(e):s}return e}var xa=0;function Sa(e){var t=++xa+"";return e?e+t:t}function Pa(e){var t=I(e);return t._chain=!0,t}function Nr(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var s=wr(e.prototype),a=e.apply(s,i);return j(a)?a:s}var gt=M(function(e,t){var n=gt.placeholder,r=function(){for(var i=0,s=t.length,a=Array(s),u=0;u<s;u++)a[u]=t[u]===n?arguments[i++]:t[u];for(;i<arguments.length;)a.push(arguments[i++]);return Nr(e,r,this,this,a)};return r});gt.placeholder=I;const _r=M(function(e,t,n){if(!E(e))throw new TypeError("Bind must be called on a function");var r=M(function(i){return Nr(e,r,t,this,n.concat(i))});return r}),D=hr(O);function et(e,t,n,r){if(r=r||[],!t&&t!==0)t=1/0;else if(t<=0)return r.concat(e);for(var i=r.length,s=0,a=O(e);s<a;s++){var u=e[s];if(D(u)&&(tt(u)||Oe(u)))if(t>1)et(u,t-1,n,r),i=r.length;else for(var l=0,c=u.length;l<c;)r[i++]=u[l++];else n||(r[i++]=u)}return r}const Ca=M(function(e,t){t=et(t,!1,!1);var n=t.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=_r(e[r],e)}return e});function Aa(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return K(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n}const Mr=M(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),Ea=gt(Mr,I,1);function Na(e,t,n){var r,i,s,a,u=0;n||(n={});var l=function(){u=n.leading===!1?0:wt(),r=null,a=e.apply(i,s),r||(i=s=null)},c=function(){var p=wt();!u&&n.leading===!1&&(u=p);var m=t-(p-u);return i=this,s=arguments,m<=0||m>t?(r&&(clearTimeout(r),r=null),u=p,a=e.apply(i,s),r||(i=s=null)):!r&&n.trailing!==!1&&(r=setTimeout(l,m)),a};return c.cancel=function(){clearTimeout(r),u=0,r=i=s=null},c}function _a(e,t,n){var r,i,s,a,u,l=function(){var p=wt()-i;t>p?r=setTimeout(l,t-p):(r=null,n||(a=e.apply(u,s)),r||(s=u=null))},c=M(function(p){return u=this,s=p,i=wt(),r||(r=setTimeout(l,t),n&&(a=e.apply(u,s))),a});return c.cancel=function(){clearTimeout(r),r=s=u=null},c}function Ma(e,t){return gt(t,e)}function qe(e){return function(){return!e.apply(this,arguments)}}function Oa(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}function Ua(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Or(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}const Fa=gt(Or,2);function Ur(e,t,n){t=U(t,n);for(var r=k(e),i,s=0,a=r.length;s<a;s++)if(i=r[s],t(e[i],i,e))return i}function Fr(e){return function(t,n,r){n=U(n,r);for(var i=O(t),s=e>0?0:i-1;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}const ct=Fr(1),Br=Fr(-1);function Dr(e,t,n,r){n=U(n,r,1);for(var i=n(t),s=0,a=O(e);s<a;){var u=Math.floor((s+a)/2);n(e[u])<i?s=u+1:a=u}return s}function Vr(e,t,n){return function(r,i,s){var a=0,u=O(r);if(typeof s=="number")e>0?a=s>=0?s:Math.max(s+u,a):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(Pt.call(r,a,u),cr),s>=0?s+a:-1;for(s=e>0?a:u-1;s>=0&&s<u;s+=e)if(r[s]===i)return s;return-1}}const Rr=Vr(1,ct,Dr),Ba=Vr(-1,Br);function Qt(e,t,n){var r=D(e)?ct:Ur,i=r(e,t,n);if(i!==void 0&&i!==-1)return e[i]}function Da(e,t){return Qt(e,bt(t))}function J(e,t,n){t=Et(t,n);var r,i;if(D(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=k(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e}function Z(e,t,n){t=U(t,n);for(var r=!D(e)&&k(e),i=(r||e).length,s=Array(i),a=0;a<i;a++){var u=r?r[a]:a;s[a]=t(e[u],u,e)}return s}function Lr(e){var t=function(n,r,i,s){var a=!D(n)&&k(n),u=(a||n).length,l=e>0?0:u-1;for(s||(i=n[a?a[l]:l],l+=e);l>=0&&l<u;l+=e){var c=a?a[l]:l;i=r(i,n[c],c,n)}return i};return function(n,r,i,s){var a=arguments.length>=3;return t(n,Et(r,s,4),i,a)}}const me=Lr(1),Jn=Lr(-1);function lt(e,t,n){var r=[];return t=U(t,n),J(e,function(i,s,a){t(i,s,a)&&r.push(i)}),r}function Va(e,t,n){return lt(e,qe(U(t)),n)}function zn(e,t,n){t=U(t,n);for(var r=!D(e)&&k(e),i=(r||e).length,s=0;s<i;s++){var a=r?r[s]:s;if(!t(e[a],a,e))return!1}return!0}function Kn(e,t,n){t=U(t,n);for(var r=!D(e)&&k(e),i=(r||e).length,s=0;s<i;s++){var a=r?r[s]:s;if(t(e[a],a,e))return!0}return!1}function G(e,t,n,r){return D(e)||(e=pt(e)),(typeof n!="number"||r)&&(n=0),Rr(e,t,n)>=0}const Ra=M(function(e,t,n){var r,i;return E(t)?i=t:(t=At(t),r=t.slice(0,-1),t=t[t.length-1]),Z(e,function(s){var a=i;if(!a){if(r&&r.length&&(s=Ve(s,r)),s==null)return;a=s[t]}return a==null?a:a.apply(s,n)})});function He(e,t){return Z(e,Le(t))}function La(e,t){return lt(e,bt(t))}function $r(e,t,n){var r=-1/0,i=-1/0,s,a;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=D(e)?e:pt(e);for(var u=0,l=e.length;u<l;u++)s=e[u],s!=null&&s>r&&(r=s)}else t=U(t,n),J(e,function(c,p,m){a=t(c,p,m),(a>i||a===-1/0&&r===-1/0)&&(r=c,i=a)});return r}function $a(e,t,n){var r=1/0,i=1/0,s,a;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=D(e)?e:pt(e);for(var u=0,l=e.length;u<l;u++)s=e[u],s!=null&&s<r&&(r=s)}else t=U(t,n),J(e,function(c,p,m){a=t(c,p,m),(a<i||a===1/0&&r===1/0)&&(r=c,i=a)});return r}var qa=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function qr(e){return e?tt(e)?Pt.call(e):_e(e)?e.match(qa):D(e)?Z(e,Re):pt(e):[]}function Hr(e,t,n){if(t==null||n)return D(e)||(e=pt(e)),e[Se(e.length-1)];var r=qr(e),i=O(r);t=Math.max(Math.min(t,i),0);for(var s=i-1,a=0;a<t;a++){var u=Se(a,s),l=r[a];r[a]=r[u],r[u]=l}return r.slice(0,t)}function Ha(e){return Hr(e,1/0)}function Ga(e,t,n){var r=0;return t=U(t,n),He(Z(e,function(i,s,a){return{value:i,index:r++,criteria:t(i,s,a)}}).sort(function(i,s){var a=i.criteria,u=s.criteria;if(a!==u){if(a>u||a===void 0)return 1;if(a<u||u===void 0)return-1}return i.index-s.index}),"value")}function Yt(e,t){return function(n,r,i){var s=t?[[],[]]:{};return r=U(r,i),J(n,function(a,u){var l=r(a,u,n);e(s,a,l)}),s}}const Ja=Yt(function(e,t,n){K(e,n)?e[n].push(t):e[n]=[t]}),za=Yt(function(e,t,n){e[n]=t}),Ka=Yt(function(e,t,n){K(e,n)?e[n]++:e[n]=1}),Qa=Yt(function(e,t,n){e[n?0:1].push(t)},!0);function Wa(e){return e==null?0:D(e)?e.length:k(e).length}function Xa(e,t,n){return t in n}const Gr=M(function(e,t){var n={},r=t[0];if(e==null)return n;E(r)?(t.length>1&&(r=Et(r,t[1])),t=Ct(e)):(r=Xa,t=et(t,!1,!1),e=Object(e));for(var i=0,s=t.length;i<s;i++){var a=t[i],u=e[a];r(u,a,e)&&(n[a]=u)}return n}),Ya=M(function(e,t){var n=t[0],r;return E(n)?(n=qe(n),t.length>1&&(r=t[1])):(t=Z(et(t,!1,!1),String),n=function(i,s){return!G(t,s)}),Gr(e,n,r)});function Jr(e,t,n){return Pt.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))}function Ie(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[0]:Jr(e,e.length-t)}function Gt(e,t,n){return Pt.call(e,t==null||n?1:t)}function Za(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[e.length-1]:Gt(e,Math.max(0,e.length-t))}function ja(e){return lt(e,Boolean)}function to(e,t){return et(e,t,!1)}const zr=M(function(e,t){return t=et(t,!0,!0),lt(e,function(n){return!G(t,n)})}),eo=M(function(e,t){return zr(e,t)});function Pe(e,t,n,r){nr(t)||(r=n,n=t,t=!1),n!=null&&(n=U(n,r));for(var i=[],s=[],a=0,u=O(e);a<u;a++){var l=e[a],c=n?n(l,a,e):l;t&&!n?((!a||s!==c)&&i.push(l),s=c):n?G(s,c)||(s.push(c),i.push(l)):G(i,l)||i.push(l)}return i}const no=M(function(e){return Pe(et(e,!0,!0))});function ro(e){for(var t=[],n=arguments.length,r=0,i=O(e);r<i;r++){var s=e[r];if(!G(t,s)){var a;for(a=1;a<n&&G(arguments[a],s);a++);a===n&&t.push(s)}}return t}function Ce(e){for(var t=e&&$r(e,O).length||0,n=Array(t),r=0;r<t;r++)n[r]=He(e,r);return n}const io=M(Ce);function so(e,t){for(var n={},r=0,i=O(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}function ao(e,t,n){t==null&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;s<r;s++,e+=n)i[s]=e;return i}function oo(e,t){if(t==null||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(Pt.call(e,r,r+=t));return n}function Ge(e,t){return e._chain?I(t).chain():t}function Kr(e){return J(xe(e),function(t){var n=I[t]=e[t];I.prototype[t]=function(){var r=[this._wrapped];return _s.apply(r,arguments),Ge(this,n.apply(I,r))}}),I}J(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=Xt[e];I.prototype[e]=function(){var n=this._wrapped;return n!=null&&(t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0]),Ge(this,n)}});J(["concat","join","slice"],function(e){var t=Xt[e];I.prototype[e]=function(){var n=this._wrapped;return n!=null&&(n=t.apply(n,arguments)),Ge(this,n)}});const uo=Object.freeze(Object.defineProperty({__proto__:null,VERSION:Zn,restArguments:M,isObject:j,isNull:Vs,isUndefined:er,isBoolean:nr,isElement:Rs,isString:_e,isNumber:rr,isDate:Ls,isRegExp:$s,isError:qs,isSymbol:ir,isArrayBuffer:sr,isDataView:Jt,isArray:tt,isFunction:E,isArguments:Oe,isFinite:zs,isNaN:cr,isTypedArray:pr,isEmpty:Ys,isMatch:dr,isEqual:Zs,isMap:ea,isWeakMap:na,isSet:ra,isWeakSet:ia,keys:k,allKeys:Ct,values:pt,pairs:sa,invert:yr,functions:xe,methods:xe,extend:kr,extendOwn:Kt,assign:Kt,defaults:br,create:oa,clone:ua,tap:ca,get:Sr,has:la,mapObject:ha,identity:Re,constant:lr,noop:Cr,toPath:xr,property:Le,propertyOf:fa,matcher:bt,matches:bt,times:pa,random:Se,now:wt,escape:ga,unescape:ma,templateSettings:Ia,template:ba,result:wa,uniqueId:Sa,chain:Pa,iteratee:$e,partial:gt,bind:_r,bindAll:Ca,memoize:Aa,delay:Mr,defer:Ea,throttle:Na,debounce:_a,wrap:Ma,negate:qe,compose:Oa,after:Ua,before:Or,once:Fa,findKey:Ur,findIndex:ct,findLastIndex:Br,sortedIndex:Dr,indexOf:Rr,lastIndexOf:Ba,find:Qt,detect:Qt,findWhere:Da,each:J,forEach:J,map:Z,collect:Z,reduce:me,foldl:me,inject:me,reduceRight:Jn,foldr:Jn,filter:lt,select:lt,reject:Va,every:zn,all:zn,some:Kn,any:Kn,contains:G,includes:G,include:G,invoke:Ra,pluck:He,where:La,max:$r,min:$a,shuffle:Ha,sample:Hr,sortBy:Ga,groupBy:Ja,indexBy:za,countBy:Ka,partition:Qa,toArray:qr,size:Wa,pick:Gr,omit:Ya,first:Ie,head:Ie,take:Ie,initial:Jr,last:Za,rest:Gt,tail:Gt,drop:Gt,compact:ja,flatten:to,without:eo,uniq:Pe,unique:Pe,union:no,intersection:ro,difference:zr,unzip:Ce,transpose:Ce,zip:io,object:so,range:ao,chunk:oo,mixin:Kr,default:I},Symbol.toStringTag,{value:"Module"}));var x=Kr(uo);x._=x;let Zt=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class Je{instanceIdInternal=Je.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;songCacheInternal;progress=null;isExecuting=!1;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,n,r){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,n){return t[n]}hasAllParamsSet(){for(const t of k(this.params())){if(this.params()[t].optional)continue;const n=this.paramsResultInternal[t];if(n==null)return!1;const i=this.params()[t].widget.type;switch(i){case A.Input:case A.Pitch:case A.Slider:case A.TrackSelector:case A.Select:case A.Switch:case A.InputNumber:case A.FileSelector:break;case A.MultiTrackSelector:if(n.length===0)return!1;break;case A.TrackPitchSelector:if(n.track===void 0||n.track===null||n.pitch===void 0||n.pitch===null)return!1;break;case A.InstrumentSelector:if(n.program===void 0||n.program===null||n.isDrum===void 0||n.isDrum===null)return!1;break;case A.MultiSourceAudioSelector:if(n==null||n.audioInfo===void 0||n.audioInfo===null)return!1;break;case A.None:if(n==null)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${i}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setProgress(t){this.progress=t}getProgress(){return this.progress}getIsExecuting(){return this.isExecuting}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of k(this.params())){const n=this.params()[t];this.paramsResultInternal[t]=n.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Zt(10)}}class co{plugins=[];threwErrorInLastRun=!1;maxNumPluginsToKeep=50;originalSong;cloneSongFnInternal;readApisInternal;activePluginIndex=-1;addAsOrReplaceActivePlugin(t){let n;return this.activePluginIndex<=-1?n=0:this.plugins[this.activePluginIndex].isRollbackable?n=this.activePluginIndex+1:n=this.activePluginIndex,this.plugins.length>0&&this.plugins.splice(n,this.plugins.length-n),this.addPluginAt(t,n),this.getPluginIndexByPluginInstanceId(t.instanceId)}getPlugins(){return this.plugins}resetCache(){for(const t of this.plugins)delete t.songCacheInternal}setOriginalSong(t){this.originalSong=t}hasOriginalSong(){return!!this.originalSong}async run(t=0){if(!this.originalSong)return this.threwErrorInLastRun=!0,null;t=Math.max(0,t),this.setActivePluginIndex(t),this.threwErrorInLastRun=!1;const n=this.getIndexOfLatestPluginWithCacheBeforeIndex(t),r=await this.cloneCachedSongAtPluginIndex(n);for(let i=t;i<this.plugins.length;i+=1)delete this.plugins[i].songCacheInternal;for(let i=0;i<this.plugins.length;i+=1)this.plugins[i].isRollbackable=i<=n;for(let i=n>=0?n+1:0;i<this.plugins.length;i+=1){const s=this.plugins[i];if(!s.enabledInternal||!s.hasAllParamsSet())return r;r.setPluginContextInternal(s);try{s.isExecuting=!0,s.setProgress(null),await s.run(r,s.getParamsInternal(),this.readApisInternal),r.clearPluginContextInternal(),s.isExecuting=!1}catch{this.threwErrorInLastRun=!0,r.clearPluginContextInternal(),s.isExecuting=!1;const u=this.getIndexOfLatestPluginWithCacheBeforeIndex(i);return u>=0?await this.cloneSong(this.plugins[u].songCacheInternal):await this.cloneSong(this.originalSong)}s.songCacheInternal=await this.cloneSong(r),s.isRollbackable=!0}return r}restoreCachedPlugin(t){return this.setActivePluginIndex(t),this.cloneCachedSongAtPluginIndex(t)}async cloneSong(t){if(!this.cloneSongFnInternal)throw new Error("Pipeline is not provided with a clone song function.");return this.cloneSongFnInternal(t)}getActivePluginIndex(){return this.activePluginIndex}setActivePluginIndex(t){this.activePluginIndex=t}async cloneCachedSongAtPluginIndex(t){if(t>=0)return await this.cloneSong(this.plugins[t].songCacheInternal);if(!this.originalSong)throw new Error("Original song is not avaiable to clone.");return await this.cloneSong(this.originalSong)}reset(){this.plugins.splice(0,this.plugins.length),this.originalSong=void 0,this.activePluginIndex=-1,this.threwErrorInLastRun=!1}isPluginFunctioning(t){return!!t.songCacheInternal}getPluginIndexByPluginInstanceId(t){return ct(this.plugins,n=>n.instanceId===t)}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getPluginCache(t){return t.songCacheInternal}setMaxNumPluginsToKeep(t){this.maxNumPluginsToKeep=t,this.maintainPluginListSize()}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let n=t-1;n>=0;n-=1)if(this.getPluginCache(this.plugins[n]))return n;return-1}maintainPluginListSize(){for(;this.plugins.length>this.maxNumPluginsToKeep&&this.plugins.length>0;)this.plugins.shift()}addPluginAt(t,n){this.plugins.splice(n,0,t),this.maintainPluginListSize()}}var R=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lo(e,t,n,r,i){for(var s=i+1;r<=i;){var a=r+i>>>1,u=e[a],l=n!==void 0?n(u,t):u-t;l>=0?(s=a,i=a-1):r=a+1}return s}function ho(e,t,n,r,i){for(var s=i+1;r<=i;){var a=r+i>>>1,u=e[a],l=n!==void 0?n(u,t):u-t;l>0?(s=a,i=a-1):r=a+1}return s}function fo(e,t,n,r,i){for(var s=r-1;r<=i;){var a=r+i>>>1,u=e[a],l=n!==void 0?n(u,t):u-t;l<0?(s=a,r=a+1):i=a-1}return s}function po(e,t,n,r,i){for(var s=r-1;r<=i;){var a=r+i>>>1,u=e[a],l=n!==void 0?n(u,t):u-t;l<=0?(s=a,r=a+1):i=a-1}return s}function go(e,t,n,r,i){for(;r<=i;){var s=r+i>>>1,a=e[s],u=n!==void 0?n(a,t):a-t;if(u===0)return s;u<=0?r=s+1:i=s-1}return-1}function It(e,t,n,r,i,s){return typeof n=="function"?s(e,t,n,r===void 0?0:r|0,i===void 0?e.length-1:i|0):s(e,t,void 0,n===void 0?0:n|0,r===void 0?e.length-1:r|0)}var S={ge:function(e,t,n,r,i){return It(e,t,n,r,i,lo)},gt:function(e,t,n,r,i){return It(e,t,n,r,i,ho)},lt:function(e,t,n,r,i){return It(e,t,n,r,i,fo)},le:function(e,t,n,r,i){return It(e,t,n,r,i,po)},eq:function(e,t,n,r,i){return It(e,t,n,r,i,go)}},Ae={exports:{}};(function(e,t){var n=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",a="[object Array]",u="[object Boolean]",l="[object Date]",c="[object Error]",p="[object Function]",m="[object GeneratorFunction]",g="[object Map]",T="[object Number]",y="[object Object]",L="[object Promise]",Ze="[object RegExp]",Ot="[object Set]",je="[object String]",tn="[object Symbol]",re="[object WeakMap]",en="[object ArrayBuffer]",Ut="[object DataView]",nn="[object Float32Array]",rn="[object Float64Array]",sn="[object Int8Array]",an="[object Int16Array]",on="[object Int32Array]",un="[object Uint8Array]",cn="[object Uint8ClampedArray]",ln="[object Uint16Array]",hn="[object Uint32Array]",oi=/[\\^$.*+?()[\]{}|]/g,ui=/\w*$/,ci=/^\[object .+?Constructor\]$/,li=/^(?:0|[1-9]\d*)$/,v={};v[s]=v[a]=v[en]=v[Ut]=v[u]=v[l]=v[nn]=v[rn]=v[sn]=v[an]=v[on]=v[g]=v[T]=v[y]=v[Ze]=v[Ot]=v[je]=v[tn]=v[un]=v[cn]=v[ln]=v[hn]=!0,v[c]=v[p]=v[re]=!1;var hi=typeof R=="object"&&R&&R.Object===Object&&R,fi=typeof self=="object"&&self&&self.Object===Object&&self,$=hi||fi||Function("return this")(),fn=t&&!t.nodeType&&t,pn=fn&&!0&&e&&!e.nodeType&&e,pi=pn&&pn.exports===fn;function gi(o,h){return o.set(h[0],h[1]),o}function di(o,h){return o.add(h),o}function mi(o,h){for(var f=-1,d=o?o.length:0;++f<d&&h(o[f],f,o)!==!1;);return o}function Ii(o,h){for(var f=-1,d=h.length,w=o.length;++f<d;)o[w+f]=h[f];return o}function gn(o,h,f,d){var w=-1,C=o?o.length:0;for(d&&C&&(f=o[++w]);++w<C;)f=h(f,o[w],w,o);return f}function vi(o,h){for(var f=-1,d=Array(o);++f<o;)d[f]=h(f);return d}function Ti(o,h){return o?.[h]}function dn(o){var h=!1;if(o!=null&&typeof o.toString!="function")try{h=!!(o+"")}catch{}return h}function mn(o){var h=-1,f=Array(o.size);return o.forEach(function(d,w){f[++h]=[w,d]}),f}function ie(o,h){return function(f){return o(h(f))}}function In(o){var h=-1,f=Array(o.size);return o.forEach(function(d){f[++h]=d}),f}var yi=Array.prototype,ki=Function.prototype,Ft=Object.prototype,se=$["__core-js_shared__"],vn=function(){var o=/[^.]+$/.exec(se&&se.keys&&se.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Tn=ki.toString,z=Ft.hasOwnProperty,Bt=Ft.toString,bi=RegExp("^"+Tn.call(z).replace(oi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yn=pi?$.Buffer:void 0,kn=$.Symbol,bn=$.Uint8Array,wi=ie(Object.getPrototypeOf,Object),xi=Object.create,Si=Ft.propertyIsEnumerable,Pi=yi.splice,wn=Object.getOwnPropertySymbols,Ci=yn?yn.isBuffer:void 0,Ai=ie(Object.keys,Object),ae=it($,"DataView"),dt=it($,"Map"),oe=it($,"Promise"),ue=it($,"Set"),ce=it($,"WeakMap"),mt=it(Object,"create"),Ei=X(ae),Ni=X(dt),_i=X(oe),Mi=X(ue),Oi=X(ce),xn=kn?kn.prototype:void 0,Sn=xn?xn.valueOf:void 0;function Q(o){var h=-1,f=o?o.length:0;for(this.clear();++h<f;){var d=o[h];this.set(d[0],d[1])}}function Ui(){this.__data__=mt?mt(null):{}}function Fi(o){return this.has(o)&&delete this.__data__[o]}function Bi(o){var h=this.__data__;if(mt){var f=h[o];return f===r?void 0:f}return z.call(h,o)?h[o]:void 0}function Di(o){var h=this.__data__;return mt?h[o]!==void 0:z.call(h,o)}function Vi(o,h){var f=this.__data__;return f[o]=mt&&h===void 0?r:h,this}Q.prototype.clear=Ui,Q.prototype.delete=Fi,Q.prototype.get=Bi,Q.prototype.has=Di,Q.prototype.set=Vi;function q(o){var h=-1,f=o?o.length:0;for(this.clear();++h<f;){var d=o[h];this.set(d[0],d[1])}}function Ri(){this.__data__=[]}function Li(o){var h=this.__data__,f=Dt(h,o);if(f<0)return!1;var d=h.length-1;return f==d?h.pop():Pi.call(h,f,1),!0}function $i(o){var h=this.__data__,f=Dt(h,o);return f<0?void 0:h[f][1]}function qi(o){return Dt(this.__data__,o)>-1}function Hi(o,h){var f=this.__data__,d=Dt(f,o);return d<0?f.push([o,h]):f[d][1]=h,this}q.prototype.clear=Ri,q.prototype.delete=Li,q.prototype.get=$i,q.prototype.has=qi,q.prototype.set=Hi;function nt(o){var h=-1,f=o?o.length:0;for(this.clear();++h<f;){var d=o[h];this.set(d[0],d[1])}}function Gi(){this.__data__={hash:new Q,map:new(dt||q),string:new Q}}function Ji(o){return Vt(this,o).delete(o)}function zi(o){return Vt(this,o).get(o)}function Ki(o){return Vt(this,o).has(o)}function Qi(o,h){return Vt(this,o).set(o,h),this}nt.prototype.clear=Gi,nt.prototype.delete=Ji,nt.prototype.get=zi,nt.prototype.has=Ki,nt.prototype.set=Qi;function rt(o){this.__data__=new q(o)}function Wi(){this.__data__=new q}function Xi(o){return this.__data__.delete(o)}function Yi(o){return this.__data__.get(o)}function Zi(o){return this.__data__.has(o)}function ji(o,h){var f=this.__data__;if(f instanceof q){var d=f.__data__;if(!dt||d.length<n-1)return d.push([o,h]),this;f=this.__data__=new nt(d)}return f.set(o,h),this}rt.prototype.clear=Wi,rt.prototype.delete=Xi,rt.prototype.get=Yi,rt.prototype.has=Zi,rt.prototype.set=ji;function ts(o,h){var f=fe(o)||xs(o)?vi(o.length,String):[],d=f.length,w=!!d;for(var C in o)(h||z.call(o,C))&&!(w&&(C=="length"||ys(C,d)))&&f.push(C);return f}function Pn(o,h,f){var d=o[h];(!(z.call(o,h)&&Nn(d,f))||f===void 0&&!(h in o))&&(o[h]=f)}function Dt(o,h){for(var f=o.length;f--;)if(Nn(o[f][0],h))return f;return-1}function es(o,h){return o&&Cn(h,pe(h),o)}function le(o,h,f,d,w,C,V){var _;if(d&&(_=C?d(o,w,C,V):d(o)),_!==void 0)return _;if(!Rt(o))return o;var On=fe(o);if(On){if(_=Is(o),!h)return gs(o,_)}else{var st=W(o),Un=st==p||st==m;if(Ps(o))return os(o,h);if(st==y||st==s||Un&&!C){if(dn(o))return C?o:{};if(_=vs(Un?{}:o),!h)return ds(o,es(_,o))}else{if(!v[st])return C?o:{};_=Ts(o,st,le,h)}}V||(V=new rt);var Fn=V.get(o);if(Fn)return Fn;if(V.set(o,_),!On)var Bn=f?ms(o):pe(o);return mi(Bn||o,function(ge,Lt){Bn&&(Lt=ge,ge=o[Lt]),Pn(_,Lt,le(ge,h,f,d,Lt,o,V))}),_}function ns(o){return Rt(o)?xi(o):{}}function rs(o,h,f){var d=h(o);return fe(o)?d:Ii(d,f(o))}function is(o){return Bt.call(o)}function ss(o){if(!Rt(o)||bs(o))return!1;var h=Mn(o)||dn(o)?bi:ci;return h.test(X(o))}function as(o){if(!En(o))return Ai(o);var h=[];for(var f in Object(o))z.call(o,f)&&f!="constructor"&&h.push(f);return h}function os(o,h){if(h)return o.slice();var f=new o.constructor(o.length);return o.copy(f),f}function he(o){var h=new o.constructor(o.byteLength);return new bn(h).set(new bn(o)),h}function us(o,h){var f=h?he(o.buffer):o.buffer;return new o.constructor(f,o.byteOffset,o.byteLength)}function cs(o,h,f){var d=h?f(mn(o),!0):mn(o);return gn(d,gi,new o.constructor)}function ls(o){var h=new o.constructor(o.source,ui.exec(o));return h.lastIndex=o.lastIndex,h}function hs(o,h,f){var d=h?f(In(o),!0):In(o);return gn(d,di,new o.constructor)}function fs(o){return Sn?Object(Sn.call(o)):{}}function ps(o,h){var f=h?he(o.buffer):o.buffer;return new o.constructor(f,o.byteOffset,o.length)}function gs(o,h){var f=-1,d=o.length;for(h||(h=Array(d));++f<d;)h[f]=o[f];return h}function Cn(o,h,f,d){f||(f={});for(var w=-1,C=h.length;++w<C;){var V=h[w],_=d?d(f[V],o[V],V,f,o):void 0;Pn(f,V,_===void 0?o[V]:_)}return f}function ds(o,h){return Cn(o,An(o),h)}function ms(o){return rs(o,pe,An)}function Vt(o,h){var f=o.__data__;return ks(h)?f[typeof h=="string"?"string":"hash"]:f.map}function it(o,h){var f=Ti(o,h);return ss(f)?f:void 0}var An=wn?ie(wn,Object):Es,W=is;(ae&&W(new ae(new ArrayBuffer(1)))!=Ut||dt&&W(new dt)!=g||oe&&W(oe.resolve())!=L||ue&&W(new ue)!=Ot||ce&&W(new ce)!=re)&&(W=function(o){var h=Bt.call(o),f=h==y?o.constructor:void 0,d=f?X(f):void 0;if(d)switch(d){case Ei:return Ut;case Ni:return g;case _i:return L;case Mi:return Ot;case Oi:return re}return h});function Is(o){var h=o.length,f=o.constructor(h);return h&&typeof o[0]=="string"&&z.call(o,"index")&&(f.index=o.index,f.input=o.input),f}function vs(o){return typeof o.constructor=="function"&&!En(o)?ns(wi(o)):{}}function Ts(o,h,f,d){var w=o.constructor;switch(h){case en:return he(o);case u:case l:return new w(+o);case Ut:return us(o,d);case nn:case rn:case sn:case an:case on:case un:case cn:case ln:case hn:return ps(o,d);case g:return cs(o,d,f);case T:case je:return new w(o);case Ze:return ls(o);case Ot:return hs(o,d,f);case tn:return fs(o)}}function ys(o,h){return h=h??i,!!h&&(typeof o=="number"||li.test(o))&&o>-1&&o%1==0&&o<h}function ks(o){var h=typeof o;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?o!=="__proto__":o===null}function bs(o){return!!vn&&vn in o}function En(o){var h=o&&o.constructor,f=typeof h=="function"&&h.prototype||Ft;return o===f}function X(o){if(o!=null){try{return Tn.call(o)}catch{}try{return o+""}catch{}}return""}function ws(o){return le(o,!0,!0)}function Nn(o,h){return o===h||o!==o&&h!==h}function xs(o){return Ss(o)&&z.call(o,"callee")&&(!Si.call(o,"callee")||Bt.call(o)==s)}var fe=Array.isArray;function _n(o){return o!=null&&Cs(o.length)&&!Mn(o)}function Ss(o){return As(o)&&_n(o)}var Ps=Ci||Ns;function Mn(o){var h=Rt(o)?Bt.call(o):"";return h==p||h==m}function Cs(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=i}function Rt(o){var h=typeof o;return!!o&&(h=="object"||h=="function")}function As(o){return!!o&&typeof o=="object"}function pe(o){return _n(o)?ts(o):as(o)}function Es(){return[]}function Ns(){return!1}e.exports=ws})(Ae,Ae.exports);const Qn=Ae.exports;class vt{ticks;bpm;time;constructor({ticks:t,bpm:n,time:r}){this.ticks=t,this.bpm=n,this.time=r}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class Ee{ticks;numerator;denominator;constructor({ticks:t,numerator:n,denominator:r}){this.ticks=t,this.numerator=n,this.denominator=r}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}function mo(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function Io(e){const t=Math.floor(e/12)-2;return mo(e)+t.toString()}const vo=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,To={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function yo(e){const t=vo.exec(e);if(!t)return-1;const n=t[1],r=t[2];return To[n.toLowerCase()]+(parseInt(r,10)+1)*12}function Qr(e,t,n,r){return`${e} // ${t} // ${n} // ${r}`}function Wr(e,t,n){return`${e} // ${t} // ${n}`}function ko(e){const t=xt(e);return Wr(t.manufacturerName,t.pluginFormatName,t.name)}function xt(e){const t=e.split(" // ");if(t.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:t[2],manufacturerName:t[0],pluginFormatName:t[1],pluginVersion:t[3]}}function Xr(e,t){return e===t}function Yr(e,t){const n=xt(e),r=xt(t);if(x.keys(n).length!==x.keys(r).length)return!1;for(const i of x.keys(n))if(i!=="pluginVersion"&&n[i]!==r[i])return!1;return!0}class bo{tempoInfos=[];currentTempoIndex=0;ticksPerSecondAtTempoTick={};constructor(t,n){for(const r of t)this.tempoInfos.push({ticks:r.getTicks(),time:r.getTime()}),this.ticksPerSecondAtTempoTick[r.getTicks()]=r.getBpm()*n/60}secondsToTick(t){let n=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].time<=t;)this.currentTempoIndex+=1,n=this.tempoInfos[this.currentTempoIndex];for(;n.time>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,n=this.tempoInfos[this.currentTempoIndex];n.time>t&&(n=this.tempoInfos[0]);const r=t-n.time,i=this.ticksPerSecondAtTempoTick[n.ticks];return Math.round(n.ticks+r*i)}tickToSeconds(t){let n=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].ticks<=t;)this.currentTempoIndex+=1,n=this.tempoInfos[this.currentTempoIndex];for(;n.ticks>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,n=this.tempoInfos[this.currentTempoIndex];n.ticks>t&&(n=this.tempoInfos[0]);const r=t-n.ticks,i=this.ticksPerSecondAtTempoTick[n.ticks];return n.time+r/i}}function Zr(e){return e>-100?Math.exp((e-6)*(1/20)):0}function wo(e){return e<=0?-100:20*Math.log10(e)}function xo(e){return e>0?20*Math.log(e)+6:-100}function So(e){return e>0?Math.pow(10,(20*Math.log(e)+6)*(1/20)):0}function Po(e){return e>0?Math.exp((20*Math.log10(e)-6)*(1/20)):0}function Co(e,t,n,r,i){return(e-t)/(n-t)*(i-r)+r}function Ao(e){return 440*Math.pow(2,(e-69)/12)}class ht{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,n,r,i){this.name=t,this.manufacturerName=n,this.pluginFormatName=r,this.pluginVersion=i,this.localInstanceIdInternal=ht.generateAudioPluginInstanceIdInternal()}getTuneflowId(){return Qr(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const n=t.createAudioPlugin(this.getTuneflowId());return n.setIsEnabled(this.isEnabled),n}matchesTfId(t){return Xr(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return Yr(t,this.getTuneflowId())}getInstanceId(){return this.localInstanceIdInternal}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}setBase64States(t){this.base64StatesInternal=t}getBase64States(){return this.base64StatesInternal}static generateAudioPluginInstanceIdInternal(){return Zt(10)}static DEFAULT_SYNTH=new ht("Synth","TuneFlow","internal","1.0")}class H{pitch;velocity;startTick;endTick;idInternal;clipInternal;constructor({pitch:t,velocity:n,startTick:r,endTick:i,id:s,clip:a}){this.pitch=t,this.velocity=n,this.startTick=r,this.endTick=i,this.idInternal=s,this.clipInternal=a}getPitch(){return this.pitch}setPitch(t){if(!H.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=Math.max(Math.min(t,127),0)}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}deleteFromParent(){!this.clipInternal||this.clipInternal.deleteNote(this)}moveNote(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick=Math.max(0,this.startTick+t),this.endTick=this.endTick+t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeft(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick+=t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeftTo(t){this.adjustLeft(t-this.startTick)}adjustRight(t){this.endTick+=t,this.isRangeValid()||this.deleteFromParent()}adjustRightTo(t){this.adjustRight(t-this.endTick)}isRangeValid(){return H.isNoteRangeValid(this.startTick,this.endTick)}static isValidPitch(t){return t>=0&&t<=127&&Number.isInteger(t)}static isNoteRangeValid(t,n){return n>=0&&t<=n&&Number.isInteger(t)&&Number.isInteger(n)}static isNoteVelocityValid(t){return t>=0&&t<=127&&Number.isInteger(t)}getClip(){return this.clipInternal}adjustPitch(t){this.pitch=this.pitch+t,H.isValidPitch(this.pitch)||this.deleteFromParent()}getId(){return this.idInternal}}var ot=(e=>(e[e.MIDI_CLIP=1]="MIDI_CLIP",e[e.AUDIO_CLIP=2]="AUDIO_CLIP",e))(ot||{});class B{song;track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;type;audioClipData;constructor({song:t,type:n,clipStartTick:r,id:i=B.generateClipIdInternal(),track:s=void 0,clipEndTick:a=void 0,audioClipData:u=void 0}){if(this.song=t,this.track=s,this.id=i,this.type=n,this.notes=[],n===2){if(!u)throw new Error("Audio clip data must be provided for audio clips.");this.audioClipData={audioFilePath:u.audioFilePath,startTick:u.startTick,duration:u.duration},r=x.isNumber(r)?Math.max(r,u.startTick):u.startTick;const l=this.getAudioEndTick();(!x.isNumber(a)||l<a)&&(a=l),this.clipStartTick=r,this.clipEndTick=a}else if(n===1){if(this.clipStartTick=r,!x.isNumber(a))throw new Error("clip end tick must be provided when creating MIDI clip.");this.clipEndTick=a}}getId(){return this.id}getType(){return this.type}getAudioClipData(){return this.audioClipData}setAudioFile(t,n,r){this.audioClipData?(this.audioClipData.audioFilePath=t,this.audioClipData.startTick=n,this.audioClipData.duration=r):this.audioClipData={audioFilePath:t,startTick:n,duration:r}}getNotes(){return B.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getDuration(){return this.song.tickToSeconds(this.clipEndTick)-this.song.tickToSeconds(this.clipStartTick)}getAudioDuration(){if(!(this.type!==2||!this.audioClipData))return this.audioClipData.duration}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:n,startTick:r,endTick:i,updateClipRange:s=!0,resolveClipConflict:a=!0}){if(this.type!==1||!H.isValidPitch(t)||!H.isNoteRangeValid(r,i)||!H.isNoteVelocityValid(n))return null;const u=new H({pitch:t,velocity:n,startTick:r,endTick:i,id:this.getNextNoteIdInternal()});return r<this.clipStartTick&&s&&this.adjustClipLeft(r,a),i>this.clipEndTick&&s&&this.adjustClipRight(i,a),this.orderedInsertNote(this.notes,u),u}getNoteIndexInternal(t){const n=S.lt(this.notes,t,(r,i)=>r.getStartTick()-i.getStartTick());for(let r=Math.max(0,n);r<this.notes.length;r+=1){const i=this.notes[r];if(i&&i===t)return r;if(i&&i.getStartTick()>t.getStartTick())break}return-1}deleteNote(t){const n=this.getNoteIndexInternal(t);n>=0&&this.deleteNoteAt(n)}deleteNoteAt(t){const n=this.notes[t];n&&(n.clipInternal=null,this.notes.splice(t,1))}orderedInsertNote(t,n){if(this.type!==1||n.getClip()===this)return;const r=S.ge(t,n,(i,s)=>i.getStartTick()-s.getStartTick());r<0?t.push(n):t.splice(r,0,n),n.clipInternal=this}adjustClipLeft(t,n=!0){t=Math.max(0,t),this.type===2&&this.audioClipData&&(t=Math.max(t,this.audioClipData.startTick)),t>this.clipEndTick?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,n=!0){if(this.type===2){const r=this.getAudioEndTick();x.isNumber(r)&&(t=Math.min(t,r))}t<this.clipStartTick||t<0?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t,n){const r=Math.max(0,this.clipStartTick+t),i=this.clipEndTick+t;if(i<0){this.deleteFromParent(!0);return}if(this.track&&this.track.resolveClipConflictInternal(this.getId(),r,i),this.track){const u=this.track.getClipIndex(this);this.track.deleteClipAt(u,!1)}const s=this.clipStartTick,a=this.clipEndTick;if(this.type===1){this.clipStartTick=r,this.clipEndTick=i;for(const u of this.notes)u.setStartTick(u.getStartTick()+t),u.setEndTick(u.getEndTick()+t)}else if(this.type===2){if(!this.audioClipData)throw new Error("Cannot move audio clip without audio data");const u=this.song,l=u.tickToSeconds(this.audioClipData.startTick),c=u.tickToSeconds(s),m=u.tickToSeconds(a)-c,g=c-l,T=u.tickToSeconds(this.clipStartTick+t),y=T-g,L=T+m;if(this.clipStartTick=r,this.clipEndTick=u.secondsToTick(L),this.audioClipData.startTick=u.secondsToTick(y),this.clipEndTick<0){this.deleteFromParent(!0);return}}this.track&&(this.track.orderedInsertClipInternal(this),n&&this.track.getAutomation().moveAllPointsWithinRange(s,a,t,0))}moveClipTo(t,n){const r=t-this.getClipStartTick();this.moveClip(r,n)}deleteFromParent(t){this.track&&(this.track.deleteClip(this,t),this.track=void 0)}getNotesByIds(t){const n=new Set(t),r=[];for(const i of this.notes)n.has(i.getId())&&r.push(i);return r}getAudioEndTick(){if(this.type!==2||!this.audioClipData)return;const t=this.getAudioDuration();if(!x.isNumber(t))return;const n=this.song.tickToSeconds(this.audioClipData.startTick);return this.song.secondsToTick(n+t)}static getNotesInRange(t,n,r){return B.getNotesInRangeImpl(t,n,r,i=>({getStartTick:()=>i}),i=>i.getStartTick(),i=>i.getEndTick())}static getNotesInRangeImpl(t,n,r,i,s,a){let u=Math.max(0,S.lt(t,i(n),(c,p)=>s(c)-s(p)));for(;t[u]&&!B.isNoteInClip(s(t[u]),a(t[u]),n,r);)u+=1;if(u>=t.length)return[];let l=Math.min(t.length-1,S.gt(t,i(r),(c,p)=>s(c)-s(p)));for(;t[l]&&!B.isNoteInClip(s(t[l]),a(t[l]),n,r);)l-=1;return l<0?[]:l<u?[]:t.slice(u,l+1)}static isNoteInClip(t,n,r,i){return(t>=r||r===0&&t<=0)&&t<=i&&n>=t}static getNotePlayableRange(t,n,r,i){if(!B.isNoteInClip(t,n,r,i))return null;const s=Math.max(t,r),a=Math.min(n,i);return s>a?null:{startTick:s,endTick:a}}trimConflictPartInternal(t,n){const r=Math.max(t,this.getClipStartTick()),i=Math.min(n,this.getClipEndTick());if(!(r>i)&&!(r>this.getClipEndTick()||i<this.getClipStartTick())){if(i>=this.getClipEndTick()&&r<=this.getClipStartTick()){this.deleteFromParent(!0);return}if(i<this.getClipEndTick()&&r>this.getClipStartTick()){const s=i+1,a=this.getClipEndTick();if(this.adjustClipRight(r-1,!1),this.track){if(this.type===1){const u=this.track.createMIDIClip({clipStartTick:s,clipEndTick:a}),l=B.getNotesInRange(this.notes,s,a);for(const c of l)u.createNote({pitch:c.getPitch(),velocity:c.getVelocity(),startTick:c.getStartTick(),endTick:c.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}else if(this.type===2){const u=this.audioClipData;this.track.createAudioClip({clipStartTick:s,clipEndTick:a,audioClipData:{audioFilePath:u.audioFilePath,startTick:u.startTick,duration:u.duration}})}}return}r>this.getClipStartTick()&&r<=this.getClipEndTick()?this.adjustClipRight(r-1,!1):i<this.getClipEndTick()&&i>=this.getClipStartTick()&&this.adjustClipLeft(i+1,!1)}}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return Zt(10)}}var Wt=(e=>(e[e.UNDEFINED=0]="UNDEFINED",e[e.VOLUME=1]="VOLUME",e[e.PAN=2]="PAN",e[e.AUDIO_PLUGIN=3]="AUDIO_PLUGIN",e))(Wt||{});class F{type;pluginInstanceId;paramId;constructor(t,n,r){this.type=t,this.pluginInstanceId=n,this.paramId=r}getType(){return this.type}setType(t){this.type=t}getPluginInstanceId(){return this.pluginInstanceId}setPluginInstanceId(t){this.pluginInstanceId=t}getParamId(){return this.paramId}setParamId(t){this.paramId=t}equals(t){return F.areAutomationTargetsEqual(this.getType(),t.getType(),this.getPluginInstanceId(),t.getPluginInstanceId(),this.getParamId(),t.getParamId())}clone(){return new F(this.type,this.pluginInstanceId,this.paramId)}toTfAutomationTargetId(){return F.encodeAutomationTarget(this.type,this.pluginInstanceId,this.paramId)}static fromTfAutomationTargetId(t){return F.decodeAutomationTarget(t)}static encodeAutomationTarget(t,n,r){return t===3?`${t}^^${n}^^${r}`:`${t}`}static decodeAutomationTarget(t){const n=t.split("^^");if(n.length===0)throw new Error(`Invalid automation target id: ${t}`);const r=Number(n[0]);return n.length>2?new F(r,n[1],n[2]):new F(r)}static areAutomationTargetsEqual(t,n,r,i,s,a){return F.encodeAutomationTarget(t,r,s)===F.encodeAutomationTarget(n,i,a)}}class ft{points=[];disabled=!1;nextPointIdInternal=1;getDisabled(){return this.disabled}setDisabled(t){this.disabled=t}getPoints(){return this.points}getPointsInRange(t,n){return ft.getPointsInRangeImpl(this.points,t,n)}static getPointsInRangeImpl(t,n,r){const i=S.ge(t,{tick:n},(a,u)=>a.tick-u.tick),s=[];for(let a=i;a<t.length;a+=1){const u=t[a];if(u.tick>r)break;s.push(u)}return s}addPoint(t,n,r=!1){const i={tick:t,value:Math.max(0,Math.min(1,n)),id:this.getNextPointIdInternal()};return ft.orderedInsertPointInternal(this.points,i,r),i}removePoints(t){const n=new Set(t);for(let r=this.points.length-1;r>=0;r-=1){const i=this.points[r];n.has(i.id)&&this.points.splice(r,1)}}removePointsInRange(t,n){const r=S.ge(this.points,{tick:t},(s,a)=>s.tick-a.tick);if(r>=this.points.length)return;let i=r;for(;i+1<this.points.length&&this.points[i+1].tick<=n;)i+=1;this.points.splice(r,i-r+1)}movePointsInRange(t,n,r,i,s=!0){const a=this.getPointsInRange(t,n);this.movePoints(a.map(u=>u.id),r,i,s)}movePoints(t,n,r,i=!0){if(t.length===0)return;const s=new Set(t);let a,u;const l=[];for(let c=0;c<this.points.length;c+=1){const p=this.points[c];!s.has(p.id)||(l.push(p),a===void 0&&(a=c),u=c)}if(!(a===void 0||u===void 0)){if(i){if(n<0){const c=Math.max(0,this.points[a].tick+n),p=S.gt(this.points,{tick:c},(m,g)=>m.tick-g.tick);p<a&&this.points.splice(p,a-p)}else if(n>0){const c=this.points[u].tick+n,p=S.lt(this.points,{tick:c},(m,g)=>m.tick-g.tick);p>u&&this.points.splice(u+1,p-u)}}for(const c of l)c.tick=Math.max(0,c.tick+n),c.value=Math.max(0,Math.min(1,c.value+r));Math.abs(n)>0&&this.points.sort((c,p)=>c.tick-p.tick)}}getNextPointIdInternal(){const t=this.nextPointIdInternal;return this.nextPointIdInternal>=2147483647?this.nextPointIdInternal=1:this.nextPointIdInternal+=1,t}static orderedInsertPointInternal(t,n,r=!1){const i=S.ge(t,n,(s,a)=>s.tick-a.tick);for(;r&&t[i]&&t[i].tick===n.tick;)t.splice(i,1);t.splice(i,0,n)}}class jr{targets=[];targetValues={};getAutomationTargets(){return this.targets}getAutomationTargetValues(){return this.targetValues}getOrCreateAutomationValueById(t){return this.targetValues[t]||(this.targetValues[t]=new ft),this.targetValues[t]}getAutomationValueById(t){return this.targetValues[t]}getAutomationValueByTarget(t){const n=t.toTfAutomationTargetId();return this.getAutomationValueById(n)}addAutomation(t,n=0){x.isNumber(n)||(n=0),this.targets.splice(n,0,t);const r=t.toTfAutomationTargetId();this.getAutomationValueById(r)||(this.targetValues[r]=new ft)}removeAutomation(t){for(let r=this.targets.length-1;r>=0;r-=1)this.targets[r].equals(t)&&this.targets.splice(r,1);const n=t.toTfAutomationTargetId();delete this.targetValues[n]}removeAutomationOfPlugin(t){for(let n=this.targets.length-1;n>=0;n-=1){const r=this.targets[n];r.getPluginInstanceId()===t&&this.removeAutomation(r)}for(const n of x.keys(this.targetValues)){const r=F.decodeAutomationTarget(n);r.getPluginInstanceId()===t&&this.removeAutomation(r)}}removeAllPointsWithinRange(t,n){for(const r of x.keys(this.targetValues))this.targetValues[r].removePointsInRange(t,n)}moveAllPointsWithinRange(t,n,r,i){for(const s of x.keys(this.targetValues))this.targetValues[s].movePointsInRange(t,n,r,i,!1)}}var ut=(e=>(e[e.MIDI_TRACK=1]="MIDI_TRACK",e[e.AUDIO_TRACK=2]="AUDIO_TRACK",e))(ut||{});class St{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;pan;samplerPlugin;audioPlugins=[];song;automation;type;constructor({type:t,song:n,uuid:r=St.generateTrackIdInternal(),clips:i=[],instrument:s,suggestedInstruments:a=[],volume:u=Zr(0),solo:l=!1,muted:c=!1,rank:p=0,pan:m=0}){this.song=n,this.type=t,s?this.insturment=s:t===1&&(this.insturment=new Tt({program:0,isDrum:!1})),this.clips=[...i],this.suggestedInstruments=[...a],this.uuid=r,this.volume=u,this.solo=l,this.muted=c,this.rank=p,this.pan=m,this.automation=new jr}getType(){return this.type}getSong(){return this.song}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:n}){this.type===1&&(this.insturment=new Tt({program:t,isDrum:n}))}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:n}){if(this.type!==1)return;const r=new Tt({program:t,isDrum:n});return this.suggestedInstruments.push(r),r}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}setPan(t){this.pan=t}getPan(){return this.pan}getSolo(){return this.solo}setSolo(t){this.solo=t,t&&this.muted&&(this.muted=!1)}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const n=xt(t);return new ht(n.name,n.manufacturerName,n.pluginFormatName,n.pluginVersion)}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t,n=!0){if(this.type!==1)return;const r=!this.samplerPlugin&&!!t||!t&&!!this.samplerPlugin||!!t&&!!this.samplerPlugin&&!t.matchesTfId(this.samplerPlugin.getTuneflowId()),i=this.samplerPlugin;this.samplerPlugin=t,r&&i&&n&&this.automation.removeAutomationOfPlugin(i.getInstanceId())}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return!this.clips||this.clips.length===0?0:this.clips[0].getClipStartTick()}getTrackEndTick(){return!this.clips||this.clips.length===0?0:this.clips[this.clips.length-1].getClipEndTick()}getClipById(t){for(const n of this.clips)if(n.getId()===t)return n;return null}getClips(){return this.clips}getClipsOverlappingWith(t,n){const r=[],i=S.lt(this.clips,{getClipStartTick:()=>t},(s,a)=>s.getClipStartTick()-a.getClipStartTick());for(let s=Math.max(i,0);s<this.clips.length;s+=1){const a=this.clips[s];if(!(a.getClipEndTick()<t)){if(a.getClipStartTick()>n)break;r.push(a)}}return r}createMIDIClip({clipStartTick:t,clipEndTick:n=void 0,insertClip:r=!0}){if(!x.isNumber(t))throw new Error("clipStartTick must be specified when creating a clip.");const i=n??t+1;if(i<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${n}`);const s=new B({id:B.generateClipIdInternal(),type:ot.MIDI_CLIP,song:this.song,track:void 0,clipStartTick:t,clipEndTick:i});return r&&this.insertClip(s),s}createAudioClip({clipStartTick:t,audioClipData:n,clipEndTick:r,insertClip:i=!0}){if(!x.isNumber(t))throw new Error("clipStartTick must be specified when creating a clip.");const s=new B({id:B.generateClipIdInternal(),type:ot.AUDIO_CLIP,song:this.song,track:void 0,clipStartTick:t,clipEndTick:r,audioClipData:n});return i&&this.insertClip(s),s}insertClip(t){if(t.getTrack()!==this)t.getTrack()&&t.deleteFromParent(!1),t.track=this;else return;this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t)}cloneClip(t){if(t.getType()===ot.MIDI_CLIP){const n=this.createMIDIClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const r of t.getRawNotes())n.createNote({pitch:r.getPitch(),velocity:r.getVelocity(),startTick:r.getStartTick(),endTick:r.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return n}else{if(t.getType()===ot.AUDIO_CLIP)return this.createAudioClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),audioClipData:t.getAudioClipData(),insertClip:!1});throw new Error(`Unsupported clip type ${t.getType()}`)}}getClipIndex(t){const n=S.le(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());return this.clips.indexOf(t,n)}deleteClip(t,n){const r=this.getClipIndex(t);this.deleteClipAt(r,n)}deleteClipAt(t,n){if(!(t<0)){if(n){const r=this.clips[t];if(!r)return;this.automation.removeAllPointsWithinRange(r.getClipStartTick(),r.getClipEndTick())}this.clips.splice(t,1)}}deleteFromParent(){this.song.removeTrack(this.getId())}getAutomation(){return this.automation}hasAnyAutomation(){return this.automation.getAutomationTargets().length>0&&!x.isEmpty(this.automation.getAutomationTargetValues())}static generateTrackIdInternal(){return Zt()}resolveClipConflictInternal(t,n,r){const i=this.getClipsOverlappingWith(n,r);for(const s of i)s.getId()!==t&&s.trimConflictPartInternal(n,r)}orderedInsertClipInternal(t){const n=S.ge(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());this.clips.splice(n,0,t)}}class Tt{program;isDrum;constructor({program:t,isDrum:n}){this.program=t,this.isDrum=n}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new Tt({program:this.program,isDrum:this.isDrum})}}var jt={},te={};function Eo(e){var t=new N(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=No(n.data),i=[],s=0;!t.eof()&&s<r.numTracks;s++){var a=t.readChunk();if(a.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+a.id+"'";var u=_o(a.data);i.push(u)}return{header:r,tracks:i}}function No(e){var t=new N(e),n=t.readUInt16(),r=t.readUInt16(),i={format:n,numTracks:r},s=t.readUInt16();return s&32768?(i.framesPerSecond=256-(s>>8),i.ticksPerFrame=s&255):i.ticksPerBeat=s,i}function _o(e){for(var t=new N(e),n=[];!t.eof();){var r=s();n.push(r)}return n;var i;function s(){var a={};a.deltaTime=t.readVarInt();var u=t.readUInt8();if((u&240)===240)if(u===255){a.meta=!0;var l=t.readUInt8(),c=t.readVarInt();switch(l){case 0:if(a.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return a.number=t.readUInt16(),a;case 1:return a.type="text",a.text=t.readString(c),a;case 2:return a.type="copyrightNotice",a.text=t.readString(c),a;case 3:return a.type="trackName",a.text=t.readString(c),a;case 4:return a.type="instrumentName",a.text=t.readString(c),a;case 5:return a.type="lyrics",a.text=t.readString(c),a;case 6:return a.type="marker",a.text=t.readString(c),a;case 7:return a.type="cuePoint",a.text=t.readString(c),a;case 32:if(a.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return a.channel=t.readUInt8(),a;case 33:if(a.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return a.port=t.readUInt8(),a;case 47:if(a.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return a;case 81:if(a.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return a.microsecondsPerBeat=t.readUInt24(),a;case 84:if(a.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var p=t.readUInt8(),m={0:24,32:25,64:29,96:30};return a.frameRate=m[p&96],a.hour=p&31,a.min=t.readUInt8(),a.sec=t.readUInt8(),a.frame=t.readUInt8(),a.subFrame=t.readUInt8(),a;case 88:if(a.type="timeSignature",c!=4)throw"Expected length for timeSignature event is 4, got "+c;return a.numerator=t.readUInt8(),a.denominator=1<<t.readUInt8(),a.metronome=t.readUInt8(),a.thirtyseconds=t.readUInt8(),a;case 89:if(a.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return a.key=t.readInt8(),a.scale=t.readUInt8(),a;case 127:return a.type="sequencerSpecific",a.data=t.readBytes(c),a;default:return a.type="unknownMeta",a.data=t.readBytes(c),a.metatypeByte=l,a}}else if(u==240){a.type="sysEx";var c=t.readVarInt();return a.data=t.readBytes(c),a}else if(u==247){a.type="endSysEx";var c=t.readVarInt();return a.data=t.readBytes(c),a}else throw"Unrecognised MIDI event type byte: "+u;else{var g;if((u&128)===0){if(i===null)throw"Running status byte encountered before status byte";g=u,u=i,a.running=!0}else g=t.readUInt8(),i=u;var T=u>>4;switch(a.channel=u&15,T){case 8:return a.type="noteOff",a.noteNumber=g,a.velocity=t.readUInt8(),a;case 9:var y=t.readUInt8();return a.type=y===0?"noteOff":"noteOn",a.noteNumber=g,a.velocity=y,y===0&&(a.byte9=!0),a;case 10:return a.type="noteAftertouch",a.noteNumber=g,a.amount=t.readUInt8(),a;case 11:return a.type="controller",a.controllerType=g,a.value=t.readUInt8(),a;case 12:return a.type="programChange",a.programNumber=g,a;case 13:return a.type="channelAftertouch",a.amount=g,a;case 14:return a.type="pitchBend",a.value=g+(t.readUInt8()<<7)-8192,a;default:throw"Unrecognised MIDI event type: "+T}}}}function N(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}N.prototype.eof=function(){return this.pos>=this.bufferLen};N.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};N.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};N.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};N.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};N.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};N.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};N.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+r};N.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};N.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};N.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};N.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var Mo=Eo;function Oo(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},r=e.tracks||[],i,s=r.length,a=new b;for(Uo(a,n,s),i=0;i<s;i++)Fo(a,r[i],t);return a.buffer}function Uo(e,t,n){var r=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var s=new b;s.writeUInt16(r),s.writeUInt16(n),s.writeUInt16(i),e.writeChunk("MThd",s.buffer)}function Fo(e,t,n){var r=new b,i,s=t.length,a=null;for(i=0;i<s;i++)(n.running===!1||!n.running&&!t[i].running)&&(a=null),a=Bo(r,t[i],a,n.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function Bo(e,t,n,r){var i=t.type,s=t.deltaTime,a=t.text||"",u=t.data||[],l=null;switch(e.writeVarInt(s),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(a.length),e.writeString(a);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(a.length),e.writeString(a);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(a.length),e.writeString(a);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(a.length),e.writeString(a);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(a.length),e.writeString(a);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(a.length),e.writeString(a);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(a.length),e.writeString(a);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c={24:0,25:32,29:64,30:96},p=t.hour&31|c[t.frameRate];e.writeUInt8(p),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var m=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(m),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(u.length),e.writeBytes(u);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(u.length),e.writeBytes(u));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(u.length),e.writeBytes(u);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(u.length),e.writeBytes(u);break;case"noteOff":var g=r!==!1&&t.byte9||r&&t.velocity==0?144:128;l=g|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":l=144|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":l=160|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":l=176|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":l=192|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":l=208|t.channel,l!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":l=224|t.channel,l!==n&&e.writeUInt8(l);var T=8192+t.value,y=T&127,L=T>>7&127;e.writeUInt8(y),e.writeUInt8(L);break;default:throw"Unrecognized event type: "+i}return l}function b(){this.buffer=[]}b.prototype.writeUInt8=function(e){this.buffer.push(e&255)};b.prototype.writeInt8=b.prototype.writeUInt8;b.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};b.prototype.writeInt16=b.prototype.writeUInt16;b.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)};b.prototype.writeInt24=b.prototype.writeUInt24;b.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};b.prototype.writeInt32=b.prototype.writeUInt32;b.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};b.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)};b.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var r=t&127|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}};b.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Do=Oo;te.parseMidi=Mo;te.writeMidi=Do;var ze={},ee={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});function ti(e,t,n){n===void 0&&(n="ticks");var r=0,i=e.length,s=i;if(i>0&&e[i-1][n]<=t)return i-1;for(;r<s;){var a=Math.floor(r+(s-r)/2),u=e[a],l=e[a+1];if(u[n]===t){for(var c=a;c<e.length;c++){var p=e[c];p[n]===t&&(a=c)}return a}else{if(u[n]<t&&l[n]>t)return a;u[n]>t?s=a:u[n]<t&&(r=a+1)}}return-1}Nt.search=ti;function Vo(e,t,n){if(n===void 0&&(n="ticks"),e.length){var r=ti(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)}Nt.insert=Vo;(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Nt,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(s){var a=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),s&&(n.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(u){return u.forEach(function(l){l.meta&&(l.type==="timeSignature"?a.timeSignatures.push({ticks:l.absoluteTime,timeSignature:[l.numerator,l.denominator]}):l.type==="setTempo"?a.tempos.push({bpm:6e7/l.microsecondsPerBeat,ticks:l.absoluteTime}):l.type==="keySignature"&&a.keySignatures.push({key:e.keySignatureKeys[l.key+7],scale:l.scale===0?"major":"minor",ticks:l.absoluteTime}))})}),s.tracks[0].forEach(function(u){u.meta&&(u.type==="trackName"?a.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&a.meta.push({text:u.text,ticks:u.absoluteTime,type:u.type}))}),this.update())}return i.prototype.update=function(){var s=this,a=0,u=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var p=c>0?s.tempos[c-1].bpm:s.tempos[0].bpm,m=l.ticks/s.ppq-u,g=60/p*m;l.time=g+a,a=l.time,u+=m}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var p=c>0?s.timeSignatures[c-1]:s.timeSignatures[0],m=(l.ticks-p.ticks)/s.ppq,g=m/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,l.measures=g+p.measures})},i.prototype.ticksToSeconds=function(s){var a=t.search(this.tempos,s);if(a!==-1){var u=this.tempos[a],l=u.time,c=(s-u.ticks)/this.ppq;return l+60/u.bpm*c}else{var p=s/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(s){var a=t.search(this.timeSignatures,s);if(a!==-1){var u=this.timeSignatures[a],l=(s-u.ticks)/this.ppq;return u.measures+l/(u.timeSignature[0]/u.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),i.prototype.secondsToTicks=function(s){var a=t.search(this.tempos,s,"time");if(a!==-1){var u=this.tempos[a],l=u.time,c=s-l,p=c/(60/u.bpm);return Math.round(u.ticks+p*this.ppq)}else{var m=s/.5;return Math.round(m*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=s.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=s.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=s.meta.map(function(a){return Object.assign({},a)}),n.set(this,s.ppq),this.update()},i.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},i}();e.Header=r})(ee);var _t={exports:{}};_t.exports=Ro;_t.exports.from=ei;_t.exports.depth=Lo;_t.exports.fromDepth=ni;function Ro(e){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return ei(e)}function ei(e){return ri(e,[])}function Lo(e,t){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return ni(e,t)}function ni(e,t){if(typeof t!="number")throw new TypeError("Expected the depth to be a number");return ii(e,[],t)}function ri(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?ri(r,t):t.push(r)}return t}function ii(e,t,n){n--;for(var r=0;r<e.length;r++){var i=e[r];n>-1&&Array.isArray(i)?ii(i,t,n):t.push(i)}return t}var ve=R&&R.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],a=0,u=s.length;a<u;a++,i++)r[i]=s[a];return r},$o=R&&R.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ze,"__esModule",{value:!0});var qo=te,Ho=ee,Go=$o(_t.exports);function Jo(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function zo(e){return Go.default(e.notes.map(function(t){return Jo(t,e.channel)}))}function Ko(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function Qo(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(r){t.push(Ko(r,e.channel))});return t}function Wo(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function Xo(e){var t=[];return e.pitchBends.forEach(function(n){t.push(Wo(n,e.channel))}),t}function Yo(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function Zo(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function jo(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function tu(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function eu(e){var t=Ho.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function nu(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function ru(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:ve([ve([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return eu(n)}),e.header.meta.map(function(n){return nu(n)}),e.header.tempos.map(function(n){return jo(n)}),e.header.timeSignatures.map(function(n){return tu(n)}))],e.tracks.map(function(n){return ve([Zo(n.name),Yo(n)],zo(n),Qo(n),Xo(n))}))};return t.tracks=t.tracks.map(function(n){n=n.sort(function(i,s){return i.absoluteTime-s.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array(qo.writeMidi(t))}ze.encode=ru;var ne={},Ke={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,s){return i[e.controlChangeNames[s]]=s,i},{});var t=new WeakMap,n=new WeakMap,r=function(){function i(s,a){t.set(this,a),n.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var s=t.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var a=t.get(this);this.ticks=a.secondsToTicks(s)},enumerable:!0,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=r})(Ke);var Qe={};Object.defineProperty(Qe,"__esModule",{value:!0});var $t=Ke;function iu(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if($t.controlChangeIds.hasOwnProperty(t))return e[$t.controlChangeIds[t]]},set:function(e,t,n){return $t.controlChangeIds.hasOwnProperty(t)?e[$t.controlChangeIds[t]]=n:e[t]=n,!0}})}Qe.createControlChanges=iu;var We={};Object.defineProperty(We,"__esModule",{value:!0});var Te=new WeakMap,su=function(){function e(t,n){Te.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=Te.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Te.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();We.PitchBend=su;var Xe={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];Mt.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];Mt.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Xe,"__esModule",{value:!0});var qt=Mt,Wn=new WeakMap,au=function(){function e(t,n){if(this.number=0,Wn.set(this,n),this.number=0,t){var r=t.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?qt.DrumKitByPatchID[this.number]:qt.instrumentByPatchID[this.number]},set:function(t){var n=qt.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":qt.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=Wn.get(this);return t.channel===9},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(t){this.number=t.number},e}();Xe.Instrument=au;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});function ou(e){var t=Math.floor(e/12)-1;return si(e)+t.toString()}function si(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function uu(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var cu=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],s=r[2],a=t[i.toLowerCase()];return a+(parseInt(s,10)+1)*12}}(),at=new WeakMap,lu=function(){function e(t,n,r){at.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return ou(this.midi)},set:function(t){this.midi=cu(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return si(this.midi)},set:function(t){this.midi=12*(this.octave+1)+uu(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=at.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=at.get(this),r=n.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=at.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=at.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=at.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();Ye.Note=lu;Object.defineProperty(ne,"__esModule",{value:!0});var ye=Nt,hu=Ke,fu=Qe,pu=We,Xn=Xe,gu=Ye,Ht=new WeakMap,du=function(){function e(t,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=fu.createControlChanges(),this.pitchBends=[],Ht.set(this,n),t){var i=t.find(function(g){return g.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new Xn.Instrument(t,this),this.channel=0,t){for(var s=t.filter(function(g){return g.type==="noteOn"}),a=t.filter(function(g){return g.type==="noteOff"}),u=function(){var g=s.shift();l.channel=g.channel;var T=a.findIndex(function(L){return L.noteNumber===g.noteNumber&&L.absoluteTime>=g.absoluteTime});if(T!==-1){var y=a.splice(T,1)[0];l.addNote({durationTicks:y.absoluteTime-g.absoluteTime,midi:g.noteNumber,noteOffVelocity:y.velocity/127,ticks:g.absoluteTime,velocity:g.velocity/127})}},l=this;s.length;)u();var c=t.filter(function(g){return g.type==="controller"});c.forEach(function(g){r.addCC({number:g.controllerType,ticks:g.absoluteTime,value:g.value/127})});var p=t.filter(function(g){return g.type==="pitchBend"});p.forEach(function(g){r.addPitchBend({ticks:g.absoluteTime,value:g.value/Math.pow(2,13)})});var m=t.find(function(g){return g.type==="endOfTrack"});this.endOfTrackTicks=m!==void 0?m.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=Ht.get(this),r=new gu.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,t),ye.insert(this.notes,r,"ticks"),this},e.prototype.addCC=function(t){var n=Ht.get(this),r=new hu.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),ye.insert(this.controlChanges[r.number],r,"ticks"),this},e.prototype.addPitchBend=function(t){var n=Ht.get(this),r=new pu.PitchBend({},n);return Object.assign(r,t),ye.insert(this.pitchBends,r,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;t<r&&(t=r)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;t<r&&(t=r)}return t},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new Xn.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var r in t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},e}();ne.Track=du;var mu=R&&R.__awaiter||function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function u(p){try{c(r.next(p))}catch(m){a(m)}}function l(p){try{c(r.throw(p))}catch(m){a(m)}}function c(p){p.done?s(p.value):i(p.value).then(u,l)}c((r=r.apply(e,t||[])).next())})},Iu=R&&R.__generator||function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(p){return l([c,p])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(p){c=[6,p],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(jt,"__esModule",{value:!0});var vu=te,Tu=ze,Yn=ee,ke=ne,yu=function(){function e(t){var n=this,r=null;t&&(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),r=vu.parseMidi(t),r.tracks.forEach(function(i){var s=0;i.forEach(function(a){s+=a.deltaTime,a.absoluteTime=s})}),r.tracks=xu(r.tracks)),this.header=new Yn.Header(r),this.tracks=[],t&&(this.tracks=r.tracks.map(function(i){return new ke.Track(i,n.header)}),r.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return e.fromUrl=function(t){return mu(this,void 0,void 0,function(){var n,r;return Iu(this,function(i){switch(i.label){case 0:return[4,fetch(t)];case 1:return n=i.sent(),n.ok?[4,n.arrayBuffer()]:[3,3];case 2:return r=i.sent(),[2,new e(r)];case 3:throw new Error("could not load "+t)}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=this.tracks.map(function(n){return n.duration});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var t=this.tracks.map(function(n){return n.durationTicks});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),e.prototype.addTrack=function(){var t=new ke.Track(void 0,this.header);return this.tracks.push(t),t},e.prototype.toArray=function(){return Tu.encode(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(t){return t.toJSON()})}},e.prototype.fromJSON=function(t){var n=this;this.header=new Yn.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map(function(r){var i=new ke.Track(void 0,n.header);return i.fromJSON(r),i})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}(),ku=jt.Midi=yu,bu=ne;jt.Track=bu.Track;var wu=ee;jt.Header=wu.Header;function xu(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,i=new Map,s=Array(16).fill(0),a=0,u=e[n];a<u.length;a++){var l=u[a],c=r,p=l.channel;if(p!==void 0){l.type==="programChange"&&(s[p]=l.programNumber);var m=s[p],g=m+" "+p;i.has(g)?c=i.get(g):(c=r+i.size,i.set(g,c))}t[c]||t.push([]),t[c].push(l)}return t}class yt{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return Qt(this.tracks,n=>n.getId()===t)}getTracksByIds(t){if(!this.tracks)return[];const n=new Set(t);return this.tracks.filter(r=>n.has(r.getId()))}getTrackIndex(t){return ct(this.tracks,n=>n.getId()===t)}createTrack({type:t,index:n,rank:r,assignDefaultSamplerPlugin:i=!1}){this.checkAccess("createTrack"),r==null||r===null?r=this.getNextTrackRank():this.nextTrackRank=Math.max(r+1,this.nextTrackRank);const s=new St({type:t,song:this,uuid:this.getNextTrackId(),rank:r==null||r===null?this.getNextTrackRank():r});return i&&t===ut.MIDI_TRACK&&s.setSamplerPlugin(s.createAudioPlugin(ht.DEFAULT_SYNTH.getTuneflowId())),n!=null?this.tracks.splice(n,0,s):this.tracks.push(s),s}cloneTrack(t){let n=this.getTrackIndex(t.getId());n<0&&(n=void 0);const r=this.createTrack({type:t.getType(),index:n});if(r.setVolume(t.getVolume()),r.setPan(t.getPan()),r.setSolo(t.getSolo()),r.setMuted(t.getMuted()),t.getType()===ut.MIDI_TRACK){const i=t.getInstrument();i&&r.setInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});for(const a of t.getSuggestedInstruments())r.createSuggestedInstrument({program:a.getProgram(),isDrum:a.getIsDrum()});const s=t.getSamplerPlugin();s&&r.setSamplerPlugin(s.clone(r))}else t.getType(),ut.AUDIO_TRACK;for(const i of t.getAudioPlugins())r.addAudioPlugin(i.clone(r));for(const i of t.getClips()){const s=r.cloneClip(i);r.insertClip(s)}return r}removeTrack(t){this.checkAccess("removeTrack");const n=this.getTrackById(t);return n?(this.tracks.splice(ct(this.tracks,r=>r.getId()===t),1),n):null}getResolution(){return this.PPQ}getBeatsPerBar(){return this.getTimeSignatures()[0].getNumerator()}getTicksPerBar(){return this.getBeatsPerBar()*this.getResolution()}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:n}){if(this.PPQ<=0)throw new Error("Song resolution must be provided before creating tempo changes.");if(this.tempos.length===0&&t!==0)throw new Error("The first tempo event must be at tick 0");const r=new vt({ticks:t,bpm:n,time:this.tickToSeconds(t)}),i=S.ge(this.tempos,r,(s,a)=>s.getTicks()-a.getTicks());return i<0?this.tempos.push(r):this.tempos.splice(i,0,r),this.retimingTempoEvents(),r}overwriteTempoChanges(t){if(t.length===0)throw new Error("Cannot clear all the tempo events.");const n=Qn(t);n.sort((i,s)=>i.getTicks()-s.getTicks());const r=n[0];if(r.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new vt({ticks:0,time:0,bpm:r.getBpm()})];for(let i=1;i<n.length;i+=1){const s=n[i];this.createTempoChange({ticks:s.getTicks(),bpm:s.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=Qn(t)}updateTempo(t,n){t.setBpmInternal(n),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:n,denominator:r}){const i=new Ee({ticks:t,numerator:n,denominator:r}),s=S.ge(this.timeSignatures,i,(a,u)=>a.getTicks()-u.getTicks());return s<0?this.timeSignatures.push(i):this.timeSignatures.splice(s,0,i),i}getLastTick(){let t=0;for(const n of this.tracks)t=Math.max(t,n.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}getTicksPerBeat(){return this.getResolution()*(4/this.getTimeSignatures()[0].getDenominator())}tickToSeconds(t){return yt.tickToSecondsImpl(t,this.getTempoChanges(),this.getResolution())}static tickToSecondsImpl(t,n,r){if(t===0)return 0;let i=S.lt(n,{getTicks:()=>t},(l,c)=>l.getTicks()-c.getTicks());i==-1&&(i=0);const s=n[i],a=t-s.getTicks(),u=yt.tempoBPMToTicksPerSecond(s.getBpm(),r);return s.getTime()+a/u}secondsToTick(t){if(t===0)return 0;let n=S.lt(this.getTempoChanges(),{getTime:()=>t},(a,u)=>a.getTime()-u.getTime());n==-1&&(n=0);const r=this.getTempoChanges()[n],i=t-r.getTime(),s=yt.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return Math.round(r.getTicks()+i*s)}static importMIDI(t,n,r=0,i=!1){const s=new ku(n),a=r,u=480/s.header.ppq;if(i){const l=[];for(const p of s.header.timeSignatures)l.push(new Ee({ticks:a+Y(p.ticks,u),numerator:p.timeSignature[0],denominator:p.timeSignature[1]}));t.overwriteTimeSignatures(l);const c=[];a>0&&c.push(new vt({ticks:0,time:0,bpm:120}));for(const p of s.header.tempos)c.push(new vt({ticks:a+Y(p.ticks,u),time:p.time,bpm:p.bpm}));t.overwriteTempoChanges(c)}for(const l of s.tracks){const c=t.createTrack({type:ut.MIDI_TRACK,assignDefaultSamplerPlugin:!0});c.setInstrument({program:l.instrument.number,isDrum:l.instrument.percussion});const p=c.createMIDIClip({clipStartTick:a});let m=Number.MAX_SAFE_INTEGER;for(const g of l.notes)p.createNote({pitch:g.midi,velocity:Math.round(g.velocity*127),startTick:a+Y(g.ticks,u),endTick:a+Y(g.ticks+g.durationTicks,u)}),m=Math.min(m,a+Y(g.ticks,u));if(l.controlChanges[7]){const g=new F(Wt.VOLUME);c.getAutomation().addAutomation(g);const T=c.getAutomation().getAutomationValueByTarget(g);for(const y of l.controlChanges[7])T.addPoint(a+Y(y.ticks,u),y.value)}if(l.controlChanges[10]){const g=new F(Wt.PAN);c.getAutomation().addAutomation(g);const T=c.getAutomation().getAutomationValueByTarget(g);for(const y of l.controlChanges[10])T.addPoint(a+Y(y.ticks,u),y.value)}m!==Number.MAX_SAFE_INTEGER&&p.adjustClipLeft(m)}}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}clearPluginContextInternal(){this.pluginContext=void 0}getNextTrackId(){const t=this.pluginContext,n=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===n.length)n.push(St.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>n.length)throw new Error("Plugin generated track ids out of sync.");const r=n[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,r}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,n){return t*n/60}retimingTempoEvents(){this.tempos.sort((t,n)=>t.getTicks()-n.getTicks());for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}function Y(e,t){return Math.round(e*t)}var A=(e=>(e[e.Slider=1]="Slider",e[e.Input=2]="Input",e[e.TrackSelector=3]="TrackSelector",e[e.Pitch=4]="Pitch",e[e.TrackPitchSelector=5]="TrackPitchSelector",e[e.InstrumentSelector=6]="InstrumentSelector",e[e.Select=7]="Select",e[e.Switch=8]="Switch",e[e.InputNumber=9]="InputNumber",e[e.MultiTrackSelector=10]="MultiTrackSelector",e[e.None=11]="None",e[e.FileSelector=12]="FileSelector",e[e.MultiSourceAudioSelector=13]="MultiSourceAudioSelector",e[e.AudioRecorder=14]="AudioRecorder",e))(A||{});async function Su(e){return e.arrayBuffer()}var ai=(e=>(e[e.SelectedTrackIds=1]="SelectedTrackIds",e[e.SelectedClipInfos=2]="SelectedClipInfos",e[e.TickAtPlayhead=3]="TickAtPlayhead",e[e.EditingClipInfo=4]="EditingClipInfo",e[e.EditingNoteIds=5]="EditingNoteIds",e[e.TickAtPlayheadSnappedToBeat=6]="TickAtPlayheadSnappedToBeat",e))(ai||{});exports.AudioPlugin=ht;exports.AutomationData=jr;exports.AutomationTarget=F;exports.AutomationTargetType=Wt;exports.AutomationValue=ft;exports.Clip=B;exports.ClipType=ot;exports.InjectSource=ai;exports.Note=H;exports.Song=yt;exports.TempoEvent=vt;exports.TickToSecondStepper=bo;exports.TimeSignatureEvent=Ee;exports.Track=St;exports.TrackType=ut;exports.TuneflowPipeline=co;exports.TuneflowPlugin=Je;exports.WidgetType=A;exports.areTuneflowIdsEqual=Xr;exports.areTuneflowIdsEqualIgnoreVersion=Yr;exports.dbToVolumeValue=Zr;exports.decodeAudioPluginTuneflowId=xt;exports.gainToDb=wo;exports.gainToVolumeValue=Po;exports.getAudioPluginTuneflowId=Qr;exports.getAudioPluginVersionlessTuneflowId=Wr;exports.getFileContentFromFileSelector=Su;exports.midiNumberToPitch=Io;exports.pitchToHz=Ao;exports.pitchToMidiNumber=yo;exports.remapRange=Co;exports.toVersionlessTfId=ko;exports.volumeValueToDb=xo;exports.volumeValueToGain=So;
