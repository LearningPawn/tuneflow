"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module";var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},e=Array.prototype,n=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,i=e.push,s=e.slice,o=n.toString,a=n.hasOwnProperty,u="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,l=Array.isArray,h=Object.keys,p=Object.create,g=u&&ArrayBuffer.isView,f=isNaN,d=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],v=Math.pow(2,53)-1;function k(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var s=Array(e+1);for(i=0;i<e;i++)s[i]=arguments[i];return s[e]=r,t.apply(this,s)}}function T(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function y(t){return void 0===t}function b(t){return!0===t||!1===t||"[object Boolean]"===o.call(t)}function S(t){var e="[object "+t+"]";return function(t){return o.call(t)===e}}var P=S("String"),w=S("Number"),x=S("Date"),C=S("RegExp"),_=S("Error"),A=S("Symbol"),E=S("ArrayBuffer"),N=S("Function"),j=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof j&&(N=function(t){return"function"==typeof t||!1});var R=N,V=S("Object"),O=c&&V(new DataView(new ArrayBuffer(8))),M="undefined"!=typeof Map&&V(new Map),B=S("DataView");var D=O?function(t){return null!=t&&R(t.getInt8)&&E(t.buffer)}:B,F=l||S("Array");function W(t,e){return null!=t&&a.call(t,e)}var $=S("Arguments");!function(){$(arguments)||($=function(t){return W(t,"callee")})}();var L=$;function U(t){return w(t)&&f(t)}function q(t){return function(){return t}}function z(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=v}}function K(t){return function(e){return null==e?void 0:e[t]}}var G=K("byteLength"),Q=z(G),J=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var H=u?function(t){return g?g(t)&&!D(t):Q(t)&&J.test(o.call(t))}:q(!1),X=K("length");function Y(t,e){e=function(t){for(var e={},n=t.length,r=0;r<n;++r)e[t[r]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var r=I.length,i=t.constructor,s=R(i)&&i.prototype||n,o="constructor";for(W(t,o)&&!e.contains(o)&&e.push(o);r--;)(o=I[r])in t&&t[o]!==s[o]&&!e.contains(o)&&e.push(o)}function Z(t){if(!T(t))return[];if(h)return h(t);var e=[];for(var n in t)W(t,n)&&e.push(n);return m&&Y(t,e),e}function tt(t,e){var n=Z(e),r=n.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var o=n[s];if(e[o]!==i[o]||!(o in i))return!1}return!0}function et(t){return t instanceof et?t:this instanceof et?void(this._wrapped=t):new et(t)}function nt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,G(t))}et.VERSION="1.13.2",et.prototype.value=function(){return this._wrapped},et.prototype.valueOf=et.prototype.toJSON=et.prototype.value,et.prototype.toString=function(){return String(this._wrapped)};function rt(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&it(t,e,n,r)}function it(t,e,n,i){t instanceof et&&(t=t._wrapped),e instanceof et&&(e=e._wrapped);var s=o.call(t);if(s!==o.call(e))return!1;if(O&&"[object Object]"==s&&D(t)){if(!D(e))return!1;s="[object DataView]"}switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(e);case"[object ArrayBuffer]":case"[object DataView]":return it(nt(t),nt(e),n,i)}var a="[object Array]"===s;if(!a&&H(t)){if(G(t)!==G(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var u=t.constructor,c=e.constructor;if(u!==c&&!(R(u)&&u instanceof u&&R(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var l=(n=n||[]).length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),a){if((l=t.length)!==e.length)return!1;for(;l--;)if(!rt(t[l],e[l],n,i))return!1}else{var h,p=Z(t);if(l=p.length,Z(e).length!==l)return!1;for(;l--;)if(!W(e,h=p[l])||!rt(t[h],e[h],n,i))return!1}return n.pop(),i.pop(),!0}function st(t){if(!T(t))return[];var e=[];for(var n in t)e.push(n);return m&&Y(t,e),e}function ot(t){var e=X(t);return function(n){if(null==n)return!1;var r=st(n);if(X(r))return!1;for(var i=0;i<e;i++)if(!R(n[t[i]]))return!1;return t!==ht||!R(n[at])}}var at="forEach",ut=["clear","delete"],ct=["get","has","set"],lt=ut.concat(at,ct),ht=ut.concat(ct),pt=["add"].concat(ut,at,"has"),gt=M?ot(lt):S("Map"),ft=M?ot(ht):S("WeakMap"),dt=M?ot(pt):S("Set"),mt=S("WeakSet");function It(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function vt(t){for(var e={},n=Z(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function kt(t){var e=[];for(var n in t)R(t[n])&&e.push(n);return e.sort()}function Tt(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var s=arguments[i],o=t(s),a=o.length,u=0;u<a;u++){var c=o[u];e&&void 0!==n[c]||(n[c]=s[c])}return n}}var yt=Tt(st),bt=Tt(Z),St=Tt(st,!0);function Pt(t){if(!T(t))return{};if(p)return p(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function wt(t){return F(t)?t:[t]}function xt(t){return et.toPath(t)}function Ct(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function _t(t,e,n){var r=Ct(t,xt(e));return y(r)?n:r}function At(t){return t}function Et(t){return t=bt({},t),function(e){return tt(e,t)}}function Nt(t){return t=xt(t),function(e){return Ct(e,t)}}function jt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,s){return t.call(e,n,r,i,s)}}return function(){return t.apply(e,arguments)}}function Rt(t,e,n){return null==t?At:R(t)?jt(t,e,n):T(t)&&!F(t)?Et(t):Nt(t)}function Vt(t,e){return Rt(t,e,1/0)}function Ot(t,e,n){return et.iteratee!==Vt?et.iteratee(t,e):Rt(t,e,n)}function Mt(){}function Bt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}et.toPath=wt,et.iteratee=Vt;var Dt=Date.now||function(){return(new Date).getTime()};function Ft(t){var e=function(e){return t[e]},n="(?:"+Z(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}}var Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$t=Ft(Wt),Lt=Ft(vt(Wt)),Ut=et.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,zt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Kt=/\\|'|\r|\n|\u2028|\u2029/g;function Gt(t){return"\\"+zt[t]}var Qt=/^\s*(\w|\$)+\s*$/;var Jt=0;function Ht(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var s=Pt(t.prototype),o=t.apply(s,i);return T(o)?o:s}var Xt=k((function(t,e){var n=Xt.placeholder,r=function(){for(var i=0,s=e.length,o=Array(s),a=0;a<s;a++)o[a]=e[a]===n?arguments[i++]:e[a];for(;i<arguments.length;)o.push(arguments[i++]);return Ht(t,r,this,this,o)};return r}));Xt.placeholder=et;var Yt=k((function(t,e,n){if(!R(t))throw new TypeError("Bind must be called on a function");var r=k((function(i){return Ht(t,r,e,this,n.concat(i))}));return r})),Zt=z(X);function te(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,s=0,o=X(t);s<o;s++){var a=t[s];if(Zt(a)&&(F(a)||L(a)))if(e>1)te(a,e-1,n,r),i=r.length;else for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else n||(r[i++]=a)}return r}var ee=k((function(t,e){var n=(e=te(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=Yt(t[r],t)}return t}));var ne=k((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Xt(ne,et,1);function ie(t){return function(){return!t.apply(this,arguments)}}function se(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var oe=Xt(se,2);function ae(t,e,n){e=Ot(e,n);for(var r,i=Z(t),s=0,o=i.length;s<o;s++)if(e(t[r=i[s]],r,t))return r}function ue(t){return function(e,n,r){n=Ot(n,r);for(var i=X(e),s=t>0?0:i-1;s>=0&&s<i;s+=t)if(n(e[s],s,e))return s;return-1}}var ce=ue(1),le=ue(-1);function he(t,e,n,r){for(var i=(n=Ot(n,r,1))(e),s=0,o=X(t);s<o;){var a=Math.floor((s+o)/2);n(t[a])<i?s=a+1:o=a}return s}function pe(t,e,n){return function(r,i,o){var a=0,u=X(r);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+u,a):u=o>=0?Math.min(o+1,u):o+u+1;else if(n&&o&&u)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=e(s.call(r,a,u),U))>=0?o+a:-1;for(o=t>0?a:u-1;o>=0&&o<u;o+=t)if(r[o]===i)return o;return-1}}var ge=pe(1,ce,he),fe=pe(-1,le);function de(t,e,n){var r=(Zt(t)?ce:ae)(t,e,n);if(void 0!==r&&-1!==r)return t[r]}function me(t,e,n){var r,i;if(e=jt(e,n),Zt(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var s=Z(t);for(r=0,i=s.length;r<i;r++)e(t[s[r]],s[r],t)}return t}function Ie(t,e,n){e=Ot(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=Array(i),o=0;o<i;o++){var a=r?r[o]:o;s[o]=e(t[a],a,t)}return s}function ve(t){var e=function(e,n,r,i){var s=!Zt(e)&&Z(e),o=(s||e).length,a=t>0?0:o-1;for(i||(r=e[s?s[a]:a],a+=t);a>=0&&a<o;a+=t){var u=s?s[a]:a;r=n(r,e[u],u,e)}return r};return function(t,n,r,i){var s=arguments.length>=3;return e(t,jt(n,i,4),r,s)}}var ke=ve(1),Te=ve(-1);function ye(t,e,n){var r=[];return e=Ot(e,n),me(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r}function be(t,e,n){e=Ot(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=0;s<i;s++){var o=r?r[s]:s;if(!e(t[o],o,t))return!1}return!0}function Se(t,e,n){e=Ot(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=0;s<i;s++){var o=r?r[s]:s;if(e(t[o],o,t))return!0}return!1}function Pe(t,e,n,r){return Zt(t)||(t=It(t)),("number"!=typeof n||r)&&(n=0),ge(t,e,n)>=0}var we=k((function(t,e,n){var r,i;return R(e)?i=e:(e=xt(e),r=e.slice(0,-1),e=e[e.length-1]),Ie(t,(function(t){var s=i;if(!s){if(r&&r.length&&(t=Ct(t,r)),null==t)return;s=t[e]}return null==s?s:s.apply(t,n)}))}));function xe(t,e){return Ie(t,Nt(e))}function Ce(t,e,n){var r,i,s=-1/0,o=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:It(t)).length;a<u;a++)null!=(r=t[a])&&r>s&&(s=r);else e=Ot(e,n),me(t,(function(t,n,r){((i=e(t,n,r))>o||i===-1/0&&s===-1/0)&&(s=t,o=i)}));return s}var _e=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ae(t){return t?F(t)?s.call(t):P(t)?t.match(_e):Zt(t)?Ie(t,At):It(t):[]}function Ee(t,e,n){if(null==e||n)return Zt(t)||(t=It(t)),t[Bt(t.length-1)];var r=Ae(t),i=X(r);e=Math.max(Math.min(e,i),0);for(var s=i-1,o=0;o<e;o++){var a=Bt(o,s),u=r[o];r[o]=r[a],r[a]=u}return r.slice(0,e)}function Ne(t,e){return function(n,r,i){var s=e?[[],[]]:{};return r=Ot(r,i),me(n,(function(e,i){var o=r(e,i,n);t(s,e,o)})),s}}var je=Ne((function(t,e,n){W(t,n)?t[n].push(e):t[n]=[e]})),Re=Ne((function(t,e,n){t[n]=e})),Ve=Ne((function(t,e,n){W(t,n)?t[n]++:t[n]=1})),Oe=Ne((function(t,e,n){t[n?0:1].push(e)}),!0);function Me(t,e,n){return e in n}var Be=k((function(t,e){var n={},r=e[0];if(null==t)return n;R(r)?(e.length>1&&(r=jt(r,e[1])),e=st(t)):(r=Me,e=te(e,!1,!1),t=Object(t));for(var i=0,s=e.length;i<s;i++){var o=e[i],a=t[o];r(a,o,t)&&(n[o]=a)}return n})),De=k((function(t,e){var n,r=e[0];return R(r)?(r=ie(r),e.length>1&&(n=e[1])):(e=Ie(te(e,!1,!1),String),r=function(t,n){return!Pe(e,n)}),Be(t,r,n)}));function Fe(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function We(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Fe(t,t.length-e)}function $e(t,e,n){return s.call(t,null==e||n?1:e)}var Le=k((function(t,e){return e=te(e,!0,!0),ye(t,(function(t){return!Pe(e,t)}))})),Ue=k((function(t,e){return Le(t,e)}));function qe(t,e,n,r){b(e)||(r=n,n=e,e=!1),null!=n&&(n=Ot(n,r));for(var i=[],s=[],o=0,a=X(t);o<a;o++){var u=t[o],c=n?n(u,o,t):u;e&&!n?(o&&s===c||i.push(u),s=c):n?Pe(s,c)||(s.push(c),i.push(u)):Pe(i,u)||i.push(u)}return i}var ze=k((function(t){return qe(te(t,!0,!0))}));function Ke(t){for(var e=t&&Ce(t,X).length||0,n=Array(e),r=0;r<e;r++)n[r]=xe(t,r);return n}var Ge=k(Ke);function Qe(t,e){return t._chain?et(e).chain():e}function Je(t){return me(kt(t),(function(e){var n=et[e]=t[e];et.prototype[e]=function(){var t=[this._wrapped];return i.apply(t,arguments),Qe(this,n.apply(et,t))}})),et}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var n=e[t];et.prototype[t]=function(){var e=this._wrapped;return null!=e&&(n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0]),Qe(this,e)}})),me(["concat","join","slice"],(function(t){var n=e[t];et.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=n.apply(t,arguments)),Qe(this,t)}}));var He=Je(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VERSION:"1.13.2",restArguments:k,isObject:T,isNull:function(t){return null===t},isUndefined:y,isBoolean:b,isElement:function(t){return!(!t||1!==t.nodeType)},isString:P,isNumber:w,isDate:x,isRegExp:C,isError:_,isSymbol:A,isArrayBuffer:E,isDataView:D,isArray:F,isFunction:R,isArguments:L,isFinite:function(t){return!A(t)&&d(t)&&!isNaN(parseFloat(t))},isNaN:U,isTypedArray:H,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(F(t)||P(t)||L(t))?0===e:0===X(Z(t))},isMatch:tt,isEqual:function(t,e){return rt(t,e)},isMap:gt,isWeakMap:ft,isSet:dt,isWeakSet:mt,keys:Z,allKeys:st,values:It,pairs:function(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:vt,functions:kt,methods:kt,extend:yt,extendOwn:bt,assign:bt,defaults:St,create:function(t,e){var n=Pt(t);return e&&bt(n,e),n},clone:function(t){return T(t)?F(t)?t.slice():yt({},t):t},tap:function(t,e){return e(t),t},get:_t,has:function(t,e){for(var n=(e=xt(e)).length,r=0;r<n;r++){var i=e[r];if(!W(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Ot(e,n);for(var r=Z(t),i=r.length,s={},o=0;o<i;o++){var a=r[o];s[a]=e(t[a],a,t)}return s},identity:At,constant:q,noop:Mt,toPath:wt,property:Nt,propertyOf:function(t){return null==t?Mt:function(e){return _t(t,e)}},matcher:Et,matches:Et,times:function(t,e,n){var r=Array(Math.max(0,t));e=jt(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:Bt,now:Dt,escape:$t,unescape:Lt,templateSettings:Ut,template:function(t,e,n){!e&&n&&(e=n),e=St({},e,et.templateSettings);var r=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(r,(function(e,n,r,o,a){return s+=t.slice(i,a).replace(Kt,Gt),i=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e})),s+="';\n";var o,a=e.variable;if(a){if(!Qt.test(a))throw new Error("variable is not a bare identifier: "+a)}else s="with(obj||{}){\n"+s+"}\n",a="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{o=new Function(a,"_",s)}catch(c){throw c.source=s,c}var u=function(t){return o.call(this,t,et)};return u.source="function("+a+"){\n"+s+"}",u},result:function(t,e,n){var r=(e=xt(e)).length;if(!r)return R(n)?n.call(t):n;for(var i=0;i<r;i++){var s=null==t?void 0:t[e[i]];void 0===s&&(s=n,i=r),t=R(s)?s.call(t):s}return t},uniqueId:function(t){var e=++Jt+"";return t?t+e:e},chain:function(t){var e=et(t);return e._chain=!0,e},iteratee:Vt,partial:Xt,bind:Yt,bindAll:ee,memoize:function(t,e){var n=function(r){var i=n.cache,s=""+(e?e.apply(this,arguments):r);return W(i,s)||(i[s]=t.apply(this,arguments)),i[s]};return n.cache={},n},delay:ne,defer:re,throttle:function(t,e,n){var r,i,s,o,a=0;n||(n={});var u=function(){a=!1===n.leading?0:Dt(),r=null,o=t.apply(i,s),r||(i=s=null)},c=function(){var c=Dt();a||!1!==n.leading||(a=c);var l=e-(c-a);return i=this,s=arguments,l<=0||l>e?(r&&(clearTimeout(r),r=null),a=c,o=t.apply(i,s),r||(i=s=null)):r||!1===n.trailing||(r=setTimeout(u,l)),o};return c.cancel=function(){clearTimeout(r),a=0,r=i=s=null},c},debounce:function(t,e,n){var r,i,s,o,a,u=function(){var c=Dt()-i;e>c?r=setTimeout(u,e-c):(r=null,n||(o=t.apply(a,s)),r||(s=a=null))},c=k((function(c){return a=this,s=c,i=Dt(),r||(r=setTimeout(u,e),n&&(o=t.apply(a,s))),o}));return c.cancel=function(){clearTimeout(r),r=s=a=null},c},wrap:function(t,e){return Xt(e,t)},negate:ie,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:se,once:oe,findKey:ae,findIndex:ce,findLastIndex:le,sortedIndex:he,indexOf:ge,lastIndexOf:fe,find:de,detect:de,findWhere:function(t,e){return de(t,Et(e))},each:me,forEach:me,map:Ie,collect:Ie,reduce:ke,foldl:ke,inject:ke,reduceRight:Te,foldr:Te,filter:ye,select:ye,reject:function(t,e,n){return ye(t,ie(Ot(e)),n)},every:be,all:be,some:Se,any:Se,contains:Pe,includes:Pe,include:Pe,invoke:we,pluck:xe,where:function(t,e){return ye(t,Et(e))},max:Ce,min:function(t,e,n){var r,i,s=1/0,o=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:It(t)).length;a<u;a++)null!=(r=t[a])&&r<s&&(s=r);else e=Ot(e,n),me(t,(function(t,n,r){((i=e(t,n,r))<o||i===1/0&&s===1/0)&&(s=t,o=i)}));return s},shuffle:function(t){return Ee(t,1/0)},sample:Ee,sortBy:function(t,e,n){var r=0;return e=Ot(e,n),xe(Ie(t,(function(t,n,i){return{value:t,index:r++,criteria:e(t,n,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")},groupBy:je,indexBy:Re,countBy:Ve,partition:Oe,toArray:Ae,size:function(t){return null==t?0:Zt(t)?t.length:Z(t).length},pick:Be,omit:De,first:We,head:We,take:We,initial:Fe,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:$e(t,Math.max(0,t.length-e))},rest:$e,tail:$e,drop:$e,compact:function(t){return ye(t,Boolean)},flatten:function(t,e){return te(t,e,!1)},without:Ue,uniq:qe,unique:qe,union:ze,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=X(t);r<i;r++){var s=t[r];if(!Pe(e,s)){var o;for(o=1;o<n&&Pe(arguments[o],s);o++);o===n&&e.push(s)}}return e},difference:Le,unzip:Ke,transpose:Ke,zip:Ge,object:function(t,e){for(var n={},r=0,i=X(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),s=0;s<r;s++,t+=n)i[s]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(s.call(t,r,r+=e));return n},mixin:Je,default:et}));He._=He;let Xe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let r=63&n[t];e+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return e};class Ye{instanceIdInternal=Ye.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;songCacheInternal;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,e){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,e){return t[e]}hasAllParamsSet(){for(const t of Z(this.params())){if(this.params()[t].optional)continue;const e=this.paramsResultInternal[t];if(null==e)return!1;const n=this.params()[t].widget.type;switch(n){case exports.WidgetType.Input:case exports.WidgetType.Pitch:case exports.WidgetType.Slider:case exports.WidgetType.TrackSelector:case exports.WidgetType.Select:case exports.WidgetType.Switch:case exports.WidgetType.InputNumber:case exports.WidgetType.FileSelector:break;case exports.WidgetType.MultiTrackSelector:if(0===e.length)return!1;break;case exports.WidgetType.TrackPitchSelector:if(void 0===e.track||null===e.track||void 0===e.pitch||null===e.pitch)return!1;break;case exports.WidgetType.InstrumentSelector:if(void 0===e.program||null===e.program||void 0===e.isDrum||null===e.isDrum)return!1;break;case exports.WidgetType.None:if(null==e)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${n}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of Z(this.params())){const e=this.params()[t];this.paramsResultInternal[t]=e.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Xe(10)}}var Ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function tn(t,e,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)>=0?(s=o,i=o-1):r=o+1}return s}function en(t,e,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)>0?(s=o,i=o-1):r=o+1}return s}function nn(t,e,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)<0?(s=o,r=o+1):i=o-1}return s}function rn(t,e,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)<=0?(s=o,r=o+1):i=o-1}return s}function sn(t,e,n,r,i,s){return"function"==typeof n?s(t,e,n,void 0===r?0:0|r,void 0===i?t.length-1:0|i):s(t,e,void 0,void 0===n?0:0|n,void 0===r?t.length-1:0|r)}var on=function(t,e,n,r,i){return sn(t,e,n,r,i,tn)},an=function(t,e,n,r,i){return sn(t,e,n,r,i,en)},un=function(t,e,n,r,i){return sn(t,e,n,r,i,nn)},cn=function(t,e,n,r,i){return sn(t,e,n,r,i,rn)},ln={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",s="[object Boolean]",o="[object Date]",a="[object Function]",u="[object GeneratorFunction]",c="[object Map]",l="[object Number]",h="[object Object]",p="[object Promise]",g="[object RegExp]",f="[object Set]",d="[object String]",m="[object Symbol]",I="[object WeakMap]",v="[object ArrayBuffer]",k="[object DataView]",T="[object Float32Array]",y="[object Float64Array]",b="[object Int8Array]",S="[object Int16Array]",P="[object Int32Array]",w="[object Uint8Array]",x="[object Uint8ClampedArray]",C="[object Uint16Array]",_="[object Uint32Array]",A=/\w*$/,E=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,j={};j[i]=j["[object Array]"]=j[v]=j[k]=j[s]=j[o]=j[T]=j[y]=j[b]=j[S]=j[P]=j[c]=j[l]=j[h]=j[g]=j[f]=j[d]=j[m]=j[w]=j[x]=j[C]=j[_]=!0,j["[object Error]"]=j[a]=j[I]=!1;var R="object"==typeof Ze&&Ze&&Ze.Object===Object&&Ze,V="object"==typeof self&&self&&self.Object===Object&&self,O=R||V||Function("return this")(),M=e&&!e.nodeType&&e,B=M&&t&&!t.nodeType&&t,D=B&&B.exports===M;function F(t,e){return t.set(e[0],e[1]),t}function W(t,e){return t.add(e),t}function $(t,e,n,r){var i=-1,s=t?t.length:0;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function L(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function U(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function q(t,e){return function(n){return t(e(n))}}function z(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var K,G=Array.prototype,Q=Function.prototype,J=Object.prototype,H=O["__core-js_shared__"],X=(K=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",Y=Q.toString,Z=J.hasOwnProperty,tt=J.toString,et=RegExp("^"+Y.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=D?O.Buffer:void 0,rt=O.Symbol,it=O.Uint8Array,st=q(Object.getPrototypeOf,Object),ot=Object.create,at=J.propertyIsEnumerable,ut=G.splice,ct=Object.getOwnPropertySymbols,lt=nt?nt.isBuffer:void 0,ht=q(Object.keys,Object),pt=Bt(O,"DataView"),gt=Bt(O,"Map"),ft=Bt(O,"Promise"),dt=Bt(O,"Set"),mt=Bt(O,"WeakMap"),It=Bt(Object,"create"),vt=Lt(pt),kt=Lt(gt),Tt=Lt(ft),yt=Lt(dt),bt=Lt(mt),St=rt?rt.prototype:void 0,Pt=St?St.valueOf:void 0;function wt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ct(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _t(t){this.__data__=new xt(t)}function At(t,e){var n=qt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&zt(t)}(t)&&Z.call(t,"callee")&&(!at.call(t,"callee")||tt.call(t)==i)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],r=n.length,s=!!r;for(var o in t)!e&&!Z.call(t,o)||s&&("length"==o||Wt(o,r))||n.push(o);return n}function Et(t,e,n){var r=t[e];Z.call(t,e)&&Ut(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function Nt(t,e){for(var n=t.length;n--;)if(Ut(t[n][0],e))return n;return-1}function jt(t,e,n,r,p,I,E){var N;if(r&&(N=I?r(t,p,I,E):r(t)),void 0!==N)return N;if(!Qt(t))return t;var R=qt(t);if(R){if(N=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!e)return function(t,e){var n=-1,r=t.length;e||(e=Array(r));for(;++n<r;)e[n]=t[n];return e}(t,N)}else{var V=Ft(t),O=V==a||V==u;if(Kt(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(V==h||V==i||O&&!I){if(L(t))return I?t:{};if(N=function(t){return"function"!=typeof t.constructor||$t(t)?{}:(e=st(t),Qt(e)?ot(e):{});var e}(O?{}:t),!e)return function(t,e){return Ot(t,Dt(t),e)}(t,function(t,e){return t&&Ot(e,Jt(e),t)}(N,t))}else{if(!j[V])return I?t:{};N=function(t,e,n,r){var i=t.constructor;switch(e){case v:return Vt(t);case s:case o:return new i(+t);case k:return function(t,e){var n=e?Vt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,r);case T:case y:case b:case S:case P:case w:case x:case C:case _:return function(t,e){var n=e?Vt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,r);case c:return function(t,e,n){return $(e?n(U(t),!0):U(t),F,new t.constructor)}(t,r,n);case l:case d:return new i(t);case g:return function(t){var e=new t.constructor(t.source,A.exec(t));return e.lastIndex=t.lastIndex,e}(t);case f:return function(t,e,n){return $(e?n(z(t),!0):z(t),W,new t.constructor)}(t,r,n);case m:return a=t,Pt?Object(Pt.call(a)):{}}var a}(t,V,jt,e)}}E||(E=new _t);var M=E.get(t);if(M)return M;if(E.set(t,N),!R)var B=n?function(t){return function(t,e,n){var r=e(t);return qt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,Jt,Dt)}(t):Jt(t);return function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););}(B||t,(function(i,s){B&&(i=t[s=i]),Et(N,s,jt(i,e,n,r,s,t,E))})),N}function Rt(t){return!(!Qt(t)||(e=t,X&&X in e))&&(Gt(t)||L(t)?et:E).test(Lt(t));var e}function Vt(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Ot(t,e,n,r){n||(n={});for(var i=-1,s=e.length;++i<s;){var o=e[i],a=r?r(n[o],t[o],o,n,t):void 0;Et(n,o,void 0===a?t[o]:a)}return n}function Mt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Bt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Rt(n)?n:void 0}wt.prototype.clear=function(){this.__data__=It?It(null):{}},wt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},wt.prototype.get=function(t){var e=this.__data__;if(It){var r=e[t];return r===n?void 0:r}return Z.call(e,t)?e[t]:void 0},wt.prototype.has=function(t){var e=this.__data__;return It?void 0!==e[t]:Z.call(e,t)},wt.prototype.set=function(t,e){return this.__data__[t]=It&&void 0===e?n:e,this},xt.prototype.clear=function(){this.__data__=[]},xt.prototype.delete=function(t){var e=this.__data__,n=Nt(e,t);return!(n<0)&&(n==e.length-1?e.pop():ut.call(e,n,1),!0)},xt.prototype.get=function(t){var e=this.__data__,n=Nt(e,t);return n<0?void 0:e[n][1]},xt.prototype.has=function(t){return Nt(this.__data__,t)>-1},xt.prototype.set=function(t,e){var n=this.__data__,r=Nt(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},Ct.prototype.clear=function(){this.__data__={hash:new wt,map:new(gt||xt),string:new wt}},Ct.prototype.delete=function(t){return Mt(this,t).delete(t)},Ct.prototype.get=function(t){return Mt(this,t).get(t)},Ct.prototype.has=function(t){return Mt(this,t).has(t)},Ct.prototype.set=function(t,e){return Mt(this,t).set(t,e),this},_t.prototype.clear=function(){this.__data__=new xt},_t.prototype.delete=function(t){return this.__data__.delete(t)},_t.prototype.get=function(t){return this.__data__.get(t)},_t.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.set=function(t,e){var n=this.__data__;if(n instanceof xt){var r=n.__data__;if(!gt||r.length<199)return r.push([t,e]),this;n=this.__data__=new Ct(r)}return n.set(t,e),this};var Dt=ct?q(ct,Object):function(){return[]},Ft=function(t){return tt.call(t)};function Wt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||N.test(t))&&t>-1&&t%1==0&&t<e}function $t(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||J)}function Lt(t){if(null!=t){try{return Y.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Ut(t,e){return t===e||t!=t&&e!=e}(pt&&Ft(new pt(new ArrayBuffer(1)))!=k||gt&&Ft(new gt)!=c||ft&&Ft(ft.resolve())!=p||dt&&Ft(new dt)!=f||mt&&Ft(new mt)!=I)&&(Ft=function(t){var e=tt.call(t),n=e==h?t.constructor:void 0,r=n?Lt(n):void 0;if(r)switch(r){case vt:return k;case kt:return c;case Tt:return p;case yt:return f;case bt:return I}return e});var qt=Array.isArray;function zt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!Gt(t)}var Kt=lt||function(){return!1};function Gt(t){var e=Qt(t)?tt.call(t):"";return e==a||e==u}function Qt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Jt(t){return zt(t)?At(t):function(t){if(!$t(t))return ht(t);var e=[];for(var n in Object(t))Z.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return jt(t,!0,!0)}}(ln,ln.exports);var hn=ln.exports;class pn{ticks;bpm;time;constructor({ticks:t,bpm:e,time:n}){this.ticks=t,this.bpm=e,this.time=n}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class gn{ticks;numerator;denominator;constructor({ticks:t,numerator:e,denominator:n}){this.ticks=t,this.numerator=e,this.denominator=n}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}const fn=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,dn={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function mn(t,e,n,r){return`${t} // ${e} // ${n} // ${r}`}function In(t,e,n){return`${t} // ${e} // ${n}`}function vn(t){const e=t.split(" // ");if(e.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:e[2],manufacturerName:e[0],pluginFormatName:e[1],pluginVersion:e[3]}}function kn(t,e){return t===e}function Tn(t,e){const n=vn(t),r=vn(e);if(He.keys(n).length!==He.keys(r).length)return!1;for(const i of He.keys(n))if("pluginVersion"!==i&&n[i]!==r[i])return!1;return!0}class yn{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,e,n,r){this.name=t,this.manufacturerName=e,this.pluginFormatName=n,this.pluginVersion=r,this.localInstanceIdInternal=yn.generateAudioPluginInstanceIdInternal()}getTuneflowId(){return mn(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const e=t.createAudioPlugin(this.getTuneflowId());return e.setIsEnabled(this.isEnabled),e}matchesTfId(t){return kn(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return Tn(t,this.getTuneflowId())}getInstanceId(){return this.localInstanceIdInternal}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}setBase64States(t){this.base64StatesInternal=t}getBase64States(){return this.base64StatesInternal}static generateAudioPluginInstanceIdInternal(){return Xe(10)}}class bn{pitch;velocity;startTick;endTick;idInternal;clipInternal;constructor({pitch:t,velocity:e,startTick:n,endTick:r,id:i,clip:s}){this.pitch=t,this.velocity=e,this.startTick=n,this.endTick=r,this.idInternal=i,this.clipInternal=s}getPitch(){return this.pitch}setPitch(t){if(!bn.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=Math.max(Math.min(t,127),0)}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}deleteFromParent(){this.clipInternal&&this.clipInternal.deleteNote(this)}moveNote(t){if(0===t)return;const e=this.clipInternal;e&&e.deleteNote(this),this.startTick=Math.max(0,this.startTick+t),this.endTick=this.endTick+t,this.isRangeValid()&&e&&e.orderedInsertNote(e.getRawNotes(),this)}adjustLeft(t){if(0===t)return;const e=this.clipInternal;e&&e.deleteNote(this),this.startTick+=t,this.isRangeValid()&&e&&e.orderedInsertNote(e.getRawNotes(),this)}adjustLeftTo(t){this.adjustLeft(t-this.startTick)}adjustRight(t){this.endTick+=t,this.isRangeValid()||this.deleteFromParent()}adjustRightTo(t){this.adjustRight(t-this.endTick)}isRangeValid(){return bn.isNoteRangeValid(this.startTick,this.endTick)}static isValidPitch(t){return t>=0&&t<=127&&Number.isInteger(t)}static isNoteRangeValid(t,e){return e>=0&&t<=e&&Number.isInteger(t)&&Number.isInteger(e)}static isNoteVelocityValid(t){return t>=0&&t<=127&&Number.isInteger(t)}getClip(){return this.clipInternal}adjustPitch(t){this.pitch=this.pitch+t,bn.isValidPitch(this.pitch)||this.deleteFromParent()}getId(){return this.idInternal}}class Sn{track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;constructor({track:t,id:e=Sn.generateClipIdInternal(),clipStartTick:n=0,clipEndTick:r=0}){this.track=t,this.id=e,this.notes=[],this.clipStartTick=n,this.clipEndTick=r}getId(){return this.id}getNotes(){return Sn.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:e,startTick:n,endTick:r,updateClipRange:i=!0,resolveClipConflict:s=!0}){if(!bn.isValidPitch(t)||!bn.isNoteRangeValid(n,r)||!bn.isNoteVelocityValid(e))return null;const o=new bn({pitch:t,velocity:e,startTick:n,endTick:r,id:this.getNextNoteIdInternal()});return n<this.clipStartTick&&i&&this.adjustClipLeft(n,s),r>this.clipEndTick&&i&&this.adjustClipRight(r,s),this.orderedInsertNote(this.notes,o),o}getNoteIndexInternal(t){const e=un(this.notes,t,((t,e)=>t.getStartTick()-e.getStartTick()));for(let n=Math.max(0,e);n<this.notes.length;n+=1){const e=this.notes[n];if(e&&e===t)return n;if(e&&e.getStartTick()>t.getStartTick())break}return-1}deleteNote(t){const e=this.getNoteIndexInternal(t);e>=0&&this.deleteNoteAt(e)}deleteNoteAt(t){const e=this.notes[t];e&&(e.clipInternal=null,this.notes.splice(t,1))}orderedInsertNote(t,e){if(e.getClip()===this)return;const n=on(t,e,((t,e)=>t.getStartTick()-e.getStartTick()));n<0?t.push(e):t.splice(n,0,e),e.clipInternal=this}adjustClipLeft(t,e=!0){(t=Math.max(0,t))>this.clipEndTick?this.deleteFromParent(!0):(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,e=!0){t<this.clipStartTick||t<0?this.deleteFromParent(!0):(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t,e){const n=Math.max(0,this.clipStartTick+t),r=this.clipEndTick+t;if(r<0)return void this.deleteFromParent(!0);if(this.track&&this.track.resolveClipConflictInternal(this.getId(),n,r),this.track){const t=this.track.getClipIndex(this);this.track.deleteClipAt(t,!1)}const i=this.clipStartTick,s=this.clipEndTick;this.clipStartTick=n,this.clipEndTick=r;for(const o of this.notes)o.setStartTick(o.getStartTick()+t),o.setEndTick(o.getEndTick()+t);this.track&&(this.track.orderedInsertClipInternal(this),e&&this.track.getAutomation().moveAllPointsWithinRange(i,s,t,0))}moveClipTo(t,e){const n=t-this.getClipStartTick();this.moveClip(n,e)}deleteFromParent(t){this.track&&(this.track.deleteClip(this,t),this.track=void 0)}getNotesByIds(t){const e=new Set(t),n=[];for(const r of this.notes)e.has(r.getId())&&n.push(r);return n}static getNotesInRange(t,e,n){return Sn.getNotesInRangeImpl(t,e,n,(t=>({getStartTick:()=>t})),(t=>t.getStartTick()),(t=>t.getEndTick()))}static getNotesInRangeImpl(t,e,n,r,i,s){let o=Math.max(0,un(t,r(e),((t,e)=>i(t)-i(e))));for(;t[o]&&!Sn.isNoteInClip(i(t[o]),s(t[o]),e,n);)o+=1;if(o>=t.length)return[];let a=Math.min(t.length-1,an(t,r(n),((t,e)=>i(t)-i(e))));for(;t[a]&&!Sn.isNoteInClip(i(t[a]),s(t[a]),e,n);)a-=1;return a<0||a<o?[]:t.slice(o,a+1)}static isNoteInClip(t,e,n,r){return(t>=n||0===n&&t<=0)&&t<=r&&e>=t}static getNotePlayableRange(t,e,n,r){if(!Sn.isNoteInClip(t,e,n,r))return null;const i=Math.max(t,n),s=Math.min(e,r);return i>s?null:{startTick:i,endTick:s}}trimConflictPartInternal(t,e){const n=Math.max(t,this.getClipStartTick()),r=Math.min(e,this.getClipEndTick());if(!(n>r||n>this.getClipEndTick()||r<this.getClipStartTick()))if(r>=this.getClipEndTick()&&n<=this.getClipStartTick())this.deleteFromParent(!0);else if(r<this.getClipEndTick()&&n>this.getClipStartTick()){const t=r+1,e=this.getClipEndTick();if(this.adjustClipRight(n-1,!1),this.track){const n=this.track.createClip({clipStartTick:t,clipEndTick:e}),r=Sn.getNotesInRange(this.notes,t,e);for(const t of r)n.createNote({pitch:t.getPitch(),velocity:t.getVelocity(),startTick:t.getStartTick(),endTick:t.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}}else n>this.getClipStartTick()&&n<=this.getClipEndTick()?this.adjustClipRight(n-1,!1):r<this.getClipEndTick()&&r>=this.getClipStartTick()&&this.adjustClipLeft(r+1,!1)}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return Xe(10)}}var Pn,wn,xn;exports.AutomationTargetType=void 0,(Pn=exports.AutomationTargetType||(exports.AutomationTargetType={}))[Pn.UNDEFINED=0]="UNDEFINED",Pn[Pn.VOLUME=1]="VOLUME",Pn[Pn.PAN=2]="PAN",Pn[Pn.AUDIO_PLUGIN=3]="AUDIO_PLUGIN";class Cn{type;pluginInstanceId;paramId;constructor(t,e,n){this.type=t,this.pluginInstanceId=e,this.paramId=n}getType(){return this.type}setType(t){this.type=t}getPluginInstanceId(){return this.pluginInstanceId}setPluginInstanceId(t){this.pluginInstanceId=t}getParamId(){return this.paramId}setParamId(t){this.paramId=t}equals(t){return Cn.areAutomationTargetsEqual(this.getType(),t.getType(),this.getPluginInstanceId(),t.getPluginInstanceId(),this.getParamId(),t.getParamId())}clone(){return new Cn(this.type,this.pluginInstanceId,this.paramId)}toTfAutomationTargetId(){return Cn.encodeAutomationTarget(this.type,this.pluginInstanceId,this.paramId)}static fromTfAutomationTargetId(t){return Cn.decodeAutomationTarget(t)}static encodeAutomationTarget(t,e,n){return 3===t?`${t}^^${e}^^${n}`:`${t}`}static decodeAutomationTarget(t){const e=t.split("^^");if(0===e.length)throw new Error(`Invalid automation target id: ${t}`);const n=Number(e[0]);return e.length>2?new Cn(n,e[1],e[2]):new Cn(n)}static areAutomationTargetsEqual(t,e,n,r,i,s){return Cn.encodeAutomationTarget(t,n,i)===Cn.encodeAutomationTarget(e,r,s)}}class _n{points=[];disabled=!1;nextPointIdInternal=1;getDisabled(){return this.disabled}setDisabled(t){this.disabled=t}getPoints(){return this.points}getPointsInRange(t,e){return _n.getPointsInRangeImpl(this.points,t,e)}static getPointsInRangeImpl(t,e,n){const r=[];for(let i=on(t,{tick:e},((t,e)=>t.tick-e.tick));i<t.length;i+=1){const e=t[i];if(e.tick>n)break;r.push(e)}return r}addPoint(t,e,n=!1){const r={tick:t,value:e,id:this.getNextPointIdInternal()};return _n.orderedInsertPointInternal(this.points,r,n),r}removePoints(t){const e=new Set(t);for(let n=this.points.length-1;n>=0;n-=1){const t=this.points[n];e.has(t.id)&&this.points.splice(n,1)}}removePointsInRange(t,e){const n=on(this.points,{tick:t},((t,e)=>t.tick-e.tick));if(n>=this.points.length)return;let r=n;for(;r+1<this.points.length&&this.points[r+1].tick<=e;)r+=1;this.points.splice(n,r-n+1)}movePointsInRange(t,e,n,r,i=!0){const s=this.getPointsInRange(t,e);this.movePoints(s.map((t=>t.id)),n,r,i)}movePoints(t,e,n,r=!0){if(0===t.length)return;const i=new Set(t);let s,o;const a=[];for(let u=0;u<this.points.length;u+=1){const t=this.points[u];i.has(t.id)&&(a.push(t),void 0===s&&(s=u),o=u)}if(void 0!==s&&void 0!==o){if(r)if(e<0){const t=Math.max(0,this.points[s].tick+e),n=an(this.points,{tick:t},((t,e)=>t.tick-e.tick));n<s&&this.points.splice(n,s-n)}else if(e>0){const t=this.points[o].tick+e,n=un(this.points,{tick:t},((t,e)=>t.tick-e.tick));n>o&&this.points.splice(o+1,n-o)}for(const t of a)t.tick=Math.max(0,t.tick+e),t.value=Math.max(0,Math.min(1,t.value+n));Math.abs(e)>0&&this.points.sort(((t,e)=>t.tick-e.tick))}}getNextPointIdInternal(){const t=this.nextPointIdInternal;return this.nextPointIdInternal>=2147483647?this.nextPointIdInternal=1:this.nextPointIdInternal+=1,t}static orderedInsertPointInternal(t,e,n=!1){const r=on(t,e,((t,e)=>t.tick-e.tick));for(;n&&t[r]&&t[r].tick===e.tick;)t.splice(r,1);t.splice(r,0,e)}}class An{targets=[];targetValues={};getAutomationTargets(){return this.targets}getAutomationTargetValues(){return this.targetValues}getOrCreateAutomationValueById(t){return this.targetValues[t]||(this.targetValues[t]=new _n),this.targetValues[t]}getAutomationValueById(t){return this.targetValues[t]}getAutomationValueByTarget(t){const e=t.toTfAutomationTargetId();return this.getAutomationValueById(e)}addAutomation(t,e=0){He.isNumber(e)||(e=0),this.targets.splice(e,0,t);const n=t.toTfAutomationTargetId();this.getAutomationValueById(n)||(this.targetValues[n]=new _n)}removeAutomation(t){for(let n=this.targets.length-1;n>=0;n-=1){this.targets[n].equals(t)&&this.targets.splice(n,1)}const e=t.toTfAutomationTargetId();delete this.targetValues[e]}removeAutomationOfPlugin(t){for(let e=this.targets.length-1;e>=0;e-=1){const n=this.targets[e];n.getPluginInstanceId()===t&&this.removeAutomation(n)}for(const e of He.keys(this.targetValues)){const n=Cn.decodeAutomationTarget(e);n.getPluginInstanceId()===t&&this.removeAutomation(n)}}removeAllPointsWithinRange(t,e){for(const n of He.keys(this.targetValues)){this.targetValues[n].removePointsInRange(t,e)}}moveAllPointsWithinRange(t,e,n,r){for(const i of He.keys(this.targetValues)){this.targetValues[i].movePointsInRange(t,e,n,r,!1)}}}class En{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;pan;samplerPlugin;audioPlugins=[];song;automation;constructor({song:t,uuid:e=En.generateTrackIdInternal(),clips:n=[],instrument:r=new Nn({program:0,isDrum:!1}),suggestedInstruments:i=[],volume:s=1,solo:o=!1,muted:a=!1,rank:u=0,pan:c=0}){this.song=t,this.insturment=r,this.clips=[...n],this.suggestedInstruments=[...i],this.uuid=e,this.volume=s,this.solo=o,this.muted=a,this.rank=u,this.pan=c,this.automation=new An}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:e}){this.insturment=new Nn({program:t,isDrum:e})}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:e}){const n=new Nn({program:t,isDrum:e});return this.suggestedInstruments.push(n),n}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}setPan(t){this.pan=t}getPan(){return this.pan}getSolo(){return this.solo}setSolo(t){this.solo=t,t&&this.muted&&(this.muted=!1)}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const e=vn(t);return new yn(e.name,e.manufacturerName,e.pluginFormatName,e.pluginVersion)}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t,e=!0){const n=!this.samplerPlugin&&!!t||!t&&!!this.samplerPlugin||!!t&&!!this.samplerPlugin&&!t.matchesTfId(this.samplerPlugin.getTuneflowId()),r=this.samplerPlugin;this.samplerPlugin=t,n&&r&&e&&this.automation.removeAutomationOfPlugin(r.getInstanceId())}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return this.clips&&0!==this.clips.length?this.clips[0].getClipStartTick():0}getTrackEndTick(){return this.clips&&0!==this.clips.length?this.clips[this.clips.length-1].getClipEndTick():0}getClipById(t){for(const e of this.clips)if(e.getId()===t)return e;return null}getClips(){return this.clips}getClipsOverlappingWith(t,e){const n=[],r=un(this.clips,{getClipStartTick:()=>t},((t,e)=>t.getClipStartTick()-e.getClipStartTick()));for(let i=Math.max(r,0);i<this.clips.length;i+=1){const r=this.clips[i];if(!(r.getClipEndTick()<t)){if(r.getClipStartTick()>e)break;n.push(r)}}return n}createClip({clipStartTick:t,clipEndTick:e,insertClip:n=!0}){if(null==t)throw new Error("clipStartTick must be specified when creating a clip.");const r=null==e?t+1:e;if(r<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${e}`);const i=new Sn({id:Sn.generateClipIdInternal(),track:void 0,clipStartTick:t,clipEndTick:r});return n&&this.insertClip(i),i}insertClip(t){t.getTrack()!==this&&(t.getTrack()&&t.deleteFromParent(!1),t.track=this,this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t))}cloneClip(t){const e=this.createClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const n of t.getRawNotes())e.createNote({pitch:n.getPitch(),velocity:n.getVelocity(),startTick:n.getStartTick(),endTick:n.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return e}getClipIndex(t){const e=cn(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));return this.clips.indexOf(t,e)}deleteClip(t,e){const n=this.getClipIndex(t);this.deleteClipAt(n,e)}deleteClipAt(t,e){if(!(t<0)){if(e){const e=this.clips[t];if(!e)return;this.automation.removeAllPointsWithinRange(e.getClipStartTick(),e.getClipEndTick())}this.clips.splice(t,1)}}deleteFromParent(){this.song.removeTrack(this.getId())}getAutomation(){return this.automation}hasAnyAutomation(){return this.automation.getAutomationTargets().length>0&&!He.isEmpty(this.automation.getAutomationTargetValues())}static generateTrackIdInternal(){return Xe()}resolveClipConflictInternal(t,e,n){const r=this.getClipsOverlappingWith(e,n);for(const i of r)i.getId()!==t&&i.trimConflictPartInternal(e,n)}orderedInsertClipInternal(t){const e=on(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));this.clips.splice(e,0,t)}}class Nn{program;isDrum;constructor({program:t,isDrum:e}){this.program=t,this.isDrum=e}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new Nn({program:this.program,isDrum:this.isDrum})}}class jn{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return de(this.tracks,(e=>e.getId()===t))}getTracksByIds(t){if(!this.tracks)return[];const e=new Set(t);return this.tracks.filter((t=>e.has(t.getId())))}getTrackIndex(t){return ce(this.tracks,(e=>e.getId()===t))}createTrack({index:t,rank:e}){this.checkAccess("createTrack"),null==e||null===e?e=this.getNextTrackRank():this.nextTrackRank=Math.max(e+1,this.nextTrackRank);const n=new En({song:this,uuid:this.getNextTrackId(),rank:null==e||null===e?this.getNextTrackRank():e});return null!=t?this.tracks.splice(t,0,n):this.tracks.push(n),n}cloneTrack(t){let e=this.getTrackIndex(t.getId());e<0&&(e=void 0);const n=this.createTrack({index:e});n.setInstrument({program:t.getInstrument().getProgram(),isDrum:t.getInstrument().getIsDrum()});for(const i of t.getSuggestedInstruments())n.createSuggestedInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});n.setVolume(t.getVolume()),n.setPan(t.getPan()),n.setSolo(t.getSolo()),n.setMuted(t.getMuted());const r=t.getSamplerPlugin();r&&n.setSamplerPlugin(r.clone(n));for(const i of t.getAudioPlugins())n.addAudioPlugin(i.clone(n));for(const i of t.getClips()){const t=n.createClip({clipStartTick:i.getClipStartTick(),clipEndTick:i.getClipEndTick()});for(const e of i.getRawNotes())t.createNote({pitch:e.getPitch(),velocity:e.getVelocity(),startTick:e.getStartTick(),endTick:e.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return n}removeTrack(t){this.checkAccess("removeTrack");const e=this.getTrackById(t);return e?(this.tracks.splice(ce(this.tracks,(e=>e.getId()===t)),1),e):null}getResolution(){return this.PPQ}getBeatsPerBar(){return this.getTimeSignatures()[0].getNumerator()}getTicksPerBar(){return this.getBeatsPerBar()*this.getResolution()}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:e}){if(0===this.tempos.length&&0!==t)throw new Error("The first tempo event must be at tick 0");const n=new pn({ticks:t,bpm:e,time:this.tickToSeconds(t)}),r=on(this.tempos,n,((t,e)=>t.getTicks()-e.getTicks()));return r<0?this.tempos.push(n):this.tempos.splice(r,0,n),this.retimingTempoEvents(),n}overwriteTempoChanges(t){if(0===t.length)throw new Error("Cannot clear all the tempo events.");const e=hn(t);e.sort(((t,e)=>t.getTicks()-e.getTicks()));const n=e[0];if(n.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new pn({ticks:0,time:0,bpm:n.getBpm()})];for(let r=1;r<e.length;r+=1){const t=e[r];this.createTempoChange({ticks:t.getTicks(),bpm:t.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=hn(t)}updateTempo(t,e){t.setBpmInternal(e),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:e,denominator:n}){const r=new gn({ticks:t,numerator:e,denominator:n}),i=on(this.timeSignatures,r,((t,e)=>t.getTicks()-e.getTicks()));return i<0?this.timeSignatures.push(r):this.timeSignatures.splice(i,0,r),r}getLastTick(){let t=0;for(const e of this.tracks)t=Math.max(t,e.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}tickToSeconds(t){if(0===t)return 0;const e=un(this.getTempoChanges(),{getTicks:()=>t},((t,e)=>t.getTicks()-e.getTicks()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTicks(),i=jn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return n.getTime()+r/i}secondsToTick(t){const e=un(this.getTempoChanges(),{getTime:()=>t},((t,e)=>t.getTime()-e.getTime()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTime(),i=jn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return Math.round(n.getTicks()+r*i)}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}clearPluginContextInternal(){this.pluginContext=void 0}getNextTrackId(){const t=this.pluginContext,e=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===e.length)e.push(En.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>e.length)throw new Error("Plugin generated track ids out of sync.");const n=e[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,n}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,e){return t*e/60}retimingTempoEvents(){this.tempos.sort(((t,e)=>t.getTicks()-e.getTicks()));for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}exports.WidgetType=void 0,(wn=exports.WidgetType||(exports.WidgetType={}))[wn.Slider=1]="Slider",wn[wn.Input=2]="Input",wn[wn.TrackSelector=3]="TrackSelector",wn[wn.Pitch=4]="Pitch",wn[wn.TrackPitchSelector=5]="TrackPitchSelector",wn[wn.InstrumentSelector=6]="InstrumentSelector",wn[wn.Select=7]="Select",wn[wn.Switch=8]="Switch",wn[wn.InputNumber=9]="InputNumber",wn[wn.MultiTrackSelector=10]="MultiTrackSelector",wn[wn.None=11]="None",wn[wn.FileSelector=12]="FileSelector",exports.InjectSource=void 0,(xn=exports.InjectSource||(exports.InjectSource={}))[xn.SelectedTrackIds=1]="SelectedTrackIds",xn[xn.SelectedClipInfos=2]="SelectedClipInfos",xn[xn.TickAtPlayhead=3]="TickAtPlayhead",xn[xn.EditingClipInfo=4]="EditingClipInfo",xn[xn.EditingNoteIds=5]="EditingNoteIds",exports.AudioPlugin=yn,exports.AutomationData=An,exports.AutomationTarget=Cn,exports.AutomationValue=_n,exports.Clip=Sn,exports.Note=bn,exports.Song=jn,exports.TempoEvent=pn,exports.TickToSecondStepper=class{tempoInfos=[];currentTempoIndex=0;ticksPerSecondAtTempoTick={};constructor(t){for(const e of t.getTempoChanges())this.tempoInfos.push({ticks:e.getTicks(),time:e.getTime()}),this.ticksPerSecondAtTempoTick[e.getTicks()]=e.getBpm()*t.getResolution()/60}tickToSeconds(t){let e=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].ticks<=t;)this.currentTempoIndex+=1,e=this.tempoInfos[this.currentTempoIndex];for(;e.ticks>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,e=this.tempoInfos[this.currentTempoIndex];e.ticks;const n=t-e.ticks,r=this.ticksPerSecondAtTempoTick[e.ticks];return e.time+n/r}},exports.TimeSignatureEvent=gn,exports.Track=En,exports.TuneflowPipeline=class{plugins=[];threwErrorInLastRun=!1;maxNumPluginsToKeep=50;originalSong;cloneSongFnInternal;addPlugin(t){this.plugins.push(t),this.maintainPluginListSize()}addPluginAt(t,e){this.plugins.splice(e,0,t),this.maintainPluginListSize()}removePlugin(t){this.plugins.splice(this.plugins.indexOf(t),1)}getPlugins(){return this.plugins}resetCache(){for(const t of this.plugins)delete t.songCacheInternal}setOriginalSong(t){this.originalSong=t}hasOriginalSong(){return!!this.originalSong}async run(t=0){if(!this.originalSong)return this.threwErrorInLastRun=!0,null;let e;t=Math.max(0,t),this.threwErrorInLastRun=!1;const n=this.getIndexOfLatestPluginWithCacheBeforeIndex(t);e=n>=0?await this.cloneSong(this.plugins[n].songCacheInternal):await this.cloneSong(this.originalSong);for(let s=t;s<this.plugins.length;s+=1)delete this.plugins[s].songCacheInternal;for(let s=0;s<=n;s+=1){this.plugins[s].isRollbackable=!0}let r=0;for(let s=n>=0?n+1:0;s<this.plugins.length;s+=1){const t=this.plugins[s];if(!t.enabledInternal)return e;if(!t.hasAllParamsSet())return e;e.setPluginContextInternal(t);try{await t.run(e,t.getParamsInternal()),e.clearPluginContextInternal()}catch(i){this.threwErrorInLastRun=!0,e.clearPluginContextInternal();const t=this.getIndexOfLatestPluginWithCacheBeforeIndex(s);return t>=0?await this.cloneSong(this.plugins[t].songCacheInternal):await this.cloneSong(this.originalSong)}t.songCacheInternal=await this.cloneSong(e),t.isRollbackable=!0,r+=1}return e}async cloneSong(t){if(!this.cloneSongFnInternal)throw new Error("Pipeline is not provided with a clone song function.");return this.cloneSongFnInternal(t)}reset(){for(const t of this.plugins)t.resetInternal()}clear(){this.plugins.splice(0,this.plugins.length),this.originalSong=void 0}movePluginUp(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<=0||this.plugins.splice(e-1,0,this.plugins.splice(e,1)[0])}movePluginDown(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<0||e>=this.plugins.length-1||this.plugins.splice(e,0,this.plugins.splice(e+1,1)[0])}isPluginFunctioning(t){return!!t.songCacheInternal}getPluginIndexByPluginInstanceId(t){return ce(this.plugins,(e=>e.instanceId===t))}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getLastFunctioningPlugin(){for(let t=this.plugins.length-1;t>=0;t-=1)if(this.isPluginFunctioning(this.plugins[t]))return this.plugins[t];return null}getPluginCache(t){return t.songCacheInternal}setMaxNumPluginsToKeep(t){this.maxNumPluginsToKeep=t,this.maintainPluginListSize()}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let e=t-1;e>=0;e-=1)if(this.getPluginCache(this.plugins[e]))return e;return-1}maintainPluginListSize(){for(;this.plugins.length>this.maxNumPluginsToKeep&&this.plugins.length>0;)this.plugins.shift()}},exports.TuneflowPlugin=Ye,exports.areTuneflowIdsEqual=kn,exports.areTuneflowIdsEqualIgnoreVersion=Tn,exports.decodeAudioPluginTuneflowId=vn,exports.getAudioPluginTuneflowId=mn,exports.getAudioPluginVersionlessTuneflowId=In,exports.midiNumberToPitch=function(t){const e=Math.floor(t/12)-1;return function(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}(t)+e.toString()},exports.pitchToMidiNumber=function(t){const e=fn.exec(t);if(!e)return-1;const n=e[1],r=e[2];return dn[n.toLowerCase()]+12*(parseInt(r,10)+1)},exports.toVersionlessTfId=function(t){const e=vn(t);return In(e.manufacturerName,e.pluginFormatName,e.name)};
