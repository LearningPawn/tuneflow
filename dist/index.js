"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var qi="1.13.2",hi=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},tn=Array.prototype,Wn=Object.prototype,pi=typeof Symbol<"u"?Symbol.prototype:null,ru=tn.push,ge=tn.slice,ce=Wn.toString,iu=Wn.hasOwnProperty,Hi=typeof ArrayBuffer<"u",su=typeof DataView<"u",ou=Array.isArray,di=Object.keys,gi=Object.create,mi=Hi&&ArrayBuffer.isView,au=isNaN,uu=isFinite,zi=!{toString:null}.propertyIsEnumerable("toString"),Ii=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],cu=Math.pow(2,53)-1;function L(e,t){return t=t==null?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var s=Array(t+1);for(i=0;i<t;i++)s[i]=arguments[i];return s[t]=r,e.apply(this,s)}}function At(e){var t=typeof e;return t==="function"||t==="object"&&!!e}function lu(e){return e===null}function Ki(e){return e===void 0}function Gi(e){return e===!0||e===!1||ce.call(e)==="[object Boolean]"}function fu(e){return!!(e&&e.nodeType===1)}function O(e){var t="[object "+e+"]";return function(n){return ce.call(n)===t}}const jn=O("String"),Ji=O("Number"),hu=O("Date"),pu=O("RegExp"),du=O("Error"),Wi=O("Symbol"),ji=O("ArrayBuffer");var Yi=O("Function"),gu=hi.document&&hi.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof gu!="function"&&(Yi=function(e){return typeof e=="function"||!1});const F=Yi,Xi=O("Object");var Qi=su&&Xi(new DataView(new ArrayBuffer(8))),Yn=typeof Map<"u"&&Xi(new Map),mu=O("DataView");function Iu(e){return e!=null&&F(e.getInt8)&&ji(e.buffer)}const He=Qi?Iu:mu,Mt=ou||O("Array");function gt(e,t){return e!=null&&iu.call(e,t)}var On=O("Arguments");(function(){On(arguments)||(On=function(e){return gt(e,"callee")})})();const Xn=On;function vu(e){return!Wi(e)&&uu(e)&&!isNaN(parseFloat(e))}function Zi(e){return Ji(e)&&au(e)}function ts(e){return function(){return e}}function es(e){return function(t){var n=e(t);return typeof n=="number"&&n>=0&&n<=cu}}function ns(e){return function(t){return t?.[e]}}const ze=ns("byteLength"),Tu=es(ze);var yu=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function bu(e){return mi?mi(e)&&!He(e):Tu(e)&&yu.test(ce.call(e))}const rs=Hi?bu:ts(!1),q=ns("length");function wu(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(i){return t[i]===!0},push:function(i){return t[i]=!0,e.push(i)}}}function is(e,t){t=wu(t);var n=Ii.length,r=e.constructor,i=F(r)&&r.prototype||Wn,s="constructor";for(gt(e,s)&&!t.contains(s)&&t.push(s);n--;)s=Ii[n],s in e&&e[s]!==i[s]&&!t.contains(s)&&t.push(s)}function _(e){if(!At(e))return[];if(di)return di(e);var t=[];for(var n in e)gt(e,n)&&t.push(n);return zi&&is(e,t),t}function ku(e){if(e==null)return!0;var t=q(e);return typeof t=="number"&&(Mt(e)||jn(e)||Xn(e))?t===0:q(_(e))===0}function ss(e,t){var n=_(t),r=n.length;if(e==null)return!r;for(var i=Object(e),s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0}function T(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e}T.VERSION=qi;T.prototype.value=function(){return this._wrapped};T.prototype.valueOf=T.prototype.toJSON=T.prototype.value;T.prototype.toString=function(){return String(this._wrapped)};function vi(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,ze(e))}var Ti="[object DataView]";function An(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return!1;if(e!==e)return t!==t;var i=typeof e;return i!=="function"&&i!=="object"&&typeof t!="object"?!1:os(e,t,n,r)}function os(e,t,n,r){e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=ce.call(e);if(i!==ce.call(t))return!1;if(Qi&&i=="[object Object]"&&He(e)){if(!He(t))return!1;i=Ti}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:+e==0?1/+e===1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return pi.valueOf.call(e)===pi.valueOf.call(t);case"[object ArrayBuffer]":case Ti:return os(vi(e),vi(t),n,r)}var s=i==="[object Array]";if(!s&&rs(e)){var o=ze(e);if(o!==ze(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if(typeof e!="object"||typeof t!="object")return!1;var a=e.constructor,c=t.constructor;if(a!==c&&!(F(a)&&a instanceof a&&F(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var l=n.length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),s){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!An(e[l],t[l],n,r))return!1}else{var p=_(e),h;if(l=p.length,_(t).length!==l)return!1;for(;l--;)if(h=p[l],!(gt(t,h)&&An(e[h],t[h],n,r)))return!1}return n.pop(),r.pop(),!0}function _u(e,t){return An(e,t)}function me(e){if(!At(e))return[];var t=[];for(var n in e)t.push(n);return zi&&is(e,t),t}function Qn(e){var t=q(e);return function(n){if(n==null)return!1;var r=me(n);if(q(r))return!1;for(var i=0;i<t;i++)if(!F(n[e[i]]))return!1;return e!==cs||!F(n[Zn])}}var Zn="forEach",as="has",tr=["clear","delete"],us=["get",as,"set"],Su=tr.concat(Zn,us),cs=tr.concat(us),xu=["add"].concat(tr,Zn,as);const Pu=Yn?Qn(Su):O("Map"),Cu=Yn?Qn(cs):O("WeakMap"),Eu=Yn?Qn(xu):O("Set"),Nu=O("WeakSet");function Wt(e){for(var t=_(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function Ou(e){for(var t=_(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r}function ls(e){for(var t={},n=_(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function Mn(e){var t=[];for(var n in e)F(e[n])&&t.push(n);return t.sort()}function er(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||n==null)return n;for(var i=1;i<r;i++)for(var s=arguments[i],o=e(s),a=o.length,c=0;c<a;c++){var l=o[c];(!t||n[l]===void 0)&&(n[l]=s[l])}return n}}const fs=er(me),Ke=er(_),hs=er(me,!0);function Au(){return function(){}}function ps(e){if(!At(e))return{};if(gi)return gi(e);var t=Au();t.prototype=e;var n=new t;return t.prototype=null,n}function Mu(e,t){var n=ps(e);return t&&Ke(n,t),n}function Vu(e){return At(e)?Mt(e)?e.slice():fs({},e):e}function Du(e,t){return t(e),e}function ds(e){return Mt(e)?e:[e]}T.toPath=ds;function Ie(e){return T.toPath(e)}function nr(e,t){for(var n=t.length,r=0;r<n;r++){if(e==null)return;e=e[t[r]]}return n?e:void 0}function gs(e,t,n){var r=nr(e,Ie(t));return Ki(r)?n:r}function Fu(e,t){t=Ie(t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(!gt(e,i))return!1;e=e[i]}return!!n}function rr(e){return e}function le(e){return e=Ke({},e),function(t){return ss(t,e)}}function ir(e){return e=Ie(e),function(t){return nr(t,e)}}function ve(e,t,n){if(t===void 0)return e;switch(n??3){case 1:return function(r){return e.call(t,r)};case 3:return function(r,i,s){return e.call(t,r,i,s)};case 4:return function(r,i,s,o){return e.call(t,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function ms(e,t,n){return e==null?rr:F(e)?ve(e,t,n):At(e)&&!Mt(e)?le(e):ir(e)}function sr(e,t){return ms(e,t,1/0)}T.iteratee=sr;function z(e,t,n){return T.iteratee!==sr?T.iteratee(e,t):ms(e,t,n)}function Uu(e,t,n){t=z(t,n);for(var r=_(e),i=r.length,s={},o=0;o<i;o++){var a=r[o];s[a]=t(e[a],a,e)}return s}function Is(){}function Ru(e){return e==null?Is:function(t){return gs(e,t)}}function Bu(e,t,n){var r=Array(Math.max(0,e));t=ve(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r}function Vn(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}const fe=Date.now||function(){return new Date().getTime()};function vs(e){var t=function(s){return e[s]},n="(?:"+_(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(s){return s=s==null?"":""+s,r.test(s)?s.replace(i,t):s}}const Ts={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$u=vs(Ts),Lu=ls(Ts),qu=vs(Lu),Hu=T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var wn=/(.)^/,zu={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ku=/\\|'|\r|\n|\u2028|\u2029/g;function Gu(e){return"\\"+zu[e]}var Ju=/^\s*(\w|\$)+\s*$/;function Wu(e,t,n){!t&&n&&(t=n),t=hs({},t,T.templateSettings);var r=RegExp([(t.escape||wn).source,(t.interpolate||wn).source,(t.evaluate||wn).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(l,p,h,g,I){return s+=e.slice(i,I).replace(Ku,Gu),i=I+l.length,p?s+=`'+
((__t=(`+p+`))==null?'':_.escape(__t))+
'`:h?s+=`'+
((__t=(`+h+`))==null?'':__t)+
'`:g&&(s+=`';
`+g+`
__p+='`),l}),s+=`';
`;var o=t.variable;if(o){if(!Ju.test(o))throw new Error("variable is not a bare identifier: "+o)}else s=`with(obj||{}){
`+s+`}
`,o="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var a;try{a=new Function(o,"_",s)}catch(l){throw l.source=s,l}var c=function(l){return a.call(this,l,T)};return c.source="function("+o+`){
`+s+"}",c}function ju(e,t,n){t=Ie(t);var r=t.length;if(!r)return F(n)?n.call(e):n;for(var i=0;i<r;i++){var s=e?.[t[i]];s===void 0&&(s=n,i=r),e=F(s)?s.call(e):s}return e}var Yu=0;function Xu(e){var t=++Yu+"";return e?e+t:t}function Qu(e){var t=T(e);return t._chain=!0,t}function ys(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var s=ps(e.prototype),o=e.apply(s,i);return At(o)?o:s}var jt=L(function(e,t){var n=jt.placeholder,r=function(){for(var i=0,s=t.length,o=Array(s),a=0;a<s;a++)o[a]=t[a]===n?arguments[i++]:t[a];for(;i<arguments.length;)o.push(arguments[i++]);return ys(e,r,this,this,o)};return r});jt.placeholder=T;const bs=L(function(e,t,n){if(!F(e))throw new TypeError("Bind must be called on a function");var r=L(function(i){return ys(e,r,t,this,n.concat(i))});return r}),j=es(q);function Vt(e,t,n,r){if(r=r||[],!t&&t!==0)t=1/0;else if(t<=0)return r.concat(e);for(var i=r.length,s=0,o=q(e);s<o;s++){var a=e[s];if(j(a)&&(Mt(a)||Xn(a)))if(t>1)Vt(a,t-1,n,r),i=r.length;else for(var c=0,l=a.length;c<l;)r[i++]=a[c++];else n||(r[i++]=a)}return r}const Zu=L(function(e,t){t=Vt(t,!1,!1);var n=t.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=bs(e[r],e)}return e});function tc(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return gt(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n}const ws=L(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),ec=jt(ws,T,1);function nc(e,t,n){var r,i,s,o,a=0;n||(n={});var c=function(){a=n.leading===!1?0:fe(),r=null,o=e.apply(i,s),r||(i=s=null)},l=function(){var p=fe();!a&&n.leading===!1&&(a=p);var h=t-(p-a);return i=this,s=arguments,h<=0||h>t?(r&&(clearTimeout(r),r=null),a=p,o=e.apply(i,s),r||(i=s=null)):!r&&n.trailing!==!1&&(r=setTimeout(c,h)),o};return l.cancel=function(){clearTimeout(r),a=0,r=i=s=null},l}function rc(e,t,n){var r,i,s,o,a,c=function(){var p=fe()-i;t>p?r=setTimeout(c,t-p):(r=null,n||(o=e.apply(a,s)),r||(s=a=null))},l=L(function(p){return a=this,s=p,i=fe(),r||(r=setTimeout(c,t),n&&(o=e.apply(a,s))),o});return l.cancel=function(){clearTimeout(r),r=s=a=null},l}function ic(e,t){return jt(t,e)}function or(e){return function(){return!e.apply(this,arguments)}}function sc(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}function oc(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function ks(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}const ac=jt(ks,2);function _s(e,t,n){t=z(t,n);for(var r=_(e),i,s=0,o=r.length;s<o;s++)if(i=r[s],t(e[i],i,e))return i}function Ss(e){return function(t,n,r){n=z(n,r);for(var i=q(t),s=e>0?0:i-1;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}const Kt=Ss(1),xs=Ss(-1);function Ps(e,t,n,r){n=z(n,r,1);for(var i=n(t),s=0,o=q(e);s<o;){var a=Math.floor((s+o)/2);n(e[a])<i?s=a+1:o=a}return s}function Cs(e,t,n){return function(r,i,s){var o=0,a=q(r);if(typeof s=="number")e>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(ge.call(r,o,a),Zi),s>=0?s+o:-1;for(s=e>0?o:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}const Es=Cs(1,Kt,Ps),uc=Cs(-1,xs);function Ge(e,t,n){var r=j(e)?Kt:_s,i=r(e,t,n);if(i!==void 0&&i!==-1)return e[i]}function cc(e,t){return Ge(e,le(t))}function at(e,t,n){t=ve(t,n);var r,i;if(j(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=_(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e}function Nt(e,t,n){t=z(t,n);for(var r=!j(e)&&_(e),i=(r||e).length,s=Array(i),o=0;o<i;o++){var a=r?r[o]:o;s[o]=t(e[a],a,e)}return s}function Ns(e){var t=function(n,r,i,s){var o=!j(n)&&_(n),a=(o||n).length,c=e>0?0:a-1;for(s||(i=n[o?o[c]:c],c+=e);c>=0&&c<a;c+=e){var l=o?o[c]:c;i=r(i,n[l],l,n)}return i};return function(n,r,i,s){var o=arguments.length>=3;return t(n,ve(r,s,4),i,o)}}const kn=Ns(1),yi=Ns(-1);function Gt(e,t,n){var r=[];return t=z(t,n),at(e,function(i,s,o){t(i,s,o)&&r.push(i)}),r}function lc(e,t,n){return Gt(e,or(z(t)),n)}function bi(e,t,n){t=z(t,n);for(var r=!j(e)&&_(e),i=(r||e).length,s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0}function wi(e,t,n){t=z(t,n);for(var r=!j(e)&&_(e),i=(r||e).length,s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1}function st(e,t,n,r){return j(e)||(e=Wt(e)),(typeof n!="number"||r)&&(n=0),Es(e,t,n)>=0}const fc=L(function(e,t,n){var r,i;return F(t)?i=t:(t=Ie(t),r=t.slice(0,-1),t=t[t.length-1]),Nt(e,function(s){var o=i;if(!o){if(r&&r.length&&(s=nr(s,r)),s==null)return;o=s[t]}return o==null?o:o.apply(s,n)})});function ar(e,t){return Nt(e,ir(t))}function hc(e,t){return Gt(e,le(t))}function Os(e,t,n){var r=-1/0,i=-1/0,s,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=j(e)?e:Wt(e);for(var a=0,c=e.length;a<c;a++)s=e[a],s!=null&&s>r&&(r=s)}else t=z(t,n),at(e,function(l,p,h){o=t(l,p,h),(o>i||o===-1/0&&r===-1/0)&&(r=l,i=o)});return r}function pc(e,t,n){var r=1/0,i=1/0,s,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=j(e)?e:Wt(e);for(var a=0,c=e.length;a<c;a++)s=e[a],s!=null&&s<r&&(r=s)}else t=z(t,n),at(e,function(l,p,h){o=t(l,p,h),(o<i||o===1/0&&r===1/0)&&(r=l,i=o)});return r}var dc=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function As(e){return e?Mt(e)?ge.call(e):jn(e)?e.match(dc):j(e)?Nt(e,rr):Wt(e):[]}function Ms(e,t,n){if(t==null||n)return j(e)||(e=Wt(e)),e[Vn(e.length-1)];var r=As(e),i=q(r);t=Math.max(Math.min(t,i),0);for(var s=i-1,o=0;o<t;o++){var a=Vn(o,s),c=r[o];r[o]=r[a],r[a]=c}return r.slice(0,t)}function gc(e){return Ms(e,1/0)}function mc(e,t,n){var r=0;return t=z(t,n),ar(Nt(e,function(i,s,o){return{value:i,index:r++,criteria:t(i,s,o)}}).sort(function(i,s){var o=i.criteria,a=s.criteria;if(o!==a){if(o>a||o===void 0)return 1;if(o<a||a===void 0)return-1}return i.index-s.index}),"value")}function en(e,t){return function(n,r,i){var s=t?[[],[]]:{};return r=z(r,i),at(n,function(o,a){var c=r(o,a,n);e(s,o,c)}),s}}const Ic=en(function(e,t,n){gt(e,n)?e[n].push(t):e[n]=[t]}),vc=en(function(e,t,n){e[n]=t}),Tc=en(function(e,t,n){gt(e,n)?e[n]++:e[n]=1}),yc=en(function(e,t,n){e[n?0:1].push(t)},!0);function bc(e){return e==null?0:j(e)?e.length:_(e).length}function wc(e,t,n){return t in n}const Vs=L(function(e,t){var n={},r=t[0];if(e==null)return n;F(r)?(t.length>1&&(r=ve(r,t[1])),t=me(e)):(r=wc,t=Vt(t,!1,!1),e=Object(e));for(var i=0,s=t.length;i<s;i++){var o=t[i],a=e[o];r(a,o,e)&&(n[o]=a)}return n}),kc=L(function(e,t){var n=t[0],r;return F(n)?(n=or(n),t.length>1&&(r=t[1])):(t=Nt(Vt(t,!1,!1),String),n=function(i,s){return!st(t,s)}),Vs(e,n,r)});function Ds(e,t,n){return ge.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))}function _n(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[0]:Ds(e,e.length-t)}function Le(e,t,n){return ge.call(e,t==null||n?1:t)}function _c(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[e.length-1]:Le(e,Math.max(0,e.length-t))}function Sc(e){return Gt(e,Boolean)}function xc(e,t){return Vt(e,t,!1)}const Fs=L(function(e,t){return t=Vt(t,!0,!0),Gt(e,function(n){return!st(t,n)})}),Pc=L(function(e,t){return Fs(e,t)});function Dn(e,t,n,r){Gi(t)||(r=n,n=t,t=!1),n!=null&&(n=z(n,r));for(var i=[],s=[],o=0,a=q(e);o<a;o++){var c=e[o],l=n?n(c,o,e):c;t&&!n?((!o||s!==l)&&i.push(c),s=l):n?st(s,l)||(s.push(l),i.push(c)):st(i,c)||i.push(c)}return i}const Cc=L(function(e){return Dn(Vt(e,!0,!0))});function Ec(e){for(var t=[],n=arguments.length,r=0,i=q(e);r<i;r++){var s=e[r];if(!st(t,s)){var o;for(o=1;o<n&&st(arguments[o],s);o++);o===n&&t.push(s)}}return t}function Fn(e){for(var t=e&&Os(e,q).length||0,n=Array(t),r=0;r<t;r++)n[r]=ar(e,r);return n}const Nc=L(Fn);function Oc(e,t){for(var n={},r=0,i=q(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}function Ac(e,t,n){t==null&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;s<r;s++,e+=n)i[s]=e;return i}function Mc(e,t){if(t==null||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(ge.call(e,r,r+=t));return n}function ur(e,t){return e._chain?T(t).chain():t}function Us(e){return at(Mn(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var r=[this._wrapped];return ru.apply(r,arguments),ur(this,n.apply(T,r))}}),T}at(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=tn[e];T.prototype[e]=function(){var n=this._wrapped;return n!=null&&(t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0]),ur(this,n)}});at(["concat","join","slice"],function(e){var t=tn[e];T.prototype[e]=function(){var n=this._wrapped;return n!=null&&(n=t.apply(n,arguments)),ur(this,n)}});const Vc=Object.freeze(Object.defineProperty({__proto__:null,VERSION:qi,restArguments:L,isObject:At,isNull:lu,isUndefined:Ki,isBoolean:Gi,isElement:fu,isString:jn,isNumber:Ji,isDate:hu,isRegExp:pu,isError:du,isSymbol:Wi,isArrayBuffer:ji,isDataView:He,isArray:Mt,isFunction:F,isArguments:Xn,isFinite:vu,isNaN:Zi,isTypedArray:rs,isEmpty:ku,isMatch:ss,isEqual:_u,isMap:Pu,isWeakMap:Cu,isSet:Eu,isWeakSet:Nu,keys:_,allKeys:me,values:Wt,pairs:Ou,invert:ls,functions:Mn,methods:Mn,extend:fs,extendOwn:Ke,assign:Ke,defaults:hs,create:Mu,clone:Vu,tap:Du,get:gs,has:Fu,mapObject:Uu,identity:rr,constant:ts,noop:Is,toPath:ds,property:ir,propertyOf:Ru,matcher:le,matches:le,times:Bu,random:Vn,now:fe,escape:$u,unescape:qu,templateSettings:Hu,template:Wu,result:ju,uniqueId:Xu,chain:Qu,iteratee:sr,partial:jt,bind:bs,bindAll:Zu,memoize:tc,delay:ws,defer:ec,throttle:nc,debounce:rc,wrap:ic,negate:or,compose:sc,after:oc,before:ks,once:ac,findKey:_s,findIndex:Kt,findLastIndex:xs,sortedIndex:Ps,indexOf:Es,lastIndexOf:uc,find:Ge,detect:Ge,findWhere:cc,each:at,forEach:at,map:Nt,collect:Nt,reduce:kn,foldl:kn,inject:kn,reduceRight:yi,foldr:yi,filter:Gt,select:Gt,reject:lc,every:bi,all:bi,some:wi,any:wi,contains:st,includes:st,include:st,invoke:fc,pluck:ar,where:hc,max:Os,min:pc,shuffle:gc,sample:Ms,sortBy:mc,groupBy:Ic,indexBy:vc,countBy:Tc,partition:yc,toArray:As,size:bc,pick:Vs,omit:kc,first:_n,head:_n,take:_n,initial:Ds,last:_c,rest:Le,tail:Le,drop:Le,compact:Sc,flatten:xc,without:Pc,uniq:Dn,unique:Dn,union:Cc,intersection:Ec,difference:Fs,unzip:Fn,transpose:Fn,zip:Nc,object:Oc,range:Ac,chunk:Mc,mixin:Us,default:T},Symbol.toStringTag,{value:"Module"}));var E=Us(Vc);E._=E;let nn=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class cr{instanceIdInternal=cr.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;songCacheInternal;progress=null;isExecuting=!1;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,n,r){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,n){return t[n]}hasAllParamsSet(){for(const t of _(this.params())){if(this.params()[t].optional)continue;const n=this.paramsResultInternal[t];if(n==null)return!1;const i=this.params()[t].widget.type;switch(i){case V.Input:case V.Pitch:case V.Slider:case V.TrackSelector:case V.Select:case V.Switch:case V.InputNumber:case V.FileSelector:break;case V.MultiTrackSelector:if(n.length===0)return!1;break;case V.TrackPitchSelector:if(n.track===void 0||n.track===null||n.pitch===void 0||n.pitch===null)return!1;break;case V.InstrumentSelector:if(n.program===void 0||n.program===null||n.isDrum===void 0||n.isDrum===null)return!1;break;case V.MultiSourceAudioSelector:if(n==null||n.audioInfo===void 0||n.audioInfo===null)return!1;break;case V.None:if(n==null)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${i}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setProgress(t){this.progress=t}getProgress(){return this.progress}getIsExecuting(){return this.isExecuting}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of _(this.params())){const n=this.params()[t];this.paramsResultInternal[t]=n.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return nn(10)}}class Dc{plugins=[];threwErrorInLastRun=!1;maxNumPluginsToKeep=50;originalSong;cloneSongFnInternal;readApisInternal;activePluginIndex=-1;addAsOrReplaceActivePlugin(t){let n;return this.activePluginIndex<=-1?n=0:this.plugins[this.activePluginIndex].isRollbackable?n=this.activePluginIndex+1:n=this.activePluginIndex,this.plugins.length>0&&this.plugins.splice(n,this.plugins.length-n),this.addPluginAt(t,n),this.getPluginIndexByPluginInstanceId(t.instanceId)}getPlugins(){return this.plugins}resetCache(){for(const t of this.plugins)delete t.songCacheInternal}setOriginalSong(t){this.originalSong=t}hasOriginalSong(){return!!this.originalSong}async run(t=0){if(!this.originalSong)return this.threwErrorInLastRun=!0,null;t=Math.max(0,t),this.setActivePluginIndex(t),this.threwErrorInLastRun=!1;const n=this.getIndexOfLatestPluginWithCacheBeforeIndex(t),r=await this.cloneCachedSongAtPluginIndex(n);for(let i=t;i<this.plugins.length;i+=1)delete this.plugins[i].songCacheInternal;for(let i=0;i<this.plugins.length;i+=1)this.plugins[i].isRollbackable=i<=n;for(let i=n>=0?n+1:0;i<this.plugins.length;i+=1){const s=this.plugins[i];if(!s.enabledInternal||!s.hasAllParamsSet())return r;r.setPluginContextInternal(s);try{s.isExecuting=!0,s.setProgress(null),await s.run(r,s.getParamsInternal(),this.readApisInternal),r.clearPluginContextInternal(),s.isExecuting=!1}catch{this.threwErrorInLastRun=!0,r.clearPluginContextInternal(),s.isExecuting=!1;const a=this.getIndexOfLatestPluginWithCacheBeforeIndex(i);return a>=0?await this.cloneSong(this.plugins[a].songCacheInternal):await this.cloneSong(this.originalSong)}s.songCacheInternal=await this.cloneSong(r),s.isRollbackable=!0}return r}restoreCachedPlugin(t){return this.setActivePluginIndex(t),this.cloneCachedSongAtPluginIndex(t)}async cloneSong(t){if(!this.cloneSongFnInternal)throw new Error("Pipeline is not provided with a clone song function.");return this.cloneSongFnInternal(t)}getActivePluginIndex(){return this.activePluginIndex}setActivePluginIndex(t){this.activePluginIndex=t}async cloneCachedSongAtPluginIndex(t){if(t>=0)return await this.cloneSong(this.plugins[t].songCacheInternal);if(!this.originalSong)throw new Error("Original song is not avaiable to clone.");return await this.cloneSong(this.originalSong)}reset(){this.plugins.splice(0,this.plugins.length),this.originalSong=void 0,this.activePluginIndex=-1,this.threwErrorInLastRun=!1}isPluginFunctioning(t){return!!t.songCacheInternal}getPluginIndexByPluginInstanceId(t){return Kt(this.plugins,n=>n.instanceId===t)}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getPluginCache(t){return t.songCacheInternal}setMaxNumPluginsToKeep(t){this.maxNumPluginsToKeep=t,this.maintainPluginListSize()}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let n=t-1;n>=0;n-=1)if(this.getPluginCache(this.plugins[n]))return n;return-1}maintainPluginListSize(){for(;this.plugins.length>this.maxNumPluginsToKeep&&this.plugins.length>0;)this.plugins.shift()}addPluginAt(t,n){this.plugins.splice(n,0,t),this.maintainPluginListSize()}}var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fc(e,t,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,a=e[o],c=n!==void 0?n(a,t):a-t;c>=0?(s=o,i=o-1):r=o+1}return s}function Uc(e,t,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,a=e[o],c=n!==void 0?n(a,t):a-t;c>0?(s=o,i=o-1):r=o+1}return s}function Rc(e,t,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=e[o],c=n!==void 0?n(a,t):a-t;c<0?(s=o,r=o+1):i=o-1}return s}function Bc(e,t,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=e[o],c=n!==void 0?n(a,t):a-t;c<=0?(s=o,r=o+1):i=o-1}return s}function $c(e,t,n,r,i){for(;r<=i;){var s=r+i>>>1,o=e[s],a=n!==void 0?n(o,t):o-t;if(a===0)return s;a<=0?r=s+1:i=s-1}return-1}function Zt(e,t,n,r,i,s){return typeof n=="function"?s(e,t,n,r===void 0?0:r|0,i===void 0?e.length-1:i|0):s(e,t,void 0,n===void 0?0:n|0,r===void 0?e.length-1:r|0)}var N={ge:function(e,t,n,r,i){return Zt(e,t,n,r,i,Fc)},gt:function(e,t,n,r,i){return Zt(e,t,n,r,i,Uc)},lt:function(e,t,n,r,i){return Zt(e,t,n,r,i,Rc)},le:function(e,t,n,r,i){return Zt(e,t,n,r,i,Bc)},eq:function(e,t,n,r,i){return Zt(e,t,n,r,i,$c)}},Un={exports:{}};(function(e,t){var n=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",c="[object Date]",l="[object Error]",p="[object Function]",h="[object GeneratorFunction]",g="[object Map]",I="[object Number]",v="[object Object]",w="[object Promise]",mt="[object RegExp]",P="[object Set]",k="[object String]",ke="[object Symbol]",Yt="[object WeakMap]",Or="[object ArrayBuffer]",_e="[object DataView]",Ar="[object Float32Array]",Mr="[object Float64Array]",Vr="[object Int8Array]",Dr="[object Int16Array]",Fr="[object Int32Array]",Ur="[object Uint8Array]",Rr="[object Uint8ClampedArray]",Br="[object Uint16Array]",$r="[object Uint32Array]",Mo=/[\\^$.*+?()[\]{}|]/g,Vo=/\w*$/,Do=/^\[object .+?Constructor\]$/,Fo=/^(?:0|[1-9]\d*)$/,b={};b[s]=b[o]=b[Or]=b[_e]=b[a]=b[c]=b[Ar]=b[Mr]=b[Vr]=b[Dr]=b[Fr]=b[g]=b[I]=b[v]=b[mt]=b[P]=b[k]=b[ke]=b[Ur]=b[Rr]=b[Br]=b[$r]=!0,b[l]=b[p]=b[Yt]=!1;var Uo=typeof X=="object"&&X&&X.Object===Object&&X,Ro=typeof self=="object"&&self&&self.Object===Object&&self,et=Uo||Ro||Function("return this")(),Lr=t&&!t.nodeType&&t,qr=Lr&&!0&&e&&!e.nodeType&&e,Bo=qr&&qr.exports===Lr;function $o(u,f){return u.set(f[0],f[1]),u}function Lo(u,f){return u.add(f),u}function qo(u,f){for(var d=-1,m=u?u.length:0;++d<m&&f(u[d],d,u)!==!1;);return u}function Ho(u,f){for(var d=-1,m=f.length,x=u.length;++d<m;)u[x+d]=f[d];return u}function Hr(u,f,d,m){var x=-1,A=u?u.length:0;for(m&&A&&(d=u[++x]);++x<A;)d=f(d,u[x],x,u);return d}function zo(u,f){for(var d=-1,m=Array(u);++d<u;)m[d]=f(d);return m}function Ko(u,f){return u?.[f]}function zr(u){var f=!1;if(u!=null&&typeof u.toString!="function")try{f=!!(u+"")}catch{}return f}function Kr(u){var f=-1,d=Array(u.size);return u.forEach(function(m,x){d[++f]=[x,m]}),d}function fn(u,f){return function(d){return u(f(d))}}function Gr(u){var f=-1,d=Array(u.size);return u.forEach(function(m){d[++f]=m}),d}var Go=Array.prototype,Jo=Function.prototype,Se=Object.prototype,hn=et["__core-js_shared__"],Jr=function(){var u=/[^.]+$/.exec(hn&&hn.keys&&hn.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""}(),Wr=Jo.toString,ct=Se.hasOwnProperty,xe=Se.toString,Wo=RegExp("^"+Wr.call(ct).replace(Mo,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jr=Bo?et.Buffer:void 0,Yr=et.Symbol,Xr=et.Uint8Array,jo=fn(Object.getPrototypeOf,Object),Yo=Object.create,Xo=Se.propertyIsEnumerable,Qo=Go.splice,Qr=Object.getOwnPropertySymbols,Zo=jr?jr.isBuffer:void 0,ta=fn(Object.keys,Object),pn=Ut(et,"DataView"),Xt=Ut(et,"Map"),dn=Ut(et,"Promise"),gn=Ut(et,"Set"),mn=Ut(et,"WeakMap"),Qt=Ut(Object,"create"),ea=Tt(pn),na=Tt(Xt),ra=Tt(dn),ia=Tt(gn),sa=Tt(mn),Zr=Yr?Yr.prototype:void 0,ti=Zr?Zr.valueOf:void 0;function It(u){var f=-1,d=u?u.length:0;for(this.clear();++f<d;){var m=u[f];this.set(m[0],m[1])}}function oa(){this.__data__=Qt?Qt(null):{}}function aa(u){return this.has(u)&&delete this.__data__[u]}function ua(u){var f=this.__data__;if(Qt){var d=f[u];return d===r?void 0:d}return ct.call(f,u)?f[u]:void 0}function ca(u){var f=this.__data__;return Qt?f[u]!==void 0:ct.call(f,u)}function la(u,f){var d=this.__data__;return d[u]=Qt&&f===void 0?r:f,this}It.prototype.clear=oa,It.prototype.delete=aa,It.prototype.get=ua,It.prototype.has=ca,It.prototype.set=la;function nt(u){var f=-1,d=u?u.length:0;for(this.clear();++f<d;){var m=u[f];this.set(m[0],m[1])}}function fa(){this.__data__=[]}function ha(u){var f=this.__data__,d=Pe(f,u);if(d<0)return!1;var m=f.length-1;return d==m?f.pop():Qo.call(f,d,1),!0}function pa(u){var f=this.__data__,d=Pe(f,u);return d<0?void 0:f[d][1]}function da(u){return Pe(this.__data__,u)>-1}function ga(u,f){var d=this.__data__,m=Pe(d,u);return m<0?d.push([u,f]):d[m][1]=f,this}nt.prototype.clear=fa,nt.prototype.delete=ha,nt.prototype.get=pa,nt.prototype.has=da,nt.prototype.set=ga;function Dt(u){var f=-1,d=u?u.length:0;for(this.clear();++f<d;){var m=u[f];this.set(m[0],m[1])}}function ma(){this.__data__={hash:new It,map:new(Xt||nt),string:new It}}function Ia(u){return Ce(this,u).delete(u)}function va(u){return Ce(this,u).get(u)}function Ta(u){return Ce(this,u).has(u)}function ya(u,f){return Ce(this,u).set(u,f),this}Dt.prototype.clear=ma,Dt.prototype.delete=Ia,Dt.prototype.get=va,Dt.prototype.has=Ta,Dt.prototype.set=ya;function Ft(u){this.__data__=new nt(u)}function ba(){this.__data__=new nt}function wa(u){return this.__data__.delete(u)}function ka(u){return this.__data__.get(u)}function _a(u){return this.__data__.has(u)}function Sa(u,f){var d=this.__data__;if(d instanceof nt){var m=d.__data__;if(!Xt||m.length<n-1)return m.push([u,f]),this;d=this.__data__=new Dt(m)}return d.set(u,f),this}Ft.prototype.clear=ba,Ft.prototype.delete=wa,Ft.prototype.get=ka,Ft.prototype.has=_a,Ft.prototype.set=Sa;function xa(u,f){var d=Tn(u)||Ya(u)?zo(u.length,String):[],m=d.length,x=!!m;for(var A in u)(f||ct.call(u,A))&&!(x&&(A=="length"||Ga(A,m)))&&d.push(A);return d}function ei(u,f,d){var m=u[f];(!(ct.call(u,f)&&si(m,d))||d===void 0&&!(f in u))&&(u[f]=d)}function Pe(u,f){for(var d=u.length;d--;)if(si(u[d][0],f))return d;return-1}function Pa(u,f){return u&&ni(f,yn(f),u)}function In(u,f,d,m,x,A,Y){var B;if(m&&(B=A?m(u,x,A,Y):m(u)),B!==void 0)return B;if(!Ee(u))return u;var ui=Tn(u);if(ui){if(B=Ha(u),!f)return $a(u,B)}else{var Rt=vt(u),ci=Rt==p||Rt==h;if(Qa(u))return Ma(u,f);if(Rt==v||Rt==s||ci&&!A){if(zr(u))return A?u:{};if(B=za(ci?{}:u),!f)return La(u,Pa(B,u))}else{if(!b[Rt])return A?u:{};B=Ka(u,Rt,In,f)}}Y||(Y=new Ft);var li=Y.get(u);if(li)return li;if(Y.set(u,B),!ui)var fi=d?qa(u):yn(u);return qo(fi||u,function(bn,Ne){fi&&(Ne=bn,bn=u[Ne]),ei(B,Ne,In(bn,f,d,m,Ne,u,Y))}),B}function Ca(u){return Ee(u)?Yo(u):{}}function Ea(u,f,d){var m=f(u);return Tn(u)?m:Ho(m,d(u))}function Na(u){return xe.call(u)}function Oa(u){if(!Ee(u)||Wa(u))return!1;var f=ai(u)||zr(u)?Wo:Do;return f.test(Tt(u))}function Aa(u){if(!ii(u))return ta(u);var f=[];for(var d in Object(u))ct.call(u,d)&&d!="constructor"&&f.push(d);return f}function Ma(u,f){if(f)return u.slice();var d=new u.constructor(u.length);return u.copy(d),d}function vn(u){var f=new u.constructor(u.byteLength);return new Xr(f).set(new Xr(u)),f}function Va(u,f){var d=f?vn(u.buffer):u.buffer;return new u.constructor(d,u.byteOffset,u.byteLength)}function Da(u,f,d){var m=f?d(Kr(u),!0):Kr(u);return Hr(m,$o,new u.constructor)}function Fa(u){var f=new u.constructor(u.source,Vo.exec(u));return f.lastIndex=u.lastIndex,f}function Ua(u,f,d){var m=f?d(Gr(u),!0):Gr(u);return Hr(m,Lo,new u.constructor)}function Ra(u){return ti?Object(ti.call(u)):{}}function Ba(u,f){var d=f?vn(u.buffer):u.buffer;return new u.constructor(d,u.byteOffset,u.length)}function $a(u,f){var d=-1,m=u.length;for(f||(f=Array(m));++d<m;)f[d]=u[d];return f}function ni(u,f,d,m){d||(d={});for(var x=-1,A=f.length;++x<A;){var Y=f[x],B=m?m(d[Y],u[Y],Y,d,u):void 0;ei(d,Y,B===void 0?u[Y]:B)}return d}function La(u,f){return ni(u,ri(u),f)}function qa(u){return Ea(u,yn,ri)}function Ce(u,f){var d=u.__data__;return Ja(f)?d[typeof f=="string"?"string":"hash"]:d.map}function Ut(u,f){var d=Ko(u,f);return Oa(d)?d:void 0}var ri=Qr?fn(Qr,Object):eu,vt=Na;(pn&&vt(new pn(new ArrayBuffer(1)))!=_e||Xt&&vt(new Xt)!=g||dn&&vt(dn.resolve())!=w||gn&&vt(new gn)!=P||mn&&vt(new mn)!=Yt)&&(vt=function(u){var f=xe.call(u),d=f==v?u.constructor:void 0,m=d?Tt(d):void 0;if(m)switch(m){case ea:return _e;case na:return g;case ra:return w;case ia:return P;case sa:return Yt}return f});function Ha(u){var f=u.length,d=u.constructor(f);return f&&typeof u[0]=="string"&&ct.call(u,"index")&&(d.index=u.index,d.input=u.input),d}function za(u){return typeof u.constructor=="function"&&!ii(u)?Ca(jo(u)):{}}function Ka(u,f,d,m){var x=u.constructor;switch(f){case Or:return vn(u);case a:case c:return new x(+u);case _e:return Va(u,m);case Ar:case Mr:case Vr:case Dr:case Fr:case Ur:case Rr:case Br:case $r:return Ba(u,m);case g:return Da(u,m,d);case I:case k:return new x(u);case mt:return Fa(u);case P:return Ua(u,m,d);case ke:return Ra(u)}}function Ga(u,f){return f=f??i,!!f&&(typeof u=="number"||Fo.test(u))&&u>-1&&u%1==0&&u<f}function Ja(u){var f=typeof u;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?u!=="__proto__":u===null}function Wa(u){return!!Jr&&Jr in u}function ii(u){var f=u&&u.constructor,d=typeof f=="function"&&f.prototype||Se;return u===d}function Tt(u){if(u!=null){try{return Wr.call(u)}catch{}try{return u+""}catch{}}return""}function ja(u){return In(u,!0,!0)}function si(u,f){return u===f||u!==u&&f!==f}function Ya(u){return Xa(u)&&ct.call(u,"callee")&&(!Xo.call(u,"callee")||xe.call(u)==s)}var Tn=Array.isArray;function oi(u){return u!=null&&Za(u.length)&&!ai(u)}function Xa(u){return tu(u)&&oi(u)}var Qa=Zo||nu;function ai(u){var f=Ee(u)?xe.call(u):"";return f==p||f==h}function Za(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=i}function Ee(u){var f=typeof u;return!!u&&(f=="object"||f=="function")}function tu(u){return!!u&&typeof u=="object"}function yn(u){return oi(u)?xa(u):Aa(u)}function eu(){return[]}function nu(){return!1}e.exports=ja})(Un,Un.exports);const ki=Un.exports;class ee{ticks;bpm;time;constructor({ticks:t,bpm:n,time:r}){this.ticks=t,this.bpm=n,this.time=r}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class Rn{ticks;numerator;denominator;constructor({ticks:t,numerator:n,denominator:r}){this.ticks=t,this.numerator=n,this.denominator=r}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}function Lc(e,t){const n=Object.create(null),r=e.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return t?i=>!!n[i.toLowerCase()]:i=>!!n[i]}process.env.NODE_ENV!=="production"&&Object.freeze({});process.env.NODE_ENV!=="production"&&Object.freeze([]);const Rs=Object.assign,qc=Object.prototype.hasOwnProperty,rn=(e,t)=>qc.call(e,t),ht=Array.isArray,re=e=>Bs(e)==="[object Map]",Hc=e=>typeof e=="string",lr=e=>typeof e=="symbol",sn=e=>e!==null&&typeof e=="object",zc=Object.prototype.toString,Bs=e=>zc.call(e),$s=e=>Bs(e).slice(8,-1),fr=e=>Hc(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Kc=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},qh=Kc(e=>e.charAt(0).toUpperCase()+e.slice(1)),Ls=(e,t)=>!Object.is(e,t),Gc=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})};let Jc;function Wc(e,t=Jc){t&&t.active&&t.effects.push(e)}const Bn=e=>{const t=new Set(e);return t.w=0,t.n=0,t},qs=e=>(e.w&pt)>0,Hs=e=>(e.n&pt)>0,jc=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=pt},Yc=e=>{const{deps:t}=e;if(t.length){let n=0;for(let r=0;r<t.length;r++){const i=t[r];qs(i)&&!Hs(i)?i.delete(e):t[n++]=i,i.w&=~pt,i.n&=~pt}t.length=n}},$n=new WeakMap;let ne=0,pt=1;const Ln=30;let W;const St=Symbol(process.env.NODE_ENV!=="production"?"iterate":""),qn=Symbol(process.env.NODE_ENV!=="production"?"Map key iterate":"");class Xc{constructor(t,n=null,r){this.fn=t,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,Wc(this,r)}run(){if(!this.active)return this.fn();let t=W,n=xt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=W,W=this,xt=!0,pt=1<<++ne,ne<=Ln?jc(this):_i(this),this.fn()}finally{ne<=Ln&&Yc(this),pt=1<<--ne,W=this.parent,xt=n,this.parent=void 0}}stop(){this.active&&(_i(this),this.onStop&&this.onStop(),this.active=!1)}}function _i(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let xt=!0;const zs=[];function Ks(){zs.push(xt),xt=!1}function Gs(){const e=zs.pop();xt=e===void 0?!0:e}function Q(e,t,n){if(xt&&W){let r=$n.get(e);r||$n.set(e,r=new Map);let i=r.get(n);i||r.set(n,i=Bn());const s=process.env.NODE_ENV!=="production"?{effect:W,target:e,type:t,key:n}:void 0;Qc(i,s)}}function Qc(e,t){let n=!1;ne<=Ln?Hs(e)||(e.n|=pt,n=!qs(e)):n=!e.has(W),n&&(e.add(W),W.deps.push(e),process.env.NODE_ENV!=="production"&&W.onTrack&&W.onTrack(Object.assign({effect:W},t)))}function dt(e,t,n,r,i,s){const o=$n.get(e);if(!o)return;let a=[];if(t==="clear")a=[...o.values()];else if(n==="length"&&ht(e))o.forEach((l,p)=>{(p==="length"||p>=r)&&a.push(l)});else switch(n!==void 0&&a.push(o.get(n)),t){case"add":ht(e)?fr(n)&&a.push(o.get("length")):(a.push(o.get(St)),re(e)&&a.push(o.get(qn)));break;case"delete":ht(e)||(a.push(o.get(St)),re(e)&&a.push(o.get(qn)));break;case"set":re(e)&&a.push(o.get(St));break}const c=process.env.NODE_ENV!=="production"?{target:e,type:t,key:n,newValue:r,oldValue:i,oldTarget:s}:void 0;if(a.length===1)a[0]&&(process.env.NODE_ENV!=="production"?Oe(a[0],c):Oe(a[0]));else{const l=[];for(const p of a)p&&l.push(...p);process.env.NODE_ENV!=="production"?Oe(Bn(l),c):Oe(Bn(l))}}function Oe(e,t){for(const n of ht(e)?e:[...e])(n!==W||n.allowRecurse)&&(process.env.NODE_ENV!=="production"&&n.onTrigger&&n.onTrigger(Rs({effect:n},t)),n.scheduler?n.scheduler():n.run())}const Zc=Lc("__proto__,__v_isRef,__isVue"),Js=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(lr)),tl=hr(),el=hr(!0),nl=hr(!0,!0),Si=rl();function rl(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const r=y(this);for(let s=0,o=this.length;s<o;s++)Q(r,"get",s+"");const i=r[t](...n);return i===-1||i===!1?r[t](...n.map(y)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){Ks();const r=y(this)[t].apply(this,n);return Gs(),r}}),e}function hr(e=!1,t=!1){return function(r,i,s){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&s===(e?t?Qs:Xs:t?Tl:Ys).get(r))return r;const o=ht(r);if(!e&&o&&rn(Si,i))return Reflect.get(Si,i,s);const a=Reflect.get(r,i,s);return(lr(i)?Js.has(i):Zc(i))||(e||Q(r,"get",i),t)?a:D(a)?!o||!fr(i)?a.value:a:sn(a)?e?to(a):Zs(a):a}}const il=sl();function sl(e=!1){return function(n,r,i,s){let o=n[r];if(Ot(o)&&D(o)&&!D(i))return!1;if(!e&&!Ot(i)&&(eo(i)||(i=y(i),o=y(o)),!ht(n)&&D(o)&&!D(i)))return o.value=i,!0;const a=ht(n)&&fr(r)?Number(r)<n.length:rn(n,r),c=Reflect.set(n,r,i,s);return n===y(s)&&(a?Ls(i,o)&&dt(n,"set",r,i,o):dt(n,"add",r,i)),c}}function ol(e,t){const n=rn(e,t),r=e[t],i=Reflect.deleteProperty(e,t);return i&&n&&dt(e,"delete",t,void 0,r),i}function al(e,t){const n=Reflect.has(e,t);return(!lr(t)||!Js.has(t))&&Q(e,"has",t),n}function ul(e){return Q(e,"iterate",ht(e)?"length":St),Reflect.ownKeys(e)}const cl={get:tl,set:il,deleteProperty:ol,has:al,ownKeys:ul},Ws={get:el,set(e,t){return process.env.NODE_ENV,!0},deleteProperty(e,t){return process.env.NODE_ENV,!0}},ll=Rs({},Ws,{get:nl}),pr=e=>e,on=e=>Reflect.getPrototypeOf(e);function Ae(e,t,n=!1,r=!1){e=e.__v_raw;const i=y(e),s=y(t);t!==s&&!n&&Q(i,"get",t),!n&&Q(i,"get",s);const{has:o}=on(i),a=r?pr:n?Ir:mr;if(o.call(i,t))return a(e.get(t));if(o.call(i,s))return a(e.get(s));e!==i&&e.get(t)}function Me(e,t=!1){const n=this.__v_raw,r=y(n),i=y(e);return e!==i&&!t&&Q(r,"has",e),!t&&Q(r,"has",i),e===i?n.has(e):n.has(e)||n.has(i)}function Ve(e,t=!1){return e=e.__v_raw,!t&&Q(y(e),"iterate",St),Reflect.get(e,"size",e)}function xi(e){e=y(e);const t=y(this);return on(t).has.call(t,e)||(t.add(e),dt(t,"add",e,e)),this}function Pi(e,t){t=y(t);const n=y(this),{has:r,get:i}=on(n);let s=r.call(n,e);s?process.env.NODE_ENV!=="production"&&js(n,r,e):(e=y(e),s=r.call(n,e));const o=i.call(n,e);return n.set(e,t),s?Ls(t,o)&&dt(n,"set",e,t,o):dt(n,"add",e,t),this}function Ci(e){const t=y(this),{has:n,get:r}=on(t);let i=n.call(t,e);i?process.env.NODE_ENV!=="production"&&js(t,n,e):(e=y(e),i=n.call(t,e));const s=r?r.call(t,e):void 0,o=t.delete(e);return i&&dt(t,"delete",e,void 0,s),o}function Ei(){const e=y(this),t=e.size!==0,n=process.env.NODE_ENV!=="production"?re(e)?new Map(e):new Set(e):void 0,r=e.clear();return t&&dt(e,"clear",void 0,void 0,n),r}function De(e,t){return function(r,i){const s=this,o=s.__v_raw,a=y(o),c=t?pr:e?Ir:mr;return!e&&Q(a,"iterate",St),o.forEach((l,p)=>r.call(i,c(l),c(p),s))}}function Fe(e,t,n){return function(...r){const i=this.__v_raw,s=y(i),o=re(s),a=e==="entries"||e===Symbol.iterator&&o,c=e==="keys"&&o,l=i[e](...r),p=n?pr:t?Ir:mr;return!t&&Q(s,"iterate",c?qn:St),{next(){const{value:h,done:g}=l.next();return g?{value:h,done:g}:{value:a?[p(h[0]),p(h[1])]:p(h),done:g}},[Symbol.iterator](){return this}}}}function lt(e){return function(...t){if(process.env.NODE_ENV!=="production"){const n=t[0]?`on key "${t[0]}" `:""}return e==="delete"?!1:this}}function fl(){const e={get(s){return Ae(this,s)},get size(){return Ve(this)},has:Me,add:xi,set:Pi,delete:Ci,clear:Ei,forEach:De(!1,!1)},t={get(s){return Ae(this,s,!1,!0)},get size(){return Ve(this)},has:Me,add:xi,set:Pi,delete:Ci,clear:Ei,forEach:De(!1,!0)},n={get(s){return Ae(this,s,!0)},get size(){return Ve(this,!0)},has(s){return Me.call(this,s,!0)},add:lt("add"),set:lt("set"),delete:lt("delete"),clear:lt("clear"),forEach:De(!0,!1)},r={get(s){return Ae(this,s,!0,!0)},get size(){return Ve(this,!0)},has(s){return Me.call(this,s,!0)},add:lt("add"),set:lt("set"),delete:lt("delete"),clear:lt("clear"),forEach:De(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{e[s]=Fe(s,!1,!1),n[s]=Fe(s,!0,!1),t[s]=Fe(s,!1,!0),r[s]=Fe(s,!0,!0)}),[e,n,t,r]}const[hl,pl,dl,gl]=fl();function dr(e,t){const n=t?e?gl:dl:e?pl:hl;return(r,i,s)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?r:Reflect.get(rn(n,i)&&i in r?n:r,i,s)}const ml={get:dr(!1,!1)},Il={get:dr(!0,!1)},vl={get:dr(!0,!0)};function js(e,t,n){const r=y(n);if(r!==n&&t.call(e,r)){const i=$s(e)}}const Ys=new WeakMap,Tl=new WeakMap,Xs=new WeakMap,Qs=new WeakMap;function yl(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function bl(e){return e.__v_skip||!Object.isExtensible(e)?0:yl($s(e))}function Zs(e){return Ot(e)?e:gr(e,!1,cl,ml,Ys)}function to(e){return gr(e,!0,Ws,Il,Xs)}function Ue(e){return gr(e,!0,ll,vl,Qs)}function gr(e,t,n,r,i){if(!sn(e))return process.env.NODE_ENV,e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const s=i.get(e);if(s)return s;const o=bl(e);if(o===0)return e;const a=new Proxy(e,o===2?r:n);return i.set(e,a),a}function Pt(e){return Ot(e)?Pt(e.__v_raw):!!(e&&e.__v_isReactive)}function Ot(e){return!!(e&&e.__v_isReadonly)}function eo(e){return!!(e&&e.__v_isShallow)}function Je(e){return Pt(e)||Ot(e)}function y(e){const t=e&&e.__v_raw;return t?y(t):e}function wl(e){return Gc(e,"__v_skip",!0),e}const mr=e=>sn(e)?Zs(e):e,Ir=e=>sn(e)?to(e):e;function D(e){return!!(e&&e.__v_isRef===!0)}function kl(e){return D(e)?e.value:e}const _l={get:(e,t,n)=>kl(Reflect.get(e,t,n)),set:(e,t,n,r)=>{const i=e[t];return D(i)&&!D(n)?(i.value=n,!0):Reflect.set(e,t,n,r)}};function Sl(e){return Pt(e)?e:new Proxy(e,_l)}Promise.resolve();function vr(e){if(H(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=tt(r)?Cl(r):vr(r);if(i)for(const s in i)t[s]=i[s]}return t}else{if(tt(e))return e;if(ot(e))return e}}const xl=/;(?![^(]*\))/g,Pl=/:(.+)/;function Cl(e){const t={};return e.split(xl).forEach(n=>{if(n){const r=n.split(Pl);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t}function Tr(e){let t="";if(tt(e))t=e;else if(H(e))for(let n=0;n<e.length;n++){const r=Tr(e[n]);r&&(t+=r+" ")}else if(ot(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const K=process.env.NODE_ENV!=="production"?Object.freeze({}):{};process.env.NODE_ENV!=="production"&&Object.freeze([]);const yr=()=>{},El=/^on[^a-z]/,Nl=e=>El.test(e),ut=Object.assign,Ol=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},Al=Object.prototype.hasOwnProperty,C=(e,t)=>Al.call(e,t),H=Array.isArray,Ml=e=>br(e)==="[object Map]",Vl=e=>br(e)==="[object Set]",U=e=>typeof e=="function",tt=e=>typeof e=="string",ot=e=>e!==null&&typeof e=="object",Dl=e=>ot(e)&&U(e.then)&&U(e.catch),Fl=Object.prototype.toString,br=e=>Fl.call(e),Ul=e=>br(e)==="[object Object]",Ni=(e,t)=>!Object.is(e,t);let Oi;const Rl=()=>Oi||(Oi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ct=[];function Bl(e){Ct.push(e)}function $l(){Ct.pop()}function $(e,...t){Ks();const n=Ct.length?Ct[Ct.length-1].component:null,r=n&&n.appContext.config.warnHandler,i=Ll();if(r)Et(r,n,11,[e+t.join(""),n&&n.proxy,i.map(({vnode:s})=>`at <${To(n,s.type)}>`).join(`
`),i]);else{const s=[`[Vue warn]: ${e}`,...t];i.length&&s.push(`
`,...ql(i))}Gs()}function Ll(){let e=Ct[Ct.length-1];if(!e)return[];const t=[];for(;e;){const n=t[0];n&&n.vnode===e?n.recurseCount++:t.push({vnode:e,recurseCount:0});const r=e.component&&e.component.parent;e=r&&r.vnode}return t}function ql(e){const t=[];return e.forEach((n,r)=>{t.push(...r===0?[]:[`
`],...Hl(n))}),t}function Hl({vnode:e,recurseCount:t}){const n=t>0?`... (${t} recursive calls)`:"",r=e.component?e.component.parent==null:!1,i=` at <${To(e.component,e.type,r)}`,s=">"+n;return e.props?[i,...zl(e.props),s]:[i+s]}function zl(e){const t=[],n=Object.keys(e);return n.slice(0,3).forEach(r=>{t.push(...no(r,e[r]))}),n.length>3&&t.push(" ..."),t}function no(e,t,n){return tt(t)?(t=JSON.stringify(t),n?t:[`${e}=${t}`]):typeof t=="number"||typeof t=="boolean"||t==null?n?t:[`${e}=${t}`]:D(t)?(t=no(e,y(t.value),!0),n?t:[`${e}=Ref<`,t,">"]):U(t)?[`${e}=fn${t.name?`<${t.name}>`:""}`]:(t=y(t),n?t:[`${e}=`,t])}const ro={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",[0]:"setup function",[1]:"render function",[2]:"watcher getter",[3]:"watcher callback",[4]:"watcher cleanup function",[5]:"native event handler",[6]:"component event handler",[7]:"vnode hook",[8]:"directive hook",[9]:"transition hook",[10]:"app errorHandler",[11]:"app warnHandler",[12]:"ref function",[13]:"async component loader",[14]:"scheduler flush. This is likely a Vue internals bug. Please open an issue at https://new-issue.vuejs.org/?repo=vuejs/core"};function Et(e,t,n,r){let i;try{i=r?e(...r):e()}catch(s){io(s,t,n)}return i}function Hn(e,t,n,r){if(U(e)){const s=Et(e,t,n,r);return s&&Dl(s)&&s.catch(o=>{io(o,t,n)}),s}const i=[];for(let s=0;s<e.length;s++)i.push(Hn(e[s],t,n,r));return i}function io(e,t,n,r=!0){const i=t?t.vnode:null;if(t){let s=t.parent;const o=t.proxy,a=process.env.NODE_ENV!=="production"?ro[n]:n;for(;s;){const l=s.ec;if(l){for(let p=0;p<l.length;p++)if(l[p](e,o,a)===!1)return}s=s.parent}const c=t.appContext.config.errorHandler;if(c){Et(c,null,10,[e,o,a]);return}}Kl(e,n,i,r)}function Kl(e,t,n,r=!0){if(process.env.NODE_ENV!=="production"){const i=ro[t];if(n&&Bl(n),$(`Unhandled error${i?` during execution of ${i}`:""}`),n&&$l(),r)throw e}}let We=!1,zn=!1;const Z=[];let ft=0;const ie=[];let $t=null,bt=0;const se=[];let rt=null,wt=0;const so=Promise.resolve();let wr=null,Kn=null;const Gl=100;function Jl(e){const t=wr||so;return e?t.then(this?e.bind(this):e):t}function Wl(e){let t=ft+1,n=Z.length;for(;t<n;){const r=t+n>>>1;he(Z[r])<e?t=r+1:n=r}return t}function oo(e){(!Z.length||!Z.includes(e,We&&e.allowRecurse?ft+1:ft))&&e!==Kn&&(e.id==null?Z.push(e):Z.splice(Wl(e.id),0,e),ao())}function ao(){!We&&!zn&&(zn=!0,wr=so.then(fo))}function uo(e,t,n,r){H(e)?n.push(...e):(!t||!t.includes(e,e.allowRecurse?r+1:r))&&n.push(e),ao()}function jl(e){uo(e,$t,ie,bt)}function co(e){uo(e,rt,se,wt)}function lo(e,t=null){if(ie.length){for(Kn=t,$t=[...new Set(ie)],ie.length=0,process.env.NODE_ENV!=="production"&&(e=e||new Map),bt=0;bt<$t.length;bt++)process.env.NODE_ENV!=="production"&&kr(e,$t[bt])||$t[bt]();$t=null,bt=0,Kn=null,lo(e,t)}}function Yl(e){if(se.length){const t=[...new Set(se)];if(se.length=0,rt){rt.push(...t);return}for(rt=t,process.env.NODE_ENV!=="production"&&(e=e||new Map),rt.sort((n,r)=>he(n)-he(r)),wt=0;wt<rt.length;wt++)process.env.NODE_ENV!=="production"&&kr(e,rt[wt])||rt[wt]();rt=null,wt=0}}const he=e=>e.id==null?1/0:e.id;function fo(e){zn=!1,We=!0,process.env.NODE_ENV!=="production"&&(e=e||new Map),lo(e),Z.sort((n,r)=>he(n)-he(r));const t=process.env.NODE_ENV!=="production"?n=>kr(e,n):yr;try{for(ft=0;ft<Z.length;ft++){const n=Z[ft];if(n&&n.active!==!1){if(process.env.NODE_ENV!=="production"&&t(n))continue;Et(n,null,14)}}}finally{ft=0,Z.length=0,Yl(e),We=!1,wr=null,(Z.length||ie.length||se.length)&&fo(e)}}function kr(e,t){if(!e.has(t))e.set(t,1);else{const n=e.get(t);if(n>Gl){const r=t.ownerInstance,i=r&&vo(r.type);return $(`Maximum recursive updates exceeded${i?` in component <${i}>`:""}. This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function.`),!0}else e.set(t,n+1)}}const te=new Set;process.env.NODE_ENV!=="production"&&(Rl().__VUE_HMR_RUNTIME__={createRecord:Sn(Xl),rerender:Sn(Ql),reload:Sn(Zl)});const je=new Map;function Xl(e,t){return je.has(e)?!1:(je.set(e,{initialDef:oe(t),instances:new Set}),!0)}function oe(e){return yo(e)?e.__vccOpts:e}function Ql(e,t){const n=je.get(e);!n||(n.initialDef.render=t,[...n.instances].forEach(r=>{t&&(r.render=t,oe(r.type).render=t),r.renderCache=[],r.update()}))}function Zl(e,t){const n=je.get(e);if(!n)return;t=oe(t),Ai(n.initialDef,t);const r=[...n.instances];for(const i of r){const s=oe(i.type);te.has(s)||(s!==n.initialDef&&Ai(s,t),te.add(s)),i.appContext.optionsCache.delete(i.type),i.ceReload?(te.add(s),i.ceReload(t.styles),te.delete(s)):i.parent?(oo(i.parent.update),i.parent.type.__asyncLoader&&i.parent.ceReload&&i.parent.ceReload(t.styles)):i.appContext.reload?i.appContext.reload():typeof window<"u"&&window.location.reload()}co(()=>{for(const i of r)te.delete(oe(i.type))})}function Ai(e,t){ut(e,t);for(const n in e)n!=="__file"&&!(n in t)&&delete e[n]}function Sn(e){return(t,n)=>{try{return e(t,n)}catch{}}}let _t=null,tf=null;const ef=e=>e.__isSuspense;function nf(e,t){t&&t.pendingBranch?H(e)?t.effects.push(...e):t.effects.push(e):co(e)}const Mi={};function rf(e,t,{immediate:n,deep:r,flush:i,onTrack:s,onTrigger:o}=K){process.env.NODE_ENV!=="production"&&!t&&(n!==void 0&&$('watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.'),r!==void 0&&$('watch() "deep" option is only respected when using the watch(source, callback, options?) signature.'));const a=k=>{$("Invalid watch source: ",k,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},c=zt;let l,p=!1,h=!1;if(D(e)?(l=()=>e.value,p=eo(e)):Pt(e)?(l=()=>e,r=!0):H(e)?(h=!0,p=e.some(Pt),l=()=>e.map(k=>{if(D(k))return k.value;if(Pt(k))return Lt(k);if(U(k))return Et(k,c,2);process.env.NODE_ENV!=="production"&&a(k)})):U(e)?t?l=()=>Et(e,c,2):l=()=>{if(!(c&&c.isUnmounted))return g&&g(),Hn(e,c,3,[I])}:(l=yr,process.env.NODE_ENV!=="production"&&a(e)),t&&r){const k=l;l=()=>Lt(k())}let g,I=k=>{g=P.onStop=()=>{Et(k,c,4)}},v=h?[]:Mi;const w=()=>{if(!!P.active)if(t){const k=P.run();(r||p||(h?k.some((ke,Yt)=>Ni(ke,v[Yt])):Ni(k,v)))&&(g&&g(),Hn(t,c,3,[k,v===Mi?void 0:v,I]),v=k)}else P.run()};w.allowRecurse=!!t;let mt;i==="sync"?mt=w:i==="post"?mt=()=>Fi(w,c&&c.suspense):mt=()=>{!c||c.isMounted?jl(w):w()};const P=new Xc(l,mt);return process.env.NODE_ENV!=="production"&&(P.onTrack=s,P.onTrigger=o),t?n?w():v=P.run():i==="post"?Fi(P.run.bind(P),c&&c.suspense):P.run(),()=>{P.stop(),c&&c.scope&&Ol(c.scope.effects,P)}}function sf(e,t,n){const r=this.proxy,i=tt(e)?e.includes(".")?of(r,e):()=>r[e]:e.bind(r,r);let s;U(t)?s=t:(s=t.handler,n=t);const o=zt;Ri(this);const a=rf(i,s.bind(r),n);return o?Ri(o):_f(),a}function of(e,t){const n=t.split(".");return()=>{let r=e;for(let i=0;i<n.length&&r;i++)r=r[n[i]];return r}}function Lt(e,t){if(!ot(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),D(e))Lt(e.value,t);else if(H(e))for(let n=0;n<e.length;n++)Lt(e[n],t);else if(Vl(e)||Ml(e))e.forEach(n=>{Lt(n,t)});else if(Ul(e))for(const n in e)Lt(e[n],t);return e}let af=!0;function uf(e){const t=e.type,{mixins:n,extends:r}=t,{mixins:i,optionsCache:s,config:{optionMergeStrategies:o}}=e.appContext,a=s.get(t);let c;return a?c=a:!i.length&&!n&&!r?c=t:(c={},i.length&&i.forEach(l=>Ye(c,l,o,!0)),Ye(c,t,o)),s.set(t,c),c}function Ye(e,t,n,r=!1){const{mixins:i,extends:s}=t;s&&Ye(e,s,n,!0),i&&i.forEach(o=>Ye(e,o,n,!0));for(const o in t)if(r&&o==="expose")process.env.NODE_ENV!=="production"&&$('"expose" option is ignored when declared in mixins or extends. It should only be declared in the base component itself.');else{const a=cf[o]||n&&n[o];e[o]=a?a(e[o],t[o]):t[o]}return e}const cf={data:Vi,props:kt,emits:kt,methods:kt,computed:kt,beforeCreate:M,created:M,beforeMount:M,mounted:M,beforeUpdate:M,updated:M,beforeDestroy:M,beforeUnmount:M,destroyed:M,unmounted:M,activated:M,deactivated:M,errorCaptured:M,serverPrefetch:M,components:kt,directives:kt,watch:ff,provide:Vi,inject:lf};function Vi(e,t){return t?e?function(){return ut(U(e)?e.call(this,this):e,U(t)?t.call(this,this):t)}:t:e}function lf(e,t){return kt(Di(e),Di(t))}function Di(e){if(H(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function M(e,t){return e?[...new Set([].concat(e,t))]:t}function kt(e,t){return e?ut(ut(Object.create(null),e),t):t}function ff(e,t){if(!e)return t;if(!t)return e;const n=ut(Object.create(null),e);for(const r in t)n[r]=M(e[r],t[r]);return n}const Fi=nf,hf=e=>e.__isTeleport,pf=Symbol(),ho=Symbol(process.env.NODE_ENV!=="production"?"Fragment":void 0),df=Symbol(process.env.NODE_ENV!=="production"?"Text":void 0),gf=Symbol(process.env.NODE_ENV!=="production"?"Comment":void 0);Symbol(process.env.NODE_ENV!=="production"?"Static":void 0);let Ui=null;function mf(e){return e?e.__v_isVNode===!0:!1}const If=(...e)=>mo(...e),po="__vInternal",go=({key:e})=>e??null,qe=({ref:e,ref_key:t,ref_for:n})=>e!=null?tt(e)||D(e)||U(e)?{i:_t,r:e,k:t,f:!!n}:e:null;function vf(e,t=null,n=null,r=0,i=null,s=e===ho?0:1,o=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&go(t),ref:t&&qe(t),scopeId:tf,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null};return a?(_r(c,n),s&128&&e.normalize(c)):n&&(c.shapeFlag|=tt(n)?8:16),process.env.NODE_ENV!=="production"&&c.key!==c.key&&$("VNode created with invalid key (NaN). VNode type:",c.type),!o&&Ui&&(c.patchFlag>0||s&6)&&c.patchFlag!==32&&Ui.push(c),c}const Tf=process.env.NODE_ENV!=="production"?If:mo;function mo(e,t=null,n=null,r=0,i=null,s=!1){if((!e||e===pf)&&(process.env.NODE_ENV!=="production"&&!e&&$(`Invalid vnode type when creating vnode: ${e}.`),e=gf),mf(e)){const a=Xe(e,t,!0);return n&&_r(a,n),a}if(yo(e)&&(e=e.__vccOpts),t){t=yf(t);let{class:a,style:c}=t;a&&!tt(a)&&(t.class=Tr(a)),ot(c)&&(Je(c)&&!H(c)&&(c=ut({},c)),t.style=vr(c))}const o=tt(e)?1:ef(e)?128:hf(e)?64:ot(e)?4:U(e)?2:0;return process.env.NODE_ENV!=="production"&&o&4&&Je(e)&&(e=y(e),$("Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`.",`
Component that was made reactive: `,e)),vf(e,t,n,r,i,o,s,!0)}function yf(e){return e?Je(e)||po in e?ut({},e):e:null}function Xe(e,t,n=!1){const{props:r,ref:i,patchFlag:s,children:o}=e,a=t?wf(r||{},t):r;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&go(a),ref:t&&t.ref?n&&i?H(i)?i.concat(qe(t)):[i,qe(t)]:qe(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:process.env.NODE_ENV!=="production"&&s===-1&&H(o)?o.map(Io):o,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ho?s===-1?16:s|16:s,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Xe(e.ssContent),ssFallback:e.ssFallback&&Xe(e.ssFallback),el:e.el,anchor:e.anchor}}function Io(e){const t=Xe(e);return H(e.children)&&(t.children=e.children.map(Io)),t}function bf(e=" ",t=0){return Tf(df,null,e,t)}function _r(e,t){let n=0;const{shapeFlag:r}=e;if(t==null)t=null;else if(H(t))n=16;else if(typeof t=="object")if(r&65){const i=t.default;i&&(i._c&&(i._d=!1),_r(e,i()),i._c&&(i._d=!0));return}else{n=32;const i=t._;!i&&!(po in t)?t._ctx=_t:i===3&&_t&&(_t.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else U(t)?(t={default:t,_ctx:_t},n=32):(t=String(t),r&64?(n=16,t=[bf(t)]):n=8);e.children=t,e.shapeFlag|=n}function wf(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const i in r)if(i==="class")t.class!==r.class&&(t.class=Tr([t.class,r.class]));else if(i==="style")t.style=vr([t.style,r.style]);else if(Nl(i)){const s=t[i],o=r[i];o&&s!==o&&!(H(s)&&s.includes(o))&&(t[i]=s?[].concat(s,o):o)}else i!==""&&(t[i]=r[i])}return t}const Gn=e=>e?Sf(e)?xf(e)||e.proxy:Gn(e.parent):null,Qe=ut(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>process.env.NODE_ENV!=="production"?Ue(e.props):e.props,$attrs:e=>process.env.NODE_ENV!=="production"?Ue(e.attrs):e.attrs,$slots:e=>process.env.NODE_ENV!=="production"?Ue(e.slots):e.slots,$refs:e=>process.env.NODE_ENV!=="production"?Ue(e.refs):e.refs,$parent:e=>Gn(e.parent),$root:e=>Gn(e.root),$emit:e=>e.emit,$options:e=>__VUE_OPTIONS_API__?uf(e):e.type,$forceUpdate:e=>()=>oo(e.update),$nextTick:e=>Jl.bind(e.proxy),$watch:e=>__VUE_OPTIONS_API__?sf.bind(e):yr}),kf={get({_:e},t){const{ctx:n,setupState:r,data:i,props:s,accessCache:o,type:a,appContext:c}=e;if(process.env.NODE_ENV!=="production"&&t==="__isVue")return!0;if(process.env.NODE_ENV!=="production"&&r!==K&&r.__isScriptSetup&&C(r,t))return r[t];let l;if(t[0]!=="$"){const I=o[t];if(I!==void 0)switch(I){case 1:return r[t];case 2:return i[t];case 4:return n[t];case 3:return s[t]}else{if(r!==K&&C(r,t))return o[t]=1,r[t];if(i!==K&&C(i,t))return o[t]=2,i[t];if((l=e.propsOptions[0])&&C(l,t))return o[t]=3,s[t];if(n!==K&&C(n,t))return o[t]=4,n[t];(!__VUE_OPTIONS_API__||af)&&(o[t]=0)}}const p=Qe[t];let h,g;if(p)return t==="$attrs"&&(Q(e,"get",t),process.env.NODE_ENV!=="production"&&void 0),p(e);if((h=a.__cssModules)&&(h=h[t]))return h;if(n!==K&&C(n,t))return o[t]=4,n[t];if(g=c.config.globalProperties,C(g,t))return g[t];process.env.NODE_ENV!=="production"&&_t&&(!tt(t)||t.indexOf("__v")!==0)&&(i!==K&&(t[0]==="$"||t[0]==="_")&&C(i,t)?$(`Property ${JSON.stringify(t)} must be accessed via $data because it starts with a reserved character ("$" or "_") and is not proxied on the render context.`):e===_t&&$(`Property ${JSON.stringify(t)} was accessed during render but is not defined on instance.`))},set({_:e},t,n){const{data:r,setupState:i,ctx:s}=e;return i!==K&&C(i,t)?(i[t]=n,!0):r!==K&&C(r,t)?(r[t]=n,!0):C(e.props,t)?(process.env.NODE_ENV!=="production"&&$(`Attempting to mutate prop "${t}". Props are readonly.`,e),!1):t[0]==="$"&&t.slice(1)in e?(process.env.NODE_ENV!=="production"&&$(`Attempting to mutate public property "${t}". Properties starting with $ are reserved and readonly.`,e),!1):(process.env.NODE_ENV!=="production"&&t in e.appContext.config.globalProperties?Object.defineProperty(s,t,{enumerable:!0,configurable:!0,value:n}):s[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:r,appContext:i,propsOptions:s}},o){let a;return!!n[o]||e!==K&&C(e,o)||t!==K&&C(t,o)||(a=s[0])&&C(a,o)||C(r,o)||C(Qe,o)||C(i.config.globalProperties,o)},defineProperty(e,t,n){return n.get!=null?this.set(e,t,n.get(),null):n.value!=null&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};process.env.NODE_ENV!=="production"&&(kf.ownKeys=e=>($("Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead."),Reflect.ownKeys(e)));let zt=null;const Ri=e=>{zt=e,e.scope.on()},_f=()=>{zt&&zt.scope.off(),zt=null};function Sf(e){return e.vnode.shapeFlag&4}function xf(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Sl(wl(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in Qe)return Qe[n](e)}}))}const Pf=/(?:^|[-_])(\w)/g,Cf=e=>e.replace(Pf,t=>t.toUpperCase()).replace(/[-_]/g,"");function vo(e){return U(e)&&e.displayName||e.name}function To(e,t,n=!1){let r=vo(t);if(!r&&t.__file){const i=t.__file.match(/([^/\\]+)\.\w+$/);i&&(r=i[1])}if(!r&&e&&e.parent){const i=s=>{for(const o in s)if(s[o]===t)return o};r=i(e.components||e.parent.type.components)||i(e.appContext.components)}return r?Cf(r):n?"App":"Anonymous"}function yo(e){return U(e)&&"__vccOpts"in e}Symbol(process.env.NODE_ENV!=="production"?"ssrContext":"");function xn(e){return!!(e&&e.__v_isShallow)}function Ef(){if(process.env.NODE_ENV==="production"||typeof window>"u")return;const e={style:"color:#3ba776"},t={style:"color:#0b1bc9"},n={style:"color:#b62e24"},r={style:"color:#9d288c"},i={header(h){return ot(h)?h.__isVue?["div",e,"VueInstance"]:D(h)?["div",{},["span",e,p(h)],"<",a(h.value),">"]:Pt(h)?["div",{},["span",e,xn(h)?"ShallowReactive":"Reactive"],"<",a(h),`>${Ot(h)?" (readonly)":""}`]:Ot(h)?["div",{},["span",e,xn(h)?"ShallowReadonly":"Readonly"],"<",a(h),">"]:null:null},hasBody(h){return h&&h.__isVue},body(h){if(h&&h.__isVue)return["div",{},...s(h.$)]}};function s(h){const g=[];h.type.props&&h.props&&g.push(o("props",y(h.props))),h.setupState!==K&&g.push(o("setup",h.setupState)),h.data!==K&&g.push(o("data",y(h.data)));const I=c(h,"computed");I&&g.push(o("computed",I));const v=c(h,"inject");return v&&g.push(o("injected",v)),g.push(["div",{},["span",{style:r.style+";opacity:0.66"},"$ (internal): "],["object",{object:h}]]),g}function o(h,g){return g=ut({},g),Object.keys(g).length?["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},h],["div",{style:"padding-left:1.25em"},...Object.keys(g).map(I=>["div",{},["span",r,I+": "],a(g[I],!1)])]]:["span",{}]}function a(h,g=!0){return typeof h=="number"?["span",t,h]:typeof h=="string"?["span",n,JSON.stringify(h)]:typeof h=="boolean"?["span",r,h]:ot(h)?["object",{object:g?y(h):h}]:["span",n,String(h)]}function c(h,g){const I=h.type;if(U(I))return;const v={};for(const w in h.ctx)l(I,w,g)&&(v[w]=h.ctx[w]);return v}function l(h,g,I){const v=h[I];if(H(v)&&v.includes(g)||ot(v)&&g in v||h.extends&&l(h.extends,g,I)||h.mixins&&h.mixins.some(w=>l(w,g,I)))return!0}function p(h){return xn(h)?"ShallowRef":h.effect?"ComputedRef":"Ref"}window.devtoolsFormatters?window.devtoolsFormatters.push(i):window.devtoolsFormatters=[i]}function Nf(){Ef()}process.env.NODE_ENV!=="production"&&Nf();function Of(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function Af(e){const t=Math.floor(e/12)-2;return Of(e)+t.toString()}const Mf=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,Vf={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function Df(e){const t=Mf.exec(e);if(!t)return-1;const n=t[1],r=t[2];return Vf[n.toLowerCase()]+(parseInt(r,10)+1)*12}function Jn(e,t,n,r){return`${e} // ${t} // ${n} // ${r}`}function bo(e,t,n){return`${e} // ${t} // ${n}`}function Ff(e){const t=pe(e);return bo(t.manufacturerName,t.pluginFormatName,t.name)}function pe(e){const t=e.split(" // ");if(t.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:t[2],manufacturerName:t[0],pluginFormatName:t[1],pluginVersion:t[3]}}function wo(e,t){return e===t}function ko(e,t){const n=pe(e),r=pe(t);if(E.keys(n).length!==E.keys(r).length)return!1;for(const i of E.keys(n))if(i!=="pluginVersion"&&n[i]!==r[i])return!1;return!0}class Uf{tempoInfos=[];currentTempoIndex=0;ticksPerSecondAtTempoTick={};constructor(t,n){for(const r of t)this.tempoInfos.push({ticks:r.getTicks(),time:r.getTime()}),this.ticksPerSecondAtTempoTick[r.getTicks()]=r.getBpm()*n/60}secondsToTick(t){let n=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].time<=t;)this.currentTempoIndex+=1,n=this.tempoInfos[this.currentTempoIndex];for(;n.time>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,n=this.tempoInfos[this.currentTempoIndex];n.time>t&&(n=this.tempoInfos[0]);const r=t-n.time,i=this.ticksPerSecondAtTempoTick[n.ticks];return Math.round(n.ticks+r*i)}tickToSeconds(t){let n=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].ticks<=t;)this.currentTempoIndex+=1,n=this.tempoInfos[this.currentTempoIndex];for(;n.ticks>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,n=this.tempoInfos[this.currentTempoIndex];n.ticks>t&&(n=this.tempoInfos[0]);const r=t-n.ticks,i=this.ticksPerSecondAtTempoTick[n.ticks];return n.time+r/i}}function _o(e){return e>-100?Math.exp((e-6)*(1/20)):0}function Rf(e){return e<=0?-100:20*Math.log10(e)}function Bf(e){return e>0?20*Math.log(e)+6:-100}function $f(e){return e>0?Math.pow(10,(20*Math.log(e)+6)*(1/20)):0}function Lf(e){return e>0?Math.exp((20*Math.log10(e)-6)*(1/20)):0}function qf(e,t,n,r,i){return(e-t)/(n-t)*(i-r)+r}function Hf(e){return 440*Math.pow(2,(e-69)/12)}function zf(e){return Je(e)||D(e)?y(e):e}class Te{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,n,r,i){this.name=t,this.manufacturerName=n,this.pluginFormatName=r,this.pluginVersion=i,this.localInstanceIdInternal=Te.generateAudioPluginInstanceIdInternal()}getTuneflowId(){return Jn(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const n=t.createAudioPlugin(this.getTuneflowId());return n.setIsEnabled(this.isEnabled),n}matchesTfId(t){return wo(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return ko(t,this.getTuneflowId())}getInstanceId(){return this.localInstanceIdInternal}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}setBase64States(t){this.base64StatesInternal=t}getBase64States(){return this.base64StatesInternal}static generateAudioPluginInstanceIdInternal(){return nn(10)}static DEFAULT_SYNTH_TFID=Jn("TuneFlow","VST3","TFSynth","1.0.0")}class it{pitch;velocity;startTick;endTick;idInternal;clipInternal;constructor({pitch:t,velocity:n,startTick:r,endTick:i,id:s,clip:o}){this.pitch=t,this.velocity=n,this.startTick=r,this.endTick=i,this.idInternal=s,this.clipInternal=o}getPitch(){return this.pitch}setPitch(t){if(!it.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=Math.max(Math.min(t,127),0)}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}deleteFromParent(){!this.clipInternal||this.clipInternal.deleteNote(this)}moveNote(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick=Math.max(0,this.startTick+t),this.endTick=this.endTick+t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeft(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick+=t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeftTo(t){this.adjustLeft(t-this.startTick)}adjustRight(t){this.endTick+=t,this.isRangeValid()||this.deleteFromParent()}adjustRightTo(t){this.adjustRight(t-this.endTick)}isRangeValid(){return it.isNoteRangeValid(this.startTick,this.endTick)}static isValidPitch(t){return t>=0&&t<=127&&Number.isInteger(t)}static isNoteRangeValid(t,n){return n>=0&&t<=n&&Number.isInteger(t)&&Number.isInteger(n)}static isNoteVelocityValid(t){return t>=0&&t<=127&&Number.isInteger(t)}getClip(){return this.clipInternal}adjustPitch(t){this.pitch=this.pitch+t,it.isValidPitch(this.pitch)||this.deleteFromParent()}getId(){return this.idInternal}}var qt=(e=>(e[e.MIDI_CLIP=1]="MIDI_CLIP",e[e.AUDIO_CLIP=2]="AUDIO_CLIP",e))(qt||{});class J{song;track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;type;audioClipData;constructor({song:t,type:n,clipStartTick:r,id:i=J.generateClipIdInternal(),track:s=void 0,clipEndTick:o=void 0,audioClipData:a=void 0}){if(this.song=t,this.track=s,this.id=i,this.type=n,this.notes=[],n===2){if(!a)throw new Error("Audio clip data must be provided for audio clips.");this.audioClipData={audioFilePath:a.audioFilePath,startTick:a.startTick,duration:a.duration},r=E.isNumber(r)?Math.max(r,a.startTick):a.startTick;const c=this.getAudioEndTick();(!E.isNumber(o)||c<o)&&(o=c),this.clipStartTick=r,this.clipEndTick=o}else if(n===1){if(this.clipStartTick=r,!E.isNumber(o))throw new Error("clip end tick must be provided when creating MIDI clip.");this.clipEndTick=o}}getId(){return this.id}getType(){return this.type}getAudioClipData(){return this.audioClipData}setAudioFile(t,n,r){this.audioClipData?(this.audioClipData.audioFilePath=t,this.audioClipData.startTick=n,this.audioClipData.duration=r):this.audioClipData={audioFilePath:t,startTick:n,duration:r}}getNotes(){return J.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getDuration(){return this.song.tickToSeconds(this.clipEndTick)-this.song.tickToSeconds(this.clipStartTick)}getAudioDuration(){if(!(this.type!==2||!this.audioClipData))return this.audioClipData.duration}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:n,startTick:r,endTick:i,updateClipRange:s=!0,resolveClipConflict:o=!0}){if(this.type!==1||!it.isValidPitch(t)||!it.isNoteRangeValid(r,i)||!it.isNoteVelocityValid(n))return null;const a=new it({pitch:t,velocity:n,startTick:r,endTick:i,id:this.getNextNoteIdInternal()});return r<this.clipStartTick&&s&&this.adjustClipLeft(r,o),i>this.clipEndTick&&s&&this.adjustClipRight(i,o),this.orderedInsertNote(this.notes,a),a}getNoteIndexInternal(t){const n=N.lt(this.notes,t,(r,i)=>r.getStartTick()-i.getStartTick());for(let r=Math.max(0,n);r<this.notes.length;r+=1){const i=this.notes[r];if(i&&i===t)return r;if(i&&i.getStartTick()>t.getStartTick())break}return-1}deleteNote(t){const n=this.getNoteIndexInternal(t);n>=0&&this.deleteNoteAt(n)}deleteNoteAt(t){const n=this.notes[t];n&&(n.clipInternal=null,this.notes.splice(t,1))}orderedInsertNote(t,n){if(this.type!==1||n.getClip()===this)return;const r=N.ge(t,n,(i,s)=>i.getStartTick()-s.getStartTick());r<0?t.push(n):t.splice(r,0,n),n.clipInternal=this}adjustClipLeft(t,n=!0){t=Math.max(0,t),this.type===2&&this.audioClipData&&(t=Math.max(t,this.audioClipData.startTick)),t>this.clipEndTick?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,n=!0){if(this.type===2){const r=this.getAudioEndTick();E.isNumber(r)&&(t=Math.min(t,r))}t<this.clipStartTick||t<0?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t,n){const r=Math.max(0,this.clipStartTick+t),i=this.clipEndTick+t;if(i<0){this.deleteFromParent(!0);return}if(this.track&&this.track.resolveClipConflictInternal(this.getId(),r,i),this.track){const a=this.track.getClipIndex(this);this.track.deleteClipAt(a,!1)}const s=this.clipStartTick,o=this.clipEndTick;if(this.type===1){this.clipStartTick=r,this.clipEndTick=i;for(const a of this.notes)a.setStartTick(a.getStartTick()+t),a.setEndTick(a.getEndTick()+t)}else if(this.type===2){if(!this.audioClipData)throw new Error("Cannot move audio clip without audio data");const a=this.song,c=a.tickToSeconds(this.audioClipData.startTick),l=a.tickToSeconds(s),h=a.tickToSeconds(o)-l,g=l-c,I=a.tickToSeconds(this.clipStartTick+t),v=I-g,w=I+h;if(this.clipStartTick=r,this.clipEndTick=a.secondsToTick(w),this.audioClipData.startTick=a.secondsToTick(v),this.clipEndTick<0){this.deleteFromParent(!0);return}}this.track&&(this.track.orderedInsertClipInternal(this),n&&this.track.getAutomation().moveAllPointsWithinRange(s,o,t,0))}moveClipTo(t,n){const r=t-this.getClipStartTick();this.moveClip(r,n)}deleteFromParent(t){this.track&&(this.track.deleteClip(this,t),this.track=void 0)}getNotesByIds(t){const n=new Set(t),r=[];for(const i of this.notes)n.has(i.getId())&&r.push(i);return r}getAudioEndTick(){if(this.type!==2||!this.audioClipData)return;const t=this.getAudioDuration();if(!E.isNumber(t))return;const n=this.song.tickToSeconds(this.audioClipData.startTick);return this.song.secondsToTick(n+t)}static getNotesInRange(t,n,r){return J.getNotesInRangeImpl(t,n,r,i=>({getStartTick:()=>i}),i=>i.getStartTick(),i=>i.getEndTick())}static getNotesInRangeImpl(t,n,r,i,s,o){let a=Math.max(0,N.lt(t,i(n),(l,p)=>s(l)-s(p)));for(;t[a]&&!J.isNoteInClip(s(t[a]),o(t[a]),n,r);)a+=1;if(a>=t.length)return[];let c=Math.min(t.length-1,N.gt(t,i(r),(l,p)=>s(l)-s(p)));for(;t[c]&&!J.isNoteInClip(s(t[c]),o(t[c]),n,r);)c-=1;return c<0?[]:c<a?[]:t.slice(a,c+1)}static isNoteInClip(t,n,r,i){return(t>=r||r===0&&t<=0)&&t<=i&&n>=t}static getNotePlayableRange(t,n,r,i){if(!J.isNoteInClip(t,n,r,i))return null;const s=Math.max(t,r),o=Math.min(n,i);return s>o?null:{startTick:s,endTick:o}}trimConflictPartInternal(t,n){const r=Math.max(t,this.getClipStartTick()),i=Math.min(n,this.getClipEndTick());if(!(r>i)&&!(r>this.getClipEndTick()||i<this.getClipStartTick())){if(i>=this.getClipEndTick()&&r<=this.getClipStartTick()){this.deleteFromParent(!0);return}if(i<this.getClipEndTick()&&r>this.getClipStartTick()){const s=i+1,o=this.getClipEndTick();if(this.adjustClipRight(r-1,!1),this.track){if(this.type===1){const a=this.track.createMIDIClip({clipStartTick:s,clipEndTick:o}),c=J.getNotesInRange(this.notes,s,o);for(const l of c)a.createNote({pitch:l.getPitch(),velocity:l.getVelocity(),startTick:l.getStartTick(),endTick:l.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}else if(this.type===2){const a=this.audioClipData;this.track.createAudioClip({clipStartTick:s,clipEndTick:o,audioClipData:{audioFilePath:a.audioFilePath,startTick:a.startTick,duration:a.duration}})}}return}r>this.getClipStartTick()&&r<=this.getClipEndTick()?this.adjustClipRight(r-1,!1):i<this.getClipEndTick()&&i>=this.getClipStartTick()&&this.adjustClipLeft(i+1,!1)}}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return nn(10)}}var Ze=(e=>(e[e.UNDEFINED=0]="UNDEFINED",e[e.VOLUME=1]="VOLUME",e[e.PAN=2]="PAN",e[e.AUDIO_PLUGIN=3]="AUDIO_PLUGIN",e))(Ze||{});class G{type;pluginInstanceId;paramId;constructor(t,n,r){this.type=t,this.pluginInstanceId=n,this.paramId=r}getType(){return this.type}setType(t){this.type=t}getPluginInstanceId(){return this.pluginInstanceId}setPluginInstanceId(t){this.pluginInstanceId=t}getParamId(){return this.paramId}setParamId(t){this.paramId=t}equals(t){return G.areAutomationTargetsEqual(this.getType(),t.getType(),this.getPluginInstanceId(),t.getPluginInstanceId(),this.getParamId(),t.getParamId())}clone(){return new G(this.type,this.pluginInstanceId,this.paramId)}toTfAutomationTargetId(){return G.encodeAutomationTarget(this.type,this.pluginInstanceId,this.paramId)}static fromTfAutomationTargetId(t){return G.decodeAutomationTarget(t)}static encodeAutomationTarget(t,n,r){return t===3?`${t}^^${n}^^${r}`:`${t}`}static decodeAutomationTarget(t){const n=t.split("^^");if(n.length===0)throw new Error(`Invalid automation target id: ${t}`);const r=Number(n[0]);return n.length>2?new G(r,n[1],n[2]):new G(r)}static areAutomationTargetsEqual(t,n,r,i,s,o){return G.encodeAutomationTarget(t,r,s)===G.encodeAutomationTarget(n,i,o)}}class Jt{points=[];disabled=!1;nextPointIdInternal=1;getDisabled(){return this.disabled}setDisabled(t){this.disabled=t}getPoints(){return this.points}getPointsInRange(t,n){return Jt.getPointsInRangeImpl(this.points,t,n)}static getPointsInRangeImpl(t,n,r){const i=N.ge(t,{tick:n},(o,a)=>o.tick-a.tick),s=[];for(let o=i;o<t.length;o+=1){const a=t[o];if(a.tick>r)break;s.push(a)}return s}addPoint(t,n,r=!1){const i={tick:t,value:Math.max(0,Math.min(1,n)),id:this.getNextPointIdInternal()};return Jt.orderedInsertPointInternal(this.points,i,r),i}removePoints(t){const n=new Set(t);for(let r=this.points.length-1;r>=0;r-=1){const i=this.points[r];n.has(i.id)&&this.points.splice(r,1)}}removePointsInRange(t,n){const r=N.ge(this.points,{tick:t},(s,o)=>s.tick-o.tick);if(r>=this.points.length)return;let i=r;for(;i+1<this.points.length&&this.points[i+1].tick<=n;)i+=1;this.points.splice(r,i-r+1)}movePointsInRange(t,n,r,i,s=!0){const o=this.getPointsInRange(t,n);this.movePoints(o.map(a=>a.id),r,i,s)}movePoints(t,n,r,i=!0){if(t.length===0)return;const s=new Set(t);let o,a;const c=[];for(let l=0;l<this.points.length;l+=1){const p=this.points[l];!s.has(p.id)||(c.push(p),o===void 0&&(o=l),a=l)}if(!(o===void 0||a===void 0)){if(i){if(n<0){const l=Math.max(0,this.points[o].tick+n),p=N.gt(this.points,{tick:l},(h,g)=>h.tick-g.tick);p<o&&this.points.splice(p,o-p)}else if(n>0){const l=this.points[a].tick+n,p=N.lt(this.points,{tick:l},(h,g)=>h.tick-g.tick);p>a&&this.points.splice(a+1,p-a)}}for(const l of c)l.tick=Math.max(0,l.tick+n),l.value=Math.max(0,Math.min(1,l.value+r));Math.abs(n)>0&&this.points.sort((l,p)=>l.tick-p.tick)}}getNextPointIdInternal(){const t=this.nextPointIdInternal;return this.nextPointIdInternal>=2147483647?this.nextPointIdInternal=1:this.nextPointIdInternal+=1,t}static orderedInsertPointInternal(t,n,r=!1){const i=N.ge(t,n,(s,o)=>s.tick-o.tick);for(;r&&t[i]&&t[i].tick===n.tick;)t.splice(i,1);t.splice(i,0,n)}}class So{targets=[];targetValues={};getAutomationTargets(){return this.targets}getAutomationTargetValues(){return this.targetValues}getOrCreateAutomationValueById(t){return this.targetValues[t]||(this.targetValues[t]=new Jt),this.targetValues[t]}getAutomationValueById(t){return this.targetValues[t]}getAutomationValueByTarget(t){const n=t.toTfAutomationTargetId();return this.getAutomationValueById(n)}addAutomation(t,n=0){E.isNumber(n)||(n=0),this.targets.splice(n,0,t);const r=t.toTfAutomationTargetId();this.getAutomationValueById(r)||(this.targetValues[r]=new Jt)}removeAutomation(t){for(let r=this.targets.length-1;r>=0;r-=1)this.targets[r].equals(t)&&this.targets.splice(r,1);const n=t.toTfAutomationTargetId();delete this.targetValues[n]}removeAutomationOfPlugin(t){for(let n=this.targets.length-1;n>=0;n-=1){const r=this.targets[n];r.getPluginInstanceId()===t&&this.removeAutomation(r)}for(const n of E.keys(this.targetValues)){const r=G.decodeAutomationTarget(n);r.getPluginInstanceId()===t&&this.removeAutomation(r)}}removeAllPointsWithinRange(t,n){for(const r of E.keys(this.targetValues))this.targetValues[r].removePointsInRange(t,n)}moveAllPointsWithinRange(t,n,r,i){for(const s of E.keys(this.targetValues))this.targetValues[s].movePointsInRange(t,n,r,i,!1)}}var Ht=(e=>(e[e.MIDI_TRACK=1]="MIDI_TRACK",e[e.AUDIO_TRACK=2]="AUDIO_TRACK",e))(Ht||{});class de{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;pan;samplerPlugin;audioPlugins=[];song;automation;type;constructor({type:t,song:n,uuid:r=de.generateTrackIdInternal(),clips:i=[],instrument:s,suggestedInstruments:o=[],volume:a=_o(0),solo:c=!1,muted:l=!1,rank:p=0,pan:h=0}){this.song=n,this.type=t,s?this.insturment=s:t===1&&(this.insturment=new ae({program:0,isDrum:!1})),this.clips=[...i],this.suggestedInstruments=[...o],this.uuid=r,this.volume=a,this.solo=c,this.muted=l,this.rank=p,this.pan=h,this.automation=new So}getType(){return this.type}getSong(){return this.song}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:n}){this.type===1&&(this.insturment=new ae({program:t,isDrum:n}))}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:n}){if(this.type!==1)return;const r=new ae({program:t,isDrum:n});return this.suggestedInstruments.push(r),r}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}setPan(t){this.pan=t}getPan(){return this.pan}getSolo(){return this.solo}setSolo(t){this.solo=t,t&&this.muted&&(this.muted=!1)}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const n=pe(t);return new Te(n.name,n.manufacturerName,n.pluginFormatName,n.pluginVersion)}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t,n=!0){if(this.type!==1)return;const r=!this.samplerPlugin&&!!t||!t&&!!this.samplerPlugin||!!t&&!!this.samplerPlugin&&!t.matchesTfId(this.samplerPlugin.getTuneflowId()),i=this.samplerPlugin;this.samplerPlugin=t,r&&i&&n&&this.automation.removeAutomationOfPlugin(i.getInstanceId())}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return!this.clips||this.clips.length===0?0:this.clips[0].getClipStartTick()}getTrackEndTick(){return!this.clips||this.clips.length===0?0:this.clips[this.clips.length-1].getClipEndTick()}getClipById(t){for(const n of this.clips)if(n.getId()===t)return n;return null}getClips(){return this.clips}getClipsOverlappingWith(t,n){const r=[],i=N.lt(this.clips,{getClipStartTick:()=>t},(s,o)=>s.getClipStartTick()-o.getClipStartTick());for(let s=Math.max(i,0);s<this.clips.length;s+=1){const o=this.clips[s];if(!(o.getClipEndTick()<t)){if(o.getClipStartTick()>n)break;r.push(o)}}return r}createMIDIClip({clipStartTick:t,clipEndTick:n=void 0,insertClip:r=!0}){if(!E.isNumber(t))throw new Error("clipStartTick must be specified when creating a clip.");const i=n??t+1;if(i<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${n}`);const s=new J({id:J.generateClipIdInternal(),type:qt.MIDI_CLIP,song:this.song,track:void 0,clipStartTick:t,clipEndTick:i});return r&&this.insertClip(s),s}createAudioClip({clipStartTick:t,audioClipData:n,clipEndTick:r,insertClip:i=!0}){if(!E.isNumber(t))throw new Error("clipStartTick must be specified when creating a clip.");const s=new J({id:J.generateClipIdInternal(),type:qt.AUDIO_CLIP,song:this.song,track:void 0,clipStartTick:t,clipEndTick:r,audioClipData:n});return i&&this.insertClip(s),s}insertClip(t){if(t.getTrack()!==this)t.getTrack()&&t.deleteFromParent(!1),t.track=this;else return;this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t)}cloneClip(t){if(t.getType()===qt.MIDI_CLIP){const n=this.createMIDIClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const r of t.getRawNotes())n.createNote({pitch:r.getPitch(),velocity:r.getVelocity(),startTick:r.getStartTick(),endTick:r.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return n}else{if(t.getType()===qt.AUDIO_CLIP)return this.createAudioClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),audioClipData:t.getAudioClipData(),insertClip:!1});throw new Error(`Unsupported clip type ${t.getType()}`)}}getClipIndex(t){const n=N.le(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());return this.clips.indexOf(t,n)}deleteClip(t,n){const r=this.getClipIndex(t);this.deleteClipAt(r,n)}deleteClipAt(t,n){if(!(t<0)){if(n){const r=this.clips[t];if(!r)return;this.automation.removeAllPointsWithinRange(r.getClipStartTick(),r.getClipEndTick())}this.clips.splice(t,1)}}deleteFromParent(){this.song.removeTrack(this.getId())}getAutomation(){return this.automation}hasAnyAutomation(){return this.automation.getAutomationTargets().length>0&&!E.isEmpty(this.automation.getAutomationTargetValues())}static generateTrackIdInternal(){return nn()}resolveClipConflictInternal(t,n,r){const i=this.getClipsOverlappingWith(n,r);for(const s of i)s.getId()!==t&&s.trimConflictPartInternal(n,r)}orderedInsertClipInternal(t){const n=N.ge(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());this.clips.splice(n,0,t)}}class ae{program;isDrum;constructor({program:t,isDrum:n}){this.program=t,this.isDrum=n}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new ae({program:this.program,isDrum:this.isDrum})}}var an={},un={};function Kf(e){var t=new R(e),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var r=Gf(n.data),i=[],s=0;!t.eof()&&s<r.numTracks;s++){var o=t.readChunk();if(o.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";var a=Jf(o.data);i.push(a)}return{header:r,tracks:i}}function Gf(e){var t=new R(e),n=t.readUInt16(),r=t.readUInt16(),i={format:n,numTracks:r},s=t.readUInt16();return s&32768?(i.framesPerSecond=256-(s>>8),i.ticksPerFrame=s&255):i.ticksPerBeat=s,i}function Jf(e){for(var t=new R(e),n=[];!t.eof();){var r=s();n.push(r)}return n;var i;function s(){var o={};o.deltaTime=t.readVarInt();var a=t.readUInt8();if((a&240)===240)if(a===255){o.meta=!0;var c=t.readUInt8(),l=t.readVarInt();switch(c){case 0:if(o.type="sequenceNumber",l!==2)throw"Expected length for sequenceNumber event is 2, got "+l;return o.number=t.readUInt16(),o;case 1:return o.type="text",o.text=t.readString(l),o;case 2:return o.type="copyrightNotice",o.text=t.readString(l),o;case 3:return o.type="trackName",o.text=t.readString(l),o;case 4:return o.type="instrumentName",o.text=t.readString(l),o;case 5:return o.type="lyrics",o.text=t.readString(l),o;case 6:return o.type="marker",o.text=t.readString(l),o;case 7:return o.type="cuePoint",o.text=t.readString(l),o;case 32:if(o.type="channelPrefix",l!=1)throw"Expected length for channelPrefix event is 1, got "+l;return o.channel=t.readUInt8(),o;case 33:if(o.type="portPrefix",l!=1)throw"Expected length for portPrefix event is 1, got "+l;return o.port=t.readUInt8(),o;case 47:if(o.type="endOfTrack",l!=0)throw"Expected length for endOfTrack event is 0, got "+l;return o;case 81:if(o.type="setTempo",l!=3)throw"Expected length for setTempo event is 3, got "+l;return o.microsecondsPerBeat=t.readUInt24(),o;case 84:if(o.type="smpteOffset",l!=5)throw"Expected length for smpteOffset event is 5, got "+l;var p=t.readUInt8(),h={0:24,32:25,64:29,96:30};return o.frameRate=h[p&96],o.hour=p&31,o.min=t.readUInt8(),o.sec=t.readUInt8(),o.frame=t.readUInt8(),o.subFrame=t.readUInt8(),o;case 88:if(o.type="timeSignature",l!=4)throw"Expected length for timeSignature event is 4, got "+l;return o.numerator=t.readUInt8(),o.denominator=1<<t.readUInt8(),o.metronome=t.readUInt8(),o.thirtyseconds=t.readUInt8(),o;case 89:if(o.type="keySignature",l!=2)throw"Expected length for keySignature event is 2, got "+l;return o.key=t.readInt8(),o.scale=t.readUInt8(),o;case 127:return o.type="sequencerSpecific",o.data=t.readBytes(l),o;default:return o.type="unknownMeta",o.data=t.readBytes(l),o.metatypeByte=c,o}}else if(a==240){o.type="sysEx";var l=t.readVarInt();return o.data=t.readBytes(l),o}else if(a==247){o.type="endSysEx";var l=t.readVarInt();return o.data=t.readBytes(l),o}else throw"Unrecognised MIDI event type byte: "+a;else{var g;if((a&128)===0){if(i===null)throw"Running status byte encountered before status byte";g=a,a=i,o.running=!0}else g=t.readUInt8(),i=a;var I=a>>4;switch(o.channel=a&15,I){case 8:return o.type="noteOff",o.noteNumber=g,o.velocity=t.readUInt8(),o;case 9:var v=t.readUInt8();return o.type=v===0?"noteOff":"noteOn",o.noteNumber=g,o.velocity=v,v===0&&(o.byte9=!0),o;case 10:return o.type="noteAftertouch",o.noteNumber=g,o.amount=t.readUInt8(),o;case 11:return o.type="controller",o.controllerType=g,o.value=t.readUInt8(),o;case 12:return o.type="programChange",o.programNumber=g,o;case 13:return o.type="channelAftertouch",o.amount=g,o;case 14:return o.type="pitchBend",o.value=g+(t.readUInt8()<<7)-8192,o;default:throw"Unrecognised MIDI event type: "+I}}}}function R(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}R.prototype.eof=function(){return this.pos>=this.bufferLen};R.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};R.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};R.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};R.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};R.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(e<<16)+(t<<8)+n};R.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};R.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),r=this.readUInt8();return(e<<24)+(t<<16)+(n<<8)+r};R.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};R.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};R.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};R.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:e,length:t,data:n}};var Wf=Kf;function jf(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var n=e.header||{},r=e.tracks||[],i,s=r.length,o=new S;for(Yf(o,n,s),i=0;i<s;i++)Xf(o,r[i],t);return o.buffer}function Yf(e,t,n){var r=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var s=new S;s.writeUInt16(r),s.writeUInt16(n),s.writeUInt16(i),e.writeChunk("MThd",s.buffer)}function Xf(e,t,n){var r=new S,i,s=t.length,o=null;for(i=0;i<s;i++)(n.running===!1||!n.running&&!t[i].running)&&(o=null),o=Qf(r,t[i],o,n.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function Qf(e,t,n,r){var i=t.type,s=t.deltaTime,o=t.text||"",a=t.data||[],c=null;switch(e.writeVarInt(s),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(o.length),e.writeString(o);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(o.length),e.writeString(o);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(o.length),e.writeString(o);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(o.length),e.writeString(o);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(o.length),e.writeString(o);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(o.length),e.writeString(o);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(o.length),e.writeString(o);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var l={24:0,25:32,29:64,30:96},p=t.hour&31|l[t.frameRate];e.writeUInt8(p),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var h=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(h),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(a.length),e.writeBytes(a);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(a.length),e.writeBytes(a));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(a.length),e.writeBytes(a);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(a.length),e.writeBytes(a);break;case"noteOff":var g=r!==!1&&t.byte9||r&&t.velocity==0?144:128;c=g|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":c=144|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":c=160|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":c=176|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":c=192|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.programNumber);break;case"channelAftertouch":c=208|t.channel,c!==n&&e.writeUInt8(c),e.writeUInt8(t.amount);break;case"pitchBend":c=224|t.channel,c!==n&&e.writeUInt8(c);var I=8192+t.value,v=I&127,w=I>>7&127;e.writeUInt8(v),e.writeUInt8(w);break;default:throw"Unrecognized event type: "+i}return c}function S(){this.buffer=[]}S.prototype.writeUInt8=function(e){this.buffer.push(e&255)};S.prototype.writeInt8=S.prototype.writeUInt8;S.prototype.writeUInt16=function(e){var t=e>>8&255,n=e&255;this.writeUInt8(t),this.writeUInt8(n)};S.prototype.writeInt16=S.prototype.writeUInt16;S.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)};S.prototype.writeInt24=S.prototype.writeUInt24;S.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)};S.prototype.writeInt32=S.prototype.writeUInt32;S.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};S.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)};S.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(t&127),t>>=7;t;){var r=t&127|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}};S.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var Zf=jf;un.parseMidi=Wf;un.writeMidi=Zf;var Sr={},cn={},ye={};Object.defineProperty(ye,"__esModule",{value:!0});function xo(e,t,n){n===void 0&&(n="ticks");var r=0,i=e.length,s=i;if(i>0&&e[i-1][n]<=t)return i-1;for(;r<s;){var o=Math.floor(r+(s-r)/2),a=e[o],c=e[o+1];if(a[n]===t){for(var l=o;l<e.length;l++){var p=e[l];p[n]===t&&(o=l)}return o}else{if(a[n]<t&&c[n]>t)return o;a[n]>t?s=o:a[n]<t&&(r=o+1)}}return-1}ye.search=xo;function th(e,t,n){if(n===void 0&&(n="ticks"),e.length){var r=xo(e,t[n],n);e.splice(r+1,0,t)}else e.push(t)}ye.insert=th;(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=ye,n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function i(s){var o=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),s&&(n.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(a){return a.forEach(function(c){c.meta&&(c.type==="timeSignature"?o.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?o.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&o.keySignatures.push({key:e.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})}),s.tracks[0].forEach(function(a){a.meta&&(a.type==="trackName"?o.name=a.text:(a.type==="text"||a.type==="cuePoint"||a.type==="marker"||a.type==="lyrics")&&o.meta.push({text:a.text,ticks:a.absoluteTime,type:a.type}))}),this.update())}return i.prototype.update=function(){var s=this,o=0,a=0;this.tempos.sort(function(c,l){return c.ticks-l.ticks}),this.tempos.forEach(function(c,l){var p=l>0?s.tempos[l-1].bpm:s.tempos[0].bpm,h=c.ticks/s.ppq-a,g=60/p*h;c.time=g+o,o=c.time,a+=h}),this.timeSignatures.sort(function(c,l){return c.ticks-l.ticks}),this.timeSignatures.forEach(function(c,l){var p=l>0?s.timeSignatures[l-1]:s.timeSignatures[0],h=(c.ticks-p.ticks)/s.ppq,g=h/p.timeSignature[0]/(p.timeSignature[1]/4);p.measures=p.measures||0,c.measures=g+p.measures})},i.prototype.ticksToSeconds=function(s){var o=t.search(this.tempos,s);if(o!==-1){var a=this.tempos[o],c=a.time,l=(s-a.ticks)/this.ppq;return c+60/a.bpm*l}else{var p=s/this.ppq;return 60/120*p}},i.prototype.ticksToMeasures=function(s){var o=t.search(this.timeSignatures,s);if(o!==-1){var a=this.timeSignatures[o],c=(s-a.ticks)/this.ppq;return a.measures+c/(a.timeSignature[0]/a.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),i.prototype.secondsToTicks=function(s){var o=t.search(this.tempos,s,"time");if(o!==-1){var a=this.tempos[o],c=a.time,l=s-c,p=l/(60/a.bpm);return Math.round(a.ticks+p*this.ppq)}else{var h=s/.5;return Math.round(h*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(o){return Object.assign({},o)}),this.timeSignatures=s.timeSignatures.map(function(o){return Object.assign({},o)}),this.keySignatures=s.keySignatures.map(function(o){return Object.assign({},o)}),this.meta=s.meta.map(function(o){return Object.assign({},o)}),n.set(this,s.ppq),this.update()},i.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},i}();e.Header=r})(cn);var be={exports:{}};be.exports=eh;be.exports.from=Po;be.exports.depth=nh;be.exports.fromDepth=Co;function eh(e){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return Po(e)}function Po(e){return Eo(e,[])}function nh(e,t){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return Co(e,t)}function Co(e,t){if(typeof t!="number")throw new TypeError("Expected the depth to be a number");return No(e,[],t)}function Eo(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?Eo(r,t):t.push(r)}return t}function No(e,t,n){n--;for(var r=0;r<e.length;r++){var i=e[r];n>-1&&Array.isArray(i)?No(i,t,n):t.push(i)}return t}var Pn=X&&X.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r},rh=X&&X.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Sr,"__esModule",{value:!0});var ih=un,sh=cn,oh=rh(be.exports);function ah(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function uh(e){return oh.default(e.notes.map(function(t){return ah(t,e.channel)}))}function ch(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function lh(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(r){t.push(ch(r,e.channel))});return t}function fh(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function hh(e){var t=[];return e.pitchBends.forEach(function(n){t.push(fh(n,e.channel))}),t}function ph(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function dh(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function gh(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function mh(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Ih(e){var t=sh.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function vh(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function Th(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:Pn([Pn([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(n){return Ih(n)}),e.header.meta.map(function(n){return vh(n)}),e.header.tempos.map(function(n){return gh(n)}),e.header.timeSignatures.map(function(n){return mh(n)}))],e.tracks.map(function(n){return Pn([dh(n.name),ph(n)],uh(n),lh(n),hh(n))}))};return t.tracks=t.tracks.map(function(n){n=n.sort(function(i,s){return i.absoluteTime-s.absoluteTime});var r=0;return n.forEach(function(i){i.deltaTime=i.absoluteTime-r,r=i.absoluteTime,delete i.absoluteTime}),n.push({deltaTime:0,meta:!0,type:"endOfTrack"}),n}),new Uint8Array(ih.writeMidi(t))}Sr.encode=Th;var ln={},xr={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,s){return i[e.controlChangeNames[s]]=s,i},{});var t=new WeakMap,n=new WeakMap,r=function(){function i(s,o){t.set(this,o),n.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"number",{get:function(){return n.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var s=t.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var o=t.get(this);this.ticks=o.secondsToTicks(s)},enumerable:!0,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=r})(xr);var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});var Re=xr;function yh(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(Re.controlChangeIds.hasOwnProperty(t))return e[Re.controlChangeIds[t]]},set:function(e,t,n){return Re.controlChangeIds.hasOwnProperty(t)?e[Re.controlChangeIds[t]]=n:e[t]=n,!0}})}Pr.createControlChanges=yh;var Cr={};Object.defineProperty(Cr,"__esModule",{value:!0});var Cn=new WeakMap,bh=function(){function e(t,n){Cn.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=Cn.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Cn.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();Cr.PitchBend=bh;var Er={},we={};Object.defineProperty(we,"__esModule",{value:!0});we.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];we.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];we.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(Er,"__esModule",{value:!0});var Be=we,Bi=new WeakMap,wh=function(){function e(t,n){if(this.number=0,Bi.set(this,n),this.number=0,t){var r=t.find(function(i){return i.type==="programChange"});r&&(this.number=r.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?Be.DrumKitByPatchID[this.number]:Be.instrumentByPatchID[this.number]},set:function(t){var n=Be.instrumentByPatchID.indexOf(t);n!==-1&&(this.number=n)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":Be.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=Bi.get(this);return t.channel===9},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(t){this.number=t.number},e}();Er.Instrument=wh;var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});function kh(e){var t=Math.floor(e/12)-1;return Oo(e)+t.toString()}function Oo(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function _h(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var Sh=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),i=r[1],s=r[2],o=t[i.toLowerCase()];return o+(parseInt(s,10)+1)*12}}(),Bt=new WeakMap,xh=function(){function e(t,n,r){Bt.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=n.velocity,this.ticks=t.ticks,this.durationTicks=n.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return kh(this.midi)},set:function(t){this.midi=Sh(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var n=t-this.octave;this.midi+=n*12},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return Oo(this.midi)},set:function(t){this.midi=12*(this.octave+1)+_h(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=Bt.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var n=Bt.get(this),r=n.secondsToTicks(this.time+t);this.durationTicks=r-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=Bt.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var n=Bt.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=Bt.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();Nr.Note=xh;Object.defineProperty(ln,"__esModule",{value:!0});var En=ye,Ph=xr,Ch=Pr,Eh=Cr,$i=Er,Nh=Nr,$e=new WeakMap,Oh=function(){function e(t,n){var r=this;if(this.name="",this.notes=[],this.controlChanges=Ch.createControlChanges(),this.pitchBends=[],$e.set(this,n),t){var i=t.find(function(g){return g.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new $i.Instrument(t,this),this.channel=0,t){for(var s=t.filter(function(g){return g.type==="noteOn"}),o=t.filter(function(g){return g.type==="noteOff"}),a=function(){var g=s.shift();c.channel=g.channel;var I=o.findIndex(function(w){return w.noteNumber===g.noteNumber&&w.absoluteTime>=g.absoluteTime});if(I!==-1){var v=o.splice(I,1)[0];c.addNote({durationTicks:v.absoluteTime-g.absoluteTime,midi:g.noteNumber,noteOffVelocity:v.velocity/127,ticks:g.absoluteTime,velocity:g.velocity/127})}},c=this;s.length;)a();var l=t.filter(function(g){return g.type==="controller"});l.forEach(function(g){r.addCC({number:g.controllerType,ticks:g.absoluteTime,value:g.value/127})});var p=t.filter(function(g){return g.type==="pitchBend"});p.forEach(function(g){r.addPitchBend({ticks:g.absoluteTime,value:g.value/Math.pow(2,13)})});var h=t.find(function(g){return g.type==="endOfTrack"});this.endOfTrackTicks=h!==void 0?h.absoluteTime:void 0}}return e.prototype.addNote=function(t){var n=$e.get(this),r=new Nh.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(r,t),En.insert(this.notes,r,"ticks"),this},e.prototype.addCC=function(t){var n=$e.get(this),r=new Ph.ControlChange({controllerType:t.number},n);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),En.insert(this.controlChanges[r.number],r,"ticks"),this},e.prototype.addPitchBend=function(t){var n=$e.get(this),r=new Eh.PitchBend({},n);return Object.assign(r,t),En.insert(this.pitchBends,r,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,n=0;n<this.notes.length-1;n++){var r=this.notes[n].time+this.notes[n].duration;t<r&&(t=r)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,n=0;n<this.notes.length-1;n++){var r=this.notes[n].ticks+this.notes[n].durationTicks;t<r&&(t=r)}return t},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(t){var n=this;this.name=t.name,this.channel=t.channel,this.instrument=new $i.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var r in t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(i){n.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){n.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},n=0;n<127;n++)this.controlChanges.hasOwnProperty(n)&&(t[n]=this.controlChanges[n].map(function(i){return i.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(r.endOfTrackTicks=this.endOfTrackTicks),r},e}();ln.Track=Oh;var Ah=X&&X.__awaiter||function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(p){try{l(r.next(p))}catch(h){o(h)}}function c(p){try{l(r.throw(p))}catch(h){o(h)}}function l(p){p.done?s(p.value):i(p.value).then(a,c)}l((r=r.apply(e,t||[])).next())})},Mh=X&&X.__generator||function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(p){return c([l,p])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(p){l=[6,p],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(an,"__esModule",{value:!0});var Vh=un,Dh=Sr,Li=cn,Nn=ln,Fh=function(){function e(t){var n=this,r=null;t&&(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),r=Vh.parseMidi(t),r.tracks.forEach(function(i){var s=0;i.forEach(function(o){s+=o.deltaTime,o.absoluteTime=s})}),r.tracks=$h(r.tracks)),this.header=new Li.Header(r),this.tracks=[],t&&(this.tracks=r.tracks.map(function(i){return new Nn.Track(i,n.header)}),r.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return e.fromUrl=function(t){return Ah(this,void 0,void 0,function(){var n,r;return Mh(this,function(i){switch(i.label){case 0:return[4,fetch(t)];case 1:return n=i.sent(),n.ok?[4,n.arrayBuffer()]:[3,3];case 2:return r=i.sent(),[2,new e(r)];case 3:throw new Error("could not load "+t)}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=this.tracks.map(function(n){return n.duration});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var t=this.tracks.map(function(n){return n.durationTicks});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),e.prototype.addTrack=function(){var t=new Nn.Track(void 0,this.header);return this.tracks.push(t),t},e.prototype.toArray=function(){return Dh.encode(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(t){return t.toJSON()})}},e.prototype.fromJSON=function(t){var n=this;this.header=new Li.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map(function(r){var i=new Nn.Track(void 0,n.header);return i.fromJSON(r),i})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}(),Uh=an.Midi=Fh,Rh=ln;an.Track=Rh.Track;var Bh=cn;an.Header=Bh.Header;function $h(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,i=new Map,s=Array(16).fill(0),o=0,a=e[n];o<a.length;o++){var c=a[o],l=r,p=c.channel;if(p!==void 0){c.type==="programChange"&&(s[p]=c.programNumber);var h=s[p],g=h+" "+p;i.has(g)?l=i.get(g):(l=r+i.size,i.set(g,l))}t[l]||t.push([]),t[l].push(c)}return t}class ue{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return Ge(this.tracks,n=>n.getId()===t)}getTracksByIds(t){if(!this.tracks)return[];const n=new Set(t);return this.tracks.filter(r=>n.has(r.getId()))}getTrackIndex(t){return Kt(this.tracks,n=>n.getId()===t)}createTrack({type:t,index:n,rank:r,assignDefaultSamplerPlugin:i=!1}){this.checkAccess("createTrack"),r==null||r===null?r=this.getNextTrackRank():this.nextTrackRank=Math.max(r+1,this.nextTrackRank);const s=new de({type:t,song:this,uuid:this.getNextTrackId(),rank:r==null||r===null?this.getNextTrackRank():r});return i&&t===Ht.MIDI_TRACK&&s.setSamplerPlugin(s.createAudioPlugin(Te.DEFAULT_SYNTH_TFID)),n!=null?this.tracks.splice(n,0,s):this.tracks.push(s),s}cloneTrack(t){let n=this.getTrackIndex(t.getId());n<0&&(n=void 0);const r=this.createTrack({type:t.getType(),index:n});if(r.setVolume(t.getVolume()),r.setPan(t.getPan()),r.setSolo(t.getSolo()),r.setMuted(t.getMuted()),t.getType()===Ht.MIDI_TRACK){const i=t.getInstrument();i&&r.setInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});for(const o of t.getSuggestedInstruments())r.createSuggestedInstrument({program:o.getProgram(),isDrum:o.getIsDrum()});const s=t.getSamplerPlugin();s&&r.setSamplerPlugin(s.clone(r))}else t.getType(),Ht.AUDIO_TRACK;for(const i of t.getAudioPlugins())r.addAudioPlugin(i.clone(r));for(const i of t.getClips()){const s=r.cloneClip(i);r.insertClip(s)}return r}removeTrack(t){this.checkAccess("removeTrack");const n=this.getTrackById(t);return n?(this.tracks.splice(Kt(this.tracks,r=>r.getId()===t),1),n):null}getResolution(){return this.PPQ}getBeatsPerBar(){return this.getTimeSignatures()[0].getNumerator()}getTicksPerBar(){return this.getBeatsPerBar()*this.getResolution()}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:n}){if(this.PPQ<=0)throw new Error("Song resolution must be provided before creating tempo changes.");if(this.tempos.length===0&&t!==0)throw new Error("The first tempo event must be at tick 0");const r=new ee({ticks:t,bpm:n,time:this.tickToSeconds(t)}),i=N.ge(this.tempos,r,(s,o)=>s.getTicks()-o.getTicks());return i<0?this.tempos.push(r):this.tempos.splice(i,0,r),this.retimingTempoEvents(),r}overwriteTempoChanges(t){if(t.length===0)throw new Error("Cannot clear all the tempo events.");const n=ki(t);n.sort((i,s)=>i.getTicks()-s.getTicks());const r=n[0];if(r.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new ee({ticks:0,time:0,bpm:r.getBpm()})];for(let i=1;i<n.length;i+=1){const s=n[i];this.createTempoChange({ticks:s.getTicks(),bpm:s.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=ki(t)}updateTempo(t,n){t.setBpmInternal(n),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:n,denominator:r}){const i=new Rn({ticks:t,numerator:n,denominator:r}),s=N.ge(this.timeSignatures,i,(o,a)=>o.getTicks()-a.getTicks());return s<0?this.timeSignatures.push(i):this.timeSignatures.splice(s,0,i),i}getLastTick(){let t=0;for(const n of this.tracks)t=Math.max(t,n.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}getTicksPerBeat(){return this.getResolution()*(4/this.getTimeSignatures()[0].getDenominator())}tickToSeconds(t){return ue.tickToSecondsImpl(t,this.getTempoChanges(),this.getResolution())}static tickToSecondsImpl(t,n,r){if(t===0)return 0;let i=N.lt(n,{getTicks:()=>t},(c,l)=>c.getTicks()-l.getTicks());i==-1&&(i=0);const s=n[i],o=t-s.getTicks(),a=ue.tempoBPMToTicksPerSecond(s.getBpm(),r);return s.getTime()+o/a}secondsToTick(t){if(t===0)return 0;let n=N.lt(this.getTempoChanges(),{getTime:()=>t},(o,a)=>o.getTime()-a.getTime());n==-1&&(n=0);const r=this.getTempoChanges()[n],i=t-r.getTime(),s=ue.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return Math.round(r.getTicks()+i*s)}static importMIDI(t,n,r=0,i=!1){const s=new Uh(n),o=r,a=480/s.header.ppq;if(i){const c=[];for(const p of s.header.timeSignatures)c.push(new Rn({ticks:o+yt(p.ticks,a),numerator:p.timeSignature[0],denominator:p.timeSignature[1]}));t.overwriteTimeSignatures(c);const l=[];o>0&&l.push(new ee({ticks:0,time:0,bpm:120}));for(const p of s.header.tempos)l.push(new ee({ticks:o+yt(p.ticks,a),time:p.time,bpm:p.bpm}));t.overwriteTempoChanges(l)}for(const c of s.tracks){const l=t.createTrack({type:Ht.MIDI_TRACK,assignDefaultSamplerPlugin:!0});l.setInstrument({program:c.instrument.number,isDrum:c.instrument.percussion});const p=l.createMIDIClip({clipStartTick:o});let h=Number.MAX_SAFE_INTEGER;for(const g of c.notes)p.createNote({pitch:g.midi,velocity:Math.round(g.velocity*127),startTick:o+yt(g.ticks,a),endTick:o+yt(g.ticks+g.durationTicks,a)}),h=Math.min(h,o+yt(g.ticks,a));if(c.controlChanges[7]){const g=new G(Ze.VOLUME);l.getAutomation().addAutomation(g);const I=l.getAutomation().getAutomationValueByTarget(g);for(const v of c.controlChanges[7])I.addPoint(o+yt(v.ticks,a),v.value)}if(c.controlChanges[10]){const g=new G(Ze.PAN);l.getAutomation().addAutomation(g);const I=l.getAutomation().getAutomationValueByTarget(g);for(const v of c.controlChanges[10])I.addPoint(o+yt(v.ticks,a),v.value)}h!==Number.MAX_SAFE_INTEGER&&p.adjustClipLeft(h)}}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}clearPluginContextInternal(){this.pluginContext=void 0}getNextTrackId(){const t=this.pluginContext,n=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===n.length)n.push(de.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>n.length)throw new Error("Plugin generated track ids out of sync.");const r=n[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,r}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,n){return t*n/60}retimingTempoEvents(){this.tempos.sort((t,n)=>t.getTicks()-n.getTicks());for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}function yt(e,t){return Math.round(e*t)}var V=(e=>(e[e.Slider=1]="Slider",e[e.Input=2]="Input",e[e.TrackSelector=3]="TrackSelector",e[e.Pitch=4]="Pitch",e[e.TrackPitchSelector=5]="TrackPitchSelector",e[e.InstrumentSelector=6]="InstrumentSelector",e[e.Select=7]="Select",e[e.Switch=8]="Switch",e[e.InputNumber=9]="InputNumber",e[e.MultiTrackSelector=10]="MultiTrackSelector",e[e.None=11]="None",e[e.FileSelector=12]="FileSelector",e[e.MultiSourceAudioSelector=13]="MultiSourceAudioSelector",e[e.AudioRecorder=14]="AudioRecorder",e))(V||{});async function Lh(e){return e.arrayBuffer()}var Ao=(e=>(e[e.SelectedTrackIds=1]="SelectedTrackIds",e[e.SelectedClipInfos=2]="SelectedClipInfos",e[e.TickAtPlayhead=3]="TickAtPlayhead",e[e.EditingClipInfo=4]="EditingClipInfo",e[e.EditingNoteIds=5]="EditingNoteIds",e[e.TickAtPlayheadSnappedToBeat=6]="TickAtPlayheadSnappedToBeat",e))(Ao||{});exports.AudioPlugin=Te;exports.AutomationData=So;exports.AutomationTarget=G;exports.AutomationTargetType=Ze;exports.AutomationValue=Jt;exports.Clip=J;exports.ClipType=qt;exports.InjectSource=Ao;exports.Note=it;exports.Song=ue;exports.TempoEvent=ee;exports.TickToSecondStepper=Uf;exports.TimeSignatureEvent=Rn;exports.Track=de;exports.TrackType=Ht;exports.TuneflowPipeline=Dc;exports.TuneflowPlugin=cr;exports.WidgetType=V;exports.areTuneflowIdsEqual=wo;exports.areTuneflowIdsEqualIgnoreVersion=ko;exports.dbToVolumeValue=_o;exports.decodeAudioPluginTuneflowId=pe;exports.gainToDb=Rf;exports.gainToVolumeValue=Lf;exports.getAudioPluginTuneflowId=Jn;exports.getAudioPluginVersionlessTuneflowId=bo;exports.getFileContentFromFileSelector=Lh;exports.maybeToRaw=zf;exports.midiNumberToPitch=Af;exports.pitchToHz=Hf;exports.pitchToMidiNumber=Df;exports.remapRange=qf;exports.toVersionlessTfId=Ff;exports.volumeValueToDb=Bf;exports.volumeValueToGain=$f;
