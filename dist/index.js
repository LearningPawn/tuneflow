"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module";var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},e=Array.prototype,n=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,i=e.push,s=e.slice,o=n.toString,a=n.hasOwnProperty,u="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,l=Array.isArray,h=Object.keys,f=Object.create,p=u&&ArrayBuffer.isView,g=isNaN,d=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),v=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],k=Math.pow(2,53)-1;function T(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var s=Array(e+1);for(i=0;i<e;i++)s[i]=arguments[i];return s[e]=r,t.apply(this,s)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function I(t){return void 0===t}function b(t){return!0===t||!1===t||"[object Boolean]"===o.call(t)}function S(t){var e="[object "+t+"]";return function(t){return o.call(t)===e}}var w=S("String"),x=S("Number"),C=S("Date"),P=S("RegExp"),_=S("Error"),E=S("Symbol"),j=S("ArrayBuffer"),N=S("Function"),A=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof A&&(N=function(t){return"function"==typeof t||!1});var R=N,O=S("Object"),M=c&&O(new DataView(new ArrayBuffer(8))),B="undefined"!=typeof Map&&O(new Map),V=S("DataView");var D=M?function(t){return null!=t&&R(t.getInt8)&&j(t.buffer)}:V,F=l||S("Array");function W(t,e){return null!=t&&a.call(t,e)}var L=S("Arguments");!function(){L(arguments)||(L=function(t){return W(t,"callee")})}();var $=L;function U(t){return x(t)&&g(t)}function z(t){return function(){return t}}function q(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=k}}function K(t){return function(e){return null==e?void 0:e[t]}}var Q=K("byteLength"),G=q(Q),J=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var H=u?function(t){return p?p(t)&&!D(t):G(t)&&J.test(o.call(t))}:z(!1),X=K("length");function Y(t,e){e=function(t){for(var e={},n=t.length,r=0;r<n;++r)e[t[r]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var r=v.length,i=t.constructor,s=R(i)&&i.prototype||n,o="constructor";for(W(t,o)&&!e.contains(o)&&e.push(o);r--;)(o=v[r])in t&&t[o]!==s[o]&&!e.contains(o)&&e.push(o)}function Z(t){if(!y(t))return[];if(h)return h(t);var e=[];for(var n in t)W(t,n)&&e.push(n);return m&&Y(t,e),e}function tt(t,e){var n=Z(e),r=n.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var o=n[s];if(e[o]!==i[o]||!(o in i))return!1}return!0}function et(t){return t instanceof et?t:this instanceof et?void(this._wrapped=t):new et(t)}function nt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Q(t))}et.VERSION="1.13.2",et.prototype.value=function(){return this._wrapped},et.prototype.valueOf=et.prototype.toJSON=et.prototype.value,et.prototype.toString=function(){return String(this._wrapped)};function rt(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&it(t,e,n,r)}function it(t,e,n,i){t instanceof et&&(t=t._wrapped),e instanceof et&&(e=e._wrapped);var s=o.call(t);if(s!==o.call(e))return!1;if(M&&"[object Object]"==s&&D(t)){if(!D(e))return!1;s="[object DataView]"}switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(e);case"[object ArrayBuffer]":case"[object DataView]":return it(nt(t),nt(e),n,i)}var a="[object Array]"===s;if(!a&&H(t)){if(Q(t)!==Q(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var u=t.constructor,c=e.constructor;if(u!==c&&!(R(u)&&u instanceof u&&R(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var l=(n=n||[]).length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),a){if((l=t.length)!==e.length)return!1;for(;l--;)if(!rt(t[l],e[l],n,i))return!1}else{var h,f=Z(t);if(l=f.length,Z(e).length!==l)return!1;for(;l--;)if(!W(e,h=f[l])||!rt(t[h],e[h],n,i))return!1}return n.pop(),i.pop(),!0}function st(t){if(!y(t))return[];var e=[];for(var n in t)e.push(n);return m&&Y(t,e),e}function ot(t){var e=X(t);return function(n){if(null==n)return!1;var r=st(n);if(X(r))return!1;for(var i=0;i<e;i++)if(!R(n[t[i]]))return!1;return t!==ht||!R(n[at])}}var at="forEach",ut=["clear","delete"],ct=["get","has","set"],lt=ut.concat(at,ct),ht=ut.concat(ct),ft=["add"].concat(ut,at,"has"),pt=B?ot(lt):S("Map"),gt=B?ot(ht):S("WeakMap"),dt=B?ot(ft):S("Set"),mt=S("WeakSet");function vt(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function kt(t){for(var e={},n=Z(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function Tt(t){var e=[];for(var n in t)R(t[n])&&e.push(n);return e.sort()}function yt(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var s=arguments[i],o=t(s),a=o.length,u=0;u<a;u++){var c=o[u];e&&void 0!==n[c]||(n[c]=s[c])}return n}}var It=yt(st),bt=yt(Z),St=yt(st,!0);function wt(t){if(!y(t))return{};if(f)return f(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function xt(t){return F(t)?t:[t]}function Ct(t){return et.toPath(t)}function Pt(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function _t(t,e,n){var r=Pt(t,Ct(e));return I(r)?n:r}function Et(t){return t}function jt(t){return t=bt({},t),function(e){return tt(e,t)}}function Nt(t){return t=Ct(t),function(e){return Pt(e,t)}}function At(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,s){return t.call(e,n,r,i,s)}}return function(){return t.apply(e,arguments)}}function Rt(t,e,n){return null==t?Et:R(t)?At(t,e,n):y(t)&&!F(t)?jt(t):Nt(t)}function Ot(t,e){return Rt(t,e,1/0)}function Mt(t,e,n){return et.iteratee!==Ot?et.iteratee(t,e):Rt(t,e,n)}function Bt(){}function Vt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}et.toPath=xt,et.iteratee=Ot;var Dt=Date.now||function(){return(new Date).getTime()};function Ft(t){var e=function(e){return t[e]},n="(?:"+Z(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}}var Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Lt=Ft(Wt),$t=Ft(kt(Wt)),Ut=et.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},zt=/(.)^/,qt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Kt=/\\|'|\r|\n|\u2028|\u2029/g;function Qt(t){return"\\"+qt[t]}var Gt=/^\s*(\w|\$)+\s*$/;var Jt=0;function Ht(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var s=wt(t.prototype),o=t.apply(s,i);return y(o)?o:s}var Xt=T((function(t,e){var n=Xt.placeholder,r=function(){for(var i=0,s=e.length,o=Array(s),a=0;a<s;a++)o[a]=e[a]===n?arguments[i++]:e[a];for(;i<arguments.length;)o.push(arguments[i++]);return Ht(t,r,this,this,o)};return r}));Xt.placeholder=et;var Yt=T((function(t,e,n){if(!R(t))throw new TypeError("Bind must be called on a function");var r=T((function(i){return Ht(t,r,e,this,n.concat(i))}));return r})),Zt=q(X);function te(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,s=0,o=X(t);s<o;s++){var a=t[s];if(Zt(a)&&(F(a)||$(a)))if(e>1)te(a,e-1,n,r),i=r.length;else for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else n||(r[i++]=a)}return r}var ee=T((function(t,e){var n=(e=te(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=Yt(t[r],t)}return t}));var ne=T((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Xt(ne,et,1);function ie(t){return function(){return!t.apply(this,arguments)}}function se(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var oe=Xt(se,2);function ae(t,e,n){e=Mt(e,n);for(var r,i=Z(t),s=0,o=i.length;s<o;s++)if(e(t[r=i[s]],r,t))return r}function ue(t){return function(e,n,r){n=Mt(n,r);for(var i=X(e),s=t>0?0:i-1;s>=0&&s<i;s+=t)if(n(e[s],s,e))return s;return-1}}var ce=ue(1),le=ue(-1);function he(t,e,n,r){for(var i=(n=Mt(n,r,1))(e),s=0,o=X(t);s<o;){var a=Math.floor((s+o)/2);n(t[a])<i?s=a+1:o=a}return s}function fe(t,e,n){return function(r,i,o){var a=0,u=X(r);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+u,a):u=o>=0?Math.min(o+1,u):o+u+1;else if(n&&o&&u)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=e(s.call(r,a,u),U))>=0?o+a:-1;for(o=t>0?a:u-1;o>=0&&o<u;o+=t)if(r[o]===i)return o;return-1}}var pe=fe(1,ce,he),ge=fe(-1,le);function de(t,e,n){var r=(Zt(t)?ce:ae)(t,e,n);if(void 0!==r&&-1!==r)return t[r]}function me(t,e,n){var r,i;if(e=At(e,n),Zt(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var s=Z(t);for(r=0,i=s.length;r<i;r++)e(t[s[r]],s[r],t)}return t}function ve(t,e,n){e=Mt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=Array(i),o=0;o<i;o++){var a=r?r[o]:o;s[o]=e(t[a],a,t)}return s}function ke(t){var e=function(e,n,r,i){var s=!Zt(e)&&Z(e),o=(s||e).length,a=t>0?0:o-1;for(i||(r=e[s?s[a]:a],a+=t);a>=0&&a<o;a+=t){var u=s?s[a]:a;r=n(r,e[u],u,e)}return r};return function(t,n,r,i){var s=arguments.length>=3;return e(t,At(n,i,4),r,s)}}var Te=ke(1),ye=ke(-1);function Ie(t,e,n){var r=[];return e=Mt(e,n),me(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r}function be(t,e,n){e=Mt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=0;s<i;s++){var o=r?r[s]:s;if(!e(t[o],o,t))return!1}return!0}function Se(t,e,n){e=Mt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,s=0;s<i;s++){var o=r?r[s]:s;if(e(t[o],o,t))return!0}return!1}function we(t,e,n,r){return Zt(t)||(t=vt(t)),("number"!=typeof n||r)&&(n=0),pe(t,e,n)>=0}var xe=T((function(t,e,n){var r,i;return R(e)?i=e:(e=Ct(e),r=e.slice(0,-1),e=e[e.length-1]),ve(t,(function(t){var s=i;if(!s){if(r&&r.length&&(t=Pt(t,r)),null==t)return;s=t[e]}return null==s?s:s.apply(t,n)}))}));function Ce(t,e){return ve(t,Nt(e))}function Pe(t,e,n){var r,i,s=-1/0,o=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(r=t[a])&&r>s&&(s=r);else e=Mt(e,n),me(t,(function(t,n,r){((i=e(t,n,r))>o||i===-1/0&&s===-1/0)&&(s=t,o=i)}));return s}var _e=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ee(t){return t?F(t)?s.call(t):w(t)?t.match(_e):Zt(t)?ve(t,Et):vt(t):[]}function je(t,e,n){if(null==e||n)return Zt(t)||(t=vt(t)),t[Vt(t.length-1)];var r=Ee(t),i=X(r);e=Math.max(Math.min(e,i),0);for(var s=i-1,o=0;o<e;o++){var a=Vt(o,s),u=r[o];r[o]=r[a],r[a]=u}return r.slice(0,e)}function Ne(t,e){return function(n,r,i){var s=e?[[],[]]:{};return r=Mt(r,i),me(n,(function(e,i){var o=r(e,i,n);t(s,e,o)})),s}}var Ae=Ne((function(t,e,n){W(t,n)?t[n].push(e):t[n]=[e]})),Re=Ne((function(t,e,n){t[n]=e})),Oe=Ne((function(t,e,n){W(t,n)?t[n]++:t[n]=1})),Me=Ne((function(t,e,n){t[n?0:1].push(e)}),!0);function Be(t,e,n){return e in n}var Ve=T((function(t,e){var n={},r=e[0];if(null==t)return n;R(r)?(e.length>1&&(r=At(r,e[1])),e=st(t)):(r=Be,e=te(e,!1,!1),t=Object(t));for(var i=0,s=e.length;i<s;i++){var o=e[i],a=t[o];r(a,o,t)&&(n[o]=a)}return n})),De=T((function(t,e){var n,r=e[0];return R(r)?(r=ie(r),e.length>1&&(n=e[1])):(e=ve(te(e,!1,!1),String),r=function(t,n){return!we(e,n)}),Ve(t,r,n)}));function Fe(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function We(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Fe(t,t.length-e)}function Le(t,e,n){return s.call(t,null==e||n?1:e)}var $e=T((function(t,e){return e=te(e,!0,!0),Ie(t,(function(t){return!we(e,t)}))})),Ue=T((function(t,e){return $e(t,e)}));function ze(t,e,n,r){b(e)||(r=n,n=e,e=!1),null!=n&&(n=Mt(n,r));for(var i=[],s=[],o=0,a=X(t);o<a;o++){var u=t[o],c=n?n(u,o,t):u;e&&!n?(o&&s===c||i.push(u),s=c):n?we(s,c)||(s.push(c),i.push(u)):we(i,u)||i.push(u)}return i}var qe=T((function(t){return ze(te(t,!0,!0))}));function Ke(t){for(var e=t&&Pe(t,X).length||0,n=Array(e),r=0;r<e;r++)n[r]=Ce(t,r);return n}var Qe=T(Ke);function Ge(t,e){return t._chain?et(e).chain():e}function Je(t){return me(Tt(t),(function(e){var n=et[e]=t[e];et.prototype[e]=function(){var t=[this._wrapped];return i.apply(t,arguments),Ge(this,n.apply(et,t))}})),et}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var n=e[t];et.prototype[t]=function(){var e=this._wrapped;return null!=e&&(n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0]),Ge(this,e)}})),me(["concat","join","slice"],(function(t){var n=e[t];et.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=n.apply(t,arguments)),Ge(this,t)}}));var He=Je(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VERSION:"1.13.2",restArguments:T,isObject:y,isNull:function(t){return null===t},isUndefined:I,isBoolean:b,isElement:function(t){return!(!t||1!==t.nodeType)},isString:w,isNumber:x,isDate:C,isRegExp:P,isError:_,isSymbol:E,isArrayBuffer:j,isDataView:D,isArray:F,isFunction:R,isArguments:$,isFinite:function(t){return!E(t)&&d(t)&&!isNaN(parseFloat(t))},isNaN:U,isTypedArray:H,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(F(t)||w(t)||$(t))?0===e:0===X(Z(t))},isMatch:tt,isEqual:function(t,e){return rt(t,e)},isMap:pt,isWeakMap:gt,isSet:dt,isWeakSet:mt,keys:Z,allKeys:st,values:vt,pairs:function(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:kt,functions:Tt,methods:Tt,extend:It,extendOwn:bt,assign:bt,defaults:St,create:function(t,e){var n=wt(t);return e&&bt(n,e),n},clone:function(t){return y(t)?F(t)?t.slice():It({},t):t},tap:function(t,e){return e(t),t},get:_t,has:function(t,e){for(var n=(e=Ct(e)).length,r=0;r<n;r++){var i=e[r];if(!W(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Mt(e,n);for(var r=Z(t),i=r.length,s={},o=0;o<i;o++){var a=r[o];s[a]=e(t[a],a,t)}return s},identity:Et,constant:z,noop:Bt,toPath:xt,property:Nt,propertyOf:function(t){return null==t?Bt:function(e){return _t(t,e)}},matcher:jt,matches:jt,times:function(t,e,n){var r=Array(Math.max(0,t));e=At(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:Vt,now:Dt,escape:Lt,unescape:$t,templateSettings:Ut,template:function(t,e,n){!e&&n&&(e=n),e=St({},e,et.templateSettings);var r=RegExp([(e.escape||zt).source,(e.interpolate||zt).source,(e.evaluate||zt).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(r,(function(e,n,r,o,a){return s+=t.slice(i,a).replace(Kt,Qt),i=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e})),s+="';\n";var o,a=e.variable;if(a){if(!Gt.test(a))throw new Error("variable is not a bare identifier: "+a)}else s="with(obj||{}){\n"+s+"}\n",a="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{o=new Function(a,"_",s)}catch(c){throw c.source=s,c}var u=function(t){return o.call(this,t,et)};return u.source="function("+a+"){\n"+s+"}",u},result:function(t,e,n){var r=(e=Ct(e)).length;if(!r)return R(n)?n.call(t):n;for(var i=0;i<r;i++){var s=null==t?void 0:t[e[i]];void 0===s&&(s=n,i=r),t=R(s)?s.call(t):s}return t},uniqueId:function(t){var e=++Jt+"";return t?t+e:e},chain:function(t){var e=et(t);return e._chain=!0,e},iteratee:Ot,partial:Xt,bind:Yt,bindAll:ee,memoize:function(t,e){var n=function(r){var i=n.cache,s=""+(e?e.apply(this,arguments):r);return W(i,s)||(i[s]=t.apply(this,arguments)),i[s]};return n.cache={},n},delay:ne,defer:re,throttle:function(t,e,n){var r,i,s,o,a=0;n||(n={});var u=function(){a=!1===n.leading?0:Dt(),r=null,o=t.apply(i,s),r||(i=s=null)},c=function(){var c=Dt();a||!1!==n.leading||(a=c);var l=e-(c-a);return i=this,s=arguments,l<=0||l>e?(r&&(clearTimeout(r),r=null),a=c,o=t.apply(i,s),r||(i=s=null)):r||!1===n.trailing||(r=setTimeout(u,l)),o};return c.cancel=function(){clearTimeout(r),a=0,r=i=s=null},c},debounce:function(t,e,n){var r,i,s,o,a,u=function(){var c=Dt()-i;e>c?r=setTimeout(u,e-c):(r=null,n||(o=t.apply(a,s)),r||(s=a=null))},c=T((function(c){return a=this,s=c,i=Dt(),r||(r=setTimeout(u,e),n&&(o=t.apply(a,s))),o}));return c.cancel=function(){clearTimeout(r),r=s=a=null},c},wrap:function(t,e){return Xt(e,t)},negate:ie,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:se,once:oe,findKey:ae,findIndex:ce,findLastIndex:le,sortedIndex:he,indexOf:pe,lastIndexOf:ge,find:de,detect:de,findWhere:function(t,e){return de(t,jt(e))},each:me,forEach:me,map:ve,collect:ve,reduce:Te,foldl:Te,inject:Te,reduceRight:ye,foldr:ye,filter:Ie,select:Ie,reject:function(t,e,n){return Ie(t,ie(Mt(e)),n)},every:be,all:be,some:Se,any:Se,contains:we,includes:we,include:we,invoke:xe,pluck:Ce,where:function(t,e){return Ie(t,jt(e))},max:Pe,min:function(t,e,n){var r,i,s=1/0,o=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(r=t[a])&&r<s&&(s=r);else e=Mt(e,n),me(t,(function(t,n,r){((i=e(t,n,r))<o||i===1/0&&s===1/0)&&(s=t,o=i)}));return s},shuffle:function(t){return je(t,1/0)},sample:je,sortBy:function(t,e,n){var r=0;return e=Mt(e,n),Ce(ve(t,(function(t,n,i){return{value:t,index:r++,criteria:e(t,n,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")},groupBy:Ae,indexBy:Re,countBy:Oe,partition:Me,toArray:Ee,size:function(t){return null==t?0:Zt(t)?t.length:Z(t).length},pick:Ve,omit:De,first:We,head:We,take:We,initial:Fe,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:Le(t,Math.max(0,t.length-e))},rest:Le,tail:Le,drop:Le,compact:function(t){return Ie(t,Boolean)},flatten:function(t,e){return te(t,e,!1)},without:Ue,uniq:ze,unique:ze,union:qe,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=X(t);r<i;r++){var s=t[r];if(!we(e,s)){var o;for(o=1;o<n&&we(arguments[o],s);o++);o===n&&e.push(s)}}return e},difference:$e,unzip:Ke,transpose:Ke,zip:Qe,object:function(t,e){for(var n={},r=0,i=X(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),s=0;s<r;s++,t+=n)i[s]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(s.call(t,r,r+=e));return n},mixin:Je,default:et}));He._=He;let Xe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let r=63&n[t];e+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return e};class Ye{instanceIdInternal=Ye.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;songCacheInternal;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,e){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,e){return t[e]}hasAllParamsSet(){for(const t of Z(this.params())){if(this.params()[t].optional)continue;const e=this.paramsResultInternal[t];if(null==e)return!1;const n=this.params()[t].widget.type;switch(n){case exports.WidgetType.Input:case exports.WidgetType.Pitch:case exports.WidgetType.Slider:case exports.WidgetType.TrackSelector:case exports.WidgetType.Select:case exports.WidgetType.Switch:case exports.WidgetType.InputNumber:case exports.WidgetType.FileSelector:break;case exports.WidgetType.MultiTrackSelector:if(0===e.length)return!1;break;case exports.WidgetType.TrackPitchSelector:if(void 0===e.track||null===e.track||void 0===e.pitch||null===e.pitch)return!1;break;case exports.WidgetType.InstrumentSelector:if(void 0===e.program||null===e.program||void 0===e.isDrum||null===e.isDrum)return!1;break;case exports.WidgetType.None:if(null==e)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${n}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of Z(this.params())){const e=this.params()[t];this.paramsResultInternal[t]=e.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Xe(10)}}var Ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function tn(t,e,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)>=0?(s=o,i=o-1):r=o+1}return s}function en(t,e,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)<0?(s=o,r=o+1):i=o-1}return s}function nn(t,e,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,a=t[o];(void 0!==n?n(a,e):a-e)<=0?(s=o,r=o+1):i=o-1}return s}function rn(t,e,n,r,i,s){return"function"==typeof n?s(t,e,n,void 0===r?0:0|r,void 0===i?t.length-1:0|i):s(t,e,void 0,void 0===n?0:0|n,void 0===r?t.length-1:0|r)}var sn=function(t,e,n,r,i){return rn(t,e,n,r,i,tn)},on=function(t,e,n,r,i){return rn(t,e,n,r,i,en)},an=function(t,e,n,r,i){return rn(t,e,n,r,i,nn)},un={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",s="[object Boolean]",o="[object Date]",a="[object Function]",u="[object GeneratorFunction]",c="[object Map]",l="[object Number]",h="[object Object]",f="[object Promise]",p="[object RegExp]",g="[object Set]",d="[object String]",m="[object Symbol]",v="[object WeakMap]",k="[object ArrayBuffer]",T="[object DataView]",y="[object Float32Array]",I="[object Float64Array]",b="[object Int8Array]",S="[object Int16Array]",w="[object Int32Array]",x="[object Uint8Array]",C="[object Uint8ClampedArray]",P="[object Uint16Array]",_="[object Uint32Array]",E=/\w*$/,j=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,A={};A[i]=A["[object Array]"]=A[k]=A[T]=A[s]=A[o]=A[y]=A[I]=A[b]=A[S]=A[w]=A[c]=A[l]=A[h]=A[p]=A[g]=A[d]=A[m]=A[x]=A[C]=A[P]=A[_]=!0,A["[object Error]"]=A[a]=A[v]=!1;var R="object"==typeof Ze&&Ze&&Ze.Object===Object&&Ze,O="object"==typeof self&&self&&self.Object===Object&&self,M=R||O||Function("return this")(),B=e&&!e.nodeType&&e,V=B&&t&&!t.nodeType&&t,D=V&&V.exports===B;function F(t,e){return t.set(e[0],e[1]),t}function W(t,e){return t.add(e),t}function L(t,e,n,r){var i=-1,s=t?t.length:0;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function $(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function U(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function z(t,e){return function(n){return t(e(n))}}function q(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var K,Q=Array.prototype,G=Function.prototype,J=Object.prototype,H=M["__core-js_shared__"],X=(K=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",Y=G.toString,Z=J.hasOwnProperty,tt=J.toString,et=RegExp("^"+Y.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=D?M.Buffer:void 0,rt=M.Symbol,it=M.Uint8Array,st=z(Object.getPrototypeOf,Object),ot=Object.create,at=J.propertyIsEnumerable,ut=Q.splice,ct=Object.getOwnPropertySymbols,lt=nt?nt.isBuffer:void 0,ht=z(Object.keys,Object),ft=Vt(M,"DataView"),pt=Vt(M,"Map"),gt=Vt(M,"Promise"),dt=Vt(M,"Set"),mt=Vt(M,"WeakMap"),vt=Vt(Object,"create"),kt=$t(ft),Tt=$t(pt),yt=$t(gt),It=$t(dt),bt=$t(mt),St=rt?rt.prototype:void 0,wt=St?St.valueOf:void 0;function xt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ct(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Pt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _t(t){this.__data__=new Ct(t)}function Et(t,e){var n=zt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&qt(t)}(t)&&Z.call(t,"callee")&&(!at.call(t,"callee")||tt.call(t)==i)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],r=n.length,s=!!r;for(var o in t)!e&&!Z.call(t,o)||s&&("length"==o||Wt(o,r))||n.push(o);return n}function jt(t,e,n){var r=t[e];Z.call(t,e)&&Ut(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function Nt(t,e){for(var n=t.length;n--;)if(Ut(t[n][0],e))return n;return-1}function At(t,e,n,r,f,v,j){var N;if(r&&(N=v?r(t,f,v,j):r(t)),void 0!==N)return N;if(!Gt(t))return t;var R=zt(t);if(R){if(N=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!e)return function(t,e){var n=-1,r=t.length;e||(e=Array(r));for(;++n<r;)e[n]=t[n];return e}(t,N)}else{var O=Ft(t),M=O==a||O==u;if(Kt(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(O==h||O==i||M&&!v){if($(t))return v?t:{};if(N=function(t){return"function"!=typeof t.constructor||Lt(t)?{}:(e=st(t),Gt(e)?ot(e):{});var e}(M?{}:t),!e)return function(t,e){return Mt(t,Dt(t),e)}(t,function(t,e){return t&&Mt(e,Jt(e),t)}(N,t))}else{if(!A[O])return v?t:{};N=function(t,e,n,r){var i=t.constructor;switch(e){case k:return Ot(t);case s:case o:return new i(+t);case T:return function(t,e){var n=e?Ot(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,r);case y:case I:case b:case S:case w:case x:case C:case P:case _:return function(t,e){var n=e?Ot(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,r);case c:return function(t,e,n){return L(e?n(U(t),!0):U(t),F,new t.constructor)}(t,r,n);case l:case d:return new i(t);case p:return function(t){var e=new t.constructor(t.source,E.exec(t));return e.lastIndex=t.lastIndex,e}(t);case g:return function(t,e,n){return L(e?n(q(t),!0):q(t),W,new t.constructor)}(t,r,n);case m:return a=t,wt?Object(wt.call(a)):{}}var a}(t,O,At,e)}}j||(j=new _t);var B=j.get(t);if(B)return B;if(j.set(t,N),!R)var V=n?function(t){return function(t,e,n){var r=e(t);return zt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,Jt,Dt)}(t):Jt(t);return function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););}(V||t,(function(i,s){V&&(i=t[s=i]),jt(N,s,At(i,e,n,r,s,t,j))})),N}function Rt(t){return!(!Gt(t)||(e=t,X&&X in e))&&(Qt(t)||$(t)?et:j).test($t(t));var e}function Ot(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Mt(t,e,n,r){n||(n={});for(var i=-1,s=e.length;++i<s;){var o=e[i],a=r?r(n[o],t[o],o,n,t):void 0;jt(n,o,void 0===a?t[o]:a)}return n}function Bt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Vt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Rt(n)?n:void 0}xt.prototype.clear=function(){this.__data__=vt?vt(null):{}},xt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},xt.prototype.get=function(t){var e=this.__data__;if(vt){var r=e[t];return r===n?void 0:r}return Z.call(e,t)?e[t]:void 0},xt.prototype.has=function(t){var e=this.__data__;return vt?void 0!==e[t]:Z.call(e,t)},xt.prototype.set=function(t,e){return this.__data__[t]=vt&&void 0===e?n:e,this},Ct.prototype.clear=function(){this.__data__=[]},Ct.prototype.delete=function(t){var e=this.__data__,n=Nt(e,t);return!(n<0)&&(n==e.length-1?e.pop():ut.call(e,n,1),!0)},Ct.prototype.get=function(t){var e=this.__data__,n=Nt(e,t);return n<0?void 0:e[n][1]},Ct.prototype.has=function(t){return Nt(this.__data__,t)>-1},Ct.prototype.set=function(t,e){var n=this.__data__,r=Nt(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},Pt.prototype.clear=function(){this.__data__={hash:new xt,map:new(pt||Ct),string:new xt}},Pt.prototype.delete=function(t){return Bt(this,t).delete(t)},Pt.prototype.get=function(t){return Bt(this,t).get(t)},Pt.prototype.has=function(t){return Bt(this,t).has(t)},Pt.prototype.set=function(t,e){return Bt(this,t).set(t,e),this},_t.prototype.clear=function(){this.__data__=new Ct},_t.prototype.delete=function(t){return this.__data__.delete(t)},_t.prototype.get=function(t){return this.__data__.get(t)},_t.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Ct){var r=n.__data__;if(!pt||r.length<199)return r.push([t,e]),this;n=this.__data__=new Pt(r)}return n.set(t,e),this};var Dt=ct?z(ct,Object):function(){return[]},Ft=function(t){return tt.call(t)};function Wt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||N.test(t))&&t>-1&&t%1==0&&t<e}function Lt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||J)}function $t(t){if(null!=t){try{return Y.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Ut(t,e){return t===e||t!=t&&e!=e}(ft&&Ft(new ft(new ArrayBuffer(1)))!=T||pt&&Ft(new pt)!=c||gt&&Ft(gt.resolve())!=f||dt&&Ft(new dt)!=g||mt&&Ft(new mt)!=v)&&(Ft=function(t){var e=tt.call(t),n=e==h?t.constructor:void 0,r=n?$t(n):void 0;if(r)switch(r){case kt:return T;case Tt:return c;case yt:return f;case It:return g;case bt:return v}return e});var zt=Array.isArray;function qt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!Qt(t)}var Kt=lt||function(){return!1};function Qt(t){var e=Gt(t)?tt.call(t):"";return e==a||e==u}function Gt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Jt(t){return qt(t)?Et(t):function(t){if(!Lt(t))return ht(t);var e=[];for(var n in Object(t))Z.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return At(t,!0,!0)}}(un,un.exports);var cn=un.exports;class ln{ticks;bpm;time;constructor({ticks:t,bpm:e,time:n}){this.ticks=t,this.bpm=e,this.time=n}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class hn{ticks;numerator;denominator;constructor({ticks:t,numerator:e,denominator:n}){this.ticks=t,this.numerator=e,this.denominator=n}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}const fn=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,pn={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function gn(t,e,n,r){return`${t} // ${e} // ${n} // ${r}`}function dn(t,e,n){return`${t} // ${e} // ${n}`}function mn(t){const e=t.split(" // ");if(e.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:e[2],manufacturerName:e[0],pluginFormatName:e[1],pluginVersion:e[3]}}function vn(t,e){return t===e}function kn(t,e){const n=mn(t),r=mn(e);if(He.keys(n).length!==He.keys(r).length)return!1;for(const i of He.keys(n))if("pluginVersion"!==i&&n[i]!==r[i])return!1;return!0}class Tn{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,e,n,r){this.name=t,this.manufacturerName=e,this.pluginFormatName=n,this.pluginVersion=r}getTuneflowId(){return gn(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const e=t.createAudioPlugin(this.getTuneflowId());return e.setIsEnabled(this.isEnabled),e}matchesTfId(t){return vn(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return kn(t,this.getTuneflowId())}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}}class yn{pitch;velocity;startTick;endTick;idInternal;clipInternal;constructor({pitch:t,velocity:e,startTick:n,endTick:r,id:i,clip:s}){this.pitch=t,this.velocity=e,this.startTick=n,this.endTick=r,this.idInternal=i,this.clipInternal=s}getPitch(){return this.pitch}setPitch(t){if(!yn.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=Math.max(Math.min(t,127),0)}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}deleteFromParent(){this.clipInternal&&this.clipInternal.deleteNote(this)}moveNote(t){if(0===t)return;const e=this.clipInternal;e&&e.deleteNote(this),this.startTick=Math.max(0,this.startTick+t),this.endTick=this.endTick+t,this.isRangeValid()&&e&&e.orderedInsertNote(e.getRawNotes(),this)}adjustLeft(t){if(0===t)return;const e=this.clipInternal;e&&e.deleteNote(this),this.startTick+=t,this.isRangeValid()&&e&&e.orderedInsertNote(e.getRawNotes(),this)}adjustLeftTo(t){this.adjustLeft(t-this.startTick)}adjustRight(t){this.endTick+=t,this.isRangeValid()||this.deleteFromParent()}adjustRightTo(t){this.adjustRight(t-this.endTick)}isRangeValid(){return yn.isNoteRangeValid(this.startTick,this.endTick)}static isValidPitch(t){return t>=0&&t<=127&&Number.isInteger(t)}static isNoteRangeValid(t,e){return e>=0&&t<=e&&Number.isInteger(t)&&Number.isInteger(e)}static isNoteVelocityValid(t){return t>=0&&t<=127&&Number.isInteger(t)}getClip(){return this.clipInternal}adjustPitch(t){this.pitch=this.pitch+t,yn.isValidPitch(this.pitch)||this.deleteFromParent()}getId(){return this.idInternal}}class In{track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;constructor({track:t,id:e=In.generateClipIdInternal(),clipStartTick:n=0,clipEndTick:r=0}){this.track=t,this.id=e,this.notes=[],this.clipStartTick=n,this.clipEndTick=r}getId(){return this.id}getNotes(){return In.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:e,startTick:n,endTick:r,updateClipRange:i=!0,resolveClipConflict:s=!0}){if(!yn.isValidPitch(t)||!yn.isNoteRangeValid(n,r)||!yn.isNoteVelocityValid(e))return null;const o=new yn({pitch:t,velocity:e,startTick:n,endTick:r,id:this.getNextNoteIdInternal()});return n<this.clipStartTick&&i&&this.adjustClipLeft(n,s),r>this.clipEndTick&&i&&this.adjustClipRight(r,s),this.orderedInsertNote(this.notes,o),o}getNoteIndexInternal(t){const e=on(this.notes,t,((t,e)=>t.getStartTick()-e.getStartTick()));for(let n=Math.max(0,e);n<this.notes.length;n+=1){const e=this.notes[n];if(e&&e===t)return n;if(e&&e.getStartTick()>t.getStartTick())break}return-1}deleteNote(t){const e=this.getNoteIndexInternal(t);e>=0&&this.deleteNoteAt(e)}deleteNoteAt(t){const e=this.notes[t];e&&(e.clipInternal=null,this.notes.splice(t,1))}orderedInsertNote(t,e){if(e.getClip()===this)return;const n=sn(t,e,((t,e)=>t.getStartTick()-e.getStartTick()));n<0?t.push(e):t.splice(n,0,e),e.clipInternal=this}adjustClipLeft(t,e=!0){(t=Math.max(0,t))>this.clipEndTick?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,e=!0){t<this.clipStartTick||t<0?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t){const e=Math.max(0,this.clipStartTick+t),n=this.clipEndTick+t;if(n<0)this.deleteFromParent();else{if(this.track&&this.track.resolveClipConflictInternal(this.getId(),e,n),this.track){const t=this.track.getClipIndex(this);this.track.deleteClipAt(t)}this.clipStartTick=e,this.clipEndTick=n;for(const e of this.notes)e.setStartTick(e.getStartTick()+t),e.setEndTick(e.getEndTick()+t);this.track&&this.track.orderedInsertClipInternal(this)}}moveClipTo(t){const e=t-this.getClipStartTick();this.moveClip(e)}deleteFromParent(){this.track&&(this.track.deleteClip(this),this.track=void 0)}getNotesByIds(t){const e=new Set(t),n=[];for(const r of this.notes)e.has(r.getId())&&n.push(r);return n}static getNotesInRange(t,e,n){return In.getNotesInRangeImpl(t,e,n,(t=>({getStartTick:()=>t})),(t=>t.getStartTick()),(t=>t.getEndTick()))}static getNotesInRangeImpl(t,e,n,r,i,s){const o=on(t,r(e),((t,e)=>i(t)-i(e))),a=[];for(let u=Math.max(o,0);u<t.length;u+=1){const r=t[u],o=i(r),c=s(r);if(o>n)break;In.isNoteInClip(o,c,e,n)&&a.push(r)}return a}static isNoteInClip(t,e,n,r){return(t>=n||0===n&&t<=0)&&t<=r&&e>=t}static getNotePlayableRange(t,e,n,r){if(!In.isNoteInClip(t,e,n,r))return null;const i=Math.max(t,n),s=Math.min(e,r);return i>s?null:{startTick:i,endTick:s}}trimConflictPartInternal(t,e){const n=Math.max(t,this.getClipStartTick()),r=Math.min(e,this.getClipEndTick());if(!(n>r||n>this.getClipEndTick()||r<this.getClipStartTick()))if(r>=this.getClipEndTick()&&n<=this.getClipStartTick())this.deleteFromParent();else if(r<this.getClipEndTick()&&n>this.getClipStartTick()){const t=r+1,e=this.getClipEndTick();if(this.adjustClipRight(n-1,!1),this.track){const n=this.track.createClip({clipStartTick:t,clipEndTick:e}),r=In.getNotesInRange(this.notes,t,e);for(const t of r)n.createNote({pitch:t.getPitch(),velocity:t.getVelocity(),startTick:t.getStartTick(),endTick:t.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}}else n>this.getClipStartTick()&&n<=this.getClipEndTick()?this.adjustClipRight(n-1,!1):r<this.getClipEndTick()&&r>=this.getClipStartTick()&&this.adjustClipLeft(r+1,!1)}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return Xe(10)}}class bn{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;pan;samplerPlugin;audioPlugins=[];song;constructor({song:t,uuid:e=bn.generateTrackIdInternal(),clips:n=[],instrument:r=new Sn({program:0,isDrum:!1}),suggestedInstruments:i=[],volume:s=1,solo:o=!1,muted:a=!1,rank:u=0,pan:c=0}){this.song=t,this.insturment=r,this.clips=[...n],this.suggestedInstruments=[...i],this.uuid=e,this.volume=s,this.solo=o,this.muted=a,this.rank=u,this.pan=c}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:e}){this.insturment=new Sn({program:t,isDrum:e})}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:e}){const n=new Sn({program:t,isDrum:e});return this.suggestedInstruments.push(n),n}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}setPan(t){this.pan=t}getPan(){return this.pan}getSolo(){return this.solo}setSolo(t){this.solo=t}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const e=mn(t),n=new Tn(e.name,e.manufacturerName,e.pluginFormatName,e.pluginVersion);return n.localInstanceIdInternal=Xe(10),n}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t){this.samplerPlugin=t}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return this.clips&&0!==this.clips.length?this.clips[0].getClipStartTick():0}getTrackEndTick(){return this.clips&&0!==this.clips.length?this.clips[this.clips.length-1].getClipEndTick():0}getClipById(t){for(const e of this.clips)if(e.getId()===t)return e;return null}getClips(){return this.clips}getClipsOverlappingWith(t,e){const n=[],r=on(this.clips,{getClipStartTick:()=>t},((t,e)=>t.getClipStartTick()-e.getClipStartTick()));for(let i=Math.max(r,0);i<this.clips.length;i+=1){const r=this.clips[i];if(!(r.getClipEndTick()<t)){if(r.getClipStartTick()>e)break;n.push(r)}}return n}createClip({clipStartTick:t,clipEndTick:e,insertClip:n=!0}){if(null==t)throw new Error("clipStartTick must be specified when creating a clip.");const r=null==e?t+1:e;if(r<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${e}`);const i=new In({id:In.generateClipIdInternal(),track:void 0,clipStartTick:t,clipEndTick:r});return n&&this.insertClip(i),i}insertClip(t){t.getTrack()!==this&&(t.getTrack()&&t.deleteFromParent(),t.track=this,this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t))}cloneClip(t){const e=this.createClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const n of t.getRawNotes())e.createNote({pitch:n.getPitch(),velocity:n.getVelocity(),startTick:n.getStartTick(),endTick:n.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return e}getClipIndex(t){const e=an(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));return this.clips.indexOf(t,e)}deleteClip(t){const e=this.getClipIndex(t);this.deleteClipAt(e)}deleteClipAt(t){t<0||this.clips.splice(t,1)}deleteFromParent(){this.song.removeTrack(this.getId())}static generateTrackIdInternal(){return Xe()}resolveClipConflictInternal(t,e,n){const r=this.getClipsOverlappingWith(e,n);for(const i of r)i.getId()!==t&&i.trimConflictPartInternal(e,n)}orderedInsertClipInternal(t){const e=sn(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));this.clips.splice(e,0,t)}}class Sn{program;isDrum;constructor({program:t,isDrum:e}){this.program=t,this.isDrum=e}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new Sn({program:this.program,isDrum:this.isDrum})}}class wn{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return de(this.tracks,(e=>e.getId()===t))}getTracksByIds(t){if(!this.tracks)return[];const e=new Set(t);return this.tracks.filter((t=>e.has(t.getId())))}getTrackIndex(t){return ce(this.tracks,(e=>e.getId()===t))}createTrack({index:t,rank:e}){this.checkAccess("createTrack"),null==e||null===e?e=this.getNextTrackRank():this.nextTrackRank=Math.max(e+1,this.nextTrackRank);const n=new bn({song:this,uuid:this.getNextTrackId(),rank:null==e||null===e?this.getNextTrackRank():e});return null!=t?this.tracks.splice(t,0,n):this.tracks.push(n),n}cloneTrack(t){let e=this.getTrackIndex(t.getId());e<0&&(e=void 0);const n=this.createTrack({index:e});n.setInstrument({program:t.getInstrument().getProgram(),isDrum:t.getInstrument().getIsDrum()});for(const i of t.getSuggestedInstruments())n.createSuggestedInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});n.setVolume(t.getVolume()),n.setPan(t.getPan()),n.setSolo(t.getSolo()),n.setMuted(t.getMuted());const r=t.getSamplerPlugin();r&&n.setSamplerPlugin(r.clone(n));for(const i of t.getAudioPlugins())n.addAudioPlugin(i.clone(n));for(const i of t.getClips()){const t=n.createClip({clipStartTick:i.getClipStartTick(),clipEndTick:i.getClipEndTick()});for(const e of i.getRawNotes())t.createNote({pitch:e.getPitch(),velocity:e.getVelocity(),startTick:e.getStartTick(),endTick:e.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return n}removeTrack(t){this.checkAccess("removeTrack");const e=this.getTrackById(t);return e?(this.tracks.splice(ce(this.tracks,(e=>e.getId()===t)),1),e):null}getResolution(){return this.PPQ}getBeatsPerBar(){return this.getTimeSignatures()[0].getNumerator()}getTicksPerBar(){return this.getBeatsPerBar()*this.getResolution()}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:e}){if(0===this.tempos.length&&0!==t)throw new Error("The first tempo event must be at tick 0");const n=new ln({ticks:t,bpm:e,time:this.tickToSeconds(t)}),r=sn(this.tempos,n,((t,e)=>t.getTicks()-e.getTicks()));return r<0?this.tempos.push(n):this.tempos.splice(r,0,n),this.retimingTempoEvents(),n}overwriteTempoChanges(t){if(0===t.length)throw new Error("Cannot clear all the tempo events.");const e=cn(t);e.sort(((t,e)=>t.getTicks()-e.getTicks()));const n=e[0];if(n.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new ln({ticks:0,time:0,bpm:n.getBpm()})];for(let r=1;r<e.length;r+=1){const t=e[r];this.createTempoChange({ticks:t.getTicks(),bpm:t.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=cn(t)}updateTempo(t,e){t.setBpmInternal(e),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:e,denominator:n}){const r=new hn({ticks:t,numerator:e,denominator:n}),i=sn(this.timeSignatures,r,((t,e)=>t.getTicks()-e.getTicks()));return i<0?this.timeSignatures.push(r):this.timeSignatures.splice(i,0,r),r}getLastTick(){let t=0;for(const e of this.tracks)t=Math.max(t,e.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}tickToSeconds(t){if(0===t)return 0;const e=on(this.getTempoChanges(),{getTicks:()=>t},((t,e)=>t.getTicks()-e.getTicks()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTicks(),i=wn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return n.getTime()+r/i}secondsToTick(t){const e=on(this.getTempoChanges(),{getTime:()=>t},((t,e)=>t.getTime()-e.getTime()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTime(),i=wn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return Math.round(n.getTicks()+r*i)}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}clearPluginContextInternal(){this.pluginContext=void 0}getNextTrackId(){const t=this.pluginContext,e=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===e.length)e.push(bn.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>e.length)throw new Error("Plugin generated track ids out of sync.");const n=e[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,n}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,e){return t*e/60}retimingTempoEvents(){this.tempos.sort(((t,e)=>t.getTicks()-e.getTicks()));for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}var xn,Cn;exports.WidgetType=void 0,(xn=exports.WidgetType||(exports.WidgetType={}))[xn.Slider=1]="Slider",xn[xn.Input=2]="Input",xn[xn.TrackSelector=3]="TrackSelector",xn[xn.Pitch=4]="Pitch",xn[xn.TrackPitchSelector=5]="TrackPitchSelector",xn[xn.InstrumentSelector=6]="InstrumentSelector",xn[xn.Select=7]="Select",xn[xn.Switch=8]="Switch",xn[xn.InputNumber=9]="InputNumber",xn[xn.MultiTrackSelector=10]="MultiTrackSelector",xn[xn.None=11]="None",xn[xn.FileSelector=12]="FileSelector",exports.InjectSource=void 0,(Cn=exports.InjectSource||(exports.InjectSource={}))[Cn.SelectedTrackIds=1]="SelectedTrackIds",Cn[Cn.SelectedClipInfos=2]="SelectedClipInfos",Cn[Cn.TickAtPlayhead=3]="TickAtPlayhead",Cn[Cn.EditingClipInfo=4]="EditingClipInfo",Cn[Cn.EditingNoteIds=5]="EditingNoteIds",exports.AudioPlugin=Tn,exports.Clip=In,exports.Note=yn,exports.Song=wn,exports.TempoEvent=ln,exports.TimeSignatureEvent=hn,exports.Track=bn,exports.TuneflowPipeline=class{plugins=[];threwErrorInLastRun=!1;maxNumPluginsToKeep=50;originalSong;cloneSongFnInternal;addPlugin(t){this.plugins.push(t),this.maintainPluginListSize()}addPluginAt(t,e){this.plugins.splice(e,0,t),this.maintainPluginListSize()}removePlugin(t){this.plugins.splice(this.plugins.indexOf(t),1)}getPlugins(){return this.plugins}resetCache(){for(const t of this.plugins)delete t.songCacheInternal}setOriginalSong(t){this.originalSong=t}hasOriginalSong(){return!!this.originalSong}async run(t=0){if(!this.originalSong)return this.threwErrorInLastRun=!0,null;let e;t=Math.max(0,t),this.threwErrorInLastRun=!1;const n=this.getIndexOfLatestPluginWithCacheBeforeIndex(t);e=n>=0?await this.cloneSong(this.plugins[n].songCacheInternal):await this.cloneSong(this.originalSong);for(let s=t;s<this.plugins.length;s+=1)delete this.plugins[s].songCacheInternal;for(let s=0;s<=n;s+=1){this.plugins[s].isRollbackable=!0}let r=0;for(let s=n>=0?n+1:0;s<this.plugins.length;s+=1){const t=this.plugins[s];if(!t.enabledInternal)return e;if(!t.hasAllParamsSet())return e;e.setPluginContextInternal(t);try{await t.run(e,t.getParamsInternal()),e.clearPluginContextInternal()}catch(i){this.threwErrorInLastRun=!0,e.clearPluginContextInternal();const t=this.getIndexOfLatestPluginWithCacheBeforeIndex(s);return t>=0?await this.cloneSong(this.plugins[t].songCacheInternal):await this.cloneSong(this.originalSong)}t.songCacheInternal=await this.cloneSong(e),t.isRollbackable=!0,r+=1}return e}async cloneSong(t){if(!this.cloneSongFnInternal)throw new Error("Pipeline is not provided with a clone song function.");return this.cloneSongFnInternal(t)}reset(){for(const t of this.plugins)t.resetInternal()}clear(){this.plugins.splice(0,this.plugins.length),this.originalSong=void 0}movePluginUp(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<=0||this.plugins.splice(e-1,0,this.plugins.splice(e,1)[0])}movePluginDown(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<0||e>=this.plugins.length-1||this.plugins.splice(e,0,this.plugins.splice(e+1,1)[0])}isPluginFunctioning(t){return!!t.songCacheInternal}getPluginIndexByPluginInstanceId(t){return ce(this.plugins,(e=>e.instanceId===t))}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getLastFunctioningPlugin(){for(let t=this.plugins.length-1;t>=0;t-=1)if(this.isPluginFunctioning(this.plugins[t]))return this.plugins[t];return null}getPluginCache(t){return t.songCacheInternal}setMaxNumPluginsToKeep(t){this.maxNumPluginsToKeep=t,this.maintainPluginListSize()}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let e=t-1;e>=0;e-=1)if(this.getPluginCache(this.plugins[e]))return e;return-1}maintainPluginListSize(){for(;this.plugins.length>this.maxNumPluginsToKeep&&this.plugins.length>0;)this.plugins.shift()}},exports.TuneflowPlugin=Ye,exports.areTuneflowIdsEqual=vn,exports.areTuneflowIdsEqualIgnoreVersion=kn,exports.decodeAudioPluginTuneflowId=mn,exports.getAudioPluginTuneflowId=gn,exports.getAudioPluginVersionlessTuneflowId=dn,exports.midiNumberToPitch=function(t){const e=Math.floor(t/12)-1;return function(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}(t)+e.toString()},exports.pitchToMidiNumber=function(t){const e=fn.exec(t);if(!e)return-1;const n=e[1],r=e[2];return pn[n.toLowerCase()]+12*(parseInt(r,10)+1)},exports.toVersionlessTfId=function(t){const e=mn(t);return dn(e.manufacturerName,e.pluginFormatName,e.name)};
