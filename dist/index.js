"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var Pn="1.13.2",ln=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},Vt=Array.prototype,oe=Object.prototype,cn=typeof Symbol<"u"?Symbol.prototype:null,Yi=Vt.push,pt=Vt.slice,lt=oe.toString,Zi=oe.hasOwnProperty,wn=typeof ArrayBuffer<"u",Wi=typeof DataView<"u",ji=Array.isArray,fn=Object.keys,hn=Object.create,gn=wn&&ArrayBuffer.isView,ts=isNaN,es=isFinite,Sn=!{toString:null}.propertyIsEnumerable("toString"),pn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ns=Math.pow(2,53)-1;function A(e,t){return t=t==null?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var s=Array(t+1);for(i=0;i<t;i++)s[i]=arguments[i];return s[t]=r,e.apply(this,s)}}function K(e){var t=typeof e;return t==="function"||t==="object"&&!!e}function rs(e){return e===null}function yn(e){return e===void 0}function Cn(e){return e===!0||e===!1||lt.call(e)==="[object Boolean]"}function is(e){return!!(e&&e.nodeType===1)}function P(e){var t="[object "+e+"]";return function(n){return lt.call(n)===t}}const ue=P("String"),An=P("Number"),ss=P("Date"),as=P("RegExp"),os=P("Error"),En=P("Symbol"),_n=P("ArrayBuffer");var xn=P("Function"),us=ln.document&&ln.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof us!="function"&&(xn=function(e){return typeof e=="function"||!1});const S=xn,Nn=P("Object");var Rn=Wi&&Nn(new DataView(new ArrayBuffer(8))),le=typeof Map<"u"&&Nn(new Map),ls=P("DataView");function cs(e){return e!=null&&S(e.getInt8)&&_n(e.buffer)}const _t=Rn?cs:ls,Q=ji||P("Array");function U(e,t){return e!=null&&Zi.call(e,t)}var jt=P("Arguments");(function(){jt(arguments)||(jt=function(e){return U(e,"callee")})})();const ce=jt;function fs(e){return!En(e)&&es(e)&&!isNaN(parseFloat(e))}function Mn(e){return An(e)&&ts(e)}function Vn(e){return function(){return e}}function bn(e){return function(t){var n=e(t);return typeof n=="number"&&n>=0&&n<=ns}}function On(e){return function(t){return t?.[e]}}const xt=On("byteLength"),hs=bn(xt);var gs=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function ps(e){return gn?gn(e)&&!_t(e):hs(e)&&gs.test(lt.call(e))}const Bn=wn?ps:Vn(!1),E=On("length");function ds(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(i){return t[i]===!0},push:function(i){return t[i]=!0,e.push(i)}}}function Dn(e,t){t=ds(t);var n=pn.length,r=e.constructor,i=S(r)&&r.prototype||oe,s="constructor";for(U(e,s)&&!t.contains(s)&&t.push(s);n--;)s=pn[n],s in e&&e[s]!==i[s]&&!t.contains(s)&&t.push(s)}function v(e){if(!K(e))return[];if(fn)return fn(e);var t=[];for(var n in e)U(e,n)&&t.push(n);return Sn&&Dn(e,t),t}function ms(e){if(e==null)return!0;var t=E(e);return typeof t=="number"&&(Q(e)||ue(e)||ce(e))?t===0:E(v(e))===0}function Ln(e,t){var n=v(t),r=n.length;if(e==null)return!r;for(var i=Object(e),s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0}function d(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e}d.VERSION=Pn;d.prototype.value=function(){return this._wrapped};d.prototype.valueOf=d.prototype.toJSON=d.prototype.value;d.prototype.toString=function(){return String(this._wrapped)};function dn(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,xt(e))}var mn="[object DataView]";function te(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return!1;if(e!==e)return t!==t;var i=typeof e;return i!=="function"&&i!=="object"&&typeof t!="object"?!1:Fn(e,t,n,r)}function Fn(e,t,n,r){e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var i=lt.call(e);if(i!==lt.call(t))return!1;if(Rn&&i=="[object Object]"&&_t(e)){if(!_t(t))return!1;i=mn}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:+e==0?1/+e===1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return cn.valueOf.call(e)===cn.valueOf.call(t);case"[object ArrayBuffer]":case mn:return Fn(dn(e),dn(t),n,r)}var s=i==="[object Array]";if(!s&&Bn(e)){var o=xt(e);if(o!==xt(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if(typeof e!="object"||typeof t!="object")return!1;var u=e.constructor,h=t.constructor;if(u!==h&&!(S(u)&&u instanceof u&&S(h)&&h instanceof h)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var f=n.length;f--;)if(n[f]===e)return r[f]===t;if(n.push(e),r.push(t),s){if(f=e.length,f!==t.length)return!1;for(;f--;)if(!te(e[f],t[f],n,r))return!1}else{var p=v(e),I;if(f=p.length,v(t).length!==f)return!1;for(;f--;)if(I=p[f],!(U(t,I)&&te(e[I],t[I],n,r)))return!1}return n.pop(),r.pop(),!0}function Is(e,t){return te(e,t)}function dt(e){if(!K(e))return[];var t=[];for(var n in e)t.push(n);return Sn&&Dn(e,t),t}function fe(e){var t=E(e);return function(n){if(n==null)return!1;var r=dt(n);if(E(r))return!1;for(var i=0;i<t;i++)if(!S(n[e[i]]))return!1;return e!==qn||!S(n[he])}}var he="forEach",$n="has",ge=["clear","delete"],Un=["get",$n,"set"],vs=ge.concat(he,Un),qn=ge.concat(Un),Ts=["add"].concat(ge,he,$n);const ks=le?fe(vs):P("Map"),Ps=le?fe(qn):P("WeakMap"),ws=le?fe(Ts):P("Set"),Ss=P("WeakSet");function nt(e){for(var t=v(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function ys(e){for(var t=v(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r}function Gn(e){for(var t={},n=v(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function ee(e){var t=[];for(var n in e)S(e[n])&&t.push(n);return t.sort()}function pe(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||n==null)return n;for(var i=1;i<r;i++)for(var s=arguments[i],o=e(s),u=o.length,h=0;h<u;h++){var f=o[h];(!t||n[f]===void 0)&&(n[f]=s[f])}return n}}const zn=pe(dt),Nt=pe(v),Hn=pe(dt,!0);function Cs(){return function(){}}function Kn(e){if(!K(e))return{};if(hn)return hn(e);var t=Cs();t.prototype=e;var n=new t;return t.prototype=null,n}function As(e,t){var n=Kn(e);return t&&Nt(n,t),n}function Es(e){return K(e)?Q(e)?e.slice():zn({},e):e}function _s(e,t){return t(e),e}function Qn(e){return Q(e)?e:[e]}d.toPath=Qn;function mt(e){return d.toPath(e)}function de(e,t){for(var n=t.length,r=0;r<n;r++){if(e==null)return;e=e[t[r]]}return n?e:void 0}function Jn(e,t,n){var r=de(e,mt(t));return yn(r)?n:r}function xs(e,t){t=mt(t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(!U(e,i))return!1;e=e[i]}return!!n}function me(e){return e}function ct(e){return e=Nt({},e),function(t){return Ln(t,e)}}function Ie(e){return e=mt(e),function(t){return de(t,e)}}function It(e,t,n){if(t===void 0)return e;switch(n??3){case 1:return function(r){return e.call(t,r)};case 3:return function(r,i,s){return e.call(t,r,i,s)};case 4:return function(r,i,s,o){return e.call(t,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function Xn(e,t,n){return e==null?me:S(e)?It(e,t,n):K(e)&&!Q(e)?ct(e):Ie(e)}function ve(e,t){return Xn(e,t,1/0)}d.iteratee=ve;function _(e,t,n){return d.iteratee!==ve?d.iteratee(e,t):Xn(e,t,n)}function Ns(e,t,n){t=_(t,n);for(var r=v(e),i=r.length,s={},o=0;o<i;o++){var u=r[o];s[u]=t(e[u],u,e)}return s}function Yn(){}function Rs(e){return e==null?Yn:function(t){return Jn(e,t)}}function Ms(e,t,n){var r=Array(Math.max(0,e));t=It(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r}function ne(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}const ft=Date.now||function(){return new Date().getTime()};function Zn(e){var t=function(s){return e[s]},n="(?:"+v(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(s){return s=s==null?"":""+s,r.test(s)?s.replace(i,t):s}}const Wn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Vs=Zn(Wn),bs=Gn(Wn),Os=Zn(bs),Bs=d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Yt=/(.)^/,Ds={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ls=/\\|'|\r|\n|\u2028|\u2029/g;function Fs(e){return"\\"+Ds[e]}var $s=/^\s*(\w|\$)+\s*$/;function Us(e,t,n){!t&&n&&(t=n),t=Hn({},t,d.templateSettings);var r=RegExp([(t.escape||Yt).source,(t.interpolate||Yt).source,(t.evaluate||Yt).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(f,p,I,R,it){return s+=e.slice(i,it).replace(Ls,Fs),i=it+f.length,p?s+=`'+
((__t=(`+p+`))==null?'':_.escape(__t))+
'`:I?s+=`'+
((__t=(`+I+`))==null?'':__t)+
'`:R&&(s+=`';
`+R+`
__p+='`),f}),s+=`';
`;var o=t.variable;if(o){if(!$s.test(o))throw new Error("variable is not a bare identifier: "+o)}else s=`with(obj||{}){
`+s+`}
`,o="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var u;try{u=new Function(o,"_",s)}catch(f){throw f.source=s,f}var h=function(f){return u.call(this,f,d)};return h.source="function("+o+`){
`+s+"}",h}function qs(e,t,n){t=mt(t);var r=t.length;if(!r)return S(n)?n.call(e):n;for(var i=0;i<r;i++){var s=e?.[t[i]];s===void 0&&(s=n,i=r),e=S(s)?s.call(e):s}return e}var Gs=0;function zs(e){var t=++Gs+"";return e?e+t:t}function Hs(e){var t=d(e);return t._chain=!0,t}function jn(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var s=Kn(e.prototype),o=e.apply(s,i);return K(o)?o:s}var rt=A(function(e,t){var n=rt.placeholder,r=function(){for(var i=0,s=t.length,o=Array(s),u=0;u<s;u++)o[u]=t[u]===n?arguments[i++]:t[u];for(;i<arguments.length;)o.push(arguments[i++]);return jn(e,r,this,this,o)};return r});rt.placeholder=d;const tr=A(function(e,t,n){if(!S(e))throw new TypeError("Bind must be called on a function");var r=A(function(i){return jn(e,r,t,this,n.concat(i))});return r}),x=bn(E);function J(e,t,n,r){if(r=r||[],!t&&t!==0)t=1/0;else if(t<=0)return r.concat(e);for(var i=r.length,s=0,o=E(e);s<o;s++){var u=e[s];if(x(u)&&(Q(u)||ce(u)))if(t>1)J(u,t-1,n,r),i=r.length;else for(var h=0,f=u.length;h<f;)r[i++]=u[h++];else n||(r[i++]=u)}return r}const Ks=A(function(e,t){t=J(t,!1,!1);var n=t.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=tr(e[r],e)}return e});function Qs(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return U(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n}const er=A(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),Js=rt(er,d,1);function Xs(e,t,n){var r,i,s,o,u=0;n||(n={});var h=function(){u=n.leading===!1?0:ft(),r=null,o=e.apply(i,s),r||(i=s=null)},f=function(){var p=ft();!u&&n.leading===!1&&(u=p);var I=t-(p-u);return i=this,s=arguments,I<=0||I>t?(r&&(clearTimeout(r),r=null),u=p,o=e.apply(i,s),r||(i=s=null)):!r&&n.trailing!==!1&&(r=setTimeout(h,I)),o};return f.cancel=function(){clearTimeout(r),u=0,r=i=s=null},f}function Ys(e,t,n){var r,i,s,o,u,h=function(){var p=ft()-i;t>p?r=setTimeout(h,t-p):(r=null,n||(o=e.apply(u,s)),r||(s=u=null))},f=A(function(p){return u=this,s=p,i=ft(),r||(r=setTimeout(h,t),n&&(o=e.apply(u,s))),o});return f.cancel=function(){clearTimeout(r),r=s=u=null},f}function Zs(e,t){return rt(t,e)}function Te(e){return function(){return!e.apply(this,arguments)}}function Ws(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}function js(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function nr(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}const ta=rt(nr,2);function rr(e,t,n){t=_(t,n);for(var r=v(e),i,s=0,o=r.length;s<o;s++)if(i=r[s],t(e[i],i,e))return i}function ir(e){return function(t,n,r){n=_(n,r);for(var i=E(t),s=e>0?0:i-1;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}const j=ir(1),sr=ir(-1);function ar(e,t,n,r){n=_(n,r,1);for(var i=n(t),s=0,o=E(e);s<o;){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s}function or(e,t,n){return function(r,i,s){var o=0,u=E(r);if(typeof s=="number")e>0?o=s>=0?s:Math.max(s+u,o):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(pt.call(r,o,u),Mn),s>=0?s+o:-1;for(s=e>0?o:u-1;s>=0&&s<u;s+=e)if(r[s]===i)return s;return-1}}const ur=or(1,j,ar),ea=or(-1,sr);function Rt(e,t,n){var r=x(e)?j:rr,i=r(e,t,n);if(i!==void 0&&i!==-1)return e[i]}function na(e,t){return Rt(e,ct(t))}function F(e,t,n){t=It(t,n);var r,i;if(x(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=v(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e}function H(e,t,n){t=_(t,n);for(var r=!x(e)&&v(e),i=(r||e).length,s=Array(i),o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s}function lr(e){var t=function(n,r,i,s){var o=!x(n)&&v(n),u=(o||n).length,h=e>0?0:u-1;for(s||(i=n[o?o[h]:h],h+=e);h>=0&&h<u;h+=e){var f=o?o[h]:h;i=r(i,n[f],f,n)}return i};return function(n,r,i,s){var o=arguments.length>=3;return t(n,It(r,s,4),i,o)}}const Zt=lr(1),In=lr(-1);function tt(e,t,n){var r=[];return t=_(t,n),F(e,function(i,s,o){t(i,s,o)&&r.push(i)}),r}function ra(e,t,n){return tt(e,Te(_(t)),n)}function vn(e,t,n){t=_(t,n);for(var r=!x(e)&&v(e),i=(r||e).length,s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0}function Tn(e,t,n){t=_(t,n);for(var r=!x(e)&&v(e),i=(r||e).length,s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1}function L(e,t,n,r){return x(e)||(e=nt(e)),(typeof n!="number"||r)&&(n=0),ur(e,t,n)>=0}const ia=A(function(e,t,n){var r,i;return S(t)?i=t:(t=mt(t),r=t.slice(0,-1),t=t[t.length-1]),H(e,function(s){var o=i;if(!o){if(r&&r.length&&(s=de(s,r)),s==null)return;o=s[t]}return o==null?o:o.apply(s,n)})});function ke(e,t){return H(e,Ie(t))}function sa(e,t){return tt(e,ct(t))}function cr(e,t,n){var r=-1/0,i=-1/0,s,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:nt(e);for(var u=0,h=e.length;u<h;u++)s=e[u],s!=null&&s>r&&(r=s)}else t=_(t,n),F(e,function(f,p,I){o=t(f,p,I),(o>i||o===-1/0&&r===-1/0)&&(r=f,i=o)});return r}function aa(e,t,n){var r=1/0,i=1/0,s,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:nt(e);for(var u=0,h=e.length;u<h;u++)s=e[u],s!=null&&s<r&&(r=s)}else t=_(t,n),F(e,function(f,p,I){o=t(f,p,I),(o<i||o===1/0&&r===1/0)&&(r=f,i=o)});return r}var oa=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function fr(e){return e?Q(e)?pt.call(e):ue(e)?e.match(oa):x(e)?H(e,me):nt(e):[]}function hr(e,t,n){if(t==null||n)return x(e)||(e=nt(e)),e[ne(e.length-1)];var r=fr(e),i=E(r);t=Math.max(Math.min(t,i),0);for(var s=i-1,o=0;o<t;o++){var u=ne(o,s),h=r[o];r[o]=r[u],r[u]=h}return r.slice(0,t)}function ua(e){return hr(e,1/0)}function la(e,t,n){var r=0;return t=_(t,n),ke(H(e,function(i,s,o){return{value:i,index:r++,criteria:t(i,s,o)}}).sort(function(i,s){var o=i.criteria,u=s.criteria;if(o!==u){if(o>u||o===void 0)return 1;if(o<u||u===void 0)return-1}return i.index-s.index}),"value")}function bt(e,t){return function(n,r,i){var s=t?[[],[]]:{};return r=_(r,i),F(n,function(o,u){var h=r(o,u,n);e(s,o,h)}),s}}const ca=bt(function(e,t,n){U(e,n)?e[n].push(t):e[n]=[t]}),fa=bt(function(e,t,n){e[n]=t}),ha=bt(function(e,t,n){U(e,n)?e[n]++:e[n]=1}),ga=bt(function(e,t,n){e[n?0:1].push(t)},!0);function pa(e){return e==null?0:x(e)?e.length:v(e).length}function da(e,t,n){return t in n}const gr=A(function(e,t){var n={},r=t[0];if(e==null)return n;S(r)?(t.length>1&&(r=It(r,t[1])),t=dt(e)):(r=da,t=J(t,!1,!1),e=Object(e));for(var i=0,s=t.length;i<s;i++){var o=t[i],u=e[o];r(u,o,e)&&(n[o]=u)}return n}),ma=A(function(e,t){var n=t[0],r;return S(n)?(n=Te(n),t.length>1&&(r=t[1])):(t=H(J(t,!1,!1),String),n=function(i,s){return!L(t,s)}),gr(e,n,r)});function pr(e,t,n){return pt.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))}function Wt(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[0]:pr(e,e.length-t)}function Et(e,t,n){return pt.call(e,t==null||n?1:t)}function Ia(e,t,n){return e==null||e.length<1?t==null||n?void 0:[]:t==null||n?e[e.length-1]:Et(e,Math.max(0,e.length-t))}function va(e){return tt(e,Boolean)}function Ta(e,t){return J(e,t,!1)}const dr=A(function(e,t){return t=J(t,!0,!0),tt(e,function(n){return!L(t,n)})}),ka=A(function(e,t){return dr(e,t)});function re(e,t,n,r){Cn(t)||(r=n,n=t,t=!1),n!=null&&(n=_(n,r));for(var i=[],s=[],o=0,u=E(e);o<u;o++){var h=e[o],f=n?n(h,o,e):h;t&&!n?((!o||s!==f)&&i.push(h),s=f):n?L(s,f)||(s.push(f),i.push(h)):L(i,h)||i.push(h)}return i}const Pa=A(function(e){return re(J(e,!0,!0))});function wa(e){for(var t=[],n=arguments.length,r=0,i=E(e);r<i;r++){var s=e[r];if(!L(t,s)){var o;for(o=1;o<n&&L(arguments[o],s);o++);o===n&&t.push(s)}}return t}function ie(e){for(var t=e&&cr(e,E).length||0,n=Array(t),r=0;r<t;r++)n[r]=ke(e,r);return n}const Sa=A(ie);function ya(e,t){for(var n={},r=0,i=E(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}function Ca(e,t,n){t==null&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;s<r;s++,e+=n)i[s]=e;return i}function Aa(e,t){if(t==null||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(pt.call(e,r,r+=t));return n}function Pe(e,t){return e._chain?d(t).chain():t}function mr(e){return F(ee(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var r=[this._wrapped];return Yi.apply(r,arguments),Pe(this,n.apply(d,r))}}),d}F(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=Vt[e];d.prototype[e]=function(){var n=this._wrapped;return n!=null&&(t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0]),Pe(this,n)}});F(["concat","join","slice"],function(e){var t=Vt[e];d.prototype[e]=function(){var n=this._wrapped;return n!=null&&(n=t.apply(n,arguments)),Pe(this,n)}});const Ea=Object.freeze(Object.defineProperty({__proto__:null,VERSION:Pn,restArguments:A,isObject:K,isNull:rs,isUndefined:yn,isBoolean:Cn,isElement:is,isString:ue,isNumber:An,isDate:ss,isRegExp:as,isError:os,isSymbol:En,isArrayBuffer:_n,isDataView:_t,isArray:Q,isFunction:S,isArguments:ce,isFinite:fs,isNaN:Mn,isTypedArray:Bn,isEmpty:ms,isMatch:Ln,isEqual:Is,isMap:ks,isWeakMap:Ps,isSet:ws,isWeakSet:Ss,keys:v,allKeys:dt,values:nt,pairs:ys,invert:Gn,functions:ee,methods:ee,extend:zn,extendOwn:Nt,assign:Nt,defaults:Hn,create:As,clone:Es,tap:_s,get:Jn,has:xs,mapObject:Ns,identity:me,constant:Vn,noop:Yn,toPath:Qn,property:Ie,propertyOf:Rs,matcher:ct,matches:ct,times:Ms,random:ne,now:ft,escape:Vs,unescape:Os,templateSettings:Bs,template:Us,result:qs,uniqueId:zs,chain:Hs,iteratee:ve,partial:rt,bind:tr,bindAll:Ks,memoize:Qs,delay:er,defer:Js,throttle:Xs,debounce:Ys,wrap:Zs,negate:Te,compose:Ws,after:js,before:nr,once:ta,findKey:rr,findIndex:j,findLastIndex:sr,sortedIndex:ar,indexOf:ur,lastIndexOf:ea,find:Rt,detect:Rt,findWhere:na,each:F,forEach:F,map:H,collect:H,reduce:Zt,foldl:Zt,inject:Zt,reduceRight:In,foldr:In,filter:tt,select:tt,reject:ra,every:vn,all:vn,some:Tn,any:Tn,contains:L,includes:L,include:L,invoke:ia,pluck:ke,where:sa,max:cr,min:aa,shuffle:ua,sample:hr,sortBy:la,groupBy:ca,indexBy:fa,countBy:ha,partition:ga,toArray:fr,size:pa,pick:gr,omit:ma,first:Wt,head:Wt,take:Wt,initial:pr,last:Ia,rest:Et,tail:Et,drop:Et,compact:va,flatten:Ta,without:ka,uniq:re,unique:re,union:Pa,intersection:wa,difference:dr,unzip:ie,transpose:ie,zip:Sa,object:ya,range:Ca,chunk:Aa,mixin:mr,default:d},Symbol.toStringTag,{value:"Module"}));var b=mr(Ea);b._=b;let Ot=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class we{instanceIdInternal=we.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;songCacheInternal;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,n){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,n){return t[n]}hasAllParamsSet(){for(const t of v(this.params())){if(this.params()[t].optional)continue;const n=this.paramsResultInternal[t];if(n==null)return!1;const i=this.params()[t].widget.type;switch(i){case C.Input:case C.Pitch:case C.Slider:case C.TrackSelector:case C.Select:case C.Switch:case C.InputNumber:case C.FileSelector:break;case C.MultiTrackSelector:if(n.length===0)return!1;break;case C.TrackPitchSelector:if(n.track===void 0||n.track===null||n.pitch===void 0||n.pitch===null)return!1;break;case C.InstrumentSelector:if(n.program===void 0||n.program===null||n.isDrum===void 0||n.isDrum===null)return!1;break;case C.None:if(n==null)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${i}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of v(this.params())){const n=this.params()[t];this.paramsResultInternal[t]=n.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Ot(10)}}class _a{plugins=[];threwErrorInLastRun=!1;maxNumPluginsToKeep=50;originalSong;cloneSongFnInternal;addPlugin(t){this.plugins.push(t),this.maintainPluginListSize()}addPluginAt(t,n){this.plugins.splice(n,0,t),this.maintainPluginListSize()}removePlugin(t){this.plugins.splice(this.plugins.indexOf(t),1)}getPlugins(){return this.plugins}resetCache(){for(const t of this.plugins)delete t.songCacheInternal}setOriginalSong(t){this.originalSong=t}hasOriginalSong(){return!!this.originalSong}async run(t=0){if(!this.originalSong)return this.threwErrorInLastRun=!0,null;t=Math.max(0,t),this.threwErrorInLastRun=!1;let n;const r=this.getIndexOfLatestPluginWithCacheBeforeIndex(t);r>=0?n=await this.cloneSong(this.plugins[r].songCacheInternal):n=await this.cloneSong(this.originalSong);for(let i=t;i<this.plugins.length;i+=1)delete this.plugins[i].songCacheInternal;for(let i=0;i<=r;i+=1){const s=this.plugins[i];s.isRollbackable=!0}for(let i=r>=0?r+1:0;i<this.plugins.length;i+=1){const s=this.plugins[i];if(!s.enabledInternal||!s.hasAllParamsSet())return n;n.setPluginContextInternal(s);try{await s.run(n,s.getParamsInternal()),n.clearPluginContextInternal()}catch{this.threwErrorInLastRun=!0,n.clearPluginContextInternal();const u=this.getIndexOfLatestPluginWithCacheBeforeIndex(i);return u>=0?await this.cloneSong(this.plugins[u].songCacheInternal):await this.cloneSong(this.originalSong)}s.songCacheInternal=await this.cloneSong(n),s.isRollbackable=!0}return n}async cloneSong(t){if(!this.cloneSongFnInternal)throw new Error("Pipeline is not provided with a clone song function.");return this.cloneSongFnInternal(t)}reset(){for(const t of this.plugins)t.resetInternal()}clear(){this.plugins.splice(0,this.plugins.length),this.originalSong=void 0}movePluginUp(t){const n=this.getPluginIndexByPluginInstanceId(t.instanceId);n<=0||this.plugins.splice(n-1,0,this.plugins.splice(n,1)[0])}movePluginDown(t){const n=this.getPluginIndexByPluginInstanceId(t.instanceId);n<0||n>=this.plugins.length-1||this.plugins.splice(n,0,this.plugins.splice(n+1,1)[0])}isPluginFunctioning(t){return!!t.songCacheInternal}getPluginIndexByPluginInstanceId(t){return j(this.plugins,n=>n.instanceId===t)}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getLastFunctioningPlugin(){for(let t=this.plugins.length-1;t>=0;t-=1)if(this.isPluginFunctioning(this.plugins[t]))return this.plugins[t];return null}getPluginCache(t){return t.songCacheInternal}setMaxNumPluginsToKeep(t){this.maxNumPluginsToKeep=t,this.maintainPluginListSize()}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let n=t-1;n>=0;n-=1)if(this.getPluginCache(this.plugins[n]))return n;return-1}maintainPluginListSize(){for(;this.plugins.length>this.maxNumPluginsToKeep&&this.plugins.length>0;)this.plugins.shift()}}var At=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xa(e,t,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,u=e[o],h=n!==void 0?n(u,t):u-t;h>=0?(s=o,i=o-1):r=o+1}return s}function Na(e,t,n,r,i){for(var s=i+1;r<=i;){var o=r+i>>>1,u=e[o],h=n!==void 0?n(u,t):u-t;h>0?(s=o,i=o-1):r=o+1}return s}function Ra(e,t,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,u=e[o],h=n!==void 0?n(u,t):u-t;h<0?(s=o,r=o+1):i=o-1}return s}function Ma(e,t,n,r,i){for(var s=r-1;r<=i;){var o=r+i>>>1,u=e[o],h=n!==void 0?n(u,t):u-t;h<=0?(s=o,r=o+1):i=o-1}return s}function Va(e,t,n,r,i){for(;r<=i;){var s=r+i>>>1,o=e[s],u=n!==void 0?n(o,t):o-t;if(u===0)return s;u<=0?r=s+1:i=s-1}return-1}function ot(e,t,n,r,i,s){return typeof n=="function"?s(e,t,n,r===void 0?0:r|0,i===void 0?e.length-1:i|0):s(e,t,void 0,n===void 0?0:n|0,r===void 0?e.length-1:r|0)}var k={ge:function(e,t,n,r,i){return ot(e,t,n,r,i,xa)},gt:function(e,t,n,r,i){return ot(e,t,n,r,i,Na)},lt:function(e,t,n,r,i){return ot(e,t,n,r,i,Ra)},le:function(e,t,n,r,i){return ot(e,t,n,r,i,Ma)},eq:function(e,t,n,r,i){return ot(e,t,n,r,i,Va)}},se={exports:{}};(function(e,t){var n=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",u="[object Boolean]",h="[object Date]",f="[object Error]",p="[object Function]",I="[object GeneratorFunction]",R="[object Map]",it="[object Number]",Dt="[object Object]",Se="[object Promise]",ye="[object RegExp]",vt="[object Set]",Ce="[object String]",Ae="[object Symbol]",Lt="[object WeakMap]",Ee="[object ArrayBuffer]",Tt="[object DataView]",_e="[object Float32Array]",xe="[object Float64Array]",Ne="[object Int8Array]",Re="[object Int16Array]",Me="[object Int32Array]",Ve="[object Uint8Array]",be="[object Uint8ClampedArray]",Oe="[object Uint16Array]",Be="[object Uint32Array]",Ar=/[\\^$.*+?()[\]{}|]/g,Er=/\w*$/,_r=/^\[object .+?Constructor\]$/,xr=/^(?:0|[1-9]\d*)$/,m={};m[s]=m[o]=m[Ee]=m[Tt]=m[u]=m[h]=m[_e]=m[xe]=m[Ne]=m[Re]=m[Me]=m[R]=m[it]=m[Dt]=m[ye]=m[vt]=m[Ce]=m[Ae]=m[Ve]=m[be]=m[Oe]=m[Be]=!0,m[f]=m[p]=m[Lt]=!1;var Nr=typeof At=="object"&&At&&At.Object===Object&&At,Rr=typeof self=="object"&&self&&self.Object===Object&&self,O=Nr||Rr||Function("return this")(),De=t&&!t.nodeType&&t,Le=De&&!0&&e&&!e.nodeType&&e,Mr=Le&&Le.exports===De;function Vr(a,l){return a.set(l[0],l[1]),a}function br(a,l){return a.add(l),a}function Or(a,l){for(var c=-1,g=a?a.length:0;++c<g&&l(a[c],c,a)!==!1;);return a}function Br(a,l){for(var c=-1,g=l.length,T=a.length;++c<g;)a[T+c]=l[c];return a}function Fe(a,l,c,g){var T=-1,w=a?a.length:0;for(g&&w&&(c=a[++T]);++T<w;)c=l(c,a[T],T,a);return c}function Dr(a,l){for(var c=-1,g=Array(a);++c<a;)g[c]=l(c);return g}function Lr(a,l){return a?.[l]}function $e(a){var l=!1;if(a!=null&&typeof a.toString!="function")try{l=!!(a+"")}catch{}return l}function Ue(a){var l=-1,c=Array(a.size);return a.forEach(function(g,T){c[++l]=[T,g]}),c}function Ft(a,l){return function(c){return a(l(c))}}function qe(a){var l=-1,c=Array(a.size);return a.forEach(function(g){c[++l]=g}),c}var Fr=Array.prototype,$r=Function.prototype,kt=Object.prototype,$t=O["__core-js_shared__"],Ge=function(){var a=/[^.]+$/.exec($t&&$t.keys&&$t.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),ze=$r.toString,$=kt.hasOwnProperty,Pt=kt.toString,Ur=RegExp("^"+ze.call($).replace(Ar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),He=Mr?O.Buffer:void 0,Ke=O.Symbol,Qe=O.Uint8Array,qr=Ft(Object.getPrototypeOf,Object),Gr=Object.create,zr=kt.propertyIsEnumerable,Hr=Fr.splice,Je=Object.getOwnPropertySymbols,Kr=He?He.isBuffer:void 0,Qr=Ft(Object.keys,Object),Ut=Z(O,"DataView"),st=Z(O,"Map"),qt=Z(O,"Promise"),Gt=Z(O,"Set"),zt=Z(O,"WeakMap"),at=Z(Object,"create"),Jr=z(Ut),Xr=z(st),Yr=z(qt),Zr=z(Gt),Wr=z(zt),Xe=Ke?Ke.prototype:void 0,Ye=Xe?Xe.valueOf:void 0;function q(a){var l=-1,c=a?a.length:0;for(this.clear();++l<c;){var g=a[l];this.set(g[0],g[1])}}function jr(){this.__data__=at?at(null):{}}function ti(a){return this.has(a)&&delete this.__data__[a]}function ei(a){var l=this.__data__;if(at){var c=l[a];return c===r?void 0:c}return $.call(l,a)?l[a]:void 0}function ni(a){var l=this.__data__;return at?l[a]!==void 0:$.call(l,a)}function ri(a,l){var c=this.__data__;return c[a]=at&&l===void 0?r:l,this}q.prototype.clear=jr,q.prototype.delete=ti,q.prototype.get=ei,q.prototype.has=ni,q.prototype.set=ri;function B(a){var l=-1,c=a?a.length:0;for(this.clear();++l<c;){var g=a[l];this.set(g[0],g[1])}}function ii(){this.__data__=[]}function si(a){var l=this.__data__,c=wt(l,a);if(c<0)return!1;var g=l.length-1;return c==g?l.pop():Hr.call(l,c,1),!0}function ai(a){var l=this.__data__,c=wt(l,a);return c<0?void 0:l[c][1]}function oi(a){return wt(this.__data__,a)>-1}function ui(a,l){var c=this.__data__,g=wt(c,a);return g<0?c.push([a,l]):c[g][1]=l,this}B.prototype.clear=ii,B.prototype.delete=si,B.prototype.get=ai,B.prototype.has=oi,B.prototype.set=ui;function X(a){var l=-1,c=a?a.length:0;for(this.clear();++l<c;){var g=a[l];this.set(g[0],g[1])}}function li(){this.__data__={hash:new q,map:new(st||B),string:new q}}function ci(a){return St(this,a).delete(a)}function fi(a){return St(this,a).get(a)}function hi(a){return St(this,a).has(a)}function gi(a,l){return St(this,a).set(a,l),this}X.prototype.clear=li,X.prototype.delete=ci,X.prototype.get=fi,X.prototype.has=hi,X.prototype.set=gi;function Y(a){this.__data__=new B(a)}function pi(){this.__data__=new B}function di(a){return this.__data__.delete(a)}function mi(a){return this.__data__.get(a)}function Ii(a){return this.__data__.has(a)}function vi(a,l){var c=this.__data__;if(c instanceof B){var g=c.__data__;if(!st||g.length<n-1)return g.push([a,l]),this;c=this.__data__=new X(g)}return c.set(a,l),this}Y.prototype.clear=pi,Y.prototype.delete=di,Y.prototype.get=mi,Y.prototype.has=Ii,Y.prototype.set=vi;function Ti(a,l){var c=Qt(a)||Gi(a)?Dr(a.length,String):[],g=c.length,T=!!g;for(var w in a)(l||$.call(a,w))&&!(T&&(w=="length"||Fi(w,g)))&&c.push(w);return c}function Ze(a,l,c){var g=a[l];(!($.call(a,l)&&en(g,c))||c===void 0&&!(l in a))&&(a[l]=c)}function wt(a,l){for(var c=a.length;c--;)if(en(a[c][0],l))return c;return-1}function ki(a,l){return a&&We(l,Jt(l),a)}function Ht(a,l,c,g,T,w,N){var y;if(g&&(y=w?g(a,T,w,N):g(a)),y!==void 0)return y;if(!yt(a))return a;var sn=Qt(a);if(sn){if(y=Bi(a),!l)return Vi(a,y)}else{var W=G(a),an=W==p||W==I;if(Hi(a))return Ai(a,l);if(W==Dt||W==s||an&&!w){if($e(a))return w?a:{};if(y=Di(an?{}:a),!l)return bi(a,ki(y,a))}else{if(!m[W])return w?a:{};y=Li(a,W,Ht,l)}}N||(N=new Y);var on=N.get(a);if(on)return on;if(N.set(a,y),!sn)var un=c?Oi(a):Jt(a);return Or(un||a,function(Xt,Ct){un&&(Ct=Xt,Xt=a[Ct]),Ze(y,Ct,Ht(Xt,l,c,g,Ct,a,N))}),y}function Pi(a){return yt(a)?Gr(a):{}}function wi(a,l,c){var g=l(a);return Qt(a)?g:Br(g,c(a))}function Si(a){return Pt.call(a)}function yi(a){if(!yt(a)||Ui(a))return!1;var l=rn(a)||$e(a)?Ur:_r;return l.test(z(a))}function Ci(a){if(!tn(a))return Qr(a);var l=[];for(var c in Object(a))$.call(a,c)&&c!="constructor"&&l.push(c);return l}function Ai(a,l){if(l)return a.slice();var c=new a.constructor(a.length);return a.copy(c),c}function Kt(a){var l=new a.constructor(a.byteLength);return new Qe(l).set(new Qe(a)),l}function Ei(a,l){var c=l?Kt(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)}function _i(a,l,c){var g=l?c(Ue(a),!0):Ue(a);return Fe(g,Vr,new a.constructor)}function xi(a){var l=new a.constructor(a.source,Er.exec(a));return l.lastIndex=a.lastIndex,l}function Ni(a,l,c){var g=l?c(qe(a),!0):qe(a);return Fe(g,br,new a.constructor)}function Ri(a){return Ye?Object(Ye.call(a)):{}}function Mi(a,l){var c=l?Kt(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)}function Vi(a,l){var c=-1,g=a.length;for(l||(l=Array(g));++c<g;)l[c]=a[c];return l}function We(a,l,c,g){c||(c={});for(var T=-1,w=l.length;++T<w;){var N=l[T],y=g?g(c[N],a[N],N,c,a):void 0;Ze(c,N,y===void 0?a[N]:y)}return c}function bi(a,l){return We(a,je(a),l)}function Oi(a){return wi(a,Jt,je)}function St(a,l){var c=a.__data__;return $i(l)?c[typeof l=="string"?"string":"hash"]:c.map}function Z(a,l){var c=Lr(a,l);return yi(c)?c:void 0}var je=Je?Ft(Je,Object):Ji,G=Si;(Ut&&G(new Ut(new ArrayBuffer(1)))!=Tt||st&&G(new st)!=R||qt&&G(qt.resolve())!=Se||Gt&&G(new Gt)!=vt||zt&&G(new zt)!=Lt)&&(G=function(a){var l=Pt.call(a),c=l==Dt?a.constructor:void 0,g=c?z(c):void 0;if(g)switch(g){case Jr:return Tt;case Xr:return R;case Yr:return Se;case Zr:return vt;case Wr:return Lt}return l});function Bi(a){var l=a.length,c=a.constructor(l);return l&&typeof a[0]=="string"&&$.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function Di(a){return typeof a.constructor=="function"&&!tn(a)?Pi(qr(a)):{}}function Li(a,l,c,g){var T=a.constructor;switch(l){case Ee:return Kt(a);case u:case h:return new T(+a);case Tt:return Ei(a,g);case _e:case xe:case Ne:case Re:case Me:case Ve:case be:case Oe:case Be:return Mi(a,g);case R:return _i(a,g,c);case it:case Ce:return new T(a);case ye:return xi(a);case vt:return Ni(a,g,c);case Ae:return Ri(a)}}function Fi(a,l){return l=l??i,!!l&&(typeof a=="number"||xr.test(a))&&a>-1&&a%1==0&&a<l}function $i(a){var l=typeof a;return l=="string"||l=="number"||l=="symbol"||l=="boolean"?a!=="__proto__":a===null}function Ui(a){return!!Ge&&Ge in a}function tn(a){var l=a&&a.constructor,c=typeof l=="function"&&l.prototype||kt;return a===c}function z(a){if(a!=null){try{return ze.call(a)}catch{}try{return a+""}catch{}}return""}function qi(a){return Ht(a,!0,!0)}function en(a,l){return a===l||a!==a&&l!==l}function Gi(a){return zi(a)&&$.call(a,"callee")&&(!zr.call(a,"callee")||Pt.call(a)==s)}var Qt=Array.isArray;function nn(a){return a!=null&&Ki(a.length)&&!rn(a)}function zi(a){return Qi(a)&&nn(a)}var Hi=Kr||Xi;function rn(a){var l=yt(a)?Pt.call(a):"";return l==p||l==I}function Ki(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=i}function yt(a){var l=typeof a;return!!a&&(l=="object"||l=="function")}function Qi(a){return!!a&&typeof a=="object"}function Jt(a){return nn(a)?Ti(a):Ci(a)}function Ji(){return[]}function Xi(){return!1}e.exports=qi})(se,se.exports);const kn=se.exports;class ae{ticks;bpm;time;constructor({ticks:t,bpm:n,time:r}){this.ticks=t,this.bpm=n,this.time=r}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class Ir{ticks;numerator;denominator;constructor({ticks:t,numerator:n,denominator:r}){this.ticks=t,this.numerator=n,this.denominator=r}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}function ba(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e%12;return t[n]}function Oa(e){const t=Math.floor(e/12)-1;return ba(e)+t.toString()}const Ba=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,Da={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function La(e){const t=Ba.exec(e);if(!t)return-1;const n=t[1],r=t[2];return Da[n.toLowerCase()]+(parseInt(r,10)+1)*12}function vr(e,t,n,r){return`${e} // ${t} // ${n} // ${r}`}function Tr(e,t,n){return`${e} // ${t} // ${n}`}function Fa(e){const t=ht(e);return Tr(t.manufacturerName,t.pluginFormatName,t.name)}function ht(e){const t=e.split(" // ");if(t.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:t[2],manufacturerName:t[0],pluginFormatName:t[1],pluginVersion:t[3]}}function kr(e,t){return e===t}function Pr(e,t){const n=ht(e),r=ht(t);if(b.keys(n).length!==b.keys(r).length)return!1;for(const i of b.keys(n))if(i!=="pluginVersion"&&n[i]!==r[i])return!1;return!0}class $a{tempoInfos=[];currentTempoIndex=0;ticksPerSecondAtTempoTick={};constructor(t){for(const n of t.getTempoChanges())this.tempoInfos.push({ticks:n.getTicks(),time:n.getTime()}),this.ticksPerSecondAtTempoTick[n.getTicks()]=n.getBpm()*t.getResolution()/60}tickToSeconds(t){let n=this.tempoInfos[this.currentTempoIndex];for(;this.tempoInfos[this.currentTempoIndex+1]&&this.tempoInfos[this.currentTempoIndex+1].ticks<=t;)this.currentTempoIndex+=1,n=this.tempoInfos[this.currentTempoIndex];for(;n.ticks>t&&this.currentTempoIndex>0;)this.currentTempoIndex-=1,n=this.tempoInfos[this.currentTempoIndex];n.ticks>t;const r=t-n.ticks,i=this.ticksPerSecondAtTempoTick[n.ticks];return n.time+r/i}}function wr(e){return e>-100?Math.exp((e-6)*(1/20)):0}function Ua(e){return e<=0?-100:20*Math.log10(e)}function qa(e){return e>0?20*Math.log(e)+6:-100}function Ga(e){return e>0?Math.pow(10,(20*Math.log(e)+6)*(1/20)):0}function za(e){return e>0?Math.exp((20*Math.log10(e)-6)*(1/20)):0}class Bt{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,n,r,i){this.name=t,this.manufacturerName=n,this.pluginFormatName=r,this.pluginVersion=i,this.localInstanceIdInternal=Bt.generateAudioPluginInstanceIdInternal()}getTuneflowId(){return vr(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const n=t.createAudioPlugin(this.getTuneflowId());return n.setIsEnabled(this.isEnabled),n}matchesTfId(t){return kr(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return Pr(t,this.getTuneflowId())}getInstanceId(){return this.localInstanceIdInternal}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}setBase64States(t){this.base64StatesInternal=t}getBase64States(){return this.base64StatesInternal}static generateAudioPluginInstanceIdInternal(){return Ot(10)}}class D{pitch;velocity;startTick;endTick;idInternal;clipInternal;constructor({pitch:t,velocity:n,startTick:r,endTick:i,id:s,clip:o}){this.pitch=t,this.velocity=n,this.startTick=r,this.endTick=i,this.idInternal=s,this.clipInternal=o}getPitch(){return this.pitch}setPitch(t){if(!D.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=Math.max(Math.min(t,127),0)}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}deleteFromParent(){!this.clipInternal||this.clipInternal.deleteNote(this)}moveNote(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick=Math.max(0,this.startTick+t),this.endTick=this.endTick+t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeft(t){if(t===0)return;const n=this.clipInternal;n&&n.deleteNote(this),this.startTick+=t,!!this.isRangeValid()&&n&&n.orderedInsertNote(n.getRawNotes(),this)}adjustLeftTo(t){this.adjustLeft(t-this.startTick)}adjustRight(t){this.endTick+=t,this.isRangeValid()||this.deleteFromParent()}adjustRightTo(t){this.adjustRight(t-this.endTick)}isRangeValid(){return D.isNoteRangeValid(this.startTick,this.endTick)}static isValidPitch(t){return t>=0&&t<=127&&Number.isInteger(t)}static isNoteRangeValid(t,n){return n>=0&&t<=n&&Number.isInteger(t)&&Number.isInteger(n)}static isNoteVelocityValid(t){return t>=0&&t<=127&&Number.isInteger(t)}getClip(){return this.clipInternal}adjustPitch(t){this.pitch=this.pitch+t,D.isValidPitch(this.pitch)||this.deleteFromParent()}getId(){return this.idInternal}}class V{track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;constructor({track:t=void 0,id:n=V.generateClipIdInternal(),clipStartTick:r=0,clipEndTick:i=0}){this.track=t,this.id=n,this.notes=[],this.clipStartTick=r,this.clipEndTick=i}getId(){return this.id}getNotes(){return V.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:n,startTick:r,endTick:i,updateClipRange:s=!0,resolveClipConflict:o=!0}){if(!D.isValidPitch(t)||!D.isNoteRangeValid(r,i)||!D.isNoteVelocityValid(n))return null;const u=new D({pitch:t,velocity:n,startTick:r,endTick:i,id:this.getNextNoteIdInternal()});return r<this.clipStartTick&&s&&this.adjustClipLeft(r,o),i>this.clipEndTick&&s&&this.adjustClipRight(i,o),this.orderedInsertNote(this.notes,u),u}getNoteIndexInternal(t){const n=k.lt(this.notes,t,(r,i)=>r.getStartTick()-i.getStartTick());for(let r=Math.max(0,n);r<this.notes.length;r+=1){const i=this.notes[r];if(i&&i===t)return r;if(i&&i.getStartTick()>t.getStartTick())break}return-1}deleteNote(t){const n=this.getNoteIndexInternal(t);n>=0&&this.deleteNoteAt(n)}deleteNoteAt(t){const n=this.notes[t];n&&(n.clipInternal=null,this.notes.splice(t,1))}orderedInsertNote(t,n){if(n.getClip()===this)return;const r=k.ge(t,n,(i,s)=>i.getStartTick()-s.getStartTick());r<0?t.push(n):t.splice(r,0,n),n.clipInternal=this}adjustClipLeft(t,n=!0){t=Math.max(0,t),t>this.clipEndTick?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,n=!0){t<this.clipStartTick||t<0?this.deleteFromParent(!0):(n&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t,n){const r=Math.max(0,this.clipStartTick+t),i=this.clipEndTick+t;if(i<0){this.deleteFromParent(!0);return}if(this.track&&this.track.resolveClipConflictInternal(this.getId(),r,i),this.track){const u=this.track.getClipIndex(this);this.track.deleteClipAt(u,!1)}const s=this.clipStartTick,o=this.clipEndTick;this.clipStartTick=r,this.clipEndTick=i;for(const u of this.notes)u.setStartTick(u.getStartTick()+t),u.setEndTick(u.getEndTick()+t);this.track&&(this.track.orderedInsertClipInternal(this),n&&this.track.getAutomation().moveAllPointsWithinRange(s,o,t,0))}moveClipTo(t,n){const r=t-this.getClipStartTick();this.moveClip(r,n)}deleteFromParent(t){this.track&&(this.track.deleteClip(this,t),this.track=void 0)}getNotesByIds(t){const n=new Set(t),r=[];for(const i of this.notes)n.has(i.getId())&&r.push(i);return r}static getNotesInRange(t,n,r){return V.getNotesInRangeImpl(t,n,r,i=>({getStartTick:()=>i}),i=>i.getStartTick(),i=>i.getEndTick())}static getNotesInRangeImpl(t,n,r,i,s,o){let u=Math.max(0,k.lt(t,i(n),(f,p)=>s(f)-s(p)));for(;t[u]&&!V.isNoteInClip(s(t[u]),o(t[u]),n,r);)u+=1;if(u>=t.length)return[];let h=Math.min(t.length-1,k.gt(t,i(r),(f,p)=>s(f)-s(p)));for(;t[h]&&!V.isNoteInClip(s(t[h]),o(t[h]),n,r);)h-=1;return h<0?[]:h<u?[]:t.slice(u,h+1)}static isNoteInClip(t,n,r,i){return(t>=r||r===0&&t<=0)&&t<=i&&n>=t}static getNotePlayableRange(t,n,r,i){if(!V.isNoteInClip(t,n,r,i))return null;const s=Math.max(t,r),o=Math.min(n,i);return s>o?null:{startTick:s,endTick:o}}trimConflictPartInternal(t,n){const r=Math.max(t,this.getClipStartTick()),i=Math.min(n,this.getClipEndTick());if(!(r>i)&&!(r>this.getClipEndTick()||i<this.getClipStartTick())){if(i>=this.getClipEndTick()&&r<=this.getClipStartTick()){this.deleteFromParent(!0);return}if(i<this.getClipEndTick()&&r>this.getClipStartTick()){const s=i+1,o=this.getClipEndTick();if(this.adjustClipRight(r-1,!1),this.track){const u=this.track.createClip({clipStartTick:s,clipEndTick:o}),h=V.getNotesInRange(this.notes,s,o);for(const f of h)u.createNote({pitch:f.getPitch(),velocity:f.getVelocity(),startTick:f.getStartTick(),endTick:f.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return}r>this.getClipStartTick()&&r<=this.getClipEndTick()?this.adjustClipRight(r-1,!1):i<this.getClipEndTick()&&i>=this.getClipStartTick()&&this.adjustClipLeft(i+1,!1)}}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return Ot(10)}}var Sr=(e=>(e[e.UNDEFINED=0]="UNDEFINED",e[e.VOLUME=1]="VOLUME",e[e.PAN=2]="PAN",e[e.AUDIO_PLUGIN=3]="AUDIO_PLUGIN",e))(Sr||{});class M{type;pluginInstanceId;paramId;constructor(t,n,r){this.type=t,this.pluginInstanceId=n,this.paramId=r}getType(){return this.type}setType(t){this.type=t}getPluginInstanceId(){return this.pluginInstanceId}setPluginInstanceId(t){this.pluginInstanceId=t}getParamId(){return this.paramId}setParamId(t){this.paramId=t}equals(t){return M.areAutomationTargetsEqual(this.getType(),t.getType(),this.getPluginInstanceId(),t.getPluginInstanceId(),this.getParamId(),t.getParamId())}clone(){return new M(this.type,this.pluginInstanceId,this.paramId)}toTfAutomationTargetId(){return M.encodeAutomationTarget(this.type,this.pluginInstanceId,this.paramId)}static fromTfAutomationTargetId(t){return M.decodeAutomationTarget(t)}static encodeAutomationTarget(t,n,r){return t===3?`${t}^^${n}^^${r}`:`${t}`}static decodeAutomationTarget(t){const n=t.split("^^");if(n.length===0)throw new Error(`Invalid automation target id: ${t}`);const r=Number(n[0]);return n.length>2?new M(r,n[1],n[2]):new M(r)}static areAutomationTargetsEqual(t,n,r,i,s,o){return M.encodeAutomationTarget(t,r,s)===M.encodeAutomationTarget(n,i,o)}}class et{points=[];disabled=!1;nextPointIdInternal=1;getDisabled(){return this.disabled}setDisabled(t){this.disabled=t}getPoints(){return this.points}getPointsInRange(t,n){return et.getPointsInRangeImpl(this.points,t,n)}static getPointsInRangeImpl(t,n,r){const i=k.ge(t,{tick:n},(o,u)=>o.tick-u.tick),s=[];for(let o=i;o<t.length;o+=1){const u=t[o];if(u.tick>r)break;s.push(u)}return s}addPoint(t,n,r=!1){const i={tick:t,value:Math.max(0,Math.min(1,n)),id:this.getNextPointIdInternal()};return et.orderedInsertPointInternal(this.points,i,r),i}removePoints(t){const n=new Set(t);for(let r=this.points.length-1;r>=0;r-=1){const i=this.points[r];n.has(i.id)&&this.points.splice(r,1)}}removePointsInRange(t,n){const r=k.ge(this.points,{tick:t},(s,o)=>s.tick-o.tick);if(r>=this.points.length)return;let i=r;for(;i+1<this.points.length&&this.points[i+1].tick<=n;)i+=1;this.points.splice(r,i-r+1)}movePointsInRange(t,n,r,i,s=!0){const o=this.getPointsInRange(t,n);this.movePoints(o.map(u=>u.id),r,i,s)}movePoints(t,n,r,i=!0){if(t.length===0)return;const s=new Set(t);let o,u;const h=[];for(let f=0;f<this.points.length;f+=1){const p=this.points[f];!s.has(p.id)||(h.push(p),o===void 0&&(o=f),u=f)}if(!(o===void 0||u===void 0)){if(i){if(n<0){const f=Math.max(0,this.points[o].tick+n),p=k.gt(this.points,{tick:f},(I,R)=>I.tick-R.tick);p<o&&this.points.splice(p,o-p)}else if(n>0){const f=this.points[u].tick+n,p=k.lt(this.points,{tick:f},(I,R)=>I.tick-R.tick);p>u&&this.points.splice(u+1,p-u)}}for(const f of h)f.tick=Math.max(0,f.tick+n),f.value=Math.max(0,Math.min(1,f.value+r));Math.abs(n)>0&&this.points.sort((f,p)=>f.tick-p.tick)}}getNextPointIdInternal(){const t=this.nextPointIdInternal;return this.nextPointIdInternal>=2147483647?this.nextPointIdInternal=1:this.nextPointIdInternal+=1,t}static orderedInsertPointInternal(t,n,r=!1){const i=k.ge(t,n,(s,o)=>s.tick-o.tick);for(;r&&t[i]&&t[i].tick===n.tick;)t.splice(i,1);t.splice(i,0,n)}}class yr{targets=[];targetValues={};getAutomationTargets(){return this.targets}getAutomationTargetValues(){return this.targetValues}getOrCreateAutomationValueById(t){return this.targetValues[t]||(this.targetValues[t]=new et),this.targetValues[t]}getAutomationValueById(t){return this.targetValues[t]}getAutomationValueByTarget(t){const n=t.toTfAutomationTargetId();return this.getAutomationValueById(n)}addAutomation(t,n=0){b.isNumber(n)||(n=0),this.targets.splice(n,0,t);const r=t.toTfAutomationTargetId();this.getAutomationValueById(r)||(this.targetValues[r]=new et)}removeAutomation(t){for(let r=this.targets.length-1;r>=0;r-=1)this.targets[r].equals(t)&&this.targets.splice(r,1);const n=t.toTfAutomationTargetId();delete this.targetValues[n]}removeAutomationOfPlugin(t){for(let n=this.targets.length-1;n>=0;n-=1){const r=this.targets[n];r.getPluginInstanceId()===t&&this.removeAutomation(r)}for(const n of b.keys(this.targetValues)){const r=M.decodeAutomationTarget(n);r.getPluginInstanceId()===t&&this.removeAutomation(r)}}removeAllPointsWithinRange(t,n){for(const r of b.keys(this.targetValues))this.targetValues[r].removePointsInRange(t,n)}moveAllPointsWithinRange(t,n,r,i){for(const s of b.keys(this.targetValues))this.targetValues[s].movePointsInRange(t,n,r,i,!1)}}class gt{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;pan;samplerPlugin;audioPlugins=[];song;automation;constructor({song:t,uuid:n=gt.generateTrackIdInternal(),clips:r=[],instrument:i=new ut({program:0,isDrum:!1}),suggestedInstruments:s=[],volume:o=wr(0),solo:u=!1,muted:h=!1,rank:f=0,pan:p=0}){this.song=t,this.insturment=i,this.clips=[...r],this.suggestedInstruments=[...s],this.uuid=n,this.volume=o,this.solo=u,this.muted=h,this.rank=f,this.pan=p,this.automation=new yr}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:n}){this.insturment=new ut({program:t,isDrum:n})}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:n}){const r=new ut({program:t,isDrum:n});return this.suggestedInstruments.push(r),r}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}setPan(t){this.pan=t}getPan(){return this.pan}getSolo(){return this.solo}setSolo(t){this.solo=t,t&&this.muted&&(this.muted=!1)}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const n=ht(t);return new Bt(n.name,n.manufacturerName,n.pluginFormatName,n.pluginVersion)}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t,n=!0){const r=!this.samplerPlugin&&!!t||!t&&!!this.samplerPlugin||!!t&&!!this.samplerPlugin&&!t.matchesTfId(this.samplerPlugin.getTuneflowId()),i=this.samplerPlugin;this.samplerPlugin=t,r&&i&&n&&this.automation.removeAutomationOfPlugin(i.getInstanceId())}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return!this.clips||this.clips.length===0?0:this.clips[0].getClipStartTick()}getTrackEndTick(){return!this.clips||this.clips.length===0?0:this.clips[this.clips.length-1].getClipEndTick()}getClipById(t){for(const n of this.clips)if(n.getId()===t)return n;return null}getClips(){return this.clips}getClipsOverlappingWith(t,n){const r=[],i=k.lt(this.clips,{getClipStartTick:()=>t},(s,o)=>s.getClipStartTick()-o.getClipStartTick());for(let s=Math.max(i,0);s<this.clips.length;s+=1){const o=this.clips[s];if(!(o.getClipEndTick()<t)){if(o.getClipStartTick()>n)break;r.push(o)}}return r}createClip({clipStartTick:t,clipEndTick:n=void 0,insertClip:r=!0}){if(t==null)throw new Error("clipStartTick must be specified when creating a clip.");const i=n??t+1;if(i<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${n}`);const s=new V({id:V.generateClipIdInternal(),track:void 0,clipStartTick:t,clipEndTick:i});return r&&this.insertClip(s),s}insertClip(t){if(t.getTrack()!==this)t.getTrack()&&t.deleteFromParent(!1),t.track=this;else return;this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t)}cloneClip(t){const n=this.createClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const r of t.getRawNotes())n.createNote({pitch:r.getPitch(),velocity:r.getVelocity(),startTick:r.getStartTick(),endTick:r.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return n}getClipIndex(t){const n=k.le(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());return this.clips.indexOf(t,n)}deleteClip(t,n){const r=this.getClipIndex(t);this.deleteClipAt(r,n)}deleteClipAt(t,n){if(!(t<0)){if(n){const r=this.clips[t];if(!r)return;this.automation.removeAllPointsWithinRange(r.getClipStartTick(),r.getClipEndTick())}this.clips.splice(t,1)}}deleteFromParent(){this.song.removeTrack(this.getId())}getAutomation(){return this.automation}hasAnyAutomation(){return this.automation.getAutomationTargets().length>0&&!b.isEmpty(this.automation.getAutomationTargetValues())}static generateTrackIdInternal(){return Ot()}resolveClipConflictInternal(t,n,r){const i=this.getClipsOverlappingWith(n,r);for(const s of i)s.getId()!==t&&s.trimConflictPartInternal(n,r)}orderedInsertClipInternal(t){const n=k.ge(this.clips,t,(r,i)=>r.getClipStartTick()-i.getClipStartTick());this.clips.splice(n,0,t)}}class ut{program;isDrum;constructor({program:t,isDrum:n}){this.program=t,this.isDrum=n}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new ut({program:this.program,isDrum:this.isDrum})}}class Mt{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return Rt(this.tracks,n=>n.getId()===t)}getTracksByIds(t){if(!this.tracks)return[];const n=new Set(t);return this.tracks.filter(r=>n.has(r.getId()))}getTrackIndex(t){return j(this.tracks,n=>n.getId()===t)}createTrack({index:t,rank:n}){this.checkAccess("createTrack"),n==null||n===null?n=this.getNextTrackRank():this.nextTrackRank=Math.max(n+1,this.nextTrackRank);const r=new gt({song:this,uuid:this.getNextTrackId(),rank:n==null||n===null?this.getNextTrackRank():n});return t!=null?this.tracks.splice(t,0,r):this.tracks.push(r),r}cloneTrack(t){let n=this.getTrackIndex(t.getId());n<0&&(n=void 0);const r=this.createTrack({index:n});r.setInstrument({program:t.getInstrument().getProgram(),isDrum:t.getInstrument().getIsDrum()});for(const s of t.getSuggestedInstruments())r.createSuggestedInstrument({program:s.getProgram(),isDrum:s.getIsDrum()});r.setVolume(t.getVolume()),r.setPan(t.getPan()),r.setSolo(t.getSolo()),r.setMuted(t.getMuted());const i=t.getSamplerPlugin();i&&r.setSamplerPlugin(i.clone(r));for(const s of t.getAudioPlugins())r.addAudioPlugin(s.clone(r));for(const s of t.getClips()){const o=r.createClip({clipStartTick:s.getClipStartTick(),clipEndTick:s.getClipEndTick()});for(const u of s.getRawNotes())o.createNote({pitch:u.getPitch(),velocity:u.getVelocity(),startTick:u.getStartTick(),endTick:u.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return r}removeTrack(t){this.checkAccess("removeTrack");const n=this.getTrackById(t);return n?(this.tracks.splice(j(this.tracks,r=>r.getId()===t),1),n):null}getResolution(){return this.PPQ}getBeatsPerBar(){return this.getTimeSignatures()[0].getNumerator()}getTicksPerBar(){return this.getBeatsPerBar()*this.getResolution()}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:n}){if(this.tempos.length===0&&t!==0)throw new Error("The first tempo event must be at tick 0");const r=new ae({ticks:t,bpm:n,time:this.tickToSeconds(t)}),i=k.ge(this.tempos,r,(s,o)=>s.getTicks()-o.getTicks());return i<0?this.tempos.push(r):this.tempos.splice(i,0,r),this.retimingTempoEvents(),r}overwriteTempoChanges(t){if(t.length===0)throw new Error("Cannot clear all the tempo events.");const n=kn(t);n.sort((i,s)=>i.getTicks()-s.getTicks());const r=n[0];if(r.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new ae({ticks:0,time:0,bpm:r.getBpm()})];for(let i=1;i<n.length;i+=1){const s=n[i];this.createTempoChange({ticks:s.getTicks(),bpm:s.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=kn(t)}updateTempo(t,n){t.setBpmInternal(n),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:n,denominator:r}){const i=new Ir({ticks:t,numerator:n,denominator:r}),s=k.ge(this.timeSignatures,i,(o,u)=>o.getTicks()-u.getTicks());return s<0?this.timeSignatures.push(i):this.timeSignatures.splice(s,0,i),i}getLastTick(){let t=0;for(const n of this.tracks)t=Math.max(t,n.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}tickToSeconds(t){if(t===0)return 0;const n=k.lt(this.getTempoChanges(),{getTicks:()=>t},(o,u)=>o.getTicks()-u.getTicks());if(n==-1)return-1;const r=this.getTempoChanges()[n],i=t-r.getTicks(),s=Mt.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return r.getTime()+i/s}secondsToTick(t){const n=k.lt(this.getTempoChanges(),{getTime:()=>t},(o,u)=>o.getTime()-u.getTime());if(n==-1)return-1;const r=this.getTempoChanges()[n],i=t-r.getTime(),s=Mt.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return Math.round(r.getTicks()+i*s)}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}clearPluginContextInternal(){this.pluginContext=void 0}getNextTrackId(){const t=this.pluginContext,n=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===n.length)n.push(gt.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>n.length)throw new Error("Plugin generated track ids out of sync.");const r=n[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,r}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,n){return t*n/60}retimingTempoEvents(){this.tempos.sort((t,n)=>t.getTicks()-n.getTicks());for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}var C=(e=>(e[e.Slider=1]="Slider",e[e.Input=2]="Input",e[e.TrackSelector=3]="TrackSelector",e[e.Pitch=4]="Pitch",e[e.TrackPitchSelector=5]="TrackPitchSelector",e[e.InstrumentSelector=6]="InstrumentSelector",e[e.Select=7]="Select",e[e.Switch=8]="Switch",e[e.InputNumber=9]="InputNumber",e[e.MultiTrackSelector=10]="MultiTrackSelector",e[e.None=11]="None",e[e.FileSelector=12]="FileSelector",e))(C||{}),Cr=(e=>(e[e.SelectedTrackIds=1]="SelectedTrackIds",e[e.SelectedClipInfos=2]="SelectedClipInfos",e[e.TickAtPlayhead=3]="TickAtPlayhead",e[e.EditingClipInfo=4]="EditingClipInfo",e[e.EditingNoteIds=5]="EditingNoteIds",e))(Cr||{});exports.AudioPlugin=Bt;exports.AutomationData=yr;exports.AutomationTarget=M;exports.AutomationTargetType=Sr;exports.AutomationValue=et;exports.Clip=V;exports.InjectSource=Cr;exports.Note=D;exports.Song=Mt;exports.TempoEvent=ae;exports.TickToSecondStepper=$a;exports.TimeSignatureEvent=Ir;exports.Track=gt;exports.TuneflowPipeline=_a;exports.TuneflowPlugin=we;exports.WidgetType=C;exports.areTuneflowIdsEqual=kr;exports.areTuneflowIdsEqualIgnoreVersion=Pr;exports.dbToVolumeValue=wr;exports.decodeAudioPluginTuneflowId=ht;exports.gainToDb=Ua;exports.gainToVolumeValue=za;exports.getAudioPluginTuneflowId=vr;exports.getAudioPluginVersionlessTuneflowId=Tr;exports.midiNumberToPitch=Oa;exports.pitchToMidiNumber=La;exports.toVersionlessTfId=Fa;exports.volumeValueToDb=qa;exports.volumeValueToGain=Ga;
