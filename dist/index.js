"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module";var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},e=Array.prototype,r=Object.prototype,n="undefined"!=typeof Symbol?Symbol.prototype:null,i=e.push,o=e.slice,s=r.toString,a=r.hasOwnProperty,u="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,l=Array.isArray,f=Object.keys,p=Object.create,h=u&&ArrayBuffer.isView,g=isNaN,d=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),v=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],k=Math.pow(2,53)-1;function T(t,e){return e=null==e?t.length-1:+e,function(){for(var r=Math.max(arguments.length-e,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var o=Array(e+1);for(i=0;i<e;i++)o[i]=arguments[i];return o[e]=n,t.apply(this,o)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function b(t){return void 0===t}function I(t){return!0===t||!1===t||"[object Boolean]"===s.call(t)}function S(t){var e="[object "+t+"]";return function(t){return s.call(t)===e}}var w=S("String"),C=S("Number"),_=S("Date"),x=S("RegExp"),P=S("Error"),E=S("Symbol"),j=S("ArrayBuffer"),A=S("Function"),N=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof N&&(A=function(t){return"function"==typeof t||!1});var O=A,M=S("Object"),R=c&&M(new DataView(new ArrayBuffer(8))),B="undefined"!=typeof Map&&M(new Map),D=S("DataView");var F=R?function(t){return null!=t&&O(t.getInt8)&&j(t.buffer)}:D,W=l||S("Array");function V(t,e){return null!=t&&a.call(t,e)}var $=S("Arguments");!function(){$(arguments)||($=function(t){return V(t,"callee")})}();var L=$;function U(t){return C(t)&&g(t)}function q(t){return function(){return t}}function z(t){return function(e){var r=t(e);return"number"==typeof r&&r>=0&&r<=k}}function Q(t){return function(e){return null==e?void 0:e[t]}}var G=Q("byteLength"),J=z(G),K=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var H=u?function(t){return h?h(t)&&!F(t):J(t)&&K.test(s.call(t))}:q(!1),X=Q("length");function Y(t,e){e=function(t){for(var e={},r=t.length,n=0;n<r;++n)e[t[n]]=!0;return{contains:function(t){return!0===e[t]},push:function(r){return e[r]=!0,t.push(r)}}}(e);var n=v.length,i=t.constructor,o=O(i)&&i.prototype||r,s="constructor";for(V(t,s)&&!e.contains(s)&&e.push(s);n--;)(s=v[n])in t&&t[s]!==o[s]&&!e.contains(s)&&e.push(s)}function Z(t){if(!y(t))return[];if(f)return f(t);var e=[];for(var r in t)V(t,r)&&e.push(r);return m&&Y(t,e),e}function tt(t,e){var r=Z(e),n=r.length;if(null==t)return!n;for(var i=Object(t),o=0;o<n;o++){var s=r[o];if(e[s]!==i[s]||!(s in i))return!1}return!0}function et(t){return t instanceof et?t:this instanceof et?void(this._wrapped=t):new et(t)}function rt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,G(t))}et.VERSION="1.13.2",et.prototype.value=function(){return this._wrapped},et.prototype.valueOf=et.prototype.toJSON=et.prototype.value,et.prototype.toString=function(){return String(this._wrapped)};function nt(t,e,r,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&it(t,e,r,n)}function it(t,e,r,i){t instanceof et&&(t=t._wrapped),e instanceof et&&(e=e._wrapped);var o=s.call(t);if(o!==s.call(e))return!1;if(R&&"[object Object]"==o&&F(t)){if(!F(e))return!1;o="[object DataView]"}switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return n.valueOf.call(t)===n.valueOf.call(e);case"[object ArrayBuffer]":case"[object DataView]":return it(rt(t),rt(e),r,i)}var a="[object Array]"===o;if(!a&&H(t)){if(G(t)!==G(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var u=t.constructor,c=e.constructor;if(u!==c&&!(O(u)&&u instanceof u&&O(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var l=(r=r||[]).length;l--;)if(r[l]===t)return i[l]===e;if(r.push(t),i.push(e),a){if((l=t.length)!==e.length)return!1;for(;l--;)if(!nt(t[l],e[l],r,i))return!1}else{var f,p=Z(t);if(l=p.length,Z(e).length!==l)return!1;for(;l--;)if(!V(e,f=p[l])||!nt(t[f],e[f],r,i))return!1}return r.pop(),i.pop(),!0}function ot(t){if(!y(t))return[];var e=[];for(var r in t)e.push(r);return m&&Y(t,e),e}function st(t){var e=X(t);return function(r){if(null==r)return!1;var n=ot(r);if(X(n))return!1;for(var i=0;i<e;i++)if(!O(r[t[i]]))return!1;return t!==ft||!O(r[at])}}var at="forEach",ut=["clear","delete"],ct=["get","has","set"],lt=ut.concat(at,ct),ft=ut.concat(ct),pt=["add"].concat(ut,at,"has"),ht=B?st(lt):S("Map"),gt=B?st(ft):S("WeakMap"),dt=B?st(pt):S("Set"),mt=S("WeakSet");function vt(t){for(var e=Z(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=t[e[i]];return n}function kt(t){for(var e={},r=Z(t),n=0,i=r.length;n<i;n++)e[t[r[n]]]=r[n];return e}function Tt(t){var e=[];for(var r in t)O(t[r])&&e.push(r);return e.sort()}function yt(t,e){return function(r){var n=arguments.length;if(e&&(r=Object(r)),n<2||null==r)return r;for(var i=1;i<n;i++)for(var o=arguments[i],s=t(o),a=s.length,u=0;u<a;u++){var c=s[u];e&&void 0!==r[c]||(r[c]=o[c])}return r}}var bt=yt(ot),It=yt(Z),St=yt(ot,!0);function wt(t){if(!y(t))return{};if(p)return p(t);var e=function(){};e.prototype=t;var r=new e;return e.prototype=null,r}function Ct(t){return W(t)?t:[t]}function _t(t){return et.toPath(t)}function xt(t,e){for(var r=e.length,n=0;n<r;n++){if(null==t)return;t=t[e[n]]}return r?t:void 0}function Pt(t,e,r){var n=xt(t,_t(e));return b(n)?r:n}function Et(t){return t}function jt(t){return t=It({},t),function(e){return tt(e,t)}}function At(t){return t=_t(t),function(e){return xt(e,t)}}function Nt(t,e,r){if(void 0===e)return t;switch(null==r?3:r){case 1:return function(r){return t.call(e,r)};case 3:return function(r,n,i){return t.call(e,r,n,i)};case 4:return function(r,n,i,o){return t.call(e,r,n,i,o)}}return function(){return t.apply(e,arguments)}}function Ot(t,e,r){return null==t?Et:O(t)?Nt(t,e,r):y(t)&&!W(t)?jt(t):At(t)}function Mt(t,e){return Ot(t,e,1/0)}function Rt(t,e,r){return et.iteratee!==Mt?et.iteratee(t,e):Ot(t,e,r)}function Bt(){}function Dt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}et.toPath=Ct,et.iteratee=Mt;var Ft=Date.now||function(){return(new Date).getTime()};function Wt(t){var e=function(e){return t[e]},r="(?:"+Z(t).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(i,e):t}}var Vt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$t=Wt(Vt),Lt=Wt(kt(Vt)),Ut=et.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,zt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Qt=/\\|'|\r|\n|\u2028|\u2029/g;function Gt(t){return"\\"+zt[t]}var Jt=/^\s*(\w|\$)+\s*$/;var Kt=0;function Ht(t,e,r,n,i){if(!(n instanceof e))return t.apply(r,i);var o=wt(t.prototype),s=t.apply(o,i);return y(s)?s:o}var Xt=T((function(t,e){var r=Xt.placeholder,n=function(){for(var i=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===r?arguments[i++]:e[a];for(;i<arguments.length;)s.push(arguments[i++]);return Ht(t,n,this,this,s)};return n}));Xt.placeholder=et;var Yt=T((function(t,e,r){if(!O(t))throw new TypeError("Bind must be called on a function");var n=T((function(i){return Ht(t,n,e,this,r.concat(i))}));return n})),Zt=z(X);function te(t,e,r,n){if(n=n||[],e||0===e){if(e<=0)return n.concat(t)}else e=1/0;for(var i=n.length,o=0,s=X(t);o<s;o++){var a=t[o];if(Zt(a)&&(W(a)||L(a)))if(e>1)te(a,e-1,r,n),i=n.length;else for(var u=0,c=a.length;u<c;)n[i++]=a[u++];else r||(n[i++]=a)}return n}var ee=T((function(t,e){var r=(e=te(e,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=e[r];t[n]=Yt(t[n],t)}return t}));var re=T((function(t,e,r){return setTimeout((function(){return t.apply(null,r)}),e)})),ne=Xt(re,et,1);function ie(t){return function(){return!t.apply(this,arguments)}}function oe(t,e){var r;return function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=null),r}}var se=Xt(oe,2);function ae(t,e,r){e=Rt(e,r);for(var n,i=Z(t),o=0,s=i.length;o<s;o++)if(e(t[n=i[o]],n,t))return n}function ue(t){return function(e,r,n){r=Rt(r,n);for(var i=X(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(r(e[o],o,e))return o;return-1}}var ce=ue(1),le=ue(-1);function fe(t,e,r,n){for(var i=(r=Rt(r,n,1))(e),o=0,s=X(t);o<s;){var a=Math.floor((o+s)/2);r(t[a])<i?o=a+1:s=a}return o}function pe(t,e,r){return function(n,i,s){var a=0,u=X(n);if("number"==typeof s)t>0?a=s>=0?s:Math.max(s+u,a):u=s>=0?Math.min(s+1,u):s+u+1;else if(r&&s&&u)return n[s=r(n,i)]===i?s:-1;if(i!=i)return(s=e(o.call(n,a,u),U))>=0?s+a:-1;for(s=t>0?a:u-1;s>=0&&s<u;s+=t)if(n[s]===i)return s;return-1}}var he=pe(1,ce,fe),ge=pe(-1,le);function de(t,e,r){var n=(Zt(t)?ce:ae)(t,e,r);if(void 0!==n&&-1!==n)return t[n]}function me(t,e,r){var n,i;if(e=Nt(e,r),Zt(t))for(n=0,i=t.length;n<i;n++)e(t[n],n,t);else{var o=Z(t);for(n=0,i=o.length;n<i;n++)e(t[o[n]],o[n],t)}return t}function ve(t,e,r){e=Rt(e,r);for(var n=!Zt(t)&&Z(t),i=(n||t).length,o=Array(i),s=0;s<i;s++){var a=n?n[s]:s;o[s]=e(t[a],a,t)}return o}function ke(t){var e=function(e,r,n,i){var o=!Zt(e)&&Z(e),s=(o||e).length,a=t>0?0:s-1;for(i||(n=e[o?o[a]:a],a+=t);a>=0&&a<s;a+=t){var u=o?o[a]:a;n=r(n,e[u],u,e)}return n};return function(t,r,n,i){var o=arguments.length>=3;return e(t,Nt(r,i,4),n,o)}}var Te=ke(1),ye=ke(-1);function be(t,e,r){var n=[];return e=Rt(e,r),me(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function Ie(t,e,r){e=Rt(e,r);for(var n=!Zt(t)&&Z(t),i=(n||t).length,o=0;o<i;o++){var s=n?n[o]:o;if(!e(t[s],s,t))return!1}return!0}function Se(t,e,r){e=Rt(e,r);for(var n=!Zt(t)&&Z(t),i=(n||t).length,o=0;o<i;o++){var s=n?n[o]:o;if(e(t[s],s,t))return!0}return!1}function we(t,e,r,n){return Zt(t)||(t=vt(t)),("number"!=typeof r||n)&&(r=0),he(t,e,r)>=0}var Ce=T((function(t,e,r){var n,i;return O(e)?i=e:(e=_t(e),n=e.slice(0,-1),e=e[e.length-1]),ve(t,(function(t){var o=i;if(!o){if(n&&n.length&&(t=xt(t,n)),null==t)return;o=t[e]}return null==o?o:o.apply(t,r)}))}));function _e(t,e){return ve(t,At(e))}function xe(t,e,r){var n,i,o=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(n=t[a])&&n>o&&(o=n);else e=Rt(e,r),me(t,(function(t,r,n){((i=e(t,r,n))>s||i===-1/0&&o===-1/0)&&(o=t,s=i)}));return o}var Pe=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ee(t){return t?W(t)?o.call(t):w(t)?t.match(Pe):Zt(t)?ve(t,Et):vt(t):[]}function je(t,e,r){if(null==e||r)return Zt(t)||(t=vt(t)),t[Dt(t.length-1)];var n=Ee(t),i=X(n);e=Math.max(Math.min(e,i),0);for(var o=i-1,s=0;s<e;s++){var a=Dt(s,o),u=n[s];n[s]=n[a],n[a]=u}return n.slice(0,e)}function Ae(t,e){return function(r,n,i){var o=e?[[],[]]:{};return n=Rt(n,i),me(r,(function(e,i){var s=n(e,i,r);t(o,e,s)})),o}}var Ne=Ae((function(t,e,r){V(t,r)?t[r].push(e):t[r]=[e]})),Oe=Ae((function(t,e,r){t[r]=e})),Me=Ae((function(t,e,r){V(t,r)?t[r]++:t[r]=1})),Re=Ae((function(t,e,r){t[r?0:1].push(e)}),!0);function Be(t,e,r){return e in r}var De=T((function(t,e){var r={},n=e[0];if(null==t)return r;O(n)?(e.length>1&&(n=Nt(n,e[1])),e=ot(t)):(n=Be,e=te(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var s=e[i],a=t[s];n(a,s,t)&&(r[s]=a)}return r})),Fe=T((function(t,e){var r,n=e[0];return O(n)?(n=ie(n),e.length>1&&(r=e[1])):(e=ve(te(e,!1,!1),String),n=function(t,r){return!we(e,r)}),De(t,n,r)}));function We(t,e,r){return o.call(t,0,Math.max(0,t.length-(null==e||r?1:e)))}function Ve(t,e,r){return null==t||t.length<1?null==e||r?void 0:[]:null==e||r?t[0]:We(t,t.length-e)}function $e(t,e,r){return o.call(t,null==e||r?1:e)}var Le=T((function(t,e){return e=te(e,!0,!0),be(t,(function(t){return!we(e,t)}))})),Ue=T((function(t,e){return Le(t,e)}));function qe(t,e,r,n){I(e)||(n=r,r=e,e=!1),null!=r&&(r=Rt(r,n));for(var i=[],o=[],s=0,a=X(t);s<a;s++){var u=t[s],c=r?r(u,s,t):u;e&&!r?(s&&o===c||i.push(u),o=c):r?we(o,c)||(o.push(c),i.push(u)):we(i,u)||i.push(u)}return i}var ze=T((function(t){return qe(te(t,!0,!0))}));function Qe(t){for(var e=t&&xe(t,X).length||0,r=Array(e),n=0;n<e;n++)r[n]=_e(t,n);return r}var Ge=T(Qe);function Je(t,e){return t._chain?et(e).chain():e}function Ke(t){return me(Tt(t),(function(e){var r=et[e]=t[e];et.prototype[e]=function(){var t=[this._wrapped];return i.apply(t,arguments),Je(this,r.apply(et,t))}})),et}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var r=e[t];et.prototype[t]=function(){var e=this._wrapped;return null!=e&&(r.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0]),Je(this,e)}})),me(["concat","join","slice"],(function(t){var r=e[t];et.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=r.apply(t,arguments)),Je(this,t)}}));var He=Ke(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VERSION:"1.13.2",restArguments:T,isObject:y,isNull:function(t){return null===t},isUndefined:b,isBoolean:I,isElement:function(t){return!(!t||1!==t.nodeType)},isString:w,isNumber:C,isDate:_,isRegExp:x,isError:P,isSymbol:E,isArrayBuffer:j,isDataView:F,isArray:W,isFunction:O,isArguments:L,isFinite:function(t){return!E(t)&&d(t)&&!isNaN(parseFloat(t))},isNaN:U,isTypedArray:H,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(W(t)||w(t)||L(t))?0===e:0===X(Z(t))},isMatch:tt,isEqual:function(t,e){return nt(t,e)},isMap:ht,isWeakMap:gt,isSet:dt,isWeakSet:mt,keys:Z,allKeys:ot,values:vt,pairs:function(t){for(var e=Z(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=[e[i],t[e[i]]];return n},invert:kt,functions:Tt,methods:Tt,extend:bt,extendOwn:It,assign:It,defaults:St,create:function(t,e){var r=wt(t);return e&&It(r,e),r},clone:function(t){return y(t)?W(t)?t.slice():bt({},t):t},tap:function(t,e){return e(t),t},get:Pt,has:function(t,e){for(var r=(e=_t(e)).length,n=0;n<r;n++){var i=e[n];if(!V(t,i))return!1;t=t[i]}return!!r},mapObject:function(t,e,r){e=Rt(e,r);for(var n=Z(t),i=n.length,o={},s=0;s<i;s++){var a=n[s];o[a]=e(t[a],a,t)}return o},identity:Et,constant:q,noop:Bt,toPath:Ct,property:At,propertyOf:function(t){return null==t?Bt:function(e){return Pt(t,e)}},matcher:jt,matches:jt,times:function(t,e,r){var n=Array(Math.max(0,t));e=Nt(e,r,1);for(var i=0;i<t;i++)n[i]=e(i);return n},random:Dt,now:Ft,escape:$t,unescape:Lt,templateSettings:Ut,template:function(t,e,r){!e&&r&&(e=r),e=St({},e,et.templateSettings);var n=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(n,(function(e,r,n,s,a){return o+=t.slice(i,a).replace(Qt,Gt),i=a+e.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e})),o+="';\n";var s,a=e.variable;if(a){if(!Jt.test(a))throw new Error("variable is not a bare identifier: "+a)}else o="with(obj||{}){\n"+o+"}\n",a="obj";o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{s=new Function(a,"_",o)}catch(c){throw c.source=o,c}var u=function(t){return s.call(this,t,et)};return u.source="function("+a+"){\n"+o+"}",u},result:function(t,e,r){var n=(e=_t(e)).length;if(!n)return O(r)?r.call(t):r;for(var i=0;i<n;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=r,i=n),t=O(o)?o.call(t):o}return t},uniqueId:function(t){var e=++Kt+"";return t?t+e:e},chain:function(t){var e=et(t);return e._chain=!0,e},iteratee:Mt,partial:Xt,bind:Yt,bindAll:ee,memoize:function(t,e){var r=function(n){var i=r.cache,o=""+(e?e.apply(this,arguments):n);return V(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return r.cache={},r},delay:re,defer:ne,throttle:function(t,e,r){var n,i,o,s,a=0;r||(r={});var u=function(){a=!1===r.leading?0:Ft(),n=null,s=t.apply(i,o),n||(i=o=null)},c=function(){var c=Ft();a||!1!==r.leading||(a=c);var l=e-(c-a);return i=this,o=arguments,l<=0||l>e?(n&&(clearTimeout(n),n=null),a=c,s=t.apply(i,o),n||(i=o=null)):n||!1===r.trailing||(n=setTimeout(u,l)),s};return c.cancel=function(){clearTimeout(n),a=0,n=i=o=null},c},debounce:function(t,e,r){var n,i,o,s,a,u=function(){var c=Ft()-i;e>c?n=setTimeout(u,e-c):(n=null,r||(s=t.apply(a,o)),n||(o=a=null))},c=T((function(c){return a=this,o=c,i=Ft(),n||(n=setTimeout(u,e),r&&(s=t.apply(a,o))),s}));return c.cancel=function(){clearTimeout(n),n=o=a=null},c},wrap:function(t,e){return Xt(e,t)},negate:ie,compose:function(){var t=arguments,e=t.length-1;return function(){for(var r=e,n=t[e].apply(this,arguments);r--;)n=t[r].call(this,n);return n}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:oe,once:se,findKey:ae,findIndex:ce,findLastIndex:le,sortedIndex:fe,indexOf:he,lastIndexOf:ge,find:de,detect:de,findWhere:function(t,e){return de(t,jt(e))},each:me,forEach:me,map:ve,collect:ve,reduce:Te,foldl:Te,inject:Te,reduceRight:ye,foldr:ye,filter:be,select:be,reject:function(t,e,r){return be(t,ie(Rt(e)),r)},every:Ie,all:Ie,some:Se,any:Se,contains:we,includes:we,include:we,invoke:Ce,pluck:_e,where:function(t,e){return be(t,jt(e))},max:xe,min:function(t,e,r){var n,i,o=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(n=t[a])&&n<o&&(o=n);else e=Rt(e,r),me(t,(function(t,r,n){((i=e(t,r,n))<s||i===1/0&&o===1/0)&&(o=t,s=i)}));return o},shuffle:function(t){return je(t,1/0)},sample:je,sortBy:function(t,e,r){var n=0;return e=Rt(e,r),_e(ve(t,(function(t,r,i){return{value:t,index:n++,criteria:e(t,r,i)}})).sort((function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return t.index-e.index})),"value")},groupBy:Ne,indexBy:Oe,countBy:Me,partition:Re,toArray:Ee,size:function(t){return null==t?0:Zt(t)?t.length:Z(t).length},pick:De,omit:Fe,first:Ve,head:Ve,take:Ve,initial:We,last:function(t,e,r){return null==t||t.length<1?null==e||r?void 0:[]:null==e||r?t[t.length-1]:$e(t,Math.max(0,t.length-e))},rest:$e,tail:$e,drop:$e,compact:function(t){return be(t,Boolean)},flatten:function(t,e){return te(t,e,!1)},without:Ue,uniq:qe,unique:qe,union:ze,intersection:function(t){for(var e=[],r=arguments.length,n=0,i=X(t);n<i;n++){var o=t[n];if(!we(e,o)){var s;for(s=1;s<r&&we(arguments[s],o);s++);s===r&&e.push(o)}}return e},difference:Le,unzip:Qe,transpose:Qe,zip:Ge,object:function(t,e){for(var r={},n=0,i=X(t);n<i;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r},range:function(t,e,r){null==e&&(e=t||0,t=0),r||(r=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/r),0),i=Array(n),o=0;o<n;o++,t+=r)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var r=[],n=0,i=t.length;n<i;)r.push(o.call(t,n,n+=e));return r},mixin:Ke,default:et}));He._=He;let Xe=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=63&r[t];e+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return e};class Ye{instanceIdInternal=Ye.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,e){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,e){return t[e]}hasAllParamsSet(){for(const t of Z(this.params())){if(this.params()[t].optional)continue;const e=this.paramsResultInternal[t];if(null==e)return!1;const r=this.params()[t].widget.type;switch(r){case exports.WidgetType.Input:case exports.WidgetType.Pitch:case exports.WidgetType.Slider:case exports.WidgetType.TrackSelector:case exports.WidgetType.Select:case exports.WidgetType.Switch:case exports.WidgetType.InputNumber:case exports.WidgetType.FileSelector:break;case exports.WidgetType.MultiTrackSelector:if(0===e.length)return!1;break;case exports.WidgetType.TrackPitchSelector:if(void 0===e.track||null===e.track||void 0===e.pitch||null===e.pitch)return!1;break;case exports.WidgetType.InstrumentSelector:if(void 0===e.program||null===e.program||void 0===e.isDrum||null===e.isDrum)return!1;break;case exports.WidgetType.None:if(null==e)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${r}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of Z(this.params())){const e=this.params()[t];this.paramsResultInternal[t]=e.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Xe(10)}}var Ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tr={exports:{}};!function(t,e){var r="__lodash_hash_undefined__",n=9007199254740991,i="[object Arguments]",o="[object Boolean]",s="[object Date]",a="[object Function]",u="[object GeneratorFunction]",c="[object Map]",l="[object Number]",f="[object Object]",p="[object Promise]",h="[object RegExp]",g="[object Set]",d="[object String]",m="[object Symbol]",v="[object WeakMap]",k="[object ArrayBuffer]",T="[object DataView]",y="[object Float32Array]",b="[object Float64Array]",I="[object Int8Array]",S="[object Int16Array]",w="[object Int32Array]",C="[object Uint8Array]",_="[object Uint8ClampedArray]",x="[object Uint16Array]",P="[object Uint32Array]",E=/\w*$/,j=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,N={};N[i]=N["[object Array]"]=N[k]=N[T]=N[o]=N[s]=N[y]=N[b]=N[I]=N[S]=N[w]=N[c]=N[l]=N[f]=N[h]=N[g]=N[d]=N[m]=N[C]=N[_]=N[x]=N[P]=!0,N["[object Error]"]=N[a]=N[v]=!1;var O="object"==typeof Ze&&Ze&&Ze.Object===Object&&Ze,M="object"==typeof self&&self&&self.Object===Object&&self,R=O||M||Function("return this")(),B=e&&!e.nodeType&&e,D=B&&t&&!t.nodeType&&t,F=D&&D.exports===B;function W(t,e){return t.set(e[0],e[1]),t}function V(t,e){return t.add(e),t}function $(t,e,r,n){var i=-1,o=t?t.length:0;for(n&&o&&(r=t[++i]);++i<o;)r=e(r,t[i],i,t);return r}function L(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(r){}return e}function U(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function q(t,e){return function(r){return t(e(r))}}function z(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var Q,G=Array.prototype,J=Function.prototype,K=Object.prototype,H=R["__core-js_shared__"],X=(Q=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"",Y=J.toString,Z=K.hasOwnProperty,tt=K.toString,et=RegExp("^"+Y.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=F?R.Buffer:void 0,nt=R.Symbol,it=R.Uint8Array,ot=q(Object.getPrototypeOf,Object),st=Object.create,at=K.propertyIsEnumerable,ut=G.splice,ct=Object.getOwnPropertySymbols,lt=rt?rt.isBuffer:void 0,ft=q(Object.keys,Object),pt=Dt(R,"DataView"),ht=Dt(R,"Map"),gt=Dt(R,"Promise"),dt=Dt(R,"Set"),mt=Dt(R,"WeakMap"),vt=Dt(Object,"create"),kt=Lt(pt),Tt=Lt(ht),yt=Lt(gt),bt=Lt(dt),It=Lt(mt),St=nt?nt.prototype:void 0,wt=St?St.valueOf:void 0;function Ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _t(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function xt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Pt(t){this.__data__=new _t(t)}function Et(t,e){var r=qt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&zt(t)}(t)&&Z.call(t,"callee")&&(!at.call(t,"callee")||tt.call(t)==i)}(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],n=r.length,o=!!n;for(var s in t)!e&&!Z.call(t,s)||o&&("length"==s||Vt(s,n))||r.push(s);return r}function jt(t,e,r){var n=t[e];Z.call(t,e)&&Ut(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function At(t,e){for(var r=t.length;r--;)if(Ut(t[r][0],e))return r;return-1}function Nt(t,e,r,n,p,v,j){var A;if(n&&(A=v?n(t,p,v,j):n(t)),void 0!==A)return A;if(!Jt(t))return t;var O=qt(t);if(O){if(A=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&Z.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!e)return function(t,e){var r=-1,n=t.length;e||(e=Array(n));for(;++r<n;)e[r]=t[r];return e}(t,A)}else{var M=Wt(t),R=M==a||M==u;if(Qt(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if(M==f||M==i||R&&!v){if(L(t))return v?t:{};if(A=function(t){return"function"!=typeof t.constructor||$t(t)?{}:(e=ot(t),Jt(e)?st(e):{});var e}(R?{}:t),!e)return function(t,e){return Rt(t,Ft(t),e)}(t,function(t,e){return t&&Rt(e,Kt(e),t)}(A,t))}else{if(!N[M])return v?t:{};A=function(t,e,r,n){var i=t.constructor;switch(e){case k:return Mt(t);case o:case s:return new i(+t);case T:return function(t,e){var r=e?Mt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,n);case y:case b:case I:case S:case w:case C:case _:case x:case P:return function(t,e){var r=e?Mt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,n);case c:return function(t,e,r){return $(e?r(U(t),!0):U(t),W,new t.constructor)}(t,n,r);case l:case d:return new i(t);case h:return function(t){var e=new t.constructor(t.source,E.exec(t));return e.lastIndex=t.lastIndex,e}(t);case g:return function(t,e,r){return $(e?r(z(t),!0):z(t),V,new t.constructor)}(t,n,r);case m:return a=t,wt?Object(wt.call(a)):{}}var a}(t,M,Nt,e)}}j||(j=new Pt);var B=j.get(t);if(B)return B;if(j.set(t,A),!O)var D=r?function(t){return function(t,e,r){var n=e(t);return qt(t)?n:function(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}(n,r(t))}(t,Kt,Ft)}(t):Kt(t);return function(t,e){for(var r=-1,n=t?t.length:0;++r<n&&!1!==e(t[r],r,t););}(D||t,(function(i,o){D&&(i=t[o=i]),jt(A,o,Nt(i,e,r,n,o,t,j))})),A}function Ot(t){return!(!Jt(t)||(e=t,X&&X in e))&&(Gt(t)||L(t)?et:j).test(Lt(t));var e}function Mt(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Rt(t,e,r,n){r||(r={});for(var i=-1,o=e.length;++i<o;){var s=e[i],a=n?n(r[s],t[s],s,r,t):void 0;jt(r,s,void 0===a?t[s]:a)}return r}function Bt(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function Dt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Ot(r)?r:void 0}Ct.prototype.clear=function(){this.__data__=vt?vt(null):{}},Ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Ct.prototype.get=function(t){var e=this.__data__;if(vt){var n=e[t];return n===r?void 0:n}return Z.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return vt?void 0!==e[t]:Z.call(e,t)},Ct.prototype.set=function(t,e){return this.__data__[t]=vt&&void 0===e?r:e,this},_t.prototype.clear=function(){this.__data__=[]},_t.prototype.delete=function(t){var e=this.__data__,r=At(e,t);return!(r<0)&&(r==e.length-1?e.pop():ut.call(e,r,1),!0)},_t.prototype.get=function(t){var e=this.__data__,r=At(e,t);return r<0?void 0:e[r][1]},_t.prototype.has=function(t){return At(this.__data__,t)>-1},_t.prototype.set=function(t,e){var r=this.__data__,n=At(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},xt.prototype.clear=function(){this.__data__={hash:new Ct,map:new(ht||_t),string:new Ct}},xt.prototype.delete=function(t){return Bt(this,t).delete(t)},xt.prototype.get=function(t){return Bt(this,t).get(t)},xt.prototype.has=function(t){return Bt(this,t).has(t)},xt.prototype.set=function(t,e){return Bt(this,t).set(t,e),this},Pt.prototype.clear=function(){this.__data__=new _t},Pt.prototype.delete=function(t){return this.__data__.delete(t)},Pt.prototype.get=function(t){return this.__data__.get(t)},Pt.prototype.has=function(t){return this.__data__.has(t)},Pt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof _t){var n=r.__data__;if(!ht||n.length<199)return n.push([t,e]),this;r=this.__data__=new xt(n)}return r.set(t,e),this};var Ft=ct?q(ct,Object):function(){return[]},Wt=function(t){return tt.call(t)};function Vt(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||A.test(t))&&t>-1&&t%1==0&&t<e}function $t(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||K)}function Lt(t){if(null!=t){try{return Y.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Ut(t,e){return t===e||t!=t&&e!=e}(pt&&Wt(new pt(new ArrayBuffer(1)))!=T||ht&&Wt(new ht)!=c||gt&&Wt(gt.resolve())!=p||dt&&Wt(new dt)!=g||mt&&Wt(new mt)!=v)&&(Wt=function(t){var e=tt.call(t),r=e==f?t.constructor:void 0,n=r?Lt(r):void 0;if(n)switch(n){case kt:return T;case Tt:return c;case yt:return p;case bt:return g;case It:return v}return e});var qt=Array.isArray;function zt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!Gt(t)}var Qt=lt||function(){return!1};function Gt(t){var e=Jt(t)?tt.call(t):"";return e==a||e==u}function Jt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Kt(t){return zt(t)?Et(t):function(t){if(!$t(t))return ft(t);var e=[];for(var r in Object(t))Z.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}t.exports=function(t){return Nt(t,!0,!0)}}(tr,tr.exports);var er=tr.exports;function rr(t,e,r,n,i){for(var o=i+1;n<=i;){var s=n+i>>>1,a=t[s];(void 0!==r?r(a,e):a-e)>=0?(o=s,i=s-1):n=s+1}return o}function nr(t,e,r,n,i){for(var o=n-1;n<=i;){var s=n+i>>>1,a=t[s];(void 0!==r?r(a,e):a-e)<0?(o=s,n=s+1):i=s-1}return o}function ir(t,e,r,n,i){for(var o=n-1;n<=i;){var s=n+i>>>1,a=t[s];(void 0!==r?r(a,e):a-e)<=0?(o=s,n=s+1):i=s-1}return o}function or(t,e,r,n,i,o){return"function"==typeof r?o(t,e,r,void 0===n?0:0|n,void 0===i?t.length-1:0|i):o(t,e,void 0,void 0===r?0:0|r,void 0===n?t.length-1:0|n)}var sr=function(t,e,r,n,i){return or(t,e,r,n,i,rr)},ar=function(t,e,r,n,i){return or(t,e,r,n,i,nr)},ur=function(t,e,r,n,i){return or(t,e,r,n,i,ir)};class cr{ticks;bpm;time;constructor({ticks:t,bpm:e,time:r}){this.ticks=t,this.bpm=e,this.time=r}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class lr{ticks;numerator;denominator;constructor({ticks:t,numerator:e,denominator:r}){this.ticks=t,this.numerator=e,this.denominator=r}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}class fr{pitch;velocity;startTick;endTick;constructor({pitch:t,velocity:e,startTick:r,endTick:n}){this.pitch=t,this.velocity=e,this.startTick=r,this.endTick=n}getPitch(){return this.pitch}setPitch(t){if(!fr.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}static isValidPitch(t){return t>=0&&t<=127}getVelocity(){return this.velocity}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}clone(){return new fr({pitch:this.pitch,velocity:this.velocity,startTick:this.startTick,endTick:this.endTick})}}class pr{track;id;notes;clipStartTick=0;clipEndTick=0;constructor({track:t,id:e=pr.generateClipIdInternal(),sortedNotes:r=[],clipStartTick:n=0,clipEndTick:i=0}){this.track=t,this.id=e,this.notes=[...r],this.clipStartTick=n,this.clipEndTick=i}getId(){return this.id}getNotes(){return pr.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:e,startTick:r,endTick:n,updateClipRange:i=!0,resolveClipConflict:o=!0}){const s=new fr({pitch:t,velocity:e,startTick:r,endTick:n});return r<this.clipStartTick&&i&&this.adjustClipLeft(r,o),n>this.clipEndTick&&i&&this.adjustClipRight(n,o),this.orderedInsertNote(this.notes,s),s}deleteNote(t){const e=ar(this.notes,t,((t,e)=>t.getStartTick()-e.getStartTick()));for(let r=Math.max(0,e);r<this.notes.length;r+=1){const e=this.notes[r];if(e&&e===t)return void this.notes.splice(r,1);if(e&&e.getStartTick()>t.getStartTick())return}}deleteNoteAt(t){this.notes.splice(t,1)}orderedInsertNote(t,e){const r=sr(t,e,((t,e)=>t.getStartTick()-e.getStartTick()));r<0?t.push(e):t.splice(r,0,e)}adjustClipLeft(t,e=!0){(t=Math.max(0,t))>this.clipEndTick?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,e=!0){t<this.clipStartTick||t<0?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t){const e=Math.max(0,this.clipStartTick+t),r=this.clipEndTick+t;if(r<0)this.deleteFromParent();else{if(this.track&&this.track.resolveClipConflictInternal(this.getId(),e,r),this.track){const t=this.track.getClipIndex(this);this.track.deleteClipAt(t)}this.clipStartTick=e,this.clipEndTick=r;for(const e of this.notes)e.setStartTick(e.getStartTick()+t),e.setEndTick(e.getEndTick()+t);this.track&&this.track.orderedInsertClipInternal(this)}}moveClipTo(t){const e=t-this.getClipStartTick();this.moveClip(e)}deleteFromParent(){this.track&&(this.track.deleteClip(this),this.track=void 0)}static getNotesInRange(t,e,r){const n=ar(t,{getStartTick:()=>e},((t,e)=>t.getStartTick()-e.getStartTick())),i=[];for(let o=Math.max(n,0);o<t.length;o+=1){const n=t[o];if(n.getStartTick()>r)break;pr.isNoteInClip(n.getStartTick(),n.getEndTick(),e,r)&&i.push(n)}return i}static isNoteInClip(t,e,r,n){return t>=r&&t<=n&&e>=t}static getNotePlayableRange(t,e,r,n){if(!pr.isNoteInClip(t,e,r,n))return null;const i=Math.max(t,r),o=Math.min(e,n);return i>o?null:{startTick:i,endTick:o}}trimConflictPartInternal(t,e){const r=Math.max(t,this.getClipStartTick()),n=Math.min(e,this.getClipEndTick());if(!(r>n||r>this.getClipEndTick()||n<this.getClipStartTick()))if(n>=this.getClipEndTick()&&r<=this.getClipStartTick())this.deleteFromParent();else{if(n<this.getClipEndTick()&&r>this.getClipStartTick()){const t=n+1,e=this.getClipEndTick(),i=pr.getNotesInRange(this.notes,t,e).map((t=>t.clone()));return this.adjustClipRight(r-1,!1),void(this.track&&this.track.createClip({sortedNotes:i,clipStartTick:t,clipEndTick:e}))}r>this.getClipStartTick()&&r<=this.getClipEndTick()?this.adjustClipRight(r-1,!1):n<this.getClipEndTick()&&n>=this.getClipStartTick()&&this.adjustClipLeft(n+1,!1)}}static generateClipIdInternal(){return Xe(10)}}class hr{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;samplerPlugin;audioPlugins=[];song;constructor({song:t,uuid:e=hr.generateTrackIdInternal(),clips:r=[],instrument:n=new gr({program:0,isDrum:!1}),suggestedInstruments:i=[],volume:o=1,solo:s=!1,muted:a=!1,rank:u=0}){this.song=t,this.insturment=n,this.clips=[...r],this.suggestedInstruments=[...i],this.uuid=e,this.volume=o,this.solo=s,this.muted=a,this.rank=u}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:e}){this.insturment=new gr({program:t,isDrum:e})}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:e}){const r=new gr({program:t,isDrum:e});return this.suggestedInstruments.push(r),r}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}getSolo(){return this.solo}setSolo(t){this.solo=t}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t){this.samplerPlugin=t}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return this.clips&&0!==this.clips.length?this.clips[0].getClipStartTick():0}getTrackEndTick(){return this.clips&&0!==this.clips.length?this.clips[this.clips.length-1].getClipEndTick():0}getClipById(t){for(const e of this.clips)if(e.getId()===t)return e;return null}getClips(){return this.clips}getClipsOverlappingWith(t,e){const r=[],n=ar(this.clips,{getClipStartTick:()=>t},((t,e)=>t.getClipStartTick()-e.getClipStartTick()));for(let i=Math.max(n,0);i<this.clips.length;i+=1){const n=this.clips[i];if(!(n.getClipEndTick()<t)){if(n.getClipStartTick()>e)break;r.push(n)}}return r}createClip({clipStartTick:t,clipEndTick:e,sortedNotes:r=[],insertClip:n=!0}){if(null==t)throw new Error("clipStartTick must be specified when creating a clip.");const i=null==e?t+1:e;if(i<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${e}`);const o=new pr({id:pr.generateClipIdInternal(),track:void 0,sortedNotes:r,clipStartTick:t,clipEndTick:i});return n&&this.insertClip(o),o}insertClip(t){t.getTrack()!==this&&(t.getTrack()&&t.deleteFromParent(),t.track=this,this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t))}cloneClip(t){const e=this.createClip({sortedNotes:[],clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const r of t.getRawNotes())e.createNote({pitch:r.getPitch(),velocity:r.getVelocity(),startTick:r.getStartTick(),endTick:r.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return e}getClipIndex(t){const e=ur(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));return this.clips.indexOf(t,e)}deleteClip(t){const e=this.getClipIndex(t);this.deleteClipAt(e)}deleteClipAt(t){t<0||this.clips.splice(t,1)}deleteFromParent(){this.song.removeTrack(this.getId())}static generateTrackIdInternal(){return Xe()}resolveClipConflictInternal(t,e,r){const n=this.getClipsOverlappingWith(e,r);for(const i of n)i.getId()!==t&&i.trimConflictPartInternal(e,r)}orderedInsertClipInternal(t){const e=sr(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));this.clips.splice(e,0,t)}}class gr{program;isDrum;constructor({program:t,isDrum:e}){this.program=t,this.isDrum=e}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new gr({program:this.program,isDrum:this.isDrum})}}class dr{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return de(this.tracks,(e=>e.getId()===t))}getTrackIndex(t){return ce(this.tracks,(e=>e.getId()===t))}createTrack({index:t,rank:e}){this.checkAccess("createTrack"),null==e||null===e?e=this.getNextTrackRank():this.nextTrackRank=Math.max(e+1,this.nextTrackRank);const r=new hr({song:this,uuid:this.getNextTrackId(),rank:null==e||null===e?this.getNextTrackRank():e});return null!=t?this.tracks.splice(t,0,r):this.tracks.push(r),r}cloneTrack(t){let e=this.getTrackIndex(t.getId());e<0&&(e=void 0);const r=this.createTrack({index:e});r.setInstrument({program:t.getInstrument().getProgram(),isDrum:t.getInstrument().getIsDrum()});for(const i of t.getSuggestedInstruments())r.createSuggestedInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});r.setVolume(t.getVolume()),r.setSolo(t.getSolo()),r.setMuted(t.getMuted());const n=t.getSamplerPlugin();n&&r.setSamplerPlugin(n.clone());for(const i of t.getAudioPlugins())r.addAudioPlugin(i.clone());for(const i of t.getClips()){const t=r.createClip({clipStartTick:i.getClipStartTick(),clipEndTick:i.getClipEndTick(),sortedNotes:[]});for(const e of i.getRawNotes())t.createNote({pitch:e.getPitch(),velocity:e.getVelocity(),startTick:e.getStartTick(),endTick:e.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return r}removeTrack(t){this.checkAccess("removeTrack");const e=this.getTrackById(t);return e?(this.tracks.splice(ce(this.tracks,(e=>e.getId()===t)),1),e):null}getResolution(){return this.PPQ}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:e}){if(0===this.tempos.length&&0!==t)throw new Error("The first tempo event must be at tick 0");const r=new cr({ticks:t,bpm:e,time:this.tickToSeconds(t)}),n=sr(this.tempos,r,((t,e)=>t.getTicks()-e.getTicks()));return n<0?this.tempos.push(r):this.tempos.splice(n,0,r),this.retimingTempoEvents(),r}overwriteTempoChanges(t){if(0===t.length)throw new Error("Cannot clear all the tempo events.");const e=er(t);e.sort(((t,e)=>t.getTicks()-e.getTicks()));const r=e[0];if(r.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new cr({ticks:0,time:0,bpm:r.getBpm()})];for(let n=1;n<e.length;n+=1){const t=e[n];this.createTempoChange({ticks:t.getTicks(),bpm:t.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=er(t)}updateTempo(t,e){t.setBpmInternal(e),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:e,denominator:r}){const n=new lr({ticks:t,numerator:e,denominator:r}),i=sr(this.timeSignatures,n,((t,e)=>t.getTicks()-e.getTicks()));return i<0?this.timeSignatures.push(n):this.timeSignatures.splice(i,0,n),n}getLastTick(){let t=0;for(const e of this.tracks)t=Math.max(t,e.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}tickToSeconds(t){if(0===t)return 0;const e=ar(this.getTempoChanges(),{getTicks:()=>t},((t,e)=>t.getTicks()-e.getTicks()));if(-1==e)return-1;const r=this.getTempoChanges()[e],n=t-r.getTicks(),i=dr.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return r.getTime()+n/i}secondsToTick(t){const e=ar(this.getTempoChanges(),{getTime:()=>t},((t,e)=>t.getTime()-e.getTime()));if(-1==e)return-1;const r=this.getTempoChanges()[e],n=t-r.getTime(),i=dr.tempoBPMToTicksPerSecond(r.getBpm(),this.getResolution());return Math.round(r.getTicks()+n*i)}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}getNextTrackId(){const t=this.pluginContext,e=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===e.length)e.push(hr.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>e.length)throw new Error("Plugin generated track ids out of sync.");const r=e[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,r}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,e){return t*e/60}retimingTempoEvents(){this.tempos.sort(((t,e)=>t.getTicks()-e.getTicks()));for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}const mr=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,vr={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function kr(t,e,r,n){return`${t} // ${e} // ${r} // ${n}`}class Tr{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;constructor(t,e,r,n){this.name=t,this.manufacturerName=e,this.pluginFormatName=r,this.pluginVersion=n}getTuneflowId(){return kr(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(){const t=new Tr(this.name,this.manufacturerName,this.pluginFormatName,this.pluginVersion);return t.setIsEnabled(this.isEnabled),t}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}}var yr,br;exports.WidgetType=void 0,(yr=exports.WidgetType||(exports.WidgetType={}))[yr.Slider=1]="Slider",yr[yr.Input=2]="Input",yr[yr.TrackSelector=3]="TrackSelector",yr[yr.Pitch=4]="Pitch",yr[yr.TrackPitchSelector=5]="TrackPitchSelector",yr[yr.InstrumentSelector=6]="InstrumentSelector",yr[yr.Select=7]="Select",yr[yr.Switch=8]="Switch",yr[yr.InputNumber=9]="InputNumber",yr[yr.MultiTrackSelector=10]="MultiTrackSelector",yr[yr.None=11]="None",yr[yr.FileSelector=12]="FileSelector",exports.InjectSource=void 0,(br=exports.InjectSource||(exports.InjectSource={}))[br.SelectedTrackIds=1]="SelectedTrackIds",br[br.SelectedClipInfos=2]="SelectedClipInfos",br[br.TickAtPlayhead=3]="TickAtPlayhead",exports.AudioPlugin=Tr,exports.Clip=pr,exports.Note=fr,exports.Song=dr,exports.TempoEvent=cr,exports.TimeSignatureEvent=lr,exports.Track=hr,exports.TuneflowPipeline=class{plugins=[];threwErrorInLastRun=!1;songCache={};addPlugin(t){this.plugins.push(t)}addPluginAt(t,e){this.plugins.splice(e,0,t)}removePlugin(t){this.plugins.splice(this.plugins.indexOf(t),1)}getPlugins(){return this.plugins}resetCache(){this.songCache={}}async run(t,e=0){e=Math.max(0,e),this.threwErrorInLastRun=!1;const r=er(t),n=this.getIndexOfLatestPluginWithCacheBeforeIndex(e);n>=0&&It(t,er(this.songCache[this.plugins[n].instanceId]));for(let s=e;s<this.plugins.length;s+=1)delete this.songCache[this.plugins[s].instanceId];let i=0;for(let s=0;s<this.plugins.length;s+=1){const e=this.plugins[s];if(!e.enabledInternal)return!0;if(this.songCache[e.instanceId])e.isRollbackable=!0;else{if(t.setPluginContextInternal(e),!e.hasAllParamsSet())return!0;try{await e.run(t,e.getParamsInternal())}catch(o){this.threwErrorInLastRun=!0;const e=this.getIndexOfLatestPluginWithCacheBeforeIndex(s);return It(t,e>=0?er(this.songCache[this.plugins[e].instanceId]):r),!1}this.songCache[e.instanceId]=er(t),e.isRollbackable=!0,i+=1}}return!0}reset(){for(const t of this.plugins)t.resetInternal()}clear(){this.plugins.splice(0,this.plugins.length)}movePluginUp(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<=0||this.plugins.splice(e-1,0,this.plugins.splice(e,1)[0])}movePluginDown(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<0||e>=this.plugins.length-1||this.plugins.splice(e,0,this.plugins.splice(e+1,1)[0])}isPluginFunctioning(t){return!!this.songCache[t.instanceId]}getPluginIndexByPluginInstanceId(t){return ce(this.plugins,(e=>e.instanceId===t))}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getLastFunctioningPlugin(){for(let t=this.plugins.length-1;t>=0;t-=1)if(this.isPluginFunctioning(this.plugins[t]))return this.plugins[t];return null}getPluginCache(t){return this.songCache[t.instanceId]}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let e=t-1;e>=0;e-=1)if(this.songCache[this.plugins[e].instanceId])return e;return-1}},exports.TuneflowPlugin=Ye,exports.decodeAudioPluginTuneflowId=function(t){const e=t.split(" // ");if(e.length<4)throw new Error("Invalid audio plugin tuneflow id.");return new Tr(e[2],e[0],e[1],e[3])},exports.getAudioPluginTuneflowId=kr,exports.midiNumberToPitch=function(t){const e=Math.floor(t/12)-1;return function(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}(t)+e.toString()},exports.pitchToMidiNumber=function(t){const e=mr.exec(t);if(!e)return-1;const r=e[1],n=e[2];return vr[r.toLowerCase()]+12*(parseInt(n,10)+1)};
