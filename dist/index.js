"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module";var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},e=Array.prototype,n=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,i=e.push,o=e.slice,s=n.toString,a=n.hasOwnProperty,u="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,l=Array.isArray,f=Object.keys,p=Object.create,h=u&&ArrayBuffer.isView,g=isNaN,d=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),v=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],k=Math.pow(2,53)-1;function T(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var o=Array(e+1);for(i=0;i<e;i++)o[i]=arguments[i];return o[e]=r,t.apply(this,o)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function b(t){return void 0===t}function I(t){return!0===t||!1===t||"[object Boolean]"===s.call(t)}function S(t){var e="[object "+t+"]";return function(t){return s.call(t)===e}}var w=S("String"),C=S("Number"),x=S("Date"),_=S("RegExp"),P=S("Error"),E=S("Symbol"),j=S("ArrayBuffer"),A=S("Function"),N=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof N&&(A=function(t){return"function"==typeof t||!1});var O=A,M=S("Object"),R=c&&M(new DataView(new ArrayBuffer(8))),B="undefined"!=typeof Map&&M(new Map),D=S("DataView");var F=R?function(t){return null!=t&&O(t.getInt8)&&j(t.buffer)}:D,V=l||S("Array");function W(t,e){return null!=t&&a.call(t,e)}var $=S("Arguments");!function(){$(arguments)||($=function(t){return W(t,"callee")})}();var L=$;function U(t){return C(t)&&g(t)}function q(t){return function(){return t}}function z(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=k}}function Q(t){return function(e){return null==e?void 0:e[t]}}var G=Q("byteLength"),J=z(G),K=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var H=u?function(t){return h?h(t)&&!F(t):J(t)&&K.test(s.call(t))}:q(!1),X=Q("length");function Y(t,e){e=function(t){for(var e={},n=t.length,r=0;r<n;++r)e[t[r]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var r=v.length,i=t.constructor,o=O(i)&&i.prototype||n,s="constructor";for(W(t,s)&&!e.contains(s)&&e.push(s);r--;)(s=v[r])in t&&t[s]!==o[s]&&!e.contains(s)&&e.push(s)}function Z(t){if(!y(t))return[];if(f)return f(t);var e=[];for(var n in t)W(t,n)&&e.push(n);return m&&Y(t,e),e}function tt(t,e){var n=Z(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0}function et(t){return t instanceof et?t:this instanceof et?void(this._wrapped=t):new et(t)}function nt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,G(t))}et.VERSION="1.13.2",et.prototype.value=function(){return this._wrapped},et.prototype.valueOf=et.prototype.toJSON=et.prototype.value,et.prototype.toString=function(){return String(this._wrapped)};function rt(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&it(t,e,n,r)}function it(t,e,n,i){t instanceof et&&(t=t._wrapped),e instanceof et&&(e=e._wrapped);var o=s.call(t);if(o!==s.call(e))return!1;if(R&&"[object Object]"==o&&F(t)){if(!F(e))return!1;o="[object DataView]"}switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(e);case"[object ArrayBuffer]":case"[object DataView]":return it(nt(t),nt(e),n,i)}var a="[object Array]"===o;if(!a&&H(t)){if(G(t)!==G(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var u=t.constructor,c=e.constructor;if(u!==c&&!(O(u)&&u instanceof u&&O(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var l=(n=n||[]).length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),a){if((l=t.length)!==e.length)return!1;for(;l--;)if(!rt(t[l],e[l],n,i))return!1}else{var f,p=Z(t);if(l=p.length,Z(e).length!==l)return!1;for(;l--;)if(!W(e,f=p[l])||!rt(t[f],e[f],n,i))return!1}return n.pop(),i.pop(),!0}function ot(t){if(!y(t))return[];var e=[];for(var n in t)e.push(n);return m&&Y(t,e),e}function st(t){var e=X(t);return function(n){if(null==n)return!1;var r=ot(n);if(X(r))return!1;for(var i=0;i<e;i++)if(!O(n[t[i]]))return!1;return t!==ft||!O(n[at])}}var at="forEach",ut=["clear","delete"],ct=["get","has","set"],lt=ut.concat(at,ct),ft=ut.concat(ct),pt=["add"].concat(ut,at,"has"),ht=B?st(lt):S("Map"),gt=B?st(ft):S("WeakMap"),dt=B?st(pt):S("Set"),mt=S("WeakSet");function vt(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function kt(t){for(var e={},n=Z(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function Tt(t){var e=[];for(var n in t)O(t[n])&&e.push(n);return e.sort()}function yt(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],s=t(o),a=s.length,u=0;u<a;u++){var c=s[u];e&&void 0!==n[c]||(n[c]=o[c])}return n}}var bt=yt(ot),It=yt(Z),St=yt(ot,!0);function wt(t){if(!y(t))return{};if(p)return p(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function Ct(t){return V(t)?t:[t]}function xt(t){return et.toPath(t)}function _t(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function Pt(t,e,n){var r=_t(t,xt(e));return b(r)?n:r}function Et(t){return t}function jt(t){return t=It({},t),function(e){return tt(e,t)}}function At(t){return t=xt(t),function(e){return _t(e,t)}}function Nt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}}function Ot(t,e,n){return null==t?Et:O(t)?Nt(t,e,n):y(t)&&!V(t)?jt(t):At(t)}function Mt(t,e){return Ot(t,e,1/0)}function Rt(t,e,n){return et.iteratee!==Mt?et.iteratee(t,e):Ot(t,e,n)}function Bt(){}function Dt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}et.toPath=Ct,et.iteratee=Mt;var Ft=Date.now||function(){return(new Date).getTime()};function Vt(t){var e=function(e){return t[e]},n="(?:"+Z(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}}var Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$t=Vt(Wt),Lt=Vt(kt(Wt)),Ut=et.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,zt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Qt=/\\|'|\r|\n|\u2028|\u2029/g;function Gt(t){return"\\"+zt[t]}var Jt=/^\s*(\w|\$)+\s*$/;var Kt=0;function Ht(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=wt(t.prototype),s=t.apply(o,i);return y(s)?s:o}var Xt=T((function(t,e){var n=Xt.placeholder,r=function(){for(var i=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===n?arguments[i++]:e[a];for(;i<arguments.length;)s.push(arguments[i++]);return Ht(t,r,this,this,s)};return r}));Xt.placeholder=et;var Yt=T((function(t,e,n){if(!O(t))throw new TypeError("Bind must be called on a function");var r=T((function(i){return Ht(t,r,e,this,n.concat(i))}));return r})),Zt=z(X);function te(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,o=0,s=X(t);o<s;o++){var a=t[o];if(Zt(a)&&(V(a)||L(a)))if(e>1)te(a,e-1,n,r),i=r.length;else for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else n||(r[i++]=a)}return r}var ee=T((function(t,e){var n=(e=te(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=Yt(t[r],t)}return t}));var ne=T((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Xt(ne,et,1);function ie(t){return function(){return!t.apply(this,arguments)}}function oe(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var se=Xt(oe,2);function ae(t,e,n){e=Rt(e,n);for(var r,i=Z(t),o=0,s=i.length;o<s;o++)if(e(t[r=i[o]],r,t))return r}function ue(t){return function(e,n,r){n=Rt(n,r);for(var i=X(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(n(e[o],o,e))return o;return-1}}var ce=ue(1),le=ue(-1);function fe(t,e,n,r){for(var i=(n=Rt(n,r,1))(e),o=0,s=X(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<i?o=a+1:s=a}return o}function pe(t,e,n){return function(r,i,s){var a=0,u=X(r);if("number"==typeof s)t>0?a=s>=0?s:Math.max(s+u,a):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return r[s=n(r,i)]===i?s:-1;if(i!=i)return(s=e(o.call(r,a,u),U))>=0?s+a:-1;for(s=t>0?a:u-1;s>=0&&s<u;s+=t)if(r[s]===i)return s;return-1}}var he=pe(1,ce,fe),ge=pe(-1,le);function de(t,e,n){var r=(Zt(t)?ce:ae)(t,e,n);if(void 0!==r&&-1!==r)return t[r]}function me(t,e,n){var r,i;if(e=Nt(e,n),Zt(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=Z(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t}function ve(t,e,n){e=Rt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=e(t[a],a,t)}return o}function ke(t){var e=function(e,n,r,i){var o=!Zt(e)&&Z(e),s=(o||e).length,a=t>0?0:s-1;for(i||(r=e[o?o[a]:a],a+=t);a>=0&&a<s;a+=t){var u=o?o[a]:a;r=n(r,e[u],u,e)}return r};return function(t,n,r,i){var o=arguments.length>=3;return e(t,Nt(n,i,4),r,o)}}var Te=ke(1),ye=ke(-1);function be(t,e,n){var r=[];return e=Rt(e,n),me(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r}function Ie(t,e,n){e=Rt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(!e(t[s],s,t))return!1}return!0}function Se(t,e,n){e=Rt(e,n);for(var r=!Zt(t)&&Z(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(e(t[s],s,t))return!0}return!1}function we(t,e,n,r){return Zt(t)||(t=vt(t)),("number"!=typeof n||r)&&(n=0),he(t,e,n)>=0}var Ce=T((function(t,e,n){var r,i;return O(e)?i=e:(e=xt(e),r=e.slice(0,-1),e=e[e.length-1]),ve(t,(function(t){var o=i;if(!o){if(r&&r.length&&(t=_t(t,r)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))}));function xe(t,e){return ve(t,At(e))}function _e(t,e,n){var r,i,o=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(r=t[a])&&r>o&&(o=r);else e=Rt(e,n),me(t,(function(t,n,r){((i=e(t,n,r))>s||i===-1/0&&o===-1/0)&&(o=t,s=i)}));return o}var Pe=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ee(t){return t?V(t)?o.call(t):w(t)?t.match(Pe):Zt(t)?ve(t,Et):vt(t):[]}function je(t,e,n){if(null==e||n)return Zt(t)||(t=vt(t)),t[Dt(t.length-1)];var r=Ee(t),i=X(r);e=Math.max(Math.min(e,i),0);for(var o=i-1,s=0;s<e;s++){var a=Dt(s,o),u=r[s];r[s]=r[a],r[a]=u}return r.slice(0,e)}function Ae(t,e){return function(n,r,i){var o=e?[[],[]]:{};return r=Rt(r,i),me(n,(function(e,i){var s=r(e,i,n);t(o,e,s)})),o}}var Ne=Ae((function(t,e,n){W(t,n)?t[n].push(e):t[n]=[e]})),Oe=Ae((function(t,e,n){t[n]=e})),Me=Ae((function(t,e,n){W(t,n)?t[n]++:t[n]=1})),Re=Ae((function(t,e,n){t[n?0:1].push(e)}),!0);function Be(t,e,n){return e in n}var De=T((function(t,e){var n={},r=e[0];if(null==t)return n;O(r)?(e.length>1&&(r=Nt(r,e[1])),e=ot(t)):(r=Be,e=te(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var s=e[i],a=t[s];r(a,s,t)&&(n[s]=a)}return n})),Fe=T((function(t,e){var n,r=e[0];return O(r)?(r=ie(r),e.length>1&&(n=e[1])):(e=ve(te(e,!1,!1),String),r=function(t,n){return!we(e,n)}),De(t,r,n)}));function Ve(t,e,n){return o.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function We(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Ve(t,t.length-e)}function $e(t,e,n){return o.call(t,null==e||n?1:e)}var Le=T((function(t,e){return e=te(e,!0,!0),be(t,(function(t){return!we(e,t)}))})),Ue=T((function(t,e){return Le(t,e)}));function qe(t,e,n,r){I(e)||(r=n,n=e,e=!1),null!=n&&(n=Rt(n,r));for(var i=[],o=[],s=0,a=X(t);s<a;s++){var u=t[s],c=n?n(u,s,t):u;e&&!n?(s&&o===c||i.push(u),o=c):n?we(o,c)||(o.push(c),i.push(u)):we(i,u)||i.push(u)}return i}var ze=T((function(t){return qe(te(t,!0,!0))}));function Qe(t){for(var e=t&&_e(t,X).length||0,n=Array(e),r=0;r<e;r++)n[r]=xe(t,r);return n}var Ge=T(Qe);function Je(t,e){return t._chain?et(e).chain():e}function Ke(t){return me(Tt(t),(function(e){var n=et[e]=t[e];et.prototype[e]=function(){var t=[this._wrapped];return i.apply(t,arguments),Je(this,n.apply(et,t))}})),et}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var n=e[t];et.prototype[t]=function(){var e=this._wrapped;return null!=e&&(n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0]),Je(this,e)}})),me(["concat","join","slice"],(function(t){var n=e[t];et.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=n.apply(t,arguments)),Je(this,t)}}));var He=Ke(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VERSION:"1.13.2",restArguments:T,isObject:y,isNull:function(t){return null===t},isUndefined:b,isBoolean:I,isElement:function(t){return!(!t||1!==t.nodeType)},isString:w,isNumber:C,isDate:x,isRegExp:_,isError:P,isSymbol:E,isArrayBuffer:j,isDataView:F,isArray:V,isFunction:O,isArguments:L,isFinite:function(t){return!E(t)&&d(t)&&!isNaN(parseFloat(t))},isNaN:U,isTypedArray:H,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(V(t)||w(t)||L(t))?0===e:0===X(Z(t))},isMatch:tt,isEqual:function(t,e){return rt(t,e)},isMap:ht,isWeakMap:gt,isSet:dt,isWeakSet:mt,keys:Z,allKeys:ot,values:vt,pairs:function(t){for(var e=Z(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:kt,functions:Tt,methods:Tt,extend:bt,extendOwn:It,assign:It,defaults:St,create:function(t,e){var n=wt(t);return e&&It(n,e),n},clone:function(t){return y(t)?V(t)?t.slice():bt({},t):t},tap:function(t,e){return e(t),t},get:Pt,has:function(t,e){for(var n=(e=xt(e)).length,r=0;r<n;r++){var i=e[r];if(!W(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Rt(e,n);for(var r=Z(t),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=e(t[a],a,t)}return o},identity:Et,constant:q,noop:Bt,toPath:Ct,property:At,propertyOf:function(t){return null==t?Bt:function(e){return Pt(t,e)}},matcher:jt,matches:jt,times:function(t,e,n){var r=Array(Math.max(0,t));e=Nt(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:Dt,now:Ft,escape:$t,unescape:Lt,templateSettings:Ut,template:function(t,e,n){!e&&n&&(e=n),e=St({},e,et.templateSettings);var r=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,(function(e,n,r,s,a){return o+=t.slice(i,a).replace(Qt,Gt),i=a+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e})),o+="';\n";var s,a=e.variable;if(a){if(!Jt.test(a))throw new Error("variable is not a bare identifier: "+a)}else o="with(obj||{}){\n"+o+"}\n",a="obj";o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{s=new Function(a,"_",o)}catch(c){throw c.source=o,c}var u=function(t){return s.call(this,t,et)};return u.source="function("+a+"){\n"+o+"}",u},result:function(t,e,n){var r=(e=xt(e)).length;if(!r)return O(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=O(o)?o.call(t):o}return t},uniqueId:function(t){var e=++Kt+"";return t?t+e:e},chain:function(t){var e=et(t);return e._chain=!0,e},iteratee:Mt,partial:Xt,bind:Yt,bindAll:ee,memoize:function(t,e){var n=function(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return W(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},delay:ne,defer:re,throttle:function(t,e,n){var r,i,o,s,a=0;n||(n={});var u=function(){a=!1===n.leading?0:Ft(),r=null,s=t.apply(i,o),r||(i=o=null)},c=function(){var c=Ft();a||!1!==n.leading||(a=c);var l=e-(c-a);return i=this,o=arguments,l<=0||l>e?(r&&(clearTimeout(r),r=null),a=c,s=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,l)),s};return c.cancel=function(){clearTimeout(r),a=0,r=i=o=null},c},debounce:function(t,e,n){var r,i,o,s,a,u=function(){var c=Ft()-i;e>c?r=setTimeout(u,e-c):(r=null,n||(s=t.apply(a,o)),r||(o=a=null))},c=T((function(c){return a=this,o=c,i=Ft(),r||(r=setTimeout(u,e),n&&(s=t.apply(a,o))),s}));return c.cancel=function(){clearTimeout(r),r=o=a=null},c},wrap:function(t,e){return Xt(e,t)},negate:ie,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:oe,once:se,findKey:ae,findIndex:ce,findLastIndex:le,sortedIndex:fe,indexOf:he,lastIndexOf:ge,find:de,detect:de,findWhere:function(t,e){return de(t,jt(e))},each:me,forEach:me,map:ve,collect:ve,reduce:Te,foldl:Te,inject:Te,reduceRight:ye,foldr:ye,filter:be,select:be,reject:function(t,e,n){return be(t,ie(Rt(e)),n)},every:Ie,all:Ie,some:Se,any:Se,contains:we,includes:we,include:we,invoke:Ce,pluck:xe,where:function(t,e){return be(t,jt(e))},max:_e,min:function(t,e,n){var r,i,o=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=Zt(t)?t:vt(t)).length;a<u;a++)null!=(r=t[a])&&r<o&&(o=r);else e=Rt(e,n),me(t,(function(t,n,r){((i=e(t,n,r))<s||i===1/0&&o===1/0)&&(o=t,s=i)}));return o},shuffle:function(t){return je(t,1/0)},sample:je,sortBy:function(t,e,n){var r=0;return e=Rt(e,n),xe(ve(t,(function(t,n,i){return{value:t,index:r++,criteria:e(t,n,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")},groupBy:Ne,indexBy:Oe,countBy:Me,partition:Re,toArray:Ee,size:function(t){return null==t?0:Zt(t)?t.length:Z(t).length},pick:De,omit:Fe,first:We,head:We,take:We,initial:Ve,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:$e(t,Math.max(0,t.length-e))},rest:$e,tail:$e,drop:$e,compact:function(t){return be(t,Boolean)},flatten:function(t,e){return te(t,e,!1)},without:Ue,uniq:qe,unique:qe,union:ze,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=X(t);r<i;r++){var o=t[r];if(!we(e,o)){var s;for(s=1;s<n&&we(arguments[s],o);s++);s===n&&e.push(o)}}return e},difference:Le,unzip:Qe,transpose:Qe,zip:Ge,object:function(t,e){for(var n={},r=0,i=X(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(o.call(t,r,r+=e));return n},mixin:Ke,default:et}));He._=He;let Xe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let r=63&n[t];e+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return e};class Ye{instanceIdInternal=Ye.generatePluginIdInternal();enabledInternal=!0;paramsResultInternal={};generatedTrackIdsInternal=[];isRollbackable=!1;static providerId(){throw new Error("providerId() should be overwritten.")}static pluginId(){throw new Error("pluginId() should be overwritten.")}static providerDisplayName(){throw new Error("providerDisplayName() should be overwritten.")}static pluginDisplayName(){throw new Error("pluginDisplayName() should be overwritten.")}static pluginDescription(){return null}static allowReset(){return!0}async init(){}params(){return{}}songAccess(){return{}}allowManualApplyAdjust(){return!1}async run(t,e){}static async create(){const t=new this;return t.resetInternal(),await t.init(),t}get instanceId(){return this.instanceIdInternal}getParam(t,e){return t[e]}hasAllParamsSet(){for(const t of Z(this.params())){if(this.params()[t].optional)continue;const e=this.paramsResultInternal[t];if(null==e)return!1;const n=this.params()[t].widget.type;switch(n){case exports.WidgetType.Input:case exports.WidgetType.Pitch:case exports.WidgetType.Slider:case exports.WidgetType.TrackSelector:case exports.WidgetType.Select:case exports.WidgetType.Switch:case exports.WidgetType.InputNumber:case exports.WidgetType.FileSelector:break;case exports.WidgetType.MultiTrackSelector:if(0===e.length)return!1;break;case exports.WidgetType.TrackPitchSelector:if(void 0===e.track||null===e.track||void 0===e.pitch||null===e.pitch)return!1;break;case exports.WidgetType.InstrumentSelector:if(void 0===e.program||null===e.program||void 0===e.isDrum||null===e.isDrum)return!1;break;case exports.WidgetType.None:if(null==e)return!1;break;default:throw new Error(`Param nullness check needs to be implemented for widget type ${n}. Either use default nullness check or define custom logic.`)}}return!0}static id(){return`${this.providerId()}.${this.pluginId()}`}static getPrefixedArtifactId(t){return`${this.id()}.${t}`}setParamsInternal(t){this.paramsResultInternal=t,this.maybeSyncEnabledWithParamsReadiness()}getParamsInternal(){return this.paramsResultInternal}resetParamsInternal(){for(const t of Z(this.params())){const e=this.params()[t];this.paramsResultInternal[t]=e.defaultValue}this.maybeSyncEnabledWithParamsReadiness()}resetInternal(){this.resetParamsInternal(),this.allowManualApplyAdjust()&&(this.enabledInternal=!1)}setEnabledInternal(t){this.enabledInternal=t}maybeSyncEnabledWithParamsReadiness(){this.allowManualApplyAdjust()&&!this.hasAllParamsSet()&&this.setEnabledInternal(!1)}static generatePluginIdInternal(){return Xe(10)}}var Ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tn={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",o="[object Boolean]",s="[object Date]",a="[object Function]",u="[object GeneratorFunction]",c="[object Map]",l="[object Number]",f="[object Object]",p="[object Promise]",h="[object RegExp]",g="[object Set]",d="[object String]",m="[object Symbol]",v="[object WeakMap]",k="[object ArrayBuffer]",T="[object DataView]",y="[object Float32Array]",b="[object Float64Array]",I="[object Int8Array]",S="[object Int16Array]",w="[object Int32Array]",C="[object Uint8Array]",x="[object Uint8ClampedArray]",_="[object Uint16Array]",P="[object Uint32Array]",E=/\w*$/,j=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,N={};N[i]=N["[object Array]"]=N[k]=N[T]=N[o]=N[s]=N[y]=N[b]=N[I]=N[S]=N[w]=N[c]=N[l]=N[f]=N[h]=N[g]=N[d]=N[m]=N[C]=N[x]=N[_]=N[P]=!0,N["[object Error]"]=N[a]=N[v]=!1;var O="object"==typeof Ze&&Ze&&Ze.Object===Object&&Ze,M="object"==typeof self&&self&&self.Object===Object&&self,R=O||M||Function("return this")(),B=e&&!e.nodeType&&e,D=B&&t&&!t.nodeType&&t,F=D&&D.exports===B;function V(t,e){return t.set(e[0],e[1]),t}function W(t,e){return t.add(e),t}function $(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function L(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function U(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function q(t,e){return function(n){return t(e(n))}}function z(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Q,G=Array.prototype,J=Function.prototype,K=Object.prototype,H=R["__core-js_shared__"],X=(Q=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"",Y=J.toString,Z=K.hasOwnProperty,tt=K.toString,et=RegExp("^"+Y.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=F?R.Buffer:void 0,rt=R.Symbol,it=R.Uint8Array,ot=q(Object.getPrototypeOf,Object),st=Object.create,at=K.propertyIsEnumerable,ut=G.splice,ct=Object.getOwnPropertySymbols,lt=nt?nt.isBuffer:void 0,ft=q(Object.keys,Object),pt=Dt(R,"DataView"),ht=Dt(R,"Map"),gt=Dt(R,"Promise"),dt=Dt(R,"Set"),mt=Dt(R,"WeakMap"),vt=Dt(Object,"create"),kt=Lt(pt),Tt=Lt(ht),yt=Lt(gt),bt=Lt(dt),It=Lt(mt),St=rt?rt.prototype:void 0,wt=St?St.valueOf:void 0;function Ct(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _t(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Pt(t){this.__data__=new xt(t)}function Et(t,e){var n=qt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&zt(t)}(t)&&Z.call(t,"callee")&&(!at.call(t,"callee")||tt.call(t)==i)}(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],r=n.length,o=!!r;for(var s in t)!e&&!Z.call(t,s)||o&&("length"==s||Wt(s,r))||n.push(s);return n}function jt(t,e,n){var r=t[e];Z.call(t,e)&&Ut(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function At(t,e){for(var n=t.length;n--;)if(Ut(t[n][0],e))return n;return-1}function Nt(t,e,n,r,p,v,j){var A;if(r&&(A=v?r(t,p,v,j):r(t)),void 0!==A)return A;if(!Jt(t))return t;var O=qt(t);if(O){if(A=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!e)return function(t,e){var n=-1,r=t.length;e||(e=Array(r));for(;++n<r;)e[n]=t[n];return e}(t,A)}else{var M=Vt(t),R=M==a||M==u;if(Qt(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(M==f||M==i||R&&!v){if(L(t))return v?t:{};if(A=function(t){return"function"!=typeof t.constructor||$t(t)?{}:(e=ot(t),Jt(e)?st(e):{});var e}(R?{}:t),!e)return function(t,e){return Rt(t,Ft(t),e)}(t,function(t,e){return t&&Rt(e,Kt(e),t)}(A,t))}else{if(!N[M])return v?t:{};A=function(t,e,n,r){var i=t.constructor;switch(e){case k:return Mt(t);case o:case s:return new i(+t);case T:return function(t,e){var n=e?Mt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,r);case y:case b:case I:case S:case w:case C:case x:case _:case P:return function(t,e){var n=e?Mt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,r);case c:return function(t,e,n){return $(e?n(U(t),!0):U(t),V,new t.constructor)}(t,r,n);case l:case d:return new i(t);case h:return function(t){var e=new t.constructor(t.source,E.exec(t));return e.lastIndex=t.lastIndex,e}(t);case g:return function(t,e,n){return $(e?n(z(t),!0):z(t),W,new t.constructor)}(t,r,n);case m:return a=t,wt?Object(wt.call(a)):{}}var a}(t,M,Nt,e)}}j||(j=new Pt);var B=j.get(t);if(B)return B;if(j.set(t,A),!O)var D=n?function(t){return function(t,e,n){var r=e(t);return qt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,Kt,Ft)}(t):Kt(t);return function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););}(D||t,(function(i,o){D&&(i=t[o=i]),jt(A,o,Nt(i,e,n,r,o,t,j))})),A}function Ot(t){return!(!Jt(t)||(e=t,X&&X in e))&&(Gt(t)||L(t)?et:j).test(Lt(t));var e}function Mt(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function Rt(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var s=e[i],a=r?r(n[s],t[s],s,n,t):void 0;jt(n,s,void 0===a?t[s]:a)}return n}function Bt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Dt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Ot(n)?n:void 0}Ct.prototype.clear=function(){this.__data__=vt?vt(null):{}},Ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Ct.prototype.get=function(t){var e=this.__data__;if(vt){var r=e[t];return r===n?void 0:r}return Z.call(e,t)?e[t]:void 0},Ct.prototype.has=function(t){var e=this.__data__;return vt?void 0!==e[t]:Z.call(e,t)},Ct.prototype.set=function(t,e){return this.__data__[t]=vt&&void 0===e?n:e,this},xt.prototype.clear=function(){this.__data__=[]},xt.prototype.delete=function(t){var e=this.__data__,n=At(e,t);return!(n<0)&&(n==e.length-1?e.pop():ut.call(e,n,1),!0)},xt.prototype.get=function(t){var e=this.__data__,n=At(e,t);return n<0?void 0:e[n][1]},xt.prototype.has=function(t){return At(this.__data__,t)>-1},xt.prototype.set=function(t,e){var n=this.__data__,r=At(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},_t.prototype.clear=function(){this.__data__={hash:new Ct,map:new(ht||xt),string:new Ct}},_t.prototype.delete=function(t){return Bt(this,t).delete(t)},_t.prototype.get=function(t){return Bt(this,t).get(t)},_t.prototype.has=function(t){return Bt(this,t).has(t)},_t.prototype.set=function(t,e){return Bt(this,t).set(t,e),this},Pt.prototype.clear=function(){this.__data__=new xt},Pt.prototype.delete=function(t){return this.__data__.delete(t)},Pt.prototype.get=function(t){return this.__data__.get(t)},Pt.prototype.has=function(t){return this.__data__.has(t)},Pt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof xt){var r=n.__data__;if(!ht||r.length<199)return r.push([t,e]),this;n=this.__data__=new _t(r)}return n.set(t,e),this};var Ft=ct?q(ct,Object):function(){return[]},Vt=function(t){return tt.call(t)};function Wt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||A.test(t))&&t>-1&&t%1==0&&t<e}function $t(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||K)}function Lt(t){if(null!=t){try{return Y.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Ut(t,e){return t===e||t!=t&&e!=e}(pt&&Vt(new pt(new ArrayBuffer(1)))!=T||ht&&Vt(new ht)!=c||gt&&Vt(gt.resolve())!=p||dt&&Vt(new dt)!=g||mt&&Vt(new mt)!=v)&&(Vt=function(t){var e=tt.call(t),n=e==f?t.constructor:void 0,r=n?Lt(n):void 0;if(r)switch(r){case kt:return T;case Tt:return c;case yt:return p;case bt:return g;case It:return v}return e});var qt=Array.isArray;function zt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!Gt(t)}var Qt=lt||function(){return!1};function Gt(t){var e=Jt(t)?tt.call(t):"";return e==a||e==u}function Jt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Kt(t){return zt(t)?Et(t):function(t){if(!$t(t))return ft(t);var e=[];for(var n in Object(t))Z.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return Nt(t,!0,!0)}}(tn,tn.exports);var en=tn.exports;function nn(t,e,n,r,i){for(var o=i+1;r<=i;){var s=r+i>>>1,a=t[s];(void 0!==n?n(a,e):a-e)>=0?(o=s,i=s-1):r=s+1}return o}function rn(t,e,n,r,i){for(var o=r-1;r<=i;){var s=r+i>>>1,a=t[s];(void 0!==n?n(a,e):a-e)<0?(o=s,r=s+1):i=s-1}return o}function on(t,e,n,r,i){for(var o=r-1;r<=i;){var s=r+i>>>1,a=t[s];(void 0!==n?n(a,e):a-e)<=0?(o=s,r=s+1):i=s-1}return o}function sn(t,e,n,r,i,o){return"function"==typeof n?o(t,e,n,void 0===r?0:0|r,void 0===i?t.length-1:0|i):o(t,e,void 0,void 0===n?0:0|n,void 0===r?t.length-1:0|r)}var an=function(t,e,n,r,i){return sn(t,e,n,r,i,nn)},un=function(t,e,n,r,i){return sn(t,e,n,r,i,rn)},cn=function(t,e,n,r,i){return sn(t,e,n,r,i,on)};class ln{ticks;bpm;time;constructor({ticks:t,bpm:e,time:n}){this.ticks=t,this.bpm=e,this.time=n}getTicks(){return this.ticks}getBpm(){return this.bpm}setBpmInternal(t){this.bpm=t}getTime(){return this.time}setTimeInternal(t){this.time=t}}class fn{ticks;numerator;denominator;constructor({ticks:t,numerator:e,denominator:n}){this.ticks=t,this.numerator=e,this.denominator=n}getTicks(){return this.ticks}setTicks(t){this.ticks=t}getNumerator(){return this.numerator}setNumerator(t){this.numerator=t}getDenominator(){return this.denominator}setDenominator(t){this.denominator=t}}const pn=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,hn={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};function gn(t,e,n,r){return`${t} // ${e} // ${n} // ${r}`}function dn(t,e,n){return`${t} // ${e} // ${n}`}function mn(t){const e=t.split(" // ");if(e.length<4)throw new Error("Invalid audio plugin tuneflow id.");return{name:e[2],manufacturerName:e[0],pluginFormatName:e[1],pluginVersion:e[3]}}function vn(t,e){return t===e}function kn(t,e){const n=mn(t),r=mn(e);if(He.keys(n).length!==He.keys(r).length)return!1;for(const i of He.keys(n))if("pluginVersion"!==i&&n[i]!==r[i])return!1;return!0}class Tn{name;manufacturerName;pluginFormatName;pluginVersion;isEnabled=!0;localInstanceIdInternal;base64StatesInternal;constructor(t,e,n,r){this.name=t,this.manufacturerName=e,this.pluginFormatName=n,this.pluginVersion=r}getTuneflowId(){return gn(this.manufacturerName,this.pluginFormatName,this.name,this.pluginVersion)}clone(t){const e=t.createAudioPlugin(this.getTuneflowId());return e.setIsEnabled(this.isEnabled),e}matchesTfId(t){return vn(t,this.getTuneflowId())}matchesTfIdIgnoreVersion(t){return kn(t,this.getTuneflowId())}toJSON(){return{name:this.name,manufacturerName:this.manufacturerName,pluginFormatName:this.pluginFormatName,pluginVersion:this.pluginVersion,isEnabled:this.isEnabled}}setIsEnabled(t){this.isEnabled=t}getIsEnabled(){return this.isEnabled}}class yn{pitch;velocity;startTick;endTick;idInternal;constructor({pitch:t,velocity:e,startTick:n,endTick:r,id:i}){this.pitch=t,this.velocity=e,this.startTick=n,this.endTick=r,this.idInternal=i}getPitch(){return this.pitch}setPitch(t){if(!yn.isValidPitch(t))throw new Error(`Invalid pitch ${t}`);this.pitch=t}static isValidPitch(t){return t>=0&&t<=127}getVelocity(){return this.velocity}getStartTick(){return this.startTick}getEndTick(){return this.endTick}setStartTick(t){this.startTick=t}setEndTick(t){this.endTick=t}equals(t){return this.startTick===t.getStartTick()&&this.endTick===t.getEndTick()&&this.pitch===t.getPitch()&&this.velocity===t.getVelocity()}}class bn{track;id;notes;clipStartTick=0;clipEndTick=0;nextNoteIdInternal=1;constructor({track:t,id:e=bn.generateClipIdInternal(),clipStartTick:n=0,clipEndTick:r=0}){this.track=t,this.id=e,this.notes=[],this.clipStartTick=n,this.clipEndTick=r}getId(){return this.id}getNotes(){return bn.getNotesInRange(this.notes,this.clipStartTick,this.clipEndTick)}getRawNotes(){return this.notes}getClipStartTick(){return this.clipStartTick}getClipEndTick(){return this.clipEndTick}getTrack(){return this.track}createNote({pitch:t,velocity:e,startTick:n,endTick:r,updateClipRange:i=!0,resolveClipConflict:o=!0}){const s=new yn({pitch:t,velocity:e,startTick:n,endTick:r,id:this.getNextNoteIdInternal()});return n<this.clipStartTick&&i&&this.adjustClipLeft(n,o),r>this.clipEndTick&&i&&this.adjustClipRight(r,o),this.orderedInsertNote(this.notes,s),s}deleteNote(t){const e=un(this.notes,t,((t,e)=>t.getStartTick()-e.getStartTick()));for(let n=Math.max(0,e);n<this.notes.length;n+=1){const e=this.notes[n];if(e&&e===t)return void this.notes.splice(n,1);if(e&&e.getStartTick()>t.getStartTick())return}}deleteNoteAt(t){this.notes.splice(t,1)}orderedInsertNote(t,e){const n=an(t,e,((t,e)=>t.getStartTick()-e.getStartTick()));n<0?t.push(e):t.splice(n,0,e)}adjustClipLeft(t,e=!0){(t=Math.max(0,t))>this.clipEndTick?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),Math.min(this.clipStartTick,t),this.clipEndTick),this.clipStartTick=t)}adjustClipRight(t,e=!0){t<this.clipStartTick||t<0?this.deleteFromParent():(e&&this.track&&this.track.resolveClipConflictInternal(this.getId(),this.clipStartTick,Math.max(this.clipEndTick,t)),this.clipEndTick=t)}moveClip(t){const e=Math.max(0,this.clipStartTick+t),n=this.clipEndTick+t;if(n<0)this.deleteFromParent();else{if(this.track&&this.track.resolveClipConflictInternal(this.getId(),e,n),this.track){const t=this.track.getClipIndex(this);this.track.deleteClipAt(t)}this.clipStartTick=e,this.clipEndTick=n;for(const e of this.notes)e.setStartTick(e.getStartTick()+t),e.setEndTick(e.getEndTick()+t);this.track&&this.track.orderedInsertClipInternal(this)}}moveClipTo(t){const e=t-this.getClipStartTick();this.moveClip(e)}deleteFromParent(){this.track&&(this.track.deleteClip(this),this.track=void 0)}static getNotesInRange(t,e,n){const r=un(t,{getStartTick:()=>e},((t,e)=>t.getStartTick()-e.getStartTick())),i=[];for(let o=Math.max(r,0);o<t.length;o+=1){const r=t[o];if(r.getStartTick()>n)break;bn.isNoteInClip(r.getStartTick(),r.getEndTick(),e,n)&&i.push(r)}return i}static isNoteInClip(t,e,n,r){return t>=n&&t<=r&&e>=t}static getNotePlayableRange(t,e,n,r){if(!bn.isNoteInClip(t,e,n,r))return null;const i=Math.max(t,n),o=Math.min(e,r);return i>o?null:{startTick:i,endTick:o}}trimConflictPartInternal(t,e){const n=Math.max(t,this.getClipStartTick()),r=Math.min(e,this.getClipEndTick());if(!(n>r||n>this.getClipEndTick()||r<this.getClipStartTick()))if(r>=this.getClipEndTick()&&n<=this.getClipStartTick())this.deleteFromParent();else if(r<this.getClipEndTick()&&n>this.getClipStartTick()){const t=r+1,e=this.getClipEndTick();if(this.adjustClipRight(n-1,!1),this.track){const n=this.track.createClip({clipStartTick:t,clipEndTick:e}),r=bn.getNotesInRange(this.notes,t,e);for(const t of r)n.createNote({pitch:t.getPitch(),velocity:t.getVelocity(),startTick:t.getStartTick(),endTick:t.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}}else n>this.getClipStartTick()&&n<=this.getClipEndTick()?this.adjustClipRight(n-1,!1):r<this.getClipEndTick()&&r>=this.getClipStartTick()&&this.adjustClipLeft(r+1,!1)}getNextNoteIdInternal(){const t=this.nextNoteIdInternal;return this.nextNoteIdInternal>=2147483647?this.nextNoteIdInternal=1:this.nextNoteIdInternal+=1,t}static generateClipIdInternal(){return Xe(10)}}class In{insturment;clips;suggestedInstruments;uuid;volume;solo;muted;rank;samplerPlugin;audioPlugins=[];song;constructor({song:t,uuid:e=In.generateTrackIdInternal(),clips:n=[],instrument:r=new Sn({program:0,isDrum:!1}),suggestedInstruments:i=[],volume:o=1,solo:s=!1,muted:a=!1,rank:u=0}){this.song=t,this.insturment=r,this.clips=[...n],this.suggestedInstruments=[...i],this.uuid=e,this.volume=o,this.solo=s,this.muted=a,this.rank=u}getInstrument(){return this.insturment}setInstrument({program:t,isDrum:e}){this.insturment=new Sn({program:t,isDrum:e})}getSuggestedInstruments(){return this.suggestedInstruments}createSuggestedInstrument({program:t,isDrum:e}){const n=new Sn({program:t,isDrum:e});return this.suggestedInstruments.push(n),n}clearSuggestedInstruments(){this.suggestedInstruments=[]}getId(){return this.uuid}setId(t){this.uuid=t}getVolume(){return this.volume}setVolume(t){this.volume=t}getSolo(){return this.solo}setSolo(t){this.solo=t}getMuted(){return this.muted}setMuted(t){this.muted=t}getRank(){return this.rank}createAudioPlugin(t){const e=mn(t),n=new Tn(e.name,e.manufacturerName,e.pluginFormatName,e.pluginVersion);return n.localInstanceIdInternal=Xe(10),n}getSamplerPlugin(){return this.samplerPlugin}setSamplerPlugin(t){this.samplerPlugin=t}getAudioPlugins(){return this.audioPlugins}addAudioPlugin(t){this.audioPlugins.push(t)}getTrackStartTick(){return this.clips&&0!==this.clips.length?this.clips[0].getClipStartTick():0}getTrackEndTick(){return this.clips&&0!==this.clips.length?this.clips[this.clips.length-1].getClipEndTick():0}getClipById(t){for(const e of this.clips)if(e.getId()===t)return e;return null}getClips(){return this.clips}getClipsOverlappingWith(t,e){const n=[],r=un(this.clips,{getClipStartTick:()=>t},((t,e)=>t.getClipStartTick()-e.getClipStartTick()));for(let i=Math.max(r,0);i<this.clips.length;i+=1){const r=this.clips[i];if(!(r.getClipEndTick()<t)){if(r.getClipStartTick()>e)break;n.push(r)}}return n}createClip({clipStartTick:t,clipEndTick:e,insertClip:n=!0}){if(null==t)throw new Error("clipStartTick must be specified when creating a clip.");const r=null==e?t+1:e;if(r<t)throw new Error(`clipEndTick must be greater or equal to clipStartTick, got clipStartTick: ${t}, clipEndTick: ${e}`);const i=new bn({id:bn.generateClipIdInternal(),track:void 0,clipStartTick:t,clipEndTick:r});return n&&this.insertClip(i),i}insertClip(t){t.getTrack()!==this&&(t.getTrack()&&t.deleteFromParent(),t.track=this,this.resolveClipConflictInternal(t.getId(),t.getClipStartTick(),t.getClipEndTick()),this.orderedInsertClipInternal(t))}cloneClip(t){const e=this.createClip({clipStartTick:t.getClipStartTick(),clipEndTick:t.getClipEndTick(),insertClip:!1});for(const n of t.getRawNotes())e.createNote({pitch:n.getPitch(),velocity:n.getVelocity(),startTick:n.getStartTick(),endTick:n.getEndTick(),updateClipRange:!1,resolveClipConflict:!1});return e}getClipIndex(t){const e=cn(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));return this.clips.indexOf(t,e)}deleteClip(t){const e=this.getClipIndex(t);this.deleteClipAt(e)}deleteClipAt(t){t<0||this.clips.splice(t,1)}deleteFromParent(){this.song.removeTrack(this.getId())}static generateTrackIdInternal(){return Xe()}resolveClipConflictInternal(t,e,n){const r=this.getClipsOverlappingWith(e,n);for(const i of r)i.getId()!==t&&i.trimConflictPartInternal(e,n)}orderedInsertClipInternal(t){const e=an(this.clips,t,((t,e)=>t.getClipStartTick()-e.getClipStartTick()));this.clips.splice(e,0,t)}}class Sn{program;isDrum;constructor({program:t,isDrum:e}){this.program=t,this.isDrum=e}getProgram(){return this.program}getIsDrum(){return this.isDrum}clone(){return new Sn({program:this.program,isDrum:this.isDrum})}}class wn{tracks;PPQ;tempos;timeSignatures;pluginContext;nextTrackRank=1;constructor(){this.tracks=[],this.PPQ=0,this.tempos=[],this.timeSignatures=[]}getTracks(){return this.tracks}getTrackById(t){return de(this.tracks,(e=>e.getId()===t))}getTrackIndex(t){return ce(this.tracks,(e=>e.getId()===t))}createTrack({index:t,rank:e}){this.checkAccess("createTrack"),null==e||null===e?e=this.getNextTrackRank():this.nextTrackRank=Math.max(e+1,this.nextTrackRank);const n=new In({song:this,uuid:this.getNextTrackId(),rank:null==e||null===e?this.getNextTrackRank():e});return null!=t?this.tracks.splice(t,0,n):this.tracks.push(n),n}cloneTrack(t){let e=this.getTrackIndex(t.getId());e<0&&(e=void 0);const n=this.createTrack({index:e});n.setInstrument({program:t.getInstrument().getProgram(),isDrum:t.getInstrument().getIsDrum()});for(const i of t.getSuggestedInstruments())n.createSuggestedInstrument({program:i.getProgram(),isDrum:i.getIsDrum()});n.setVolume(t.getVolume()),n.setSolo(t.getSolo()),n.setMuted(t.getMuted());const r=t.getSamplerPlugin();r&&n.setSamplerPlugin(r.clone(n));for(const i of t.getAudioPlugins())n.addAudioPlugin(i.clone(n));for(const i of t.getClips()){const t=n.createClip({clipStartTick:i.getClipStartTick(),clipEndTick:i.getClipEndTick()});for(const e of i.getRawNotes())t.createNote({pitch:e.getPitch(),velocity:e.getVelocity(),startTick:e.getStartTick(),endTick:e.getEndTick(),updateClipRange:!1,resolveClipConflict:!1})}return n}removeTrack(t){this.checkAccess("removeTrack");const e=this.getTrackById(t);return e?(this.tracks.splice(ce(this.tracks,(e=>e.getId()===t)),1),e):null}getResolution(){return this.PPQ}setResolution(t){this.PPQ=t}getTempoChanges(){return this.tempos}createTempoChange({ticks:t,bpm:e}){if(0===this.tempos.length&&0!==t)throw new Error("The first tempo event must be at tick 0");const n=new ln({ticks:t,bpm:e,time:this.tickToSeconds(t)}),r=an(this.tempos,n,((t,e)=>t.getTicks()-e.getTicks()));return r<0?this.tempos.push(n):this.tempos.splice(r,0,n),this.retimingTempoEvents(),n}overwriteTempoChanges(t){if(0===t.length)throw new Error("Cannot clear all the tempo events.");const e=en(t);e.sort(((t,e)=>t.getTicks()-e.getTicks()));const n=e[0];if(n.getTicks()>0)throw new Error("The first tempo event needs to start from tick 0");this.tempos=[new ln({ticks:0,time:0,bpm:n.getBpm()})];for(let r=1;r<e.length;r+=1){const t=e[r];this.createTempoChange({ticks:t.getTicks(),bpm:t.getBpm()})}}overwriteTimeSignatures(t){this.timeSignatures=en(t)}updateTempo(t,e){t.setBpmInternal(e),this.retimingTempoEvents()}getTimeSignatures(){return this.timeSignatures}createTimeSignature({ticks:t,numerator:e,denominator:n}){const r=new fn({ticks:t,numerator:e,denominator:n}),i=an(this.timeSignatures,r,((t,e)=>t.getTicks()-e.getTicks()));return i<0?this.timeSignatures.push(r):this.timeSignatures.splice(i,0,r),r}getLastTick(){let t=0;for(const e of this.tracks)t=Math.max(t,e.getTrackEndTick());return t}getDuration(){return this.tickToSeconds(this.getLastTick())}tickToSeconds(t){if(0===t)return 0;const e=un(this.getTempoChanges(),{getTicks:()=>t},((t,e)=>t.getTicks()-e.getTicks()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTicks(),i=wn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return n.getTime()+r/i}secondsToTick(t){const e=un(this.getTempoChanges(),{getTime:()=>t},((t,e)=>t.getTime()-e.getTime()));if(-1==e)return-1;const n=this.getTempoChanges()[e],r=t-n.getTime(),i=wn.tempoBPMToTicksPerSecond(n.getBpm(),this.getResolution());return Math.round(n.getTicks()+r*i)}setPluginContextInternal(t){this.pluginContext={plugin:t,numTracksCreatedByPlugin:0}}getNextTrackId(){const t=this.pluginContext,e=t.plugin.generatedTrackIdsInternal;if(t.numTracksCreatedByPlugin===e.length)e.push(In.generateTrackIdInternal());else if(t.numTracksCreatedByPlugin>e.length)throw new Error("Plugin generated track ids out of sync.");const n=e[t.numTracksCreatedByPlugin];return t.numTracksCreatedByPlugin+=1,n}getNextTrackRank(){const t=this.nextTrackRank;return this.nextTrackRank+=1,t}checkAccess(t){if(!this.pluginContext)throw new Error("Song needs to be accessed in a plugin context in order to use privileged methods.");if(!this.pluginContext.plugin.songAccess()[t])throw new Error(`Plugin ${this.pluginContext.plugin.constructor.id()} requires access ${t} in order to run.`)}static tempoBPMToTicksPerSecond(t,e){return t*e/60}retimingTempoEvents(){this.tempos.sort(((t,e)=>t.getTicks()-e.getTicks()));for(const t of this.tempos)t.setTimeInternal(this.tickToSeconds(t.getTicks()))}}var Cn,xn;exports.WidgetType=void 0,(Cn=exports.WidgetType||(exports.WidgetType={}))[Cn.Slider=1]="Slider",Cn[Cn.Input=2]="Input",Cn[Cn.TrackSelector=3]="TrackSelector",Cn[Cn.Pitch=4]="Pitch",Cn[Cn.TrackPitchSelector=5]="TrackPitchSelector",Cn[Cn.InstrumentSelector=6]="InstrumentSelector",Cn[Cn.Select=7]="Select",Cn[Cn.Switch=8]="Switch",Cn[Cn.InputNumber=9]="InputNumber",Cn[Cn.MultiTrackSelector=10]="MultiTrackSelector",Cn[Cn.None=11]="None",Cn[Cn.FileSelector=12]="FileSelector",exports.InjectSource=void 0,(xn=exports.InjectSource||(exports.InjectSource={}))[xn.SelectedTrackIds=1]="SelectedTrackIds",xn[xn.SelectedClipInfos=2]="SelectedClipInfos",xn[xn.TickAtPlayhead=3]="TickAtPlayhead",exports.AudioPlugin=Tn,exports.Clip=bn,exports.Note=yn,exports.Song=wn,exports.TempoEvent=ln,exports.TimeSignatureEvent=fn,exports.Track=In,exports.TuneflowPipeline=class{plugins=[];threwErrorInLastRun=!1;songCache={};addPlugin(t){this.plugins.push(t)}addPluginAt(t,e){this.plugins.splice(e,0,t)}removePlugin(t){this.plugins.splice(this.plugins.indexOf(t),1)}getPlugins(){return this.plugins}resetCache(){this.songCache={}}async run(t,e=0){e=Math.max(0,e),this.threwErrorInLastRun=!1;const n=en(t),r=this.getIndexOfLatestPluginWithCacheBeforeIndex(e);r>=0&&It(t,en(this.songCache[this.plugins[r].instanceId]));for(let s=e;s<this.plugins.length;s+=1)delete this.songCache[this.plugins[s].instanceId];let i=0;for(let s=0;s<this.plugins.length;s+=1){const e=this.plugins[s];if(!e.enabledInternal)return!0;if(this.songCache[e.instanceId])e.isRollbackable=!0;else{if(t.setPluginContextInternal(e),!e.hasAllParamsSet())return!0;try{await e.run(t,e.getParamsInternal())}catch(o){this.threwErrorInLastRun=!0;const e=this.getIndexOfLatestPluginWithCacheBeforeIndex(s);return It(t,e>=0?en(this.songCache[this.plugins[e].instanceId]):n),!1}this.songCache[e.instanceId]=en(t),e.isRollbackable=!0,i+=1}}return!0}reset(){for(const t of this.plugins)t.resetInternal()}clear(){this.plugins.splice(0,this.plugins.length)}movePluginUp(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<=0||this.plugins.splice(e-1,0,this.plugins.splice(e,1)[0])}movePluginDown(t){const e=this.getPluginIndexByPluginInstanceId(t.instanceId);e<0||e>=this.plugins.length-1||this.plugins.splice(e,0,this.plugins.splice(e+1,1)[0])}isPluginFunctioning(t){return!!this.songCache[t.instanceId]}getPluginIndexByPluginInstanceId(t){return ce(this.plugins,(e=>e.instanceId===t))}getThrewErrorInLastRun(){return this.threwErrorInLastRun}getLastFunctioningPlugin(){for(let t=this.plugins.length-1;t>=0;t-=1)if(this.isPluginFunctioning(this.plugins[t]))return this.plugins[t];return null}getPluginCache(t){return this.songCache[t.instanceId]}getIndexOfLatestPluginWithCacheBeforeIndex(t){for(let e=t-1;e>=0;e-=1)if(this.songCache[this.plugins[e].instanceId])return e;return-1}},exports.TuneflowPlugin=Ye,exports.areTuneflowIdsEqual=vn,exports.areTuneflowIdsEqualIgnoreVersion=kn,exports.decodeAudioPluginTuneflowId=mn,exports.getAudioPluginTuneflowId=gn,exports.getAudioPluginVersionlessTuneflowId=dn,exports.midiNumberToPitch=function(t){const e=Math.floor(t/12)-1;return function(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}(t)+e.toString()},exports.pitchToMidiNumber=function(t){const e=pn.exec(t);if(!e)return-1;const n=e[1],r=e[2];return hn[n.toLowerCase()]+12*(parseInt(r,10)+1)},exports.toVersionlessTfId=function(t){const e=mn(t);return dn(e.manufacturerName,e.pluginFormatName,e.name)};
